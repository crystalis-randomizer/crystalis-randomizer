export class Evaluator {
    constructor(env) {
        this.env = env;
        this.functions = new Map([
            ['.min', Math.min],
            ['.max', Math.max],
            ['.byteat', (addr) => this.byteAt(addr)],
            ['.wordat', (addr) => this.byteAt(addr) | this.byteAt(addr + 1) << 8],
        ]);
        this.prefix = new Map([
            ['+', x => x],
            ['-', x => -x],
            ['~', x => ~x],
            ['!', x => Number(!x)],
            ['<', x => x & 0xff],
            ['>', x => x >> 8 & 0xff],
        ]);
        this.infix = new Map([
            ['+', (a, b) => a + b],
            ['-', (a, b) => a - b],
            ['*', (a, b) => a * b],
            ['/', (a, b) => Math.floor(a / b)],
            ['.mod', (a, b) => a % b],
            ['<<', (a, b) => a << b],
            ['>>', (a, b) => a >>> b],
            ['&', (a, b) => a & b],
            ['|', (a, b) => a | b],
            ['^', (a, b) => a ^ b],
            ['&&', (a, b) => a && b],
            ['||', (a, b) => a || b],
            ['.xor', (a, b) => Number(!a && b || !b && a)],
            ['<', (a, b) => Number(a < b)],
            ['<=', (a, b) => Number(a <= b)],
            ['>', (a, b) => Number(a > b)],
            ['>=', (a, b) => Number(a >= b)],
            ['=', (a, b) => Number(a === b)],
            ['<>', (a, b) => Number(a !== b)],
        ]);
    }
    definedSymbol(name) {
        throw new Error(`unimplemented`);
    }
    referencedSymbol(name) {
        throw new Error(`unimplemented`);
    }
    evaluate(expr) {
        throw new Error(`unimplemented`);
    }
    simplify(expr) {
        var _a;
        const args = expr.args;
        if (!args)
            return expr;
        let nums = [];
        for (let i = 0; i < args.length; i++) {
            args[i] = this.simplify(args[i]);
            if (args[i].op === 'num' && nums) {
                nums[i] = args[i].num;
            }
            else {
                nums = undefined;
            }
        }
        const f = (_a = this.functions.get(expr.op)) !== null && _a !== void 0 ? _a : (args.length === 1 ?
            this.prefix.get(expr.op) :
            this.infix.get(expr.op));
        if (!f || !nums)
            return { op: expr.op, args };
        const result = f(...nums);
        return { op: 'num', num: result };
    }
    byteAt(addr) {
        throw new Error(`not implemented`);
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZXZhbHVhdG9yLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vc3JjL2pzL2FzbS9ldmFsdWF0b3IudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBTUEsTUFBTSxPQUFPLFNBQVM7SUFFcEIsWUFBcUIsR0FBZ0I7UUFBaEIsUUFBRyxHQUFILEdBQUcsQ0FBYTtRQXdDcEIsY0FBUyxHQUEwQixJQUFJLEdBQUcsQ0FBQztZQUMxRCxDQUFDLE1BQU0sRUFBRSxJQUFJLENBQUMsR0FBRyxDQUFDO1lBQ2xCLENBQUMsTUFBTSxFQUFFLElBQUksQ0FBQyxHQUFHLENBQUM7WUFDbEIsQ0FBQyxTQUFTLEVBQUUsQ0FBQyxJQUFJLEVBQUUsRUFBRSxDQUFDLElBQUksQ0FBQyxNQUFNLENBQUMsSUFBSSxDQUFDLENBQUM7WUFDeEMsQ0FBQyxTQUFTLEVBQUUsQ0FBQyxJQUFJLEVBQUUsRUFBRSxDQUFDLElBQUksQ0FBQyxNQUFNLENBQUMsSUFBSSxDQUFDLEdBQUcsSUFBSSxDQUFDLE1BQU0sQ0FBQyxJQUFJLEdBQUcsQ0FBQyxDQUFDLElBQUksQ0FBQyxDQUFDO1NBQ3RFLENBQUMsQ0FBQztRQUVjLFdBQU0sR0FBdUMsSUFBSSxHQUFHLENBQUM7WUFDcEUsQ0FBQyxHQUFHLEVBQUUsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUM7WUFDYixDQUFDLEdBQUcsRUFBRSxDQUFDLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQyxDQUFDO1lBQ2QsQ0FBQyxHQUFHLEVBQUUsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUMsQ0FBQztZQUNkLENBQUMsR0FBRyxFQUFFLENBQUMsQ0FBQyxFQUFFLENBQUMsTUFBTSxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUM7WUFDdEIsQ0FBQyxHQUFHLEVBQUUsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDLEdBQUcsSUFBSSxDQUFDO1lBQ3BCLENBQUMsR0FBRyxFQUFFLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxJQUFJLENBQUMsR0FBRyxJQUFJLENBQUM7U0FFMUIsQ0FBQyxDQUFDO1FBRWMsVUFBSyxHQUF1QixJQUFJLEdBQUcsQ0FBQztZQUNuRCxDQUFDLEdBQUcsRUFBRSxDQUFDLENBQUMsRUFBRSxDQUFDLEVBQUUsRUFBRSxDQUFDLENBQUMsR0FBRyxDQUFDLENBQUM7WUFDdEIsQ0FBQyxHQUFHLEVBQUUsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxFQUFFLEVBQUUsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxDQUFDO1lBQ3RCLENBQUMsR0FBRyxFQUFFLENBQUMsQ0FBQyxFQUFFLENBQUMsRUFBRSxFQUFFLENBQUMsQ0FBQyxHQUFHLENBQUMsQ0FBQztZQUN0QixDQUFDLEdBQUcsRUFBRSxDQUFDLENBQUMsRUFBRSxDQUFDLEVBQUUsRUFBRSxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDO1lBQ2xDLENBQUMsTUFBTSxFQUFFLENBQUMsQ0FBQyxFQUFFLENBQUMsRUFBRSxFQUFFLENBQUMsQ0FBQyxHQUFHLENBQUMsQ0FBQztZQUN6QixDQUFDLElBQUksRUFBRSxDQUFDLENBQUMsRUFBRSxDQUFDLEVBQUUsRUFBRSxDQUFDLENBQUMsSUFBSSxDQUFDLENBQUM7WUFDeEIsQ0FBQyxJQUFJLEVBQUUsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxFQUFFLEVBQUUsQ0FBQyxDQUFDLEtBQUssQ0FBQyxDQUFDO1lBQ3pCLENBQUMsR0FBRyxFQUFFLENBQUMsQ0FBQyxFQUFFLENBQUMsRUFBRSxFQUFFLENBQUMsQ0FBQyxHQUFHLENBQUMsQ0FBQztZQUN0QixDQUFDLEdBQUcsRUFBRSxDQUFDLENBQUMsRUFBRSxDQUFDLEVBQUUsRUFBRSxDQUFDLENBQUMsR0FBRyxDQUFDLENBQUM7WUFDdEIsQ0FBQyxHQUFHLEVBQUUsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxFQUFFLEVBQUUsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxDQUFDO1lBQ3RCLENBQUMsSUFBSSxFQUFFLENBQUMsQ0FBQyxFQUFFLENBQUMs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QUFDLEVBQUUsRUFBRSxJQUFJLENBQUMsRUFBRSxFQUFFLElBQUksRUFBQyxDQUFDO1FBQzVDLE1BQU0sTUFBTSxHQUFHLENBQUMsQ0FBQyxHQUFHLElBQUksQ0FBQyxDQUFDO1FBQzFCLE9BQU8sRUFBQyxFQUFFLEVBQUUsS0FBSyxFQUFFLEdBQUcsRUFBRSxNQUFNLEVBQUMsQ0FBQztJQUNsQyxDQUFDO0lBRU8sTUFBTSxDQUFDLElBQVk7UUFDekIsTUFBTSxJQUFJLEtBQUssQ0FBQyxpQkFBaUIsQ0FBQyxDQUFDO0lBQ3JDLENBQUM7Q0F3Q0YiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQge0V4cHJ9IGZyb20gJy4vZXhwci5qcyc7XG5cbmludGVyZmFjZSBFbnZpcm9ubWVudCB7XG4gIHBjKCk6IG51bWJlcnx1bmRlZmluZWQ7IC8vID8/PyAtIHVuZGVmIGluIGEgcmVsb2MgY29udGV4dCBvdXRzaWRlIGxpbmtlclxufVxuXG5leHBvcnQgY2xhc3MgRXZhbHVhdG9yIHtcblxuICBjb25zdHJ1Y3RvcihyZWFkb25seSBlbnY6IEVudmlyb25tZW50KSB7fVxuXG4gIGRlZmluZWRTeW1ib2wobmFtZTogc3RyaW5nKTogYm9vbGVhbiB7XG4gICAgdGhyb3cgbmV3IEVycm9yKGB1bmltcGxlbWVudGVkYCk7XG4gIH1cblxuICByZWZlcmVuY2VkU3ltYm9sKG5hbWU6IHN0cmluZyk6IGJvb2xlYW4ge1xuICAgIHRocm93IG5ldyBFcnJvcihgdW5pbXBsZW1lbnRlZGApO1xuICB9XG5cbiAgZXZhbHVhdGUoZXhwcjogRXhwcik6IG51bWJlciB7XG4gICAgdGhyb3cgbmV3IEVycm9yKGB1bmltcGxlbWVudGVkYCk7XG4gIH1cblxuICBzaW1wbGlmeShleHByOiBFeHByKTogRXhwciB7XG4gICAgY29uc3QgYXJncyA9IGV4cHIuYXJncztcbiAgICBpZiAoIWFyZ3MpIHJldHVybiBleHByO1xuICAgIGxldCBudW1zOiBudW1iZXJbXXx1bmRlZmluZWQgPSBbXTtcbiAgICBmb3IgKGxldCBpID0gMDsgaSA8IGFyZ3MubGVuZ3RoOyBpKyspIHtcbiAgICAgIGFyZ3NbaV0gPSB0aGlzLnNpbXBsaWZ5KGFyZ3NbaV0pO1xuICAgICAgaWYgKGFyZ3NbaV0ub3AgPT09ICdudW0nICYmIG51bXMpIHtcbiAgICAgICAgbnVtc1tpXSA9IGFyZ3NbaV0ubnVtITtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIG51bXMgPSB1bmRlZmluZWQ7XG4gICAgICB9XG4gICAgfVxuICAgIGNvbnN0IGYgPVxuICAgICAgICB0aGlzLmZ1bmN0aW9ucy5nZXQoZXhwci5vcCkgPz9cbiAgICAgICAgKGFyZ3MubGVuZ3RoID09PSAxID9cbiAgICAgICAgICAgIHRoaXMucHJlZml4LmdldChleHByLm9wKSA6XG4gICAgICAgICAgICB0aGlzLmluZml4LmdldChleHByLm9wKSk7XG4gICAgaWYgKCFmIHx8ICFudW1zKSByZXR1cm4ge29wOiBleHByLm9wLCBhcmdzfTtcbiAgICBjb25zdCByZXN1bHQgPSBmKC4uLm51bXMpO1xuICAgIHJldHVybiB7b3A6ICdudW0nLCBudW06IHJlc3VsdH07XG4gIH1cblxuICBwcml2YXRlIGJ5dGVBdChhZGRyOiBudW1iZXIpOiBudW1iZXIge1xuICAgIHRocm93IG5ldyBFcnJvcihgbm90IGltcGxlbWVudGVkYCk7XG4gIH1cblxuICBwcml2YXRlIHJlYWRvbmx5IGZ1bmN0aW9uczogTWFwPHN0cmluZywgRnVuY1R5cGU+ID0gbmV3IE1hcChbXG4gICAgWycubWluJywgTWF0aC5taW5dLFxuICAgIFsnLm1heCcsIE1hdGgubWF4XSxcbiAgICBbJy5ieXRlYXQnLCAoYWRkcikgPT4gdGhpcy5ieXRlQXQoYWRkcildLFxuICAgIFsnLndvcmRhdCcsIChhZGRyKSA9PiB0aGlzLmJ5dGVBdChhZGRyKSB8IHRoaXMuYnl0ZUF0KGFkZHIgKyAxKSA8PCA4XSxcbiAgXSk7XG5cbiAgcHJpdmF0ZSByZWFkb25seSBwcmVmaXg6IE1hcDxzdHJpbmcsICh4OiBudW1iZXIpID0+IG51bWJlcj4gPSBuZXcgTWFwKFtcbiAgICBbJysnLCB4ID0+IHhdLFxuICAgIFsnLScsIHggPT4gLXhdLFxuICAgIFsnficsIHggPT4gfnhdLFxuICAgIFsnIScsIHggPT4gTnVtYmVyKCF4KV0sXG4gICAgWyc8JywgeCA9PiB4ICYgMHhmZl0sXG4gICAgWyc+JywgeCA9PiB4ID4+IDggJiAweGZmXSxcbiAgICAvLyBOT1RFOiAuYmFua2J5dGVzIG5vdCBzdXBwb3J0ZWQgeWV0Li4uXG4gIF0pO1xuXG4gIHByaXZhdGUgcmVhZG9ubHkgaW5maXg6IE1hcDxzdHJpbmcsIEJpbk9wPiA9IG5ldyBNYXAoW1xuICAgIFsnKycsIChhLCBiKSA9PiBhICsgYl0sXG4gICAgWyctJywgKGEsIGIpID0+IGEgLSBiXSxcbiAgICBbJyonLCAoYSwgYikgPT4gYSAqIGJdLFxuICAgIFsnLycsIChhLCBiKSA9PiBNYXRoLmZsb29yKGEgLyBiKV0sXG4gICAgWycubW9kJywgKGEsIGIpID0+IGEgJSBiXSxcbiAgICBbJzw8JywgKGEsIGIpID0+IGEgPDwgYl0sXG4gICAgWyc+PicsIChhLCBiKSA9PiBhID4+PiBiXSxcbiAgICBbJyYnLCAoYSwgYikgPT4gYSAmIGJdLFxuICAgIFsnfCcsIChhLCBiKSA9PiBhIHwgYl0sXG4gICAgWydeJywgKGEsIGIpID0+IGEgXiBiXSxcbiAgICBbJyYmJywgKGEsIGIpID0+IGEgJiYgYl0sXG4gICAgWyd8fCcsIChhLCBiKSA9PiBhIHx8IGJdLFxuICAgIFsnLnhvcicsIChhLCBiKSA9PiBOdW1iZXIoIWEgJiYgYiB8fCAhYiAmJiBhKV0sIC8vIGxvZ2ljYWwgeG9yXG4gICAgWyc8JywgKGEsIGIpID0+IE51bWJlcihhIDwgYildLCAvL1xuICAgIFsnPD0nLCAoYSwgYikgPT4gTnVtYmVyKGEgPD0gYildLFxuICAgIFsnPicsIChhLCBiKSA9PiBOdW1iZXIoYSA+IGIpXSxcbiAgICBbJz49JywgKGEsIGIpID0+IE51bWJlcihhID49IGIpXSxcbiAgICBbJz0nLCAoYSwgYikgPT4gTnVtYmVyKGEgPT09IGIpXSxcbiAgICBbJzw+JywgKGEsIGIpID0+IE51bWJlcihhICE9PSBiKV0sIC8vIFRPRE86ICE9ID9cbiAgXSk7XG59XG5cblxudHlwZSBCaW5PcCA9IChhOiBudW1iZXIsIGI6IG51bWJlcikgPT4gbnVtYmVyO1xudHlwZSBGdW5jVHlwZSA9ICguLi5hcmdzOiBudW1iZXJbXSkgPT4gbnVtYmVyXG4iXX0=