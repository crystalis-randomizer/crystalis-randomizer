import { Token } from './token.js';
export var Expr;
(function (Expr) {
    function traverse(expr, f) {
        function rec(e) {
            if (!e.args)
                return e;
            return { ...e, args: e.args.map(c => t(c, e)) };
        }
        ;
        function t(e, p) {
            const source = e.source;
            e = f(e, rec, p);
            if (source && !e.source)
                e.source = source;
            return e;
        }
        return t(expr);
    }
    Expr.traverse = traverse;
    function traversePost(expr, f) {
        return traverse(expr, (expr, rec) => f(rec(expr)));
    }
    Expr.traversePost = traversePost;
    function evaluate(expr) {
        var _a, _b, _c, _d;
        switch (expr.op) {
            case '.move':
            case 'im':
            case 'sym':
                return expr;
            case 'num':
                if (((_a = expr.meta) === null || _a === void 0 ? void 0 : _a.rel) && expr.meta.org != null) {
                    const { rel, ...meta } = expr.meta;
                    return { op: 'num', num: expr.num + meta.org, meta };
                }
                return expr;
            case '.max': return sameChunk(expr, Math.max);
            case '.min': return sameChunk(expr, Math.min);
            default:
        }
        if (((_b = expr.args) === null || _b === void 0 ? void 0 : _b.length) === 1) {
            switch (expr.op) {
                case '+': return expr.args[0];
                case '-': return unary(expr, x => -x);
                case '~': return unary(expr, x => ~x);
                case '!': return unary(expr, x => +!x);
                case '<': return unary(expr, x => x & 0xff);
                case '>': return unary(expr, x => (x >> 8) & 0xff);
                case '^': return (_d = num((_c = expr.args[0].meta) === null || _c === void 0 ? void 0 : _c.bank)) !== null && _d !== void 0 ? _d : expr;
                default: throw new Error(`Unknown unary operator: ${expr.op}`);
            }
        }
        switch (expr.op) {
            case '+': return plus(expr);
            case '-': return minus(expr);
            case '*': return binary(expr, (a, b) => a * b);
            case '/': return binary(expr, (a, b) => Math.floor(a / b));
            case '.mod': return binary(expr, (a, b) => a % b);
            case '&': return binary(expr, (a, b) => a & b);
            case '|': return binary(expr, (a, b) => a | b);
            case '^': return binary(expr, (a, b) => a ^ b);
            case '<<': return binary(expr, (a, b) => a << b);
            case '>>': return binary(expr, (a, b) => a >>> b);
            case '<': return binary(expr, (a, b) => +(a < b));
            case '<=': return binary(expr, (a, b) => +(a <= b));
            case '>': return binary(expr, (a, b) => +(a > b));
            case '>=': return binary(expr, (a, b) => +(a >= b));
            case '=': return binary(expr, (a, b) => +(a == b));
            case '<>': return binary(expr, (a, b) => +(a != b));
            case '&&': return binary(expr, (a, b) => a && b);
            case '||': return binary(expr, (a, b) => a || b);
            case '.xor': return binary(expr, (a, b) => !a && b || !b && a || 0);
            default: throw new Error(`Unknown operator: ${expr.op}`);
        }
    }
    Expr.evaluate = evaluate;
    function identifier(expr) {
        if (expr.op === 'sym' && expr.sym)
            return expr.sym;
        throw new Error(`Expected identifier but got op: ${expr.op}`);
    }
    Expr.identifier = identifier;
    function parseOnly(tokens, index = 0) {
        const [expr, i] = parse(tokens, index);
        if (i < tokens.length) {
            parse(tokens, index);
            throw new Error(`Garbage after expression: ${Token.nameAt(tokens[i])}`);
        }
        else if (!expr) {
            throw new Error(`No expression?`);
        }
        return expr;
    }
    Expr.parseOnly = parseOnly;
    function parse(tokens, index = 0) {
        const ops = [];
        const exprs = [];
        function popOp() {
            const [op, [, , arity]] = ops.pop();
            const args = exprs.splice(exprs.length - arity, arity);
            if (args.length !== arity)
                throw new Error('shunting parse failed?');
            exprs.push(fixSize({ op, args }));
        }
        let val = true;
        let i = index;
        for (; i < tokens.length; i++) {
            const front = tokens[i];
            if (val) {
                if (front.token === 'cs' || front.token === 'op') {
                    const mapped = NAME_MAP.get(front.str);
                    const prefix = PREFIXOPS.get(mapped !== null && mapped !== void 0 ? mapped : front.str);
                    if (prefix) {
                        ops.push([front.str, prefix]);
                    }
                    else if (front.token === 'cs') {
                        const op = front.str;
                        if (!FUNCTIONS.has(op)) {
                            throw new Error(`No such function: ${Token.nameAt(front)}`);
                        }
                        const next = tokens[i + 1];
                        if ((next === null || next === void 0 ? void 0 : next.token) !== 'lp') {
                            throw new Error(`Bad funcall: ${Token.nameAt(next !== null && next !== void 0 ? next : front)}`);
                        }
                        const close = Token.findBalanced(tokens, i + 1);
                        if (close < 0) {
                            throw new Error(`Never closed: ${Token.nameAt(next)}`);
                        }
                        const args = [];
                        for (const arg of Token.parseArgList(tokens, i + 2, close)) {
                            args.push(parseOnly(arg));
                        }
                        i = close;
                        exprs.push(fixSize({ op, args }));
                        val = false;
                    }
                    else if (Token.eq(front, Token.STAR)) {
                        exprs.push({ op: 'sym', sym: '*' });
                        val = false;
                    }
                    else {
                        throw new Error(`Unknown prefix operator: ${Token.nameAt(front)}`);
                    }
                }
                else if (front.token === 'lp') {
                    const close = Token.findBalanced(tokens, i);
                    if (close < 0) {
                        throw new Error(`No close paren: ${Token.nameAt(front)}`);
                    }
                    const e = parseOnly(tokens.slice(i + 1, close));
                    exprs.push(e);
                    i = close;
                    val = false;
                }
                else if (front.token === 'ident') {
                    exprs.push({ op: 'sym', sym: front.str });
                    val = false;
                }
                else if (front.token === 'num') {
                    const num = front.num;
                    exprs.push({ op: 'num', num, meta: size(num) });
                    val = false;
                }
                else {
                    throw new Error(`Bad expression token: ${Token.nameAt(front)}`);
                }
            }
            else {
                if (Token.eq(front, Token.COMMA)) {
                    break;
                }
                if (front.token === 'cs' || front.token === 'op') {
                    const mapped = NAME_MAP.get(front.str);
                    const op = BINOPS.get(mapped !== null && mapped !== void 0 ? mapped : front.str);
                    if (!op)
                        break;
                    while (ops.length) {
                        const top = ops[ops.length - 1];
                        const cmp = compareOp(top[1], op);
                        if (cmp < 0)
                            break;
                        if (cmp === 0) {
                            throw new Error(`Mixing ${top[0]} and ${front.str} needs explicit parens.${Token.at(front)}`);
                        }
                        popOp();
                    }
                    ops.push([front.str, op]);
                    val = true;
                }
                else {
                    break;
                }
            }
        }
        while (ops.length)
            popOp();
        if (exprs.length !== 1)
            throw new Error(`shunting parse failed?`);
        if (tokens[index].source)
            exprs[0].source = tokens[index].source;
        return [exprs[0], i];
    }
    Expr.parse = parse;
    function sameChunk(expr, f) {
        throw new Error();
    }
    function num(num) {
        if (num == null)
            return undefined;
        return { op: 'num', num, meta: size(num) };
    }
    function unary(expr, f) {
        const arg = expr.args[0];
        if (!isAbs(arg))
            return expr;
        const num = f(arg.num);
        return { op: 'num', num, meta: size(num) };
    }
    function binary(expr, f) {
        const [a, b] = expr.args;
        if (!isAbs(a) || !isAbs(b))
            return expr;
        const num = f(a.num, b.num);
        return { op: 'num', num, meta: size(num) };
    }
    function plus(expr) {
        var _a, _b, _c, _d, _e, _f;
        const [a, b] = expr.args;
        if (a.op !== 'num' || b.op !== 'num')
            return expr;
        const out = { op: 'num', num: a.num + b.num };
        if (a.meta || b.meta) {
            if (((_a = a.meta) === null || _a === void 0 ? void 0 : _a.rel) && ((_b = b.meta) === null || _b === void 0 ? void 0 : _b.rel))
                return expr;
            if ((_c = a.meta) === null || _c === void 0 ? void 0 : _c.rel) {
                out.meta = a.meta;
            }
            else if ((_d = b.meta) === null || _d === void 0 ? void 0 : _d.rel) {
                out.meta = b.meta;
            }
        }
        if (!((_e = out.meta) === null || _e === void 0 ? void 0 : _e.rel) && ((_f = out.meta) === null || _f === void 0 ? void 0 : _f.size) == null) {
            (out.meta || (out.meta = {})).size = size(out.num).size;
        }
        return out;
    }
    function minus(expr) {
        var _a, _b, _c, _d, _e;
        const [a, b] = expr.args;
        if (a.op !== 'num' || b.op !== 'num')
            return expr;
        const out = { op: 'num', num: a.num - b.num };
        if ((_a = b.meta) === null || _a === void 0 ? void 0 : _a.rel) {
            return ((_b = a.meta) === null || _b === void 0 ? void 0 : _b.rel) && a.meta.chunk === b.meta.chunk ? out : expr;
        }
        if ((_c = a.meta) === null || _c === void 0 ? void 0 : _c.rel)
            out.meta = a.meta;
        if (!((_d = out.meta) === null || _d === void 0 ? void 0 : _d.rel) && ((_e = out.meta) === null || _e === void 0 ? void 0 : _e.size) == null) {
            (out.meta || (out.meta = {})).size = size(out.num).size;
        }
        return out;
    }
    function isAbs(expr) {
        var _a;
        return expr.op === 'num' && !((_a = expr.meta) === null || _a === void 0 ? void 0 : _a.rel);
    }
})(Expr || (Expr = {}));
function compareOp(top, next) {
    if (top[0] > next[0])
        return 1;
    if (top[0] < next[0])
        return -1;
    if (top[1] !== next[1])
        return 0;
    return top[1];
}
const BINARY = 2;
const UNARY = 1;
export const BINOPS = new Map([
    ['*', [5, 4, BINARY]],
    ['/', [5, 4, BINARY]],
    ['.mod', [5, 3, BINARY]],
    ['&', [5, 2, BINARY]],
    ['^', [5, 1, BINARY]],
    ['<<', [5, 0, BINARY]],
    ['>>', [5, 0, BINARY]],
    ['+', [4, 2, BINARY]],
    ['-', [4, 2, BINARY]],
    ['|', [4, 1, BINARY]],
    ['<', [3, 0, BINARY]],
    ['<=', [3, 0, BINARY]],
    ['>', [3, 0, BINARY]],
    ['>=', [3, 0, BINARY]],
    ['=', [3, 0, BINARY]],
    ['<>', [3, 0, BINARY]],
    ['&&', [2, 3, BINARY]],
    ['.xor', [2, 2, BINARY]],
    ['||', [2, 1, BINARY]],
]);
const PREFIXOPS = new Map([
    ['+', [9, -1, UNARY]],
    ['-', [9, -1, UNARY]],
    ['~', [9, -1, UNARY]],
    ['<', [9, -1, UNARY]],
    ['>', [9, -1, UNARY]],
    ['^', [9, -1, UNARY]],
    ['!', [2, -1, UNARY]],
]);
const FUNCTIONS = new Set([
    '.byteat',
    '.wordat',
    '.max', '.min',
]);
const NAME_MAP = new Map([
    ['.bitand', '&'],
    ['.bitxor', '^'],
    ['.bitor', '|'],
    ['.shl', '<<'],
    ['.shr', '>>'],
    ['.and', '&&'],
    ['.or', '||'],
    ['.bitnot', '~'],
    ['.lobyte', '<'],
    ['.hibyte', '>'],
    ['.bankbyte', '^'],
    ['.not', '!'],
]);
const SIZE_TRANSFORMS = new Map([
    ['^', (...args) => args.length === 1 ? 1 : Math.max(...args)],
    ['<', () => 1],
    ['>', () => 1],
    ['!', () => 1],
    ['<=', () => 1],
    ['>=', () => 1],
    ['<>', () => 1],
    ['=', () => 1],
    ['&', Math.max],
    ['&&', Math.max],
    ['|', Math.max],
    ['||', Math.max],
    ['.xor', Math.max],
    ['.max', Math.max],
    ['.min', Math.max],
]);
function fixSize(expr) {
    const xform = SIZE_TRANSFORMS.get(expr.op);
    const size = xform === null || xform === void 0 ? void 0 : xform(...expr.args.map(e => { var _a; return Number((_a = e.meta) === null || _a === void 0 ? void 0 : _a.size); }));
    if (size)
        (expr.meta || (expr.meta = {})).size = size;
    return expr;
}
function size(num) {
    return { size: 0 <= num && num < 256 ? 1 : 2 };
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZXhwci5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3NyYy9qcy9hc20vZXhwci50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxPQUFPLEVBQWEsS0FBSyxFQUFDLE1BQU0sWUFBWSxDQUFDO0FBa0I3QyxNQUFNLEtBQVcsSUFBSSxDQTZUcEI7QUE3VEQsV0FBaUIsSUFBSTtJQXNCbkIsU0FBZ0IsUUFBUSxDQUFDLElBQVUsRUFBRSxDQUFZO1FBQy9DLFNBQVMsR0FBRyxDQUFDLENBQU87WUFDbEIsSUFBSSxDQUFDLENBQUMsQ0FBQyxJQUFJO2dCQUFFLE9BQU8sQ0FBQyxDQUFDO1lBQ3RCLE9BQU8sRUFBQyxHQUFHLENBQUMsRUFBRSxJQUFJLEVBQUUsQ0FBQyxDQUFDLElBQUksQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDLEVBQUMsQ0FBQztRQUNoRCxDQUFDO1FBQUEsQ0FBQztRQUNGLFNBQVMsQ0FBQyxDQUFDLENBQU8sRUFBRSxDQUFRO1lBQzFCLE1BQU0sTUFBTSxHQUFHLENBQUMsQ0FBQyxNQUFNLENBQUM7WUFDeEIsQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDLEVBQUUsR0FBRyxFQUFFLENBQUMsQ0FBQyxDQUFDO1lBQ2pCLElBQUksTUFBTSxJQUFJLENBQUMsQ0FBQyxDQUFDLE1BQU07Z0JBQUUsQ0FBQyxDQUFDLE1BQU0sR0FBRyxNQUFNLENBQUM7WUFDM0MsT0FBTyxDQUFDLENBQUM7UUFDWCxDQUFDO1FBQ0QsT0FBTyxDQUFDLENBQUMsSUFBSSxDQUFDLENBQUM7SUFDakIsQ0FBQztJQVplLGFBQVEsV0FZdkIsQ0FBQTtJQUVELFNBQWdCLFlBQVksQ0FBQyxJQUFVLEVBQUUsQ0FBTTtRQUM3QyxPQUFPLFFBQVEsQ0FBQyxJQUFJLEVBQUUsQ0FBQyxJQUFJLEVBQUUsR0FBRyxFQUFFLEVBQUUsQ0FBQyxDQUFDLENBQUMsR0FBRyxD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TSxDQUFDLElBQUksRUFBRSxDQUFDLENBQUMsRUFBRSxDQUFDLEVBQUUsRUFBRSxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDLENBQUM7WUFDM0QsS0FBSyxNQUFNLENBQUMsQ0FBQyxPQUFPLE1BQU0sQ0FBQyxJQUFJLEVBQUUsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxFQUFFLEVBQUUsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUM7WUFDbEQsS0FBSyxHQUFHLENBQUMsQ0FBQyxPQUFPLE1BQU0sQ0FBQyxJQUFJLEVBQUUsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxFQUFFLEVBQUUsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUM7WUFDL0MsS0FBSyxHQUFHLENBQUMsQ0FBQyxPQUFPLE1BQU0sQ0FBQyxJQUFJLEVBQUUsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxFQUFFLEVBQUUsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUM7WUFDL0MsS0FBSyxHQUFHLENBQUMsQ0FBQyxPQUFPLE1BQU0sQ0FBQyxJQUFJLEVBQUUsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxFQUFFLEVBQUUsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUM7WUFDL0MsS0FBSyxJQUFJLENBQUMsQ0FBQyxPQUFPLE1BQU0sQ0FBQyxJQUFJLEVBQUUsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxFQUFFLEVBQUUsQ0FBQyxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUM7WUFDakQsS0FBSyxJQUFJLENBQUMsQ0FBQyxPQUFPLE1BQU0sQ0FBQyxJQUFJLEVBQUUsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxFQUFFLEVBQUUsQ0FBQyxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUM7WUFDbEQsS0FBSyxHQUFHLENBQUMsQ0FBQyxPQUFPLE1BQU0sQ0FBQyxJQUFJLEVBQUUsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxFQUFFLEVBQUUsQ0FBQyxDQUFDLENBQUMsQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDLENBQUM7WUFDbEQsS0FBSyxJQUFJLENBQUMsQ0FBQyxPQUFPLE1BQU0sQ0FBQyxJQUFJLEVBQUUsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxFQUFFLEVBQUUsQ0FBQyxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLENBQUM7WUFDcEQsS0FBSyxHQUFHLENBQUMsQ0FBQyxPQUFPLE1BQU0sQ0FBQyxJQUFJLEVBQUUsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxFQUFFLEVBQUUsQ0FBQyxDQUFDLENBQUMsQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDLENBQUM7WUFDbEQsS0FBSyxJQUFJLENBQUMsQ0FBQyxPQUFPLE1BQU0sQ0FBQyxJQUFJLEVBQUUsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxFQUFFLEVBQUUsQ0FBQyxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLENBQUM7WUFDcEQsS0FBSyxHQUFHLENBQUMsQ0FBQyxPQUFPLE1BQU0sQ0FBQyxJQUFJLEVBQUUsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxFQUFFLEVBQUUsQ0FBQyxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLENBQUM7WUFDbkQsS0FBSyxJQUFJLENBQUMsQ0FBQyxPQUFPLE1BQU0sQ0FBQyxJQUFJLEVBQUUsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxFQUFFLEVBQUUsQ0FBQyxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLENBQUM7WUFDcEQsS0FBSyxJQUFJLENBQUMsQ0FBQyxPQUFPLE1BQU0sQ0FBQyxJQUFJLEVBQUUsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxFQUFFLEVBQUUsQ0FBQyxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUM7WUFDakQsS0FBSyxJQUFJLENBQUMsQ0FBQyxPQUFPLE1BQU0sQ0FBQyxJQUFJLEVBQUUsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxFQUFFLEVBQUUsQ0FBQyxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUM7WUFDakQsS0FBSyxNQUFNLENBQUMsQ0FBQyxPQUFPLE1BQU0sQ0FBQyxJQUFJLEVBQUUsQ0FB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QUVyQixDQUFDLEdBQUcsRUFBRSxDQUFDLENBQUMsRUFBRSxDQUFDLEVBQUUsTUFBTSxDQUFDLENBQUM7SUFDckIsQ0FBQyxJQUFJLEVBQUUsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxFQUFFLE1BQU0sQ0FBQyxDQUFDO0lBQ3RCLENBQUMsR0FBRyxFQUFFLENBQUMsQ0FBQyxFQUFFLENBQUMsRUFBRSxNQUFNLENBQUMsQ0FBQztJQUNyQixDQUFDLElBQUksRUFBRSxDQUFDLENBQUMsRUFBRSxDQUFDLEVBQUUsTUFBTSxDQUFDLENBQUM7SUFDdEIsQ0FBQyxHQUFHLEVBQUUsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxFQUFFLE1BQU0sQ0FBQyxDQUFDO0lBQ3JCLENBQUMsSUFBSSxFQUFFLENBQUMsQ0FBQyxFQUFFLENBQUMsRUFBRSxNQUFNLENBQUMsQ0FBQztJQUV0QixDQUFDLElBQUksRUFBRSxDQUFDLENBQUMsRUFBRSxDQUFDLEVBQUUsTUFBTSxDQUFDLENBQUM7SUFDdEIsQ0FBQyxNQUFNLEVBQUUsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxFQUFFLE1BQU0sQ0FBQyxDQUFDO0lBQ3hCLENBQUMsSUFBSSxFQUFFLENBQUMsQ0FBQyxFQUFFLENBQUMsRUFBRSxNQUFNLENBQUMsQ0FBQztDQUd2QixDQUFDLENBQUM7QUFFSCxNQUFNLFNBQVMsR0FBRyxJQUFJLEdBQUcsQ0FBdUI7SUFFOUMsQ0FBQyxHQUFHLEVBQUUsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDLEVBQUUsS0FBSyxDQUFDLENBQUM7SUFDckIsQ0FBQyxHQUFHLEVBQUUsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDLEVBQUUsS0FBSyxDQUFDLENBQUM7SUFDckIsQ0FBQyxHQUFHLEVBQUUsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDLEVBQUUsS0FBSyxDQUFDLENBQUM7SUFDckIsQ0FBQyxHQUFHLEVBQUUsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDLEVBQUUsS0FBSyxDQUFDLENBQUM7SUFDckIsQ0FBQyxHQUFHLEVBQUUsQ0FBQyxDQUFDLEVBQUUs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SUFBSSxDQUFDLElBQUksQ0FBQyxJQUFJLEdBQUcsRUFBRSxDQUFDLENBQUMsQ0FBQyxJQUFJLEdBQUcsSUFBSSxDQUFDO0lBQ3RELE9BQU8sSUFBSSxDQUFDO0FBQ2QsQ0FBQztBQUVELFNBQVMsSUFBSSxDQUFDLEdBQVc7SUFDdkIsT0FBTyxFQUFDLElBQUksRUFBRSxDQUFDLElBQUksR0FBRyxJQUFJLEdBQUcsR0FBRyxHQUFHLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxFQUFDLENBQUM7QUFDL0MsQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7U291cmNlSW5mbywgVG9rZW59IGZyb20gJy4vdG9rZW4uanMnO1xuXG5leHBvcnQgaW50ZXJmYWNlIEV4cHIge1xuICAvLyBvcGVyYXRvciAoZS5nLiAnKycgb3IgJy5tYXgnKSBvciAnc3ltJywgJ251bScsIG9yICdpbSdcbiAgLy8gIC0gc3ltOiBhbiBvZmZzZXQgaW50byB0aGUgc3ltYm9scyBhcnJheSAob3IgdGhlIG5hbWUgaW4gJ3N5bScpXG4gIC8vICAtIG51bTogYSBudW1iZXIgbGl0ZXJhbCwgb3IgYW4gb2Zmc2V0IGludG8gdGhlIHN5bWJvbHMgYXJyYXkuXG4gIC8vICAtIGltOiBhbiBpbXBvcnQgZnJvbSBhbm90aGVyIG9iamVjdCBmaWxlICh1c2VzICdzeW0nKS5cbiAgLy8gVE9ETyAtIHdoYXQgYWJvdXQgZGlmZmVyZW50IGFkZHJlc3MgdHlwZXM/IGJhbmsgaGludC9ldGM/XG4gIC8vICAgICAgLSBkb2VzIGJhbmsgaGludCBuZWVkIHRvIGdldCBzdG9yZWQgaW4gdGhlIG9iamVjdCBmaWxlP1xuICAvLyAgICAgICAgLSBwcm9iYWJseSBub3QuLi4/XG4gIG9wOiBzdHJpbmc7XG4gIGFyZ3M/OiBFeHByW107XG4gIG51bT86IG51bWJlcjtcbiAgbWV0YT86IEV4cHIuTWV0YTtcbiAgc3ltPzogc3RyaW5nO1xuICBzb3VyY2U/OiBTb3VyY2VJbmZvO1xufVxuXG5leHBvcnQgbmFtZXNwYWNlIEV4cHIge1xuXG4gIC8qKiBFeHRyYSBpbmZvcm1hdGlvbiBmb3IgJ251bScgdmFsdWVzLiAqL1xuICBleHBvcnQgaW50ZXJmYWNlIE1ldGEge1xuICAgIC8qKiBXaGV0aGVyIHRoaXMgaXMgcmVsYXRpdmUgdG8gdGhlIHN0YXJ0IG9mIHRoZSBjaHVuay4gKi9cbiAgICByZWw/OiBib29sZWFuO1xuICAgIC8qKiBSZWxhdGl2ZSBjaHVuayB0aGUgdmFsdWUgaXMgZGVmaW5lZCBpbi4gKi9cbiAgICBjaHVuaz86IG51bWJlcjtcbiAgICAvKiogT3JnIHZhbHVlIG9mIGNodW5rLCBpZiBrbm93bi4gKi9cbiAgICBvcmc/OiBudW1iZXI7XG4gICAgLyoqIEJhbmsgdmFsdWUgb2YgY2h1bmssIGlmIGtub3duLiAqL1xuICAgIGJhbms/OiBudW1iZXI7XG4gICAgLyoqIE9mZnNldCB2YWx1ZSBvZiBjaHVuaywgaWYga25vd24uICovXG4gICAgb2Zmc2V0PzogbnVtYmVyO1xuICAgIC8qKiBTaXplIGhpbnQgZm9yIG51bWJlci4gKi9cbiAgICBzaXplPzogbnVtYmVyO1xuICB9XG5cbiAgdHlwZSBSZWMgPSAoZXhwcjogRXhwcikgPT4gRXhwcjsgLy8gcmVjdXJzZXMgaW50byBjaGlsZHJlblxuICB0eXBlIFRyYXZlcnNlciA9IChleHByOiBFeHByLCByZWM6IFJlYywgcGFyZW50PzogRXhwcikgPT4gRXhwcjtcblxuICAvKiogUGVyZm9ybXMgYSBwb3N0LW9yZGVyIHRyYXZlcnNhbC4gKi9cbiAgZXhwb3J0IGZ1bmN0aW9uIHRyYXZlcnNlKGV4cHI6IEV4cHIsIGY6IFRyYXZlcnNlcikge1xuICAgIGZ1bmN0aW9uIHJlYyhlOiBFeHByKSB7XG4gICAgICBpZiAoIWUuYXJncykgcmV0dXJuIGU7XG4gICAgICByZXR1cm4gey4uLmUsIGFyZ3M6IGUuYXJncy5tYXAoYyA9PiB0KGMsIGUpKX07XG4gICAgfTtcbiAgICBmdW5jdGlvbiB0KGU6IEV4cHIsIHA/OiBFeHByKSB7XG4gICAgICBjb25zdCBzb3VyY2UgPSBlLnNvdXJjZTtcbiAgICAgIGUgPSBmKGUsIHJlYywgcCk7XG4gICAgICBpZiAoc291cmNlICYmICFlLnNvdXJjZSkgZS5zb3VyY2UgPSBzb3VyY2U7XG4gICAgICByZXR1cm4gZTtcbiAgICB9XG4gICAgcmV0dXJuIHQoZXhwcik7XG4gIH1cblxuICBleHBvcnQgZnVuY3Rpb24gdHJhdmVyc2VQb3N0KGV4cHI6IEV4cHIsIGY6IFJlYyk6IEV4cHIge1xuICAgIHJldHVybiB0cmF2ZXJzZShleHByLCAoZXhwciwgcmVjKSA9PiBmKHJlYyhleHByKSkpO1xuICB9XG5cbiAgZXhwb3J0IGZ1bmN0aW9uIGV2YWx1YXRlKGV4cHI6IEV4cHIpOiBFeHByIHtcbiAgICBzd2l0Y2ggKGV4cHIub3ApIHsgLy8gdmFyLWFyZyBmdW5jdGlvbnNcbiAgICAgIGNhc2UgJy5tb3ZlJzpcbiAgICAgIGNhc2UgJ2ltJzpcbiAgICAgIGNhc2UgJ3N5bSc6XG4gICAgICAgIHJldHVybiBleHByO1xuICAgICAgY2FzZSAnbnVtJzpcbiAgICAgICAgaWYgKGV4cHIubWV0YT8ucmVsICYmIGV4cHIubWV0YS5vcmcgIT0gbnVsbCkge1xuICAgICAgICAgIC8vIFJlbW92ZSB0aGUgJ3JlbCcgdGFnIHNpbmNlIGl0J3Mgbm8gbG9uZ2VyIHJlbGF0aXZlLlxuICAgICAgICAgIGNvbnN0IHtyZWwsIC4uLm1ldGF9ID0gZXhwci5tZXRhO1xuICAgICAgICAgIC8vIFRPRE8gLSBwdWxsIHNpemUgZnJvbSBtZXRhP1xuICAgICAgICAgIHJldHVybiB7b3A6ICdudW0nLCBudW06IGV4cHIubnVtISArIG1ldGEub3JnISwgbWV0YX07XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGV4cHI7XG4gICAgICBjYXNlICcubWF4JzogcmV0dXJuIHNhbWVDaHVuayhleHByLCBNYXRoLm1heCk7XG4gICAgICBjYXNlICcubWluJzogcmV0dXJuIHNhbWVDaHVuayhleHByLCBNYXRoLm1pbik7XG4gICAgICBkZWZhdWx0OiAvLyBmYWxsIHRocm91Z2ggdG8gbGF0ZXIgY2hlY2tzXG4gICAgfVxuXG4gICAgLy8gU3BlY2lhbCBjYXNlIGZvciB1bmFyaWVzXG4gICAgaWYgKGV4cHIuYXJncz8ubGVuZ3RoID09PSAxKSB7XG4gICAgICBzd2l0Y2ggKGV4cHIub3ApIHtcbiAgICAgICAgY2FzZSAnKyc6IHJldHVybiBleHByLmFyZ3MhWzBdO1xuICAgICAgICBjYXNlICctJzogcmV0dXJuIHVuYXJ5KGV4cHIsIHggPT4gLXgpO1xuICAgICAgICBjYXNlICd+JzogcmV0dXJuIHVuYXJ5KGV4cHIsIHggPT4gfngpO1xuICAgICAgICBjYXNlICchJzogcmV0dXJuIHVuYXJ5KGV4cHIsIHggPT4gKyF4KTtcbiAgICAgICAgY2FzZSAnPCc6IHJldHVybiB1bmFyeShleHByLCB4ID0+IHggJiAweGZmKTtcbiAgICAgICAgY2FzZSAnPic6IHJldHVybiB1bmFyeShleHByLCB4ID0+ICh4ID4+IDgpICYgMHhmZik7XG4gICAgICAgIGNhc2UgJ14nOiByZXR1cm4gbnVtKGV4cHIuYXJncyFbMF0ubWV0YT8uYmFuaykgPz8gZXhwcjtcbiAgICAgICAgZGVmYXVsdDogdGhyb3cgbmV3IEVycm9yKGBVbmtub3duIHVuYXJ5IG9wZXJhdG9yOiAke2V4cHIub3B9YCk7XG4gICAgICB9XG4gICAgfVxuXG4gICAgc3dpdGNoIChleHByLm9wKSB7XG4gICAgICBjYXNlICcrJzogcmV0dXJuIHBsdXMoZXhwcik7XG4gICAgICBjYXNlICctJzogcmV0dXJuIG1pbnVzKGV4cHIpO1xuICAgICAgY2FzZSAnKic6IHJldHVybiBiaW5hcnkoZXhwciwgKGEsIGIpID0+IGEgKiBiKTtcbiAgICAgIGNhc2UgJy8nOiByZXR1cm4gYmluYXJ5KGV4cHIsIChhLCBiKSA9PiBNYXRoLmZsb29yKGEgLyBiKSk7XG4gICAgICBjYXNlICcubW9kJzogcmV0dXJuIGJpbmFyeShleHByLCAoYSwgYikgPT4gYSAlIGIpO1xuICAgICAgY2FzZSAnJic6IHJldHVybiBiaW5hcnkoZXhwciwgKGEsIGIpID0+IGEgJiBiKTtcbiAgICAgIGNhc2UgJ3wnOiByZXR1cm4gYmluYXJ5KGV4cHIsIChhLCBiKSA9PiBhIHwgYik7XG4gICAgICBjYXNlICdeJzogcmV0dXJuIGJpbmFyeShleHByLCAoYSwgYikgPT4gYSBeIGIpO1xuICAgICAgY2FzZSAnPDwnOiByZXR1cm4gYmluYXJ5KGV4cHIsIChhLCBiKSA9PiBhIDw8IGIpO1xuICAgICAgY2FzZSAnPj4nOiByZXR1cm4gYmluYXJ5KGV4cHIsIChhLCBiKSA9PiBhID4+PiBiKTtcbiAgICAgIGNhc2UgJzwnOiByZXR1cm4gYmluYXJ5KGV4cHIsIChhLCBiKSA9PiArKGEgPCBiKSk7XG4gICAgICBjYXNlICc8PSc6IHJldHVybiBiaW5hcnkoZXhwciwgKGEsIGIpID0+ICsoYSA8PSBiKSk7XG4gICAgICBjYXNlICc+JzogcmV0dXJuIGJpbmFyeShleHByLCAoYSwgYikgPT4gKyhhID4gYikpO1xuICAgICAgY2FzZSAnPj0nOiByZXR1cm4gYmluYXJ5KGV4cHIsIChhLCBiKSA9PiArKGEgPj0gYikpO1xuICAgICAgY2FzZSAnPSc6IHJldHVybiBiaW5hcnkoZXhwciwgKGEsIGIpID0+ICsoYSA9PSBiKSk7XG4gICAgICBjYXNlICc8Pic6IHJldHVybiBiaW5hcnkoZXhwciwgKGEsIGIpID0+ICsoYSAhPSBiKSk7XG4gICAgICBjYXNlICcmJic6IHJldHVybiBiaW5hcnkoZXhwciwgKGEsIGIpID0+IGEgJiYgYik7XG4gICAgICBjYXNlICd8fCc6IHJldHVybiBiaW5hcnkoZXhwciwgKGEsIGIpID0+IGEgfHwgYik7XG4gICAgICBjYXNlICcueG9yJzogcmV0dXJuIGJpbmFyeShleHByLCAoYSwgYikgPT4gIWEgJiYgYiB8fCAhYiAmJiBhIHx8IDApO1xuICAgICAgZGVmYXVsdDogdGhyb3cgbmV3IEVycm9yKGBVbmtub3duIG9wZXJhdG9yOiAke2V4cHIub3B9YCk7XG4gICAgfVxuICB9XG5cbiAgZXhwb3J0IGZ1bmN0aW9uIGlkZW50aWZpZXIoZXhwcjogRXhwcik6IHN0cmluZyB7XG4gICAgaWYgKGV4cHIub3AgPT09ICdzeW0nICYmIGV4cHIuc3ltKSByZXR1cm4gZXhwci5zeW07XG4gICAgdGhyb3cgbmV3IEVycm9yKGBFeHBlY3RlZCBpZGVudGlmaWVyIGJ1dCBnb3Qgb3A6ICR7ZXhwci5vcH1gKTtcbiAgfVxuXG4gIC8vIC8qKiBSZXR1cm5zIHRoZSBpZGVudGlmaWVyLiAqL1xuICAvLyBleHBvcnQgZnVuY3Rpb24gaWRlbnRpZmllcihleHByOiBFeHByKTogc3RyaW5nIHtcbiAgLy8gICBjb25zdCB0ZXJtczogc3RyaW5nW10gPSBbXTtcbiAgLy8gICBhcHBlbmQoZXhwcik7XG4gIC8vICAgcmV0dXJuIHRlcm1zLmpvaW4oJzo6Jyk7XG4gIC8vICAgZnVuY3Rpb24gYXBwZW5kKGU6IEV4cHIpIHtcbiAgLy8gICAgIGlmIChlLm9wID09PSAnaWRlbnQnKSB7XG4gIC8vICAgICAgIHRlcm1zLnB1c2goZS5zeW0hKTtcbiAgLy8gICAgIH0gZWxzZSBpZiAoZS5vcCA9PT0gJzo6Jykge1xuICAvLyAgICAgICBpZiAoZS5hcmdzIS5sZW5ndGggPT09IDEpIHRlcm1zLnB1c2goJycpO1xuICAvLyAgICAgICBlLmFyZ3MhLmZvckVhY2goYXBwZW5kKTtcbiAgLy8gICAgIH0gZWxzZSB7XG4gIC8vICAgICAgIHRocm93IG5ldyBFcnJvcihgRXhwZWN0ZWQgaWRlbnRpZmllciBidXQgZ290IG9wOiAke2Uub3B9YCk7XG4gIC8vICAgICB9XG4gIC8vICAgfVxuICAvLyB9XG5cbiAgLyoqIFBhcnNlIGEgc2luZ2xlIGV4cHJlc3Npb24sIG11c3Qgb2NjdXB5IHRoZSByZXN0IG9mIHRoZSBsaW5lLiAqL1xuICBleHBvcnQgZnVuY3Rpb24gcGFyc2VPbmx5KHRva2VuczogVG9rZW5bXSwgaW5kZXggPSAwKTogRXhwciB7XG4gICAgY29uc3QgW2V4cHIsIGldID0gcGFyc2UodG9rZW5zLCBpbmRleCk7XG4gICAgaWYgKGkgPCB0b2tlbnMubGVuZ3RoKSB7XG4gICAgICBwYXJzZSh0b2tlbnMsIGluZGV4KTtcbiAgICAgIHRocm93IG5ldyBFcnJvcihgR2FyYmFnZSBhZnRlciBleHByZXNzaW9uOiAke1Rva2VuLm5hbWVBdCh0b2tlbnNbaV0pfWApO1xuICAgIH0gZWxzZSBpZiAoIWV4cHIpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcihgTm8gZXhwcmVzc2lvbj9gKTtcbiAgICB9XG4gICAgcmV0dXJuIGV4cHI7XG4gIH1cblxuICAvLyBSZXR1cm5zIFt1bmRlZmluZWQsIC0xXSBpZiBhIGJhZCBwYXJzZS5cbiAgLy8gR2l2ZSB1cCBvbiBub3JtYWwgcGFyc2luZywganVzdCB1c2UgYSBzaHVudGluZyB5YXJkIGFnYWluLi4uXG4gIC8vICAtIGJ1dCBoYW5kbGUgcGFyZW5zIHJlY3Vyc2l2ZWx5LlxuICBleHBvcnQgZnVuY3Rpb24gcGFyc2UodG9rZW5zOiBUb2tlbltdLCBpbmRleCA9IDApOiBbRXhwcnx1bmRlZmluZWQsIG51bWJlcl0ge1xuLy9jb25zb2xlLmxvZygnUEFSU0U6IHRva2Vucz0nLCB0b2tlbnMsICdpbmRleD0nLCBpbmRleCk7XG4vL3RyeSB7IHRocm93IG5ldyBFcnJvcigpOyB9IGNhdGNoIChlKSB7IGNvbnNvbGUubG9nKGUuc3RhY2spOyB9XG4gICAgY29uc3Qgb3BzOiBbc3RyaW5nLCBPcGVyYXRvck1ldGFdW10gPSBbXTtcbiAgICBjb25zdCBleHByczogRXhwcltdID0gW107XG5cbiAgICBmdW5jdGlvbiBwb3BPcCgpIHtcbiAgICAgIGNvbnN0IFtvcCwgWywsIGFyaXR5XV0gPSBvcHMucG9wKCkhO1xuLy9jb25zb2xlLmxvZygncG9wJywgb3AsIGFyaXR5KTtcbiAgICAgIGNvbnN0IGFyZ3MgPSBleHBycy5zcGxpY2UoZXhwcnMubGVuZ3RoIC0gYXJpdHksIGFyaXR5KTtcbiAgICAgIGlmIChhcmdzLmxlbmd0aCAhPT0gYXJpdHkpIHRocm93IG5ldyBFcnJvcignc2h1bnRpbmcgcGFyc2UgZmFpbGVkPycpO1xuICAgICAgZXhwcnMucHVzaChmaXhTaXplKHtvcCwgYXJnc30pKTtcbiAgICB9XG5cbiAgICBsZXQgdmFsID0gdHJ1ZTtcbiAgICBsZXQgaSA9IGluZGV4O1xuICAgIGZvciAoOyBpIDwgdG9rZW5zLmxlbmd0aDsgaSsrKSB7XG4gICAgICBjb25zdCBmcm9udCA9IHRva2Vuc1tpXTtcbi8vY29uc29sZS5sb2coJ2V4cHJzOicsZXhwcnMsJ29wczonLG9wcywndG9rOicsZnJvbnQpO1xuICAgICAgaWYgKHZhbCkge1xuICAgICAgICAvLyBsb29raW5nIGZvciBhIHZhbHVlOiBsaXRlcmFsLCBiYWxhbmNlZCBwYXJlbnMsIG9yIHByZWZpeCBvcC5cbiAgICAgICAgaWYgKGZyb250LnRva2VuID09PSAnY3MnIHx8IGZyb250LnRva2VuID09PSAnb3AnKSB7XG4gICAgICAgICAgY29uc3QgbWFwcGVkID0gTkFNRV9NQVAuZ2V0KGZyb250LnN0cik7XG4gICAgICAgICAgY29uc3QgcHJlZml4ID0gUFJFRklYT1BTLmdldChtYXBwZWQgPz8gZnJvbnQuc3RyKTtcbiAgICAgICAgICBpZiAocHJlZml4KSB7XG4gICAgICAgICAgICBvcHMucHVzaChbZnJvbnQuc3RyLCBwcmVmaXhdKTtcbiAgICAgICAgICB9IGVsc2UgaWYgKGZyb250LnRva2VuID09PSAnY3MnKSB7XG4gICAgICAgICAgICBjb25zdCBvcCA9IGZyb250LnN0cjtcbiAgICAgICAgICAgIGlmICghRlVOQ1RJT05TLmhhcyhvcCkpIHtcbiAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKGBObyBzdWNoIGZ1bmN0aW9uOiAke1Rva2VuLm5hbWVBdChmcm9udCl9YCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBjb25zdCBuZXh0ID0gdG9rZW5zW2kgKyAxXTtcbiAgICAgICAgICAgIGlmIChuZXh0Py50b2tlbiAhPT0gJ2xwJykge1xuICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYEJhZCBmdW5jYWxsOiAke1Rva2VuLm5hbWVBdChuZXh0ID8/IGZyb250KX1gKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGNvbnN0IGNsb3NlID0gVG9rZW4uZmluZEJhbGFuY2VkKHRva2VucywgaSArIDEpO1xuICAgICAgICAgICAgaWYgKGNsb3NlIDwgMCkge1xuICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYE5ldmVyIGNsb3NlZDogJHtUb2tlbi5uYW1lQXQobmV4dCl9YCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBjb25zdCBhcmdzOiBFeHByW10gPSBbXTtcbiAgICAgICAgICAgIGZvciAoY29uc3QgYXJnIG9mIFRva2VuLnBhcnNlQXJnTGlzdCh0b2tlbnMsIGkgKyAyLCBjbG9zZSkpIHtcbiAgICAgICAgICAgICAgYXJncy5wdXNoKHBhcnNlT25seShhcmcpKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGkgPSBjbG9zZTtcbiAgICAgICAgICAgIGV4cHJzLnB1c2goZml4U2l6ZSh7b3AsIGFyZ3N9KSk7XG4gICAgICAgICAgICB2YWwgPSBmYWxzZTtcbiAgICAgICAgICB9IGVsc2UgaWYgKFRva2VuLmVxKGZyb250LCBUb2tlbi5TVEFSKSkge1xuICAgICAgICAgICAgZXhwcnMucHVzaCh7b3A6ICdzeW0nLCBzeW06ICcqJ30pO1xuICAgICAgICAgICAgdmFsID0gZmFsc2U7XG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihgVW5rbm93biBwcmVmaXggb3BlcmF0b3I6ICR7VG9rZW4ubmFtZUF0KGZyb250KX1gKTtcbiAgICAgICAgICB9XG4gICAgICAgIH0gZWxzZSBpZiAoZnJvbnQudG9rZW4gPT09ICdscCcpIHtcbiAgICAgICAgICAvLyBmaW5kIGJhbGFuY2VkIHBhcmVuc1xuICAgICAgICAgIGNvbnN0IGNsb3NlID0gVG9rZW4uZmluZEJhbGFuY2VkKHRva2VucywgaSk7XG4gICAgICAgICAgaWYgKGNsb3NlIDwgMCkge1xuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKGBObyBjbG9zZSBwYXJlbjogJHtUb2tlbi5uYW1lQXQoZnJvbnQpfWApO1xuICAgICAgICAgIH0gLy8gcmV0dXJuIFt1bmRlZmluZWQsIC0xXTtcbiAgICAgICAgICBjb25zdCBlID0gcGFyc2VPbmx5KHRva2Vucy5zbGljZShpICsgMSwgY2xvc2UpKTtcbiAgICAgICAgICBleHBycy5wdXNoKGUpO1xuICAgICAgICAgIGkgPSBjbG9zZTtcbiAgICAgICAgICB2YWwgPSBmYWxzZTtcbiAgICAgICAgfSBlbHNlIGlmIChmcm9udC50b2tlbiA9PT0gJ2lkZW50Jykge1xuICAgICAgICAgIC8vIGFkZCBzeW1ib2xcbiAgICAgICAgICBleHBycy5wdXNoKHtvcDogJ3N5bScsIHN5bTogZnJvbnQuc3RyfSk7XG4gICAgICAgICAgLy8gVE9ETyAtIHVzZSBzY29wZSBpbmZvcm1hdGlvbiB0byBkZXRlcm1pbmUgc2l6ZT9cbiAgICAgICAgICB2YWwgPSBmYWxzZTtcbiAgICAgICAgfSBlbHNlIGlmIChmcm9udC50b2tlbiA9PT0gJ251bScpIHtcbiAgICAgICAgICAvLyBhZGQgbnVtYmVyXG4gICAgICAgICAgY29uc3QgbnVtID0gZnJvbnQubnVtO1xuICAgICAgICAgIGV4cHJzLnB1c2goe29wOiAnbnVtJywgbnVtLCBtZXRhOiBzaXplKG51bSl9KTtcbiAgICAgICAgICB2YWwgPSBmYWxzZTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAvLyBiYWQgdG9rZW4/P1xuICAgICAgICAgIHRocm93IG5ldyBFcnJvcihgQmFkIGV4cHJlc3Npb24gdG9rZW46ICR7VG9rZW4ubmFtZUF0KGZyb250KX1gKTtcbiAgICAgICAgICAvLyByZXR1cm4gW3VuZGVmaW5lZCwgLTFdO1xuICAgICAgICB9XG4gICAgICB9IGVsc2Uge1xuICAgICAgICAvLyBsb29raW5nIGZvciBhbiBpbmZpeCBvcGVyYXRvciBvciBFT0wuXG4gICAgICAgIGlmIChUb2tlbi5lcShmcm9udCwgVG9rZW4uQ09NTUEpIC8qIHx8IFRva2VuLmVxKGZyb250LCBUb2tlbi5SUCkgKi8pIHtcbiAgICAgICAgICAvLyBUT0RPIC0gaXMgcnBhcmVuIG9rYXk/IHVzdWFsbHkgc2hvdWxkIGhhdmUgZXh0cmFjdGVkIHRoZSBiYWxhbmNlZFxuICAgICAgICAgIC8vIHBhcmVuIG91dCBmaXJzdD9cbiAgICAgICAgICBicmVhaztcbiAgICAgICAgfVxuICAgICAgICBpZiAoZnJvbnQudG9rZW4gPT09ICdjcycgfHwgZnJvbnQudG9rZW4gPT09ICdvcCcpIHtcbiAgICAgICAgICBjb25zdCBtYXBwZWQgPSBOQU1FX01BUC5nZXQoZnJvbnQuc3RyKTtcbiAgICAgICAgICBjb25zdCBvcCA9IEJJTk9QUy5nZXQobWFwcGVkID8/IGZyb250LnN0cik7XG4gICAgICAgICAgaWYgKCFvcCkgYnJlYWs7IC8vIHdlJ3JlIGF0IHRoZSBlbmQuLi4/ICBvciBpZiBubyBvcC5cbiAgICAgICAgICAvLyBzZWUgaWYgYW55dGhpbmcgdG8gdGhlIGxlZnQgaXMgZmFzdGVyLlxuICAgICAgICAgIHdoaWxlIChvcHMubGVuZ3RoKSB7XG4gICAgICAgICAgICBjb25zdCB0b3AgPSBvcHNbb3BzLmxlbmd0aCAtIDFdO1xuICAgICAgICAgICAgY29uc3QgY21wID0gY29tcGFyZU9wKHRvcFsxXSwgb3ApO1xuICAgICAgICAgICAgaWYgKGNtcCA8IDApIGJyZWFrO1xuICAgICAgICAgICAgaWYgKGNtcCA9PT0gMCkge1xuICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXG4gICAgICAgICAgICAgICAgICBgTWl4aW5nICR7dG9wWzBdfSBhbmQgJHtmcm9udC5zdHJ9IG5lZWRzIGV4cGxpY2l0IHBhcmVucy4ke1xuICAgICAgICAgICAgICAgICAgIFRva2VuLmF0KGZyb250KX1gKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHBvcE9wKCk7XG4gICAgICAgICAgfVxuICAgICAgICAgIG9wcy5wdXNoKFtmcm9udC5zdHIsIG9wXSk7XG4gICAgICAgICAgdmFsID0gdHJ1ZTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAvL3Rocm93IG5ldyBFcnJvcihgR2FyYmFnZSBhZnRlciBleHByZXNzaW9uOiAke1Rva2VuLm5hbWVBdChmcm9udCl9YCk7XG4vL2NvbnNvbGUubG9nKCdiYWQgdmFsdWUnLCBpLCBmcm9udCk7XG4gICAgICAgICAgYnJlYWs7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG4vL2NvbnNvbGUubG9nKCdleHByczonLGV4cHJzLCdvcHM6JyxvcHMpO1xuICAgIC8vIE5vdyBwb3AgYWxsIHRoZSBvcHNcbiAgICB3aGlsZSAob3BzLmxlbmd0aCkgcG9wT3AoKTtcbi8vY29uc29sZS5sb2coJ3Bvc3QtcG9wOicsIGV4cHJzKTtcbiAgICBpZiAoZXhwcnMubGVuZ3RoICE9PSAxKSB0aHJvdyBuZXcgRXJyb3IoYHNodW50aW5nIHBhcnNlIGZhaWxlZD9gKTtcbiAgICBpZiAodG9rZW5zW2luZGV4XS5zb3VyY2UpIGV4cHJzWzBdLnNvdXJjZSA9IHRva2Vuc1tpbmRleF0uc291cmNlO1xuICAgIHJldHVybiBbZXhwcnNbMF0sIGldO1xuICB9XG5cblxuICAvLyB3b3JrcyBvbiBhYnNvbHV0ZSBudW1iZXJzLCBvciByZWxhdGl2ZSBudW1iZXJzIGlmIGFsbCBpbiBzYW1lIGNodW5rLlxuICAvLyBtYXkgbm90IG1peCByZWxhdGl2ZSArIGFic29sdXRlLlxuICBmdW5jdGlvbiBzYW1lQ2h1bmsoZXhwcjogRXhwciwgZjogKC4uLm51bXM6IG51bWJlcltdKSA9PiBudW1iZXIpOiBFeHByIHtcbiAgICB0aHJvdyBuZXcgRXJyb3IoKTtcbiAgfVxuXG4gIGZ1bmN0aW9uIG51bShudW06IG51bWJlcnx1bmRlZmluZWQpOiBFeHByfHVuZGVmaW5lZCB7XG4gICAgaWYgKG51bSA9PSBudWxsKSByZXR1cm4gdW5kZWZpbmVkO1xuICAgIHJldHVybiB7b3A6ICdudW0nLCBudW0sIG1ldGE6IHNpemUobnVtKX07XG4gIH1cblxuICBmdW5jdGlvbiB1bmFyeShleHByOiBFeHByLCBmOiAoeDogbnVtYmVyKSA9PiBudW1iZXIpOiBFeHByIHtcbiAgICAvLyByZXF1aXJlIGFic29sdXRlXG4gICAgY29uc3QgYXJnID0gZXhwci5hcmdzIVswXTtcbiAgICBpZiAoIWlzQWJzKGFyZykpIHJldHVybiBleHByO1xuICAgIGNvbnN0IG51bSA9IGYoYXJnLm51bSEpO1xuICAgIHJldHVybiB7b3A6ICdudW0nLCBudW0sIG1ldGE6IHNpemUobnVtKX07XG4gIH1cblxuICBmdW5jdGlvbiBiaW5hcnkoZXhwcjogRXhwciwgZjogKHg6IG51bWJlciwgeTogbnVtYmVyKSA9PiBudW1iZXIpOiBFeHByIHtcbiAgICAvLyByZXF1aXJlIGJvdGggdG8gYmUgYWJzb2x1dGVcbiAgICBjb25zdCBbYSwgYl0gPSBleHByLmFyZ3MhO1xuICAgIGlmICghaXNBYnMoYSkgfHwgIWlzQWJzKGIpKSByZXR1cm4gZXhwcjtcbiAgICBjb25zdCBudW0gPSBmKGEubnVtISwgYi5udW0hKTtcbiAgICByZXR1cm4ge29wOiAnbnVtJywgbnVtLCBtZXRhOiBzaXplKG51bSl9O1xuICB9XG5cbiAgZnVuY3Rpb24gcGx1cyhleHByOiBFeHByKTogRXhwciB7XG4gICAgLy8gYWxsb3cgc29tZSByZWxhdGl2ZSwgYnV0IG9ubHkgaWYgYWRkaW5nIGEgbm9uLWFkZHJlc3M/XG4gICAgY29uc3QgW2EsIGJdID0gZXhwci5hcmdzITtcbiAgICBpZiAoYS5vcCAhPT0gJ251bScgfHwgYi5vcCAhPT0gJ251bScpIHJldHVybiBleHByO1xuICAgIGNvbnN0IG91dDogRXhwciA9IHtvcDogJ251bScsIG51bTogYS5udW0hICsgYi5udW0hfTtcbiAgICBpZiAoYS5tZXRhIHx8IGIubWV0YSkge1xuICAgICAgaWYgKGEubWV0YT8ucmVsICYmIGIubWV0YT8ucmVsKSByZXR1cm4gZXhwcjsgLy8gYmFzaWNhbGx5IG5vbnNlbnNlXG4gICAgICBpZiAoYS5tZXRhPy5yZWwpIHtcbiAgICAgICAgb3V0Lm1ldGEgPSBhLm1ldGE7XG4gICAgICB9IGVsc2UgaWYgKGIubWV0YT8ucmVsKSB7XG4gICAgICAgIG91dC5tZXRhID0gYi5tZXRhO1xuICAgICAgfVxuICAgIH1cbiAgICBpZiAoIW91dC5tZXRhPy5yZWwgJiYgb3V0Lm1ldGE/LnNpemUgPT0gbnVsbCkge1xuICAgICAgKG91dC5tZXRhIHx8IChvdXQubWV0YSA9IHt9KSkuc2l6ZSA9IHNpemUob3V0Lm51bSEpLnNpemU7XG4gICAgfVxuICAgIHJldHVybiBvdXQ7XG4gIH1cblxuICBmdW5jdGlvbiBtaW51cyhleHByOiBFeHByKTogRXhwciB7XG4gICAgLy8gYWxsb3cgcmVsIC0gcmVsIGZvciBkZWx0YVxuICAgIGNvbnN0IFthLCBiXSA9IGV4cHIuYXJncyE7XG4gICAgaWYgKGEub3AgIT09ICdudW0nIHx8IGIub3AgIT09ICdudW0nKSByZXR1cm4gZXhwcjtcbiAgICBjb25zdCBvdXQ6IEV4cHIgPSB7b3A6ICdudW0nLCBudW06IGEubnVtISAtIGIubnVtIX07XG4gICAgaWYgKGIubWV0YT8ucmVsKSB7XG4gICAgICByZXR1cm4gYS5tZXRhPy5yZWwgJiYgYS5tZXRhLmNodW5rID09PSBiLm1ldGEuY2h1bmsgPyBvdXQgOiBleHByO1xuICAgIH1cbiAgICBpZiAoYS5tZXRhPy5yZWwpIG91dC5tZXRhID0gYS5tZXRhO1xuICAgIGlmICghb3V0Lm1ldGE/LnJlbCAmJiBvdXQubWV0YT8uc2l6ZSA9PSBudWxsKSB7XG4gICAgICAob3V0Lm1ldGEgfHwgKG91dC5tZXRhID0ge30pKS5zaXplID0gc2l6ZShvdXQubnVtISkuc2l6ZTtcbiAgICB9XG4gICAgcmV0dXJuIG91dDtcbiAgfVxuXG4gIGZ1bmN0aW9uIGlzQWJzKGV4cHI6IEV4cHIpOiBib29sZWFuIHtcbiAgICByZXR1cm4gZXhwci5vcCA9PT0gJ251bScgJiYgIWV4cHIubWV0YT8ucmVsO1xuICB9XG59XG5cblxuXG4vLyBSZXR1cm5zID4wIGlmIHRvcCBpcyBmYXN0ZXIsIDwwIGlmIHRvcCBpcyBzbG93ZXIsIGFuZCAwIGlmIGNhbid0IG1peFxuZnVuY3Rpb24gY29tcGFyZU9wKHRvcDogT3BlcmF0b3JNZXRhLCBuZXh0OiBPcGVyYXRvck1ldGEpOiBudW1iZXIge1xuICBpZiAodG9wWzBdID4gbmV4dFswXSkgcmV0dXJuIDE7XG4gIGlmICh0b3BbMF0gPCBuZXh0WzBdKSByZXR1cm4gLTE7XG4gIGlmICh0b3BbMV0gIT09IG5leHRbMV0pIHJldHVybiAwO1xuICByZXR1cm4gdG9wWzFdO1xufVxuXG5cbi8vIHByZWNlZGVuY2UsIGFzc29jaWF0aXZpdHksIGFyaXR5XG50eXBlIE9wZXJhdG9yTWV0YSA9IHJlYWRvbmx5IFtudW1iZXIsIG51bWJlciwgbnVtYmVyXTtcbmNvbnN0IEJJTkFSWSA9IDI7XG5jb25zdCBVTkFSWSA9IDE7XG5leHBvcnQgY29uc3QgQklOT1BTID0gbmV3IE1hcDxzdHJpbmcsIE9wZXJhdG9yTWV0YT4oW1xuICAvLyBTY29waW5nIG9wZXJhdG9yXG4gIC8vIFsnOjonLCBbOCwgMSwgQklOQVJZXV0sXG4gIC8vIE1lbW9yeSBoaW50c1xuICAvL1snOicsIFs2LCAwXV0sXG4gIC8vIE11bHRpcGxpY2F0aXZlIG9wZXJhdG9yczogbm90ZSB0aGF0IGJpdHdpc2UgYW5kIGFyaXRobWV0aWMgY2Fubm90IGFzc29jaWF0ZVxuICBbJyonLCBbNSwgNCwgQklOQVJZXV0sXG4gIFsnLycsIFs1LCA0LCBCSU5BUlldXSxcbiAgWycubW9kJywgWzUsIDMsIEJJTkFSWV1dLFxuICBbJyYnLCBbNSwgMiwgQklOQVJZXV0sXG4gIFsnXicsIFs1LCAxLCBCSU5BUlldXSxcbiAgWyc8PCcsIFs1LCAwLCBCSU5BUlldXSxcbiAgWyc+PicsIFs1LCAwLCBCSU5BUlldXSxcbiAgLy8gQXJpdGhtZXRpYyBvcGVyYXRvcnM6IG5vdGUgdGhhdCBiaXR3aXNlIGFuZCBhcml0aG1ldGljIGNhbm5vdCBhc3NvY2lhdGVcbiAgWycrJywgWzQsIDIsIEJJTkFSWV1dLFxuICBbJy0nLCBbNCwgMiwgQklOQVJZXV0sXG4gIFsnfCcsIFs0LCAxLCBCSU5BUlldXSxcbiAgLy8gQ29tcGFyaXNvbiBvcGVyYXRvcnNcbiAgWyc8JywgWzMsIDAsIEJJTkFSWV1dLFxuICBbJzw9JywgWzMsIDAsIEJJTkFSWV1dLFxuICBbJz4nLCBbMywgMCwgQklOQVJZXV0sXG4gIFsnPj0nLCBbMywgMCwgQklOQVJZXV0sXG4gIFsnPScsIFszLCAwLCBCSU5BUlldXSxcbiAgWyc8PicsIFszLCAwLCBCSU5BUlldXSxcbiAgLy8gTG9naWNhbCBvcGVyYXRvcnM6IGRpZmZlcmVudCBraW5kcyBjYW5ub3QgYXNzb2NpYXRlXG4gIFsnJiYnLCBbMiwgMywgQklOQVJZXV0sXG4gIFsnLnhvcicsIFsyLCAyLCBCSU5BUlldXSxcbiAgWyd8fCcsIFsyLCAxLCBCSU5BUlldXSxcbiAgLy8gQ29tbWFcbiAgLy9bJywnLCBbMSwgMV1dLFxuXSk7XG5cbmNvbnN0IFBSRUZJWE9QUyA9IG5ldyBNYXA8c3RyaW5nLCBPcGVyYXRvck1ldGE+KFtcbiAgLy8gWyc6OicsIFs5LCAtMSwgVU5BUlldXSwgLy8gZ2xvYmFsIHNjb3BlXG4gIFsnKycsIFs5LCAtMSwgVU5BUlldXSxcbiAgWyctJywgWzksIC0xLCBVTkFSWV1dLFxuICBbJ34nLCBbOSwgLTEsIFVOQVJZXV0sXG4gIFsnPCcsIFs5LCAtMSwgVU5BUlldXSxcbiAgWyc+JywgWzksIC0xLCBVTkFSWV1dLFxuICBbJ14nLCBbOSwgLTEsIFVOQVJZXV0sXG4gIFsnIScsIFsyLCAtMSwgVU5BUlldXSxcbl0pO1xuXG4vLyBUT0RPIC0gc2tpcDEgYW5kIHNraXAyIG1hY3Jvc1xuLy8gLm1hY3JvIHNraXAxXG4vLyAgIC5ieXRlICQyY1xuLy8gLmVuZG1hY3JvXG4vLyAubWFjcm8gc2tpcDJcbi8vICAgLmJ5dGUgJDRjXG4vLyAgIC5hc3NlcnQgLmJ5dGVhdCgqICsgMikgPCAkMjAgLm9yIFxcXG4vLyAgICAgICAgICAgLmJ5dGVhdCgqICsgMikgPj0gJDYwIC5vciBcXFxuLy8gICAgICAgICAgIC5ieXRlYXQoKiArIDEpICYgJDA3IC5pbiBbMiwzLDRdXG4vLyAuZW5kbWFjcm9cbi8vIE5PVEU6IGRhbmdlcm91cyByZWFkcyBhcmUgMjAwMiwgMjAwNCwgMjAwNyAocGx1cyBtaXJyb3JzKSwgNDAxNVxuLy8gVGhlbiB0aGUgYXNzZW1ibGVyIG5lZWRzIHRvIHVuZGVyc3RhbmQgdGhlIGZsb3cgb2YgdGhlc2UgdHdvIG9wcy4uLlxuLy8gb3IganVzdCBkaXNhc3NlbWJsZSBpdCBvbiB0aGUgZmx5P1xuY29uc3QgRlVOQ1RJT05TID0gbmV3IFNldDxzdHJpbmc+KFtcbiAgJy5ieXRlYXQnLFxuICAnLndvcmRhdCcsXG4gICcubWF4JywgJy5taW4nLFxuXSk7XG5cbmNvbnN0IE5BTUVfTUFQID0gbmV3IE1hcDxzdHJpbmcsIHN0cmluZz4oW1xuICBbJy5iaXRhbmQnLCAnJiddLFxuICBbJy5iaXR4b3InLCAnXiddLFxuICBbJy5iaXRvcicsICd8J10sXG4gIFsnLnNobCcsICc8PCddLFxuICBbJy5zaHInLCAnPj4nXSxcbiAgWycuYW5kJywgJyYmJ10sXG4gIFsnLm9yJywgJ3x8J10sXG4gIFsnLmJpdG5vdCcsICd+J10sXG4gIFsnLmxvYnl0ZScsICc8J10sXG4gIFsnLmhpYnl0ZScsICc+J10sXG4gIFsnLmJhbmtieXRlJywgJ14nXSwgLy8gPz8/IGhvdyB0byBpbXBsZW1lbnQgb24gbnVtYmVyP1xuICBbJy5ub3QnLCAnISddLFxuXSk7XG5cbmNvbnN0IFNJWkVfVFJBTlNGT1JNUyA9IG5ldyBNYXA8c3RyaW5nLCAoLi4uYXJnczogbnVtYmVyW10pID0+IG51bWJlcj4oW1xuICAvLyB1bmFyeTogYmFuayBieXRlOyBiaW5hcnk6IGJpdHhvclxuICBbJ14nLCAoLi4uYXJncykgPT4gYXJncy5sZW5ndGggPT09IDEgPyAxIDogTWF0aC5tYXgoLi4uYXJncyldLFxuICBbJzwnLCAoKSA9PiAxXSwgLy8gdW5hcnkgKGxvYnl0ZSkgYW5kIGJpbmFyeSAoY21wKSBib3RoIHNpbmdsZS1ieXRlXG4gIFsnPicsICgpID0+IDFdLCAvLyB1bmFyeSAoaGlieXRlKSBhbmQgYmluYXJ5IChjbXApIGJvdGggc2luZ2xlLWJ5dGVcbiAgWychJywgKCkgPT4gMV0sIC8vIG5vdCBhbHdheXMgMCBvciAxXG4gIFsnPD0nLCAoKSA9PiAxXSwgLy8gY21wXG4gIFsnPj0nLCAoKSA9PiAxXSwgLy8gY21wXG4gIFsnPD4nLCAoKSA9PiAxXSwgLy8gY21wXG4gIFsnPScsICgpID0+IDFdLCAvLyBjbXBcbiAgLy8gYml0d2lzZSBhbmQgbG9naWNhbCBvcGVyYXRvciByZXR1cm4gbWF4XG4gIFsnJicsIE1hdGgubWF4XSxcbiAgWycmJicsIE1hdGgubWF4XSxcbiAgWyd8JywgTWF0aC5tYXhdLFxuICBbJ3x8JywgTWF0aC5tYXhdLFxuICBbJy54b3InLCBNYXRoLm1heF0sXG4gIFsnLm1heCcsIE1hdGgubWF4XSxcbiAgWycubWluJywgTWF0aC5tYXhdLCAvLyBjb3VsZCB1c2UgbWluLCBidXQgbWF5IG5vdCBiZSBzYWZlIHcvIG5lZ2F0aXZlc1xuXSk7XG4gIFxuZnVuY3Rpb24gZml4U2l6ZShleHByOiBFeHByKTogRXhwciB7XG4gIGNvbnN0IHhmb3JtID0gU0laRV9UUkFOU0ZPUk1TLmdldChleHByLm9wKTtcbiAgY29uc3Qgc2l6ZSA9IHhmb3JtPy4oLi4uZXhwci5hcmdzIS5tYXAoZSA9PiBOdW1iZXIoZS5tZXRhPy5zaXplKSkpO1xuICBpZiAoc2l6ZSkgKGV4cHIubWV0YSB8fCAoZXhwci5tZXRhID0ge30pKS5zaXplID0gc2l6ZTtcbiAgcmV0dXJuIGV4cHI7XG59XG5cbmZ1bmN0aW9uIHNpemUobnVtOiBudW1iZXIpOiBFeHByLk1ldGEge1xuICByZXR1cm4ge3NpemU6IDAgPD0gbnVtICYmIG51bSA8IDI1NiA/IDEgOiAyfTtcbn1cblxuLy8gZnVuY3Rpb24gZmFpbChtc2c6IHN0cmluZyk6IG5ldmVyIHtcbi8vICAgdGhyb3cgbmV3IEVycm9yKG1zZyk7XG4vLyB9XG4iXX0=