export class Spoiler {
    constructor(rom) {
        this.rom = rom;
        this.slots = [];
        this.route = [];
        this.mazes = [];
        this.trades = [];
        this.walls = [];
        this.unidentifiedItems = [];
        this.wildWarps = [];
        this.houses = [];
        this.flags = '';
    }
    addCheck(condition, deps) {
        this.route.push(new Check(this, condition, deps));
    }
    addSlot(slot, slotName, item) {
        this.slots[slot & 0xff] =
            new Slot(this.rom, slot & 0xff, slotName, item & 0xff);
    }
    addMaze(id, name, maze) {
        this.mazes.push({ id, name, maze });
    }
    addTrade(itemId, item, npc) {
        this.trades.push({ itemId, item, npc });
    }
    addUnidentifiedItem(itemId, oldName, newName) {
        this.unidentifiedItems.push({ itemId, oldName, newName });
    }
    addWall(location, oldElement, newElement) {
        this.walls.push({ location, oldElement, newElement });
    }
    addWildWarp(id, name) {
        this.wildWarps.push({ id, name });
    }
    addHouse(houseId, townId) {
        this.houses.push({
            houseId, townId,
            house: this.rom.locations[houseId].name,
            town: this.rom.locations[townId].name,
        });
    }
    formatCondition(id) {
        var _a;
        return (_a = this.rom.flags[id]) === null || _a === void 0 ? void 0 : _a.name;
    }
    formatConditionList(conditions) {
        const terms = [];
        for (const c of conditions) {
            const f = this.rom.flags[c];
            if (f === null || f === void 0 ? void 0 : f.logic.track)
                terms.push(f.name);
        }
        return terms.join(', ');
    }
}
class Check {
    constructor(spoiler, condition, deps) {
        this.spoiler = spoiler;
        this.condition = condition;
        this.deps = deps;
    }
    toString() {
        let item = 0;
        if ((this.condition & ~0x7f) === 0x100) {
            item = 0x200 | this.spoiler.rom.slots[this.condition & 0xff];
        }
        return `${this.spoiler.formatCondition(this.condition)}${item ? ` (${this.spoiler.formatCondition(item)})` : ''}: [${this.spoiler.formatConditionList(this.deps)}]`;
    }
}
class Slot {
    constructor(rom, slot, slotName, item) {
        this.slot = slot;
        this.slotName = slotName;
        this.item = item;
        this.itemName = slotToItem(rom, item);
        this.originalItem = slotToItem(rom, slot);
    }
    toString() {
        return `${this.itemName}: ${this.slotName} (${this.originalItem})`;
    }
}
function slotToItem(rom, slot) {
    if (slot >= 0x70)
        return 'Mimic';
    return rom.items[rom.itemGets[slot].itemId].messageName;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic3BvaWxlci5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3NyYy9qcy9yb20vc3BvaWxlci50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFXQSxNQUFNLE9BQU8sT0FBTztJQWFsQixZQUFxQixHQUFRO1FBQVIsUUFBRyxHQUFILEdBQUcsQ0FBSztRQVpwQixVQUFLLEdBQVcsRUFBRSxDQUFDO1FBQ25CLFVBQUssR0FBWSxFQUFFLENBQUM7UUFDcEIsVUFBSyxHQUFXLEVBQUUsQ0FBQztRQUNuQixXQUFNLEdBQVksRUFBRSxDQUFDO1FBQ3JCLFVBQUssR0FBVyxFQUFFLENBQUM7UUFDbkIsc0JBQWlCLEdBQXVCLEVBQUUsQ0FBQztRQUMzQyxjQUFTLEdBQWUsRUFBRSxDQUFDO1FBQzNCLFdBQU0sR0FBWSxFQUFFLENBQUM7UUFDOUIsVUFBSyxHQUFXLEVBQUUsQ0FBQztJQUlhLENBQUM7SUFFakMsUUFBUSxDQUFDLFNBQWlCLEVBQUUsSUFBdUI7UUFDakQsSUFBSSxDQUFDLEtBQUssQ0FBQyxJQUFJLENBQUMsSUFBSSxLQUFLLENBQUMsSUFBSSxFQUFFLFNBQVMsRUFBRSxJQUFJLENBQUMsQ0FBQyxDQUFDO0lBQ3BELENBQUM7SUFFRCxPQUFPLENBQUMsSUFBWSxFQUFFLFFBQWdCLEVBQUUsSUFBWTtRQUNsRCxJQUFJLENBQUMsS0FBSyxDQUFDLElBQUksR0FBRyxJQUFJLENBQUM7WUFDbkIsSUFBSSxJQUFJLENBQUMsSUFBSSxDQUFDLEdBQUcsRUFBRSxJQUFJLEdBQUcsSUFBSSxFQUFFLFFBQVEsRUFBRSxJQUFJLEdBQUcsSUFBSSxDQUFDLENBQUM7SUFDN0QsQ0FBQztJQUVELE9BQU8sQ0FBQyxFQUFVLEVBQUUsSUFBWSxFQUFFLElBQVk7UUFDNUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxJQUFJLENBQUMsRUFBQyxFQUFFLEVBQUUsSUFBSSxFQUFFLElBQUksRUFBQyxDQUFDLENBQUM7SUFDcEMsQ0FBQztJQUVELFFBQVEsQ0FB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QUFZLEdBQVEsRUFDQyxJQUFZLEVBQ1osUUFBZ0IsRUFDaEIsSUFBWTtRQUZaLFNBQUksR0FBSixJQUFJLENBQVE7UUFDWixhQUFRLEdBQVIsUUFBUSxDQUFRO1FBQ2hCLFNBQUksR0FBSixJQUFJLENBQVE7UUFDL0IsSUFBSSxDQUFDLFFBQVEsR0FBRyxVQUFVLENBQUMsR0FBRyxFQUFFLElBQUksQ0FBQyxDQUFDO1FBQ3RDLElBQUksQ0FBQyxZQUFZLEdBQUcsVUFBVSxDQUFDLEdBQUcsRUFBRSxJQUFJLENBQUMsQ0FBQztJQUM1QyxDQUFDO0lBRUQsUUFBUTtRQUVOLE9BQU8sR0FBRyxJQUFJLENBQUMsUUFBUSxLQUFLLElBQUksQ0FBQyxRQUFRLEtBQUssSUFBSSxDQUFDLFlBQVksR0FBRyxDQUFDO0lBQ3JFLENBQUM7Q0FDRjtBQUVELFNBQVMsVUFBVSxDQUFDLEdBQVEsRUFBRSxJQUFZO0lBQ3hDLElBQUksSUFBSSxJQUFJLElBQUk7UUFBRSxPQUFPLE9BQU8sQ0FBQztJQUNqQyxPQUFPLEdBQUcsQ0FBQyxLQUFLLENBQUMsR0FBRyxDQUFDLFFBQVEsQ0FBQyxJQUFJLENBQUMsQ0FBQyxNQUFNLENBQUMsQ0FBQyxXQUFXLENBQUM7QUFDMUQsQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7Um9tfSBmcm9tICcuLi9yb20uanMnO1xuXG4vKipcbiAqIFN0b3JlcyBvcmdhbml6ZWQgaW5mb3JtYXRpb24gYWJvdXQgdGhlIHNodWZmbGUsIGluY2x1ZGluZ1xuICogICAtIHdoaWNoIGl0ZW1zIGFyZSBpbiB3aGljaCBzbG90c1xuICogICAtIGEga25vd24td29ya2luZyByb3V0ZSB0aHJvdWdoIHRoZSBnYW1lXG4gKiAgIC0gd2hpY2ggZW5lbWllcyBhcmUgc2h1ZmZsZSB3aGVyZVxuICogICAtIGVuZW15IHZ1bG5lcmFiaWxpdGllc1xuICogICAtIGxvY2F0aW9uIGNvbm5lY3Rpb25zXG4gKiAgIC0gcm91dGVzIHRvIGVhY2ggYXJlYVxuICovXG5leHBvcnQgY2xhc3MgU3BvaWxlciB7XG4gIHJlYWRvbmx5IHNsb3RzOiBTbG90W10gPSBbXTtcbiAgcmVhZG9ubHkgcm91dGU6IENoZWNrW10gPSBbXTtcbiAgcmVhZG9ubHkgbWF6ZXM6IE1hemVbXSA9IFtdO1xuICByZWFkb25seSB0cmFkZXM6IFRyYWRlW10gPSBbXTtcbiAgcmVhZG9ubHkgd2FsbHM6IFdhbGxbXSA9IFtdO1xuICByZWFkb25seSB1bmlkZW50aWZpZWRJdGVtczogVW5pZGVudGlmaWVkSXRlbVtdID0gW107XG4gIHJlYWRvbmx5IHdpbGRXYXJwczogV2lsZFdhcnBbXSA9IFtdO1xuICByZWFkb25seSBob3VzZXM6IEhvdXNlW10gPSBbXTtcbiAgZmxhZ3M6IHN0cmluZyA9ICcnO1xuXG4gIC8vIFRPRE8gLSBzaG9wcywgYm9zcyB3ZWFrbmVzc2VzXG5cbiAgY29uc3RydWN0b3IocmVhZG9ubHkgcm9tOiBSb20pIHt9XG5cbiAgYWRkQ2hlY2soY29uZGl0aW9uOiBudW1iZXIsIGRlcHM6IHJlYWRvbmx5IG51bWJlcltdKTogdm9pZCB7XG4gICAgdGhpcy5yb3V0ZS5wdXNoKG5ldyBDaGVjayh0aGlzLCBjb25kaXRpb24sIGRlcHMpKTtcbiAgfVxuXG4gIGFkZFNsb3Qoc2xvdDogbnVtYmVyLCBzbG90TmFtZTogc3RyaW5nLCBpdGVtOiBudW1iZXIpOiB2b2lkIHtcbiAgICB0aGlzLnNsb3RzW3Nsb3QgJiAweGZmXSA9XG4gICAgICAgIG5ldyBTbG90KHRoaXMucm9tLCBzbG90ICYgMHhmZiwgc2xvdE5hbWUsIGl0ZW0gJiAweGZmKTtcbiAgfVxuXG4gIGFkZE1hemUoaWQ6IG51bWJlciwgbmFtZTogc3RyaW5nLCBtYXplOiBzdHJpbmcpOiB2b2lkIHtcbiAgICB0aGlzLm1hemVzLnB1c2goe2lkLCBuYW1lLCBtYXplfSk7XG4gIH1cblxuICBhZGRUcmFkZShpdGVtSWQ6IG51bWJlciwgaXRlbTogc3RyaW5nLCBucGM6IHN0cmluZyk6IHZvaWQge1xuICAgIHRoaXMudHJhZGVzLnB1c2goe2l0ZW1JZCwgaXRlbSwgbnBjfSk7XG4gIH1cblxuICBhZGRVbmlkZW50aWZpZWRJdGVtKGl0ZW1JZDogbnVtYmVyLCBvbGROYW1lOiBzdHJpbmcsIG5ld05hbWU6IHN0cmluZyk6IHZvaWQge1xuICAgIHRoaXMudW5pZGVudGlmaWVkSXRlbXMucHVzaCh7aXRlbUlkLCBvbGROYW1lLCBuZXdOYW1lfSk7XG4gIH1cblxuICBhZGRXYWxsKGxvY2F0aW9uOiBzdHJpbmcsIG9sZEVsZW1lbnQ6IG51bWJlciwgbmV3RWxlbWVudDogbnVtYmVyKTogdm9pZCB7XG4gICAgdGhpcy53YWxscy5wdXNoKHtsb2NhdGlvbiwgb2xkRWxlbWVudCwgbmV3RWxlbWVudH0pO1xuICB9XG5cbiAgYWRkV2lsZFdhcnAoaWQ6IG51bWJlciwgbmFtZTogc3RyaW5nKTogdm9pZCB7XG4gICAgdGhpcy53aWxkV2FycHMucHVzaCh7aWQsIG5hbWV9KTtcbiAgfVxuXG4gIGFkZEhvdXNlKGhvdXNlSWQ6IG51bWJlciwgdG93bklkOiBudW1iZXIpOiB2b2lkIHtcbiAgICB0aGlzLmhvdXNlcy5wdXNoKHtcbiAgICAgIGhvdXNlSWQsIHRvd25JZCxcbiAgICAgIGhvdXNlOiB0aGlzLnJvbS5sb2NhdGlvbnNbaG91c2VJZF0ubmFtZSxcbiAgICAgIHRvd246IHRoaXMucm9tLmxvY2F0aW9uc1t0b3duSWRdLm5hbWUsXG4gICAgfSk7XG4gIH1cblxuICBmb3JtYXRDb25kaXRpb24oaWQ6IG51bWJlcik6IHN0cmluZyB7XG4gICAgcmV0dXJuIHRoaXMucm9tLmZsYWdzW2lkXT8ubmFtZVxuICB9XG5cbiAgZm9ybWF0Q29uZGl0aW9uTGlzdChjb25kaXRpb25zOiByZWFkb25seSBudW1iZXJbXSk6IHN0cmluZyB7XG4gICAgY29uc3QgdGVybXM6IHN0cmluZ1tdID0gW107XG4gICAgZm9yIChjb25zdCBjIG9mIGNvbmRpdGlvbnMpIHtcbiAgICAgIGNvbnN0IGYgPSB0aGlzLnJvbS5mbGFnc1tjXTtcbiAgICAgIGlmIChmPy5sb2dpYy50cmFjaykgdGVybXMucHVzaChmLm5hbWUpO1xuICAgIH1cbiAgICByZXR1cm4gdGVybXMuam9pbignLCAnKTtcbiAgfVxufVxuXG5pbnRlcmZhY2UgTWF6ZSB7XG4gIGlkOiBudW1iZXI7XG4gIG5hbWU6IHN0cmluZztcbiAgbWF6ZTogc3RyaW5nO1xufVxuXG5pbnRlcmZhY2UgVHJhZGUge1xuICBpdGVtSWQ6IG51bWJlcjtcbiAgaXRlbTogc3RyaW5nO1xuICBucGM6IHN0cmluZztcbn1cblxuaW50ZXJmYWNlIFVuaWRlbnRpZmllZEl0ZW0ge1xuICBpdGVtSWQ6IG51bWJlcjtcbiAgb2xkTmFtZTogc3RyaW5nO1xuICBuZXdOYW1lOiBzdHJpbmc7XG59XG5cbmludGVyZmFjZSBXYWxsIHtcbiAgbG9jYXRpb246IHN0cmluZztcbiAgb2xkRWxlbWVudDogbnVtYmVyO1xuICBuZXdFbGVtZW50OiBudW1iZXI7XG59XG5cbmludGVyZmFjZSBXaWxkV2FycCB7XG4gIGlkOiBudW1iZXI7XG4gIG5hbWU6IHN0cmluZztcbn1cblxuaW50ZXJmYWNlIEhvdXNlIHtcbiAgaG91c2VJZDogbnVtYmVyO1xuICBob3VzZTogc3RyaW5nO1xuICB0b3duSWQ6IG51bWJlcjtcbiAgdG93bjogc3RyaW5nO1xufVxuXG5jbGFzcyBDaGVjayB7XG4gIGNvbnN0cnVjdG9yKHJlYWRvbmx5IHNwb2lsZXI6IFNwb2lsZXIsXG4gICAgICAgICAgICAgIHJlYWRvbmx5IGNvbmRpdGlvbjogbnVtYmVyLFxuICAgICAgICAgICAgICByZWFkb25seSBkZXBzOiByZWFkb25seSBudW1iZXJbXSkge31cblxuICB0b1N0cmluZygpOiBzdHJpbmcge1xuICAgIGxldCBpdGVtID0gMDtcbiAgICBpZiAoKHRoaXMuY29uZGl0aW9uICYgfjB4N2YpID09PSAweDEwMCkge1xuICAgICAgaXRlbSA9IDB4MjAwIHwgdGhpcy5zcG9pbGVyLnJvbS5zbG90c1t0aGlzLmNvbmRpdGlvbiAmIDB4ZmZdO1xuICAgIH1cbiAgICByZXR1cm4gYCR7dGhpcy5zcG9pbGVyLmZvcm1hdENvbmRpdGlvbih0aGlzLmNvbmRpdGlvbil9JHtcbiAgICAgICAgICAgIGl0ZW0gPyBgICgke3RoaXMuc3BvaWxlci5mb3JtYXRDb25kaXRpb24oaXRlbSl9KWAgOiAnJ1xuICAgICAgICAgICAgfTogWyR7dGhpcy5zcG9pbGVyLmZvcm1hdENvbmRpdGlvbkxpc3QodGhpcy5kZXBzKX1dYDtcbiAgfVxufVxuXG5jbGFzcyBTbG90IHtcbiAgcmVhZG9ubHkgaXRlbU5hbWU6IHN0cmluZztcbiAgcmVhZG9ubHkgb3JpZ2luYWxJdGVtOiBzdHJpbmc7XG5cbiAgY29uc3RydWN0b3Iocm9tOiBSb20sXG4gICAgICAgICAgICAgIHJlYWRvbmx5IHNsb3Q6IG51bWJlcixcbiAgICAgICAgICAgICAgcmVhZG9ubHkgc2xvdE5hbWU6IHN0cmluZyxcbiAgICAgICAgICAgICAgcmVhZG9ubHkgaXRlbTogbnVtYmVyKSB7XG4gICAgdGhpcy5pdGVtTmFtZSA9IHNsb3RUb0l0ZW0ocm9tLCBpdGVtKTtcbiAgICB0aGlzLm9yaWdpbmFsSXRlbSA9IHNsb3RUb0l0ZW0ocm9tLCBzbG90KTtcbiAgfVxuXG4gIHRvU3RyaW5nKCk6IHN0cmluZyB7XG4gICAgLy8gRmlndXJlIG91dCB0aGUgbmFtZSBvZiB0aGUgc2xvdCwgdGhlIG9yaWdpbmFsIGl0ZW0sIGV0Y1xuICAgIHJldHVybiBgJHt0aGlzLml0ZW1OYW1lfTogJHt0aGlzLnNsb3ROYW1lfSAoJHt0aGlzLm9yaWdpbmFsSXRlbX0pYDtcbiAgfVxufVxuXG5mdW5jdGlvbiBzbG90VG9JdGVtKHJvbTogUm9tLCBzbG90OiBudW1iZXIpOiBzdHJpbmcge1xuICBpZiAoc2xvdCA+PSAweDcwKSByZXR1cm4gJ01pbWljJztcbiAgcmV0dXJuIHJvbS5pdGVtc1tyb20uaXRlbUdldHNbc2xvdF0uaXRlbUlkXS5tZXNzYWdlTmFtZTtcbn1cbiJdfQ==