import { die } from '../assert.js';
import { Address, Segment, readLittleEndian, upperCamelToSpaces } from './util.js';
const { $0f, $1b } = Segment;
export class Bosses {
    constructor(rom) {
        this.rom = rom;
        this.Vampire1 = new Boss(this, {
            flag: this.rom.flags.Vampire1,
            kill: 0x0,
            npc: this.rom.npcs.Vampire1,
            shuffled: true,
            sword: 1,
        });
        this.Insect = new Boss(this, {
            flag: this.rom.flags.GiantInsect,
            kill: 0x1,
            npc: this.rom.npcs.Insect,
            sword: 1,
        });
        this.Kelbesque1 = new Boss(this, {
            flag: this.rom.flags.Kelbesque1,
            kill: 0x2,
            npc: this.rom.npcs.Kelbesque1,
            shuffled: true,
        });
        this.Rage = new Boss(this, {
            flag: this.rom.flags.Rage,
            kill: 0x3,
            npc: this.rom.npcs.Rage,
        });
        this.Sabera1 = new Boss(this, {
            address: 0x3656e,
            flag: this.rom.flags.Sabera1,
            kill: 0x4,
            npc: this.rom.npcs.SaberaDisguisedAsMesia,
            shuffled: true,
        });
        this.Vampire2 = new Boss(this, {
            flag: this.rom.flags.Vampire2,
            kill: 0xc,
            npc: this.rom.npcs.Vampire2,
            shuffled: true,
            sword: 1,
        });
        this.Mado1 = new Boss(this, {
            address: 0x3d820,
            flag: this.rom.flags.Mado1,
            kill: 0x5,
            shuffled: true,
        });
        this.Kelbesque2 = new Boss(this, {
            flag: this.rom.flags.Kelbesque2,
            kill: 0x6,
            npc: this.rom.npcs.Kelbesque2,
            shuffled: true,
        });
        this.Sabera2 = new Boss(this, {
            flag: this.rom.flags.Sabera2,
            kill: 0x7,
            npc: this.rom.npcs.Sabera2,
            shuffled: true,
        });
        this.Mado2 = new Boss(this, {
            flag: this.rom.flags.Mado2,
            kill: 0x8,
            npc: this.rom.npcs.Mado2,
            shuffled: true,
        });
        this.Karmine = new Boss(this, {
            flag: this.rom.flags.Karmine,
            kill: 0x9,
            npc: this.rom.npcs.Karmine,
            shuffled: true,
            sword: 2,
        });
        this.Draygon1 = new Boss(this, {
            flag: this.rom.flags.Draygon1,
            kill: 0xa,
            npc: this.rom.npcs.Draygon,
            shuffled: true,
            sword: 2,
        });
        this.StatueOfMoon = new Boss(this, {
            flag: this.rom.flags.UsedBowOfMoon,
            npc: this.rom.npcs.StatueOfMoon,
        });
        this.StatueOfSun = new Boss(this, {
            flag: this.rom.flags.UsedBowOfSun,
            npc: this.rom.npcs.StatueOfSun,
        });
        this.Draygon2 = new Boss(this, {
            flag: this.rom.flags.Draygon2,
            kill: 0xb,
            npc: this.rom.npcs.Draygon,
        });
        this.Dyna = new Boss(this, {
            kill: 0xd,
            object: 0xa4,
        });
        this.musics = [
            new BossMusic($0f, 0xa4b8, [this.Vampire1, this.Vampire2]),
            new BossMusic($0f, 0xa690, [this.Insect]),
            new BossMusic($0f, 0xa99b, [this.Kelbesque1, this.Kelbesque2]),
            new BossMusic($0f, 0xacb1, [this.Sabera1, this.Sabera2]),
            new BossMusic($0f, 0xae0f, [this.Mado1, this.Mado2]),
            new BossMusic($0f, 0xaf83, [this.Karmine]),
            new BossMusic($0f, 0xb187, [this.Draygon1]),
            new BossMusic($0f, 0xb311, [this.Draygon2]),
            new BossMusic($1b, 0xbc30, [this.Dyna]),
        ];
        this.all = [];
        for (const key in this) {
            if (!this.hasOwnProperty(key))
                continue;
            const boss = this[key];
            if (boss instanceof Boss) {
                boss.name = upperCamelToSpaces(key);
                this.all.push(boss);
            }
        }
    }
    isBossFlag(flag) {
        const flags = this.flags || (this.flags = (() => {
            const f = new Set();
            for (const boss of this.all) {
                if (boss.flag != null)
                    f.add(boss.flag.id);
            }
            return f;
        })());
        return flags.has(flag);
    }
    fromLocation(id) {
        return this.all.find(b => b.location === id);
    }
    fromBossKill(num) {
        return this.all.find(b => b.kill === num);
    }
    fromObject(id) {
        return this.all.find(b => b.object === id);
    }
    [Symbol.iterator]() {
        return this.all[Symbol.iterator]();
    }
    write() {
        const a = this.rom.assembler();
        for (const music of this.musics) {
            music.addr.loc(a);
            a.byte(music.bgm);
        }
        return [a.module()];
    }
}
export class BossMusic {
    constructor(seg, org, bosses) {
        this.bosses = bosses;
        this.addr = Address.of(seg, org);
        const rom = bosses[0].bosses.rom;
        this.bgm = this.addr.read(rom.prg);
    }
}
export class Boss {
    constructor(bosses, { flag, npc, kill, shuffled, address, sword = 3, object }) {
        this.bosses = bosses;
        const { prg } = bosses.rom;
        this.flag = flag;
        this.npc = npc;
        this.object =
            address ? prg[address] : npc ? npc.data[1] : object !== null && object !== void 0 ? object : die(`address, npc, or object is required`);
        this.swordLevel = sword;
        this.shuffled = Boolean(shuffled);
        this.kill = kill;
        if (kill != null) {
            const killAddr = 0x14000 + readLittleEndian(prg, 0x1f96b + 2 * kill);
            const drop = prg[killAddr + 4];
            if (drop !== 0xff)
                this.drop = drop;
            this.location = prg[0x1f95d + kill];
        }
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYm9zc2VzLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vc3JjL2pzL3JvbS9ib3NzZXMudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQ0EsT0FBTyxFQUFDLEdBQUcsRUFBQyxNQUFNLGNBQWMsQ0FBQztBQUlqQyxPQUFPLEVBQVUsT0FBTyxFQUFFLE9BQU8sRUFDekIsZ0JBQWdCLEVBQUUsa0JBQWtCLEVBQUMsTUFBTSxXQUFXLENBQUM7QUFFL0QsTUFBTSxFQUFDLEdBQUcsRUFBRSxHQUFHLEVBQUMsR0FBRyxPQUFPLENBQUM7QUFpQjNCLE1BQU0sT0FBTyxNQUFNO0lBK0dqQixZQUFxQixHQUFRO1FBQVIsUUFBRyxHQUFILEdBQUcsQ0FBSztRQTdHcEIsYUFBUSxHQUFHLElBQUksSUFBSSxDQUFDLElBQUksRUFBRTtZQUNqQyxJQUFJLEVBQUUsSUFBSSxDQUFDLEdBQUcsQ0FBQyxLQUFLLENBQUMsUUFBUTtZQUM3QixJQUFJLEVBQUUsR0FBRztZQUNULEdBQUcsRUFBRSxJQUFJLENBQUMsR0FBRyxDQUFDLElBQUksQ0FBQyxRQUFRO1lBQzNCLFFBQVEsRUFBRSxJQUFJO1lBQ2QsS0FBSyxFQUFFLENBQUM7U0FDVCxDQUFDLENBQUM7UUFDTSxXQUFNLEdBQUcsSUFBSSxJQUFJLENBQUMsSUFBSSxFQUFFO1lBQy9CLElBQUksRUFBRSxJQUFJLENBQUMsR0FBRyxDQUFDLEtBQUssQ0FBQyxXQUFXO1lBQ2hDLElBQUksRUFBRSxHQUFHO1lBQ1QsR0FBRyxFQUFFLElBQUksQ0FBQyxHQUFHLENBQUMsSUFBSSxDQUFDLE1BQU07WUFDekIsS0FBSyxFQUFFLENBQUM7U0FDVCxDQUFDLENBQUM7UUFDTSxlQUFVLEdBQUcsSUFBSSxJQUFJLENBQUMsSUFBSSxFQUFFO1lBQ25DLElBQUksRUFBRSxJQUFJLENBQUMsR0FBRyxDQUFDLEtBQUssQ0FBQyxVQUFVO1lBQy9CLElBQUksRUFBRSxHQUFHO1lBQ1QsR0FBRyxFQUFFLElBQUksQ0FB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QUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FDNUMsTUFBTSxhQUFOLE1BQU0sY0FBTixNQUFNLEdBQUksR0FBRyxDQUFDLHFDQUFxQyxDQUFDLENBQUM7UUFDekQsSUFBSSxDQUFDLFVBQVUsR0FBRyxLQUFLLENBQUM7UUFDeEIsSUFBSSxDQUFDLFFBQVEsR0FBRyxPQUFPLENBQUMsUUFBUSxDQUFDLENBQUM7UUFDbEMsSUFBSSxDQUFDLElBQUksR0FBRyxJQUFJLENBQUM7UUFDakIsSUFBSSxJQUFJLElBQUksSUFBSSxFQUFFO1lBQ2hCLE1BQU0sUUFBUSxHQUFHLE9BQU8sR0FBRyxnQkFBZ0IsQ0FBQyxHQUFHLEVBQUUsT0FBTyxHQUFHLENBQUMsR0FBRyxJQUFJLENBQUMsQ0FBQztZQUNyRSxNQUFNLElBQUksR0FBRyxHQUFHLENBQUMsUUFBUSxHQUFHLENBQUMsQ0FBQyxDQUFDO1lBQy9CLElBQUksSUFBSSxLQUFLLElBQUk7Z0JBQUUsSUFBSSxDQUFDLElBQUksR0FBRyxJQUFJLENBQUM7WUFDcEMsSUFBSSxDQUFDLFFBQVEsR0FBRyxHQUFHLENBQUMsT0FBTyxHQUFHLElBQUksQ0FBQyxDQUFDO1NBQ3JDO0lBQ0gsQ0FBQztDQUNGIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHtNb2R1bGV9IGZyb20gJy4uL2FzbS9tb2R1bGUuanMnO1xuaW1wb3J0IHtkaWV9IGZyb20gJy4uL2Fzc2VydC5qcyc7XG5pbXBvcnQge1JvbX0gZnJvbSAnLi4vcm9tLmpzJztcbmltcG9ydCB7RmxhZ30gZnJvbSAnLi9mbGFncy5qcyc7XG5pbXBvcnQge05wY30gZnJvbSAnLi9ucGMuanMnO1xuaW1wb3J0IHtNdXRhYmxlLCBBZGRyZXNzLCBTZWdtZW50LFxuICAgICAgICByZWFkTGl0dGxlRW5kaWFuLCB1cHBlckNhbWVsVG9TcGFjZXN9IGZyb20gJy4vdXRpbC5qcyc7XG5cbmNvbnN0IHskMGYsICQxYn0gPSBTZWdtZW50O1xuXG5pbnRlcmZhY2UgQm9zc0RhdGEge1xuICByZWFkb25seSBmbGFnPzogRmxhZztcbiAgcmVhZG9ubHkgbnBjPzogTnBjO1xuICByZWFkb25seSBraWxsPzogbnVtYmVyO1xuICByZWFkb25seSBzaHVmZmxlZD86IGJvb2xlYW47XG4gIHJlYWRvbmx5IGFkZHJlc3M/OiBudW1iZXI7XG4gIHJlYWRvbmx5IHN3b3JkPzogbnVtYmVyO1xuICByZWFkb25seSBvYmplY3Q/OiBudW1iZXI7XG59XG5cbi8vIFRPRE8gLSB3ZSBuZWVkIGEgY29uc2lzdGVudCB3YXkgdG8gcmVmZXIgdG8gYm9zc2VzLi4uXG4vLyAgLSBtYXliZSBib3NzZXMuZnJvbU5wY0lkKCksIGJvc3Nlcy5mcm9tT2JqZWN0SWQoKSwgYm9zc2VzLmZyb21Cb3NzS2lsbCgpXG5cbi8vIFJlcHJlc2VudHMgYSBib3NzIHNsb3QuICBOb3RlIHRoYXQgdGhlIHNwZWNpZmljIG9iamVjdCBpcyB0aWVkIG1vc3QgdGlnaHRseVxuLy8gdG8gdGhlIGJvc3Mga2lsbCAoZHJvcCksIHJhdGhlciB0aGFuIHRoZSBzcGVjaWZpYyBpZGVudGl0eSBvZiB0aGUgYm9zcy5cbmV4cG9ydCBjbGFzcyBCb3NzZXMgaW1wbGVtZW50cyBJdGVyYWJsZTxCb3NzPiB7XG5cbiAgcmVhZG9ubHkgVmFtcGlyZTEgPSBuZXcgQm9zcyh0aGlzLCB7XG4gICAgZmxhZzogdGhpcy5yb20uZmxhZ3MuVmFtcGlyZTEsXG4gICAga2lsbDogMHgwLFxuICAgIG5wYzogdGhpcy5yb20ubnBjcy5WYW1waXJlMSxcbiAgICBzaHVmZmxlZDogdHJ1ZSxcbiAgICBzd29yZDogMSxcbiAgfSk7XG4gIHJlYWRvbmx5IEluc2VjdCA9IG5ldyBCb3NzKHRoaXMsIHtcbiAgICBmbGFnOiB0aGlzLnJvbS5mbGFncy5HaWFudEluc2VjdCxcbiAgICBraWxsOiAweDEsXG4gICAgbnBjOiB0aGlzLnJvbS5ucGNzLkluc2VjdCxcbiAgICBzd29yZDogMSxcbiAgfSk7XG4gIHJlYWRvbmx5IEtlbGJlc3F1ZTEgPSBuZXcgQm9zcyh0aGlzLCB7XG4gICAgZmxhZzogdGhpcy5yb20uZmxhZ3MuS2VsYmVzcXVlMSxcbiAgICBraWxsOiAweDIsXG4gICAgbnBjOiB0aGlzLnJvbS5ucGNzLktlbGJlc3F1ZTEsXG4gICAgc2h1ZmZsZWQ6IHRydWUsXG4gIH0pO1xuICByZWFkb25seSBSYWdlID0gbmV3IEJvc3ModGhpcywge1xuICAgIGZsYWc6IHRoaXMucm9tLmZsYWdzLlJhZ2UsXG4gICAga2lsbDogMHgzLFxuICAgIG5wYzogdGhpcy5yb20ubnBjcy5SYWdlLFxuICB9KTtcbiAgcmVhZG9ubHkgU2FiZXJhMSA9IG5ldyBCb3NzKHRoaXMsIHtcbiAgICBhZGRyZXNzOiAweDM2NTZlLFxuICAgIGZsYWc6IHRoaXMucm9tLmZsYWdzLlNhYmVyYTEsXG4gICAga2lsbDogMHg0LFxuICAgIG5wYzogdGhpcy5yb20ubnBjcy5TYWJlcmFEaXNndWlzZWRBc01lc2lhLFxuICAgIHNodWZmbGVkOiB0cnVlLFxuICB9KTtcbiAgcmVhZG9ubHkgVmFtcGlyZTIgPSBuZXcgQm9zcyh0aGlzLCB7XG4gICAgZmxhZzogdGhpcy5yb20uZmxhZ3MuVmFtcGlyZTIsXG4gICAga2lsbDogMHhjLFxuICAgIG5wYzogdGhpcy5yb20ubnBjcy5WYW1waXJlMixcbiAgICBzaHVmZmxlZDogdHJ1ZSxcbiAgICBzd29yZDogMSxcbiAgfSk7XG4gIHJlYWRvbmx5IE1hZG8xID0gbmV3IEJvc3ModGhpcywge1xuICAgIGFkZHJlc3M6IDB4M2Q4MjAsXG4gICAgZmxhZzogdGhpcy5yb20uZmxhZ3MuTWFkbzEsXG4gICAga2lsbDogMHg1LFxuICAgIHNodWZmbGVkOiB0cnVlLFxuICB9KTtcbiAgcmVhZG9ubHkgS2VsYmVzcXVlMiA9IG5ldyBCb3NzKHRoaXMsIHtcbiAgICBmbGFnOiB0aGlzLnJvbS5mbGFncy5LZWxiZXNxdWUyLFxuICAgIGtpbGw6IDB4NixcbiAgICBucGM6IHRoaXMucm9tLm5wY3MuS2VsYmVzcXVlMixcbiAgICBzaHVmZmxlZDogdHJ1ZSxcbiAgfSk7XG4gIHJlYWRvbmx5IFNhYmVyYTIgPSBuZXcgQm9zcyh0aGlzLCB7XG4gICAgZmxhZzogdGhpcy5yb20uZmxhZ3MuU2FiZXJhMixcbiAgICBraWxsOiAweDcsXG4gICAgbnBjOiB0aGlzLnJvbS5ucGNzLlNhYmVyYTIsXG4gICAgc2h1ZmZsZWQ6IHRydWUsXG4gIH0pO1xuICByZWFkb25seSBNYWRvMiA9IG5ldyBCb3NzKHRoaXMsIHtcbiAgICBmbGFnOiB0aGlzLnJvbS5mbGFncy5NYWRvMixcbiAgICBraWxsOiAweDgsXG4gICAgbnBjOiB0aGlzLnJvbS5ucGNzLk1hZG8yLFxuICAgIHNodWZmbGVkOiB0cnVlLFxuICB9KTtcbiAgcmVhZG9ubHkgS2FybWluZSA9IG5ldyBCb3NzKHRoaXMsIHtcbiAgICBmbGFnOiB0aGlzLnJvbS5mbGFncy5LYXJtaW5lLFxuICAgIGtpbGw6IDB4OSxcbiAgICBucGM6IHRoaXMucm9tLm5wY3MuS2FybWluZSxcbiAgICBzaHVmZmxlZDogdHJ1ZSxcbiAgICBzd29yZDogMixcbiAgfSk7XG4gIHJlYWRvbmx5IERyYXlnb24xID0gbmV3IEJvc3ModGhpcywge1xuICAgIGZsYWc6IHRoaXMucm9tLmZsYWdzLkRyYXlnb24xLFxuICAgIGtpbGw6IDB4YSxcbiAgICBucGM6IHRoaXMucm9tLm5wY3MuRHJheWdvbixcbiAgICBzaHVmZmxlZDogdHJ1ZSxcbiAgICBzd29yZDogMixcbiAgfSk7XG4gIHJlYWRvbmx5IFN0YXR1ZU9mTW9vbiA9IG5ldyBCb3NzKHRoaXMsIHtcbiAgICBmbGFnOiB0aGlzLnJvbS5mbGFncy5Vc2VkQm93T2ZNb29uLFxuICAgIG5wYzogdGhpcy5yb20ubnBjcy5TdGF0dWVPZk1vb24sXG4gIH0pO1xuICByZWFkb25seSBTdGF0dWVPZlN1biA9IG5ldyBCb3NzKHRoaXMsIHtcbiAgICBmbGFnOiB0aGlzLnJvbS5mbGFncy5Vc2VkQm93T2ZTdW4sXG4gICAgbnBjOiB0aGlzLnJvbS5ucGNzLlN0YXR1ZU9mU3VuLFxuICB9KTtcbiAgcmVhZG9ubHkgRHJheWdvbjIgPSBuZXcgQm9zcyh0aGlzLCB7XG4gICAgZmxhZzogdGhpcy5yb20uZmxhZ3MuRHJheWdvbjIsXG4gICAga2lsbDogMHhiLFxuICAgIG5wYzogdGhpcy5yb20ubnBjcy5EcmF5Z29uLFxuICB9KTtcbiAgcmVhZG9ubHkgRHluYSA9IG5ldyBCb3NzKHRoaXMsIHtcbiAgICBraWxsOiAweGQsXG4gICAgb2JqZWN0OiAweGE0LFxuICB9KTtcblxuICByZWFkb25seSBtdXNpY3MgPSBbXG4gICAgbmV3IEJvc3NNdXNpYygkMGYsIDB4YTRiOCwgW3RoaXMuVmFtcGlyZTEsIHRoaXMuVmFtcGlyZTJdKSxcbiAgICBuZXcgQm9zc011c2ljKCQwZiwgMHhhNjkwLCBbdGhpcy5JbnNlY3RdKSxcbiAgICBuZXcgQm9zc011c2ljKCQwZiwgMHhhOTliLCBbdGhpcy5LZWxiZXNxdWUxLCB0aGlzLktlbGJlc3F1ZTJdKSxcbiAgICBuZXcgQm9zc011c2ljKCQwZiwgMHhhY2IxLCBbdGhpcy5TYWJlcmExLCB0aGlzLlNhYmVyYTJdKSxcbiAgICBuZXcgQm9zc011c2ljKCQwZiwgMHhhZTBmLCBbdGhpcy5NYWRvMSwgdGhpcy5NYWRvMl0pLFxuICAgIG5ldyBCb3NzTXVzaWMoJDBmLCAweGFmODMsIFt0aGlzLkthcm1pbmVdKSxcbiAgICBuZXcgQm9zc011c2ljKCQwZiwgMHhiMTg3LCBbdGhpcy5EcmF5Z29uMV0pLFxuICAgIG5ldyBCb3NzTXVzaWMoJDBmLCAweGIzMTEsIFt0aGlzLkRyYXlnb24yXSksXG4gICAgbmV3IEJvc3NNdXNpYygkMWIsIDB4YmMzMCwgW3RoaXMuRHluYV0pLFxuICBdO1xuXG4gIHByaXZhdGUgcmVhZG9ubHkgYWxsOiBCb3NzW10gPSBbXTtcbiAgcHJpdmF0ZSBmbGFncz86IFNldDxudW1iZXI+O1xuXG4gIGNvbnN0cnVjdG9yKHJlYWRvbmx5IHJvbTogUm9tKSB7XG4gICAgZm9yIChjb25zdCBrZXkgaW4gdGhpcykge1xuICAgICAgaWYgKCF0aGlzLmhhc093blByb3BlcnR5KGtleSkpIGNvbnRpbnVlO1xuICAgICAgY29uc3QgYm9zcyA9IHRoaXNba2V5XTtcbiAgICAgIGlmIChib3NzIGluc3RhbmNlb2YgQm9zcykge1xuICAgICAgICAoYm9zcyBhcyBNdXRhYmxlPEJvc3M+KS5uYW1lID0gdXBwZXJDYW1lbFRvU3BhY2VzKGtleSk7XG4gICAgICAgIHRoaXMuYWxsLnB1c2goYm9zcyk7XG4gICAgICB9XG4gICAgfVxuICB9XG5cbiAgaXNCb3NzRmxhZyhmbGFnOiBudW1iZXIpOiBib29sZWFuIHtcbiAgICBjb25zdCBmbGFncyA9IHRoaXMuZmxhZ3MgfHwgKHRoaXMuZmxhZ3MgPSAoKCkgPT4ge1xuICAgICAgY29uc3QgZiA9IG5ldyBTZXQ8bnVtYmVyPigpO1xuICAgICAgZm9yIChjb25zdCBib3NzIG9mIHRoaXMuYWxsKSB7XG4gICAgICAgIGlmIChib3NzLmZsYWcgIT0gbnVsbCkgZi5hZGQoYm9zcy5mbGFnLmlkKTtcbiAgICAgIH1cbiAgICAgIHJldHVybiBmO1xuICAgIH0pKCkpO1xuICAgIHJldHVybiBmbGFncy5oYXMoZmxhZyk7XG4gIH1cblxuICBmcm9tTG9jYXRpb24oaWQ6IG51bWJlcik6IEJvc3N8dW5kZWZpbmVkIHtcbiAgICByZXR1cm4gdGhpcy5hbGwuZmluZChiID0+IGIubG9jYXRpb24gPT09IGlkKTtcbiAgfVxuXG4gIGZyb21Cb3NzS2lsbChudW06IG51bWJlcik6IEJvc3N8dW5kZWZpbmVkIHtcbiAgICByZXR1cm4gdGhpcy5hbGwuZmluZChiID0+IGIua2lsbCA9PT0gbnVtKTtcbiAgfVxuXG4gIGZyb21PYmplY3QoaWQ6IG51bWJlcik6IEJvc3N8dW5kZWZpbmVkIHtcbiAgICByZXR1cm4gdGhpcy5hbGwuZmluZChiID0+IGIub2JqZWN0ID09PSBpZCk7XG4gIH1cblxuICBbU3ltYm9sLml0ZXJhdG9yXSgpOiBJdGVyYWJsZUl0ZXJhdG9yPEJvc3M+IHtcbiAgICByZXR1cm4gdGhpcy5hbGxbU3ltYm9sLml0ZXJhdG9yXSgpO1xuICB9XG5cbiAgd3JpdGUoKTogTW9kdWxlW10ge1xuICAgIGNvbnN0IGEgPSB0aGlzLnJvbS5hc3NlbWJsZXIoKTtcbiAgICBmb3IgKGNvbnN0IG11c2ljIG9mIHRoaXMubXVzaWNzKSB7XG4gICAgICBtdXNpYy5hZGRyLmxvYyhhKTtcbiAgICAgIGEuYnl0ZShtdXNpYy5iZ20pO1xuICAgIH1cbiAgICByZXR1cm4gW2EubW9kdWxlKCldO1xuICB9XG59XG5cbmV4cG9ydCBjbGFzcyBCb3NzTXVzaWMge1xuICBiZ206IG51bWJlcjtcbiAgcmVhZG9ubHkgYWRkcjogQWRkcmVzcztcblxuICBjb25zdHJ1Y3RvcihzZWc6IFNlZ21lbnQsIG9yZzogbnVtYmVyLCByZWFkb25seSBib3NzZXM6IHJlYWRvbmx5IEJvc3NbXSkge1xuICAgIHRoaXMuYWRkciA9IEFkZHJlc3Mub2Yoc2VnLCBvcmcpO1xuICAgIGNvbnN0IHJvbSA9IGJvc3Nlc1swXS5ib3NzZXMucm9tOyAvLyBwdWxsIGl0IG91dCBvZiBzb21ld2hlcmVcbiAgICB0aGlzLmJnbSA9IHRoaXMuYWRkci5yZWFkKHJvbS5wcmcpO1xuICB9XG59XG5cbi8vIE5PVEU6IGN1cnJlbnRseSB0aGlzIGRhdGEgaXMgcmVhZC1vbmx5LlxuZXhwb3J0IGNsYXNzIEJvc3Mge1xuXG4gIC8vIFRPRE8gLSBtYWtlIG9iamVjdCBzZXR0YWJsZT9cbiAgcmVhZG9ubHkgbmFtZSE6IHN0cmluZztcbiAgcmVhZG9ubHkgb2JqZWN0OiBudW1iZXI7XG4gIHJlYWRvbmx5IGZsYWc/OiBGbGFnO1xuICByZWFkb25seSBucGM/OiBOcGM7XG4gIHJlYWRvbmx5IHN3b3JkTGV2ZWw6IG51bWJlcjtcbiAgcmVhZG9ubHkgc2h1ZmZsZWQ6IGJvb2xlYW47XG4gIHJlYWRvbmx5IGRyb3A/OiBudW1iZXI7XG4gIHJlYWRvbmx5IGtpbGw/OiBudW1iZXI7XG4gIHJlYWRvbmx5IGxvY2F0aW9uPzogbnVtYmVyO1xuXG4gIC8vIE9ubHkgdXNlZCBmb3IgbG9naWMuXG4gIGNvbnN0cnVjdG9yKHJlYWRvbmx5IGJvc3NlczogQm9zc2VzLFxuICAgICAgICAgICAgICB7ZmxhZywgbnBjLCBraWxsLCBzaHVmZmxlZCxcbiAgICAgICAgICAgICAgIGFkZHJlc3MsIHN3b3JkID0gMywgb2JqZWN0fTogQm9zc0RhdGEpIHtcbiAgICBjb25zdCB7cHJnfSA9IGJvc3Nlcy5yb207XG4gICAgdGhpcy5mbGFnID0gZmxhZztcbiAgICB0aGlzLm5wYyA9IG5wYztcbiAgICB0aGlzLm9iamVjdCA9XG4gICAgICAgIGFkZHJlc3MgPyBwcmdbYWRkcmVzc10gOiBucGMgPyBucGMuZGF0YVsxXSA6XG4gICAgICAgIG9iamVjdCA/PyBkaWUoYGFkZHJlc3MsIG5wYywgb3Igb2JqZWN0IGlzIHJlcXVpcmVkYCk7XG4gICAgdGhpcy5zd29yZExldmVsID0gc3dvcmQ7XG4gICAgdGhpcy5zaHVmZmxlZCA9IEJvb2xlYW4oc2h1ZmZsZWQpO1xuICAgIHRoaXMua2lsbCA9IGtpbGw7XG4gICAgaWYgKGtpbGwgIT0gbnVsbCkge1xuICAgICAgY29uc3Qga2lsbEFkZHIgPSAweDE0MDAwICsgcmVhZExpdHRsZUVuZGlhbihwcmcsIDB4MWY5NmIgKyAyICoga2lsbCk7XG4gICAgICBjb25zdCBkcm9wID0gcHJnW2tpbGxBZGRyICsgNF07XG4gICAgICBpZiAoZHJvcCAhPT0gMHhmZikgdGhpcy5kcm9wID0gZHJvcDtcbiAgICAgIHRoaXMubG9jYXRpb24gPSBwcmdbMHgxZjk1ZCArIGtpbGxdO1xuICAgIH1cbiAgfVxufVxuIl19