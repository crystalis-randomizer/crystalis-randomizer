import { DefaultMap } from '../util.js';
export class Graphics {
    constructor(rom) {
        this.rom = rom;
        this.palettes = new Uint32Array(0x400);
        this.tiles = new DefaultMap((() => {
            return (key) => {
                const data = new Uint32Array(64);
                const uint8 = new Uint8Array(data.buffer);
                data.fill(0);
                const pal = (key & 0xff) << 2;
                const id = key >>> 8;
                const pat = this.rom.patterns.get(id);
                for (let r = 0; r < 8; r++) {
                    let hi = pat.pixels[8 | r] << 1;
                    let lo = pat.pixels[r];
                    for (let c = 7; c >= 0; c--) {
                        const z = hi & 2 | lo & 1;
                        hi >>>= 1;
                        lo >>>= 1;
                        if (z)
                            data[r << 3 | c] = this.palettes[pal | z];
                    }
                }
                return uint8;
            };
        })());
        this.metatiles = new DefaultMap((() => {
            const canvas = document.createElement('canvas');
            canvas.width = canvas.height = 16;
            const ctx = canvas.getContext('2d');
            return (key) => {
                ctx.clearRect(0, 0, 16, 16);
                const pal = key % 256;
                key = Math.floor(key / 256);
                const id = key >>> 24;
                const pats = [(key >>> 16) & 0xff, (key >>> 8) & 0xff];
                const ts = this.rom.tilesets[key & 0xff];
                for (let r = 0; r < 2; r++) {
                    for (let c = 0; c < 2; c++) {
                        const tile = ts.tiles[r << 1 | c][id];
                        const data = this.tiles.get(pats[tile >>> 7] << 14 | (tile & 0x7f) << 8 | pal);
                        const imgData = ctx.getImageData(c << 3, r << 3, 8, 8);
                        imgData.data.set(data);
                        ctx.putImageData(imgData, c << 3, r << 3);
                    }
                }
                return canvas.toDataURL('image/png');
            };
        })());
        this.rebuildPalettes();
    }
    rebuildPalettes() {
        for (let i = 0; i < 0x100; i++) {
            for (let j = 0; j < 4; j++) {
                const color = COLORS[this.rom.palettes[i].color(j)];
                this.palettes[i << 2 | j] = color | 0xff000000;
            }
        }
    }
    metatile(id, pats, tileset, pal) {
        return this.metatiles.get(id * 0x100000000 + (pats[0] << 24 | pats[1] << 16 | tileset << 8 | pal));
    }
    paletteCss(id, index = 0) {
        const rgb = this.palettes[id << 2 | index];
        return `rgb(${rgb & 0xff}, ${rgb >> 8 & 0xff}, ${rgb >> 16 & 0xff})`;
    }
}
const COLORS = [
    0x525252, 0xB40000, 0xA00000, 0xB1003D, 0x740069, 0x00005B, 0x00005F, 0x001840,
    0x002F10, 0x084A08, 0x006700, 0x124200, 0x6D2800, 0x000000, 0x000000, 0x000000,
    0xC4D5E7, 0xFF4000, 0xDC0E22, 0xFF476B, 0xD7009F, 0x680AD7, 0x0019BC, 0x0054B1,
    0x006A5B, 0x008C03, 0x00AB00, 0x2C8800, 0xA47200, 0x000000, 0x000000, 0x000000,
    0xF8F8F8, 0xFFAB3C, 0xFF7981, 0xFF5BC5, 0xFF48F2, 0xDF49FF, 0x476DFF, 0x00B4F7,
    0x00E0FF, 0x00E375, 0x03F42B, 0x78B82E, 0xE5E218, 0x787878, 0x000000, 0x000000,
    0xFFFFFF, 0xFFF2BE, 0xF8B8B8, 0xF8B8D8, 0xFFB6FF, 0xFFC3FF, 0xC7D1FF, 0x9ADAFF,
    0x88EDF8, 0x83FFDD, 0xB8F8B8, 0xF5F8AC, 0xFFFFB0, 0xF8D8F8, 0x000000, 0x000000,
];
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZ3JhcGhpY3MuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi9zcmMvanMvZWRpdC9ncmFwaGljcy50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFDQSxPQUFPLEVBQUMsVUFBVSxFQUFDLE1BQU0sWUFBWSxDQUFDO0FBRXRDLE1BQU0sT0FBTyxRQUFRO0lBeURuQixZQUFxQixHQUFRO1FBQVIsUUFBRyxHQUFILEdBQUcsQ0FBSztRQXREN0IsYUFBUSxHQUFHLElBQUksV0FBVyxDQUFDLEtBQUssQ0FBQyxDQUFDO1FBR2xDLFVBQUssR0FBRyxJQUFJLFVBQVUsQ0FBcUIsQ0FBQyxHQUFHLEVBQUU7WUFDL0MsT0FBTyxDQUFDLEdBQVcsRUFBRSxFQUFFO2dCQUNyQixNQUFNLElBQUksR0FBRyxJQUFJLFdBQVcsQ0FBQyxFQUFFLENBQUMsQ0FBQztnQkFDakMsTUFBTSxLQUFLLEdBQUcsSUFBSSxVQUFVLENBQUMsSUFBSSxDQUFDLE1BQU0sQ0FBQyxDQUFDO2dCQUMxQyxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxDQUFDO2dCQUNiLE1BQU0sR0FBRyxHQUFHLENBQUMsR0FBRyxHQUFHLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQztnQkFDOUIsTUFBTSxFQUFFLEdBQUcsR0FBRyxLQUFLLENBQUMsQ0FBQztnQkFHckIsTUFBTSxHQUFHLEdBQUcsSUFBSSxDQUFDLEdBQUcsQ0FBQyxRQUFRLENBQUMsR0FBRyxDQUFDLEVBQUUsQ0FBQyxDQUFDO2dCQUN0QyxLQUFLLElBQUksQ0FBQyxHQUFHLENBQUMsRUFBRSxDQUFDLEdBQUcsQ0FBQyxFQUFFLENBQUMsRUFBRSxFQUFFO29CQUMxQixJQUFJLEVBQUUsR0FBRyxHQUFHLENBQUMsTUFBTSxDQUFDLENBQUMsR0FBRyxDQUFDLENBQUMsSUFBSSxDQUFDLENBQUM7b0JBQ2hDLElBQUksRUFBRSxHQUFHLEdBQUcsQ0FBQyxNQUFNLENBQUMsQ0FBQyxDQUFDLENBQUM7b0JBQ3ZCLEtB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UUFBUSxFQUFFLFFBQVEsRUFBRSxRQUFRO0lBQzlFLFFBQVEsRUFBRSxRQUFRLEVBQUUsUUFBUSxFQUFFLFFBQVEsRUFBRSxRQUFRLEVBQUUsUUFBUSxFQUFFLFFBQVEsRUFBRSxRQUFRO0lBQzlFLFFBQVEsRUFBRSxRQUFRLEVBQUUsUUFBUSxFQUFFLFFBQVEsRUFBRSxRQUFRLEVBQUUsUUFBUSxFQUFFLFFBQVEsRUFBRSxRQUFRO0lBQzlFLFFBQVEsRUFBRSxRQUFRLEVBQUUsUUFBUSxFQUFFLFFBQVEsRUFBRSxRQUFRLEVBQUUsUUFBUSxFQUFFLFFBQVEsRUFBRSxRQUFRO0lBQzlFLFFBQVEsRUFBRSxRQUFRLEVBQUUsUUFBUSxFQUFFLFFBQVEsRUFBRSxRQUFRLEVBQUUsUUFBUSxFQUFFLFFBQVEsRUFBRSxRQUFRO0lBQzlFLFFBQVEsRUFBRSxRQUFRLEVBQUUsUUFBUSxFQUFFLFFBQVEsRUFBRSxRQUFRLEVBQUUsUUFBUSxFQUFFLFFBQVEsRUFBRSxRQUFRO0lBQzlFLFFBQVEsRUFBRSxRQUFRLEVBQUUsUUFBUSxFQUFFLFFBQVEsRUFBRSxRQUFRLEVBQUUsUUFBUSxFQUFFLFFBQVEsRUFBRSxRQUFRO0lBQzlFLFFBQVEsRUFBRSxRQUFRLEVBQUUsUUFBUSxFQUFFLFFBQVEsRUFBRSxRQUFRLEVBQUUsUUFBUSxFQUFFLFFBQVEsRUFBRSxRQUFRO0NBQy9FLENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQge1JvbX0gZnJvbSAnLi4vcm9tLmpzJztcbmltcG9ydCB7RGVmYXVsdE1hcH0gZnJvbSAnLi4vdXRpbC5qcyc7XG5cbmV4cG9ydCBjbGFzcyBHcmFwaGljcyB7XG5cbiAgLyoqIGtleSBpcyAoaWQpKGluZGV4KSAqL1xuICBwYWxldHRlcyA9IG5ldyBVaW50MzJBcnJheSgweDQwMCk7XG5cbiAgLyoqIGtleSBpcyAodGlsZWlkKShwYWxldHRlKSAqL1xuICB0aWxlcyA9IG5ldyBEZWZhdWx0TWFwPG51bWJlciwgVWludDhBcnJheT4oKCgpID0+IHtcbiAgICByZXR1cm4gKGtleTogbnVtYmVyKSA9PiB7XG4gICAgICBjb25zdCBkYXRhID0gbmV3IFVpbnQzMkFycmF5KDY0KTtcbiAgICAgIGNvbnN0IHVpbnQ4ID0gbmV3IFVpbnQ4QXJyYXkoZGF0YS5idWZmZXIpO1xuICAgICAgZGF0YS5maWxsKDApO1xuICAgICAgY29uc3QgcGFsID0gKGtleSAmIDB4ZmYpIDw8IDI7XG4gICAgICBjb25zdCBpZCA9IGtleSA+Pj4gODtcblxuICAgICAgLy8gUGxvdCBvbiBjYW52YXNcbiAgICAgIGNvbnN0IHBhdCA9IHRoaXMucm9tLnBhdHRlcm5zLmdldChpZCk7XG4gICAgICBmb3IgKGxldCByID0gMDsgciA8IDg7IHIrKykge1xuICAgICAgICBsZXQgaGkgPSBwYXQucGl4ZWxzWzggfCByXSA8PCAxO1xuICAgICAgICBsZXQgbG8gPSBwYXQucGl4ZWxzW3JdO1xuICAgICAgICBmb3IgKGxldCBjID0gNzsgYyA+PSAwOyBjLS0pIHtcbiAgICAgICAgICBjb25zdCB6ID0gaGkgJiAyIHwgbG8gJiAxO1xuICAgICAgICAgIGhpID4+Pj0gMTtcbiAgICAgICAgICBsbyA+Pj49IDE7XG4gICAgICAgICAgaWYgKHopIGRhdGFbciA8PCAzIHwgY10gPSB0aGlzLnBhbGV0dGVzW3BhbCB8IHpdO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgICByZXR1cm4gdWludDg7XG4gICAgfTtcbiAgfSkoKSk7XG5cbiAgLyoqIGtleSBpcyA0MCBiaXRzOiAoaWQpKHBhdDApKHBhdDEpKHRpbGVzZXQpKHBhbCkgKi9cbiAgbWV0YXRpbGVzID0gbmV3IERlZmF1bHRNYXA8bnVtYmVyLCBzdHJpbmc+KCgoKSA9PiB7XG4gICAgY29uc3QgY2FudmFzID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnY2FudmFzJyk7XG4gICAgY2FudmFzLndpZHRoID0gY2FudmFzLmhlaWdodCA9IDE2O1xuICAgIGNvbnN0IGN0eCA9IGNhbnZhcy5nZXRDb250ZXh0KCcyZCcpITtcbiAgICByZXR1cm4gKGtleTogbnVtYmVyKSA9PiB7XG4gICAgICBjdHguY2xlYXJSZWN0KDAsIDAsIDE2LCAxNik7XG4gICAgICBjb25zdCBwYWwgPSBrZXkgJSAyNTY7XG4gICAgICBrZXkgPSBNYXRoLmZsb29yKGtleSAvIDI1Nik7XG4gICAgICBjb25zdCBpZCA9IGtleSA+Pj4gMjQ7XG4gICAgICBjb25zdCBwYXRzID0gWyhrZXkgPj4+IDE2KSAmIDB4ZmYsIChrZXkgPj4+IDgpICYgMHhmZl07XG4gICAgICBjb25zdCB0cyA9IHRoaXMucm9tLnRpbGVzZXRzW2tleSAmIDB4ZmZdO1xuICAgICAgLy8gUGxvdCBvbiB0aGUgY2FudmFzXG4gICAgICBmb3IgKGxldCByID0gMDsgciA8IDI7IHIrKykge1xuICAgICAgICBmb3IgKGxldCBjID0gMDsgYyA8IDI7IGMrKykge1xuICAgICAgICAgIGNvbnN0IHRpbGUgPSB0cy50aWxlc1tyIDw8IDEgfCBjXVtpZF07XG4gICAgICAgICAgY29uc3QgZGF0YSA9XG4gICAgICAgICAgICAgIHRoaXMudGlsZXMuZ2V0KHBhdHNbdGlsZSA+Pj4gN10gPDwgMTQgfCAodGlsZSAmIDB4N2YpIDw8IDggfCBwYWwpO1xuICAgICAgICAgIGNvbnN0IGltZ0RhdGEgPSBjdHguZ2V0SW1hZ2VEYXRhKGMgPDwgMywgciA8PCAzLCA4LCA4KTtcbiAgICAgICAgICBpbWdEYXRhLmRhdGEuc2V0KGRhdGEpO1xuICAgICAgICAgIGN0eC5wdXRJbWFnZURhdGEoaW1nRGF0YSwgYyA8PCAzLCByIDw8IDMpO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgICByZXR1cm4gY2FudmFzLnRvRGF0YVVSTCgnaW1hZ2UvcG5nJyk7ICAgICAgXG4gICAgfTtcbiAgfSkoKSk7XG5cbiAgY29uc3RydWN0b3IocmVhZG9ubHkgcm9tOiBSb20pIHtcbiAgICB0aGlzLnJlYnVpbGRQYWxldHRlcygpO1xuICB9XG5cbiAgcmVidWlsZFBhbGV0dGVzKCkge1xuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgMHgxMDA7IGkrKykge1xuICAgICAgZm9yIChsZXQgaiA9IDA7IGogPCA0OyBqKyspIHtcbiAgICAgICAgY29uc3QgY29sb3IgPSBDT0xPUlNbdGhpcy5yb20ucGFsZXR0ZXNbaV0uY29sb3IoaildO1xuICAgICAgICB0aGlzLnBhbGV0dGVzW2kgPDwgMiB8IGpdID0gY29sb3IgfCAweGZmMDAwMDAwO1xuICAgICAgfVxuICAgIH1cbiAgfVxuXG4gIG1ldGF0aWxlKGlkOiBudW1iZXIsIHBhdHM6IFtudW1iZXIsIG51bWJlcl0sIHRpbGVzZXQ6IG51bWJlciwgcGFsOiBudW1iZXIpOiBzdHJpbmcge1xuICAgIHJldHVybiB0aGlzLm1ldGF0aWxlcy5nZXQoXG4gICAgICAgIGlkICogMHgxMDAwMDAwMDAgKyAocGF0c1swXSA8PCAyNCB8IHBhdHNbMV0gPDwgMTYgfCB0aWxlc2V0IDw8IDggfCBwYWwpKTtcbiAgfVxuXG4gIHBhbGV0dGVDc3MoaWQ6IG51bWJlciwgaW5kZXg6IG51bWJlciA9IDApOiBzdHJpbmcge1xuICAgIGNvbnN0IHJnYiA9IHRoaXMucGFsZXR0ZXNbaWQgPDwgMiB8IGluZGV4XTtcbiAgICByZXR1cm4gYHJnYigke3JnYiAmIDB4ZmZ9LCAke3JnYiA+PiA4ICYgMHhmZn0sICR7cmdiID4+IDE2ICYgMHhmZn0pYDtcbiAgfVxufVxuXG5jb25zdCBDT0xPUlMgPSBbXG4gIDB4NTI1MjUyLCAweEI0MDAwMCwgMHhBMDAwMDAsIDB4QjEwMDNELCAweDc0MDA2OSwgMHgwMDAwNUIsIDB4MDAwMDVGLCAweDAwMTg0MCxcbiAgMHgwMDJGMTAsIDB4MDg0QTA4LCAweDAwNjcwMCwgMHgxMjQyMDAsIDB4NkQyODAwLCAweDAwMDAwMCwgMHgwMDAwMDAsIDB4MDAwMDAwLFxuICAweEM0RDVFNywgMHhGRjQwMDAsIDB4REMwRTIyLCAweEZGNDc2QiwgMHhENzAwOUYsIDB4NjgwQUQ3LCAweDAwMTlCQywgMHgwMDU0QjEsXG4gIDB4MDA2QTVCLCAweDAwOEMwMywgMHgwMEFCMDAsIDB4MkM4ODAwLCAweEE0NzIwMCwgMHgwMDAwMDAsIDB4MDAwMDAwLCAweDAwMDAwMCxcbiAgMHhGOEY4RjgsIDB4RkZBQjNDLCAweEZGNzk4MSwgMHhGRjVCQzUsIDB4RkY0OEYyLCAweERGNDlGRiwgMHg0NzZERkYsIDB4MDBCNEY3LFxuICAweDAwRTBGRiwgMHgwMEUzNzUsIDB4MDNGNDJCLCAweDc4QjgyRSwgMHhFNUUyMTgsIDB4Nzg3ODc4LCAweDAwMDAwMCwgMHgwMDAwMDAsXG4gIDB4RkZGRkZGLCAweEZGRjJCRSwgMHhGOEI4QjgsIDB4RjhCOEQ4LCAweEZGQjZGRiwgMHhGRkMzRkYsIDB4QzdEMUZGLCAweDlBREFGRixcbiAgMHg4OEVERjgsIDB4ODNGRkRELCAweEI4RjhCOCwgMHhGNUY4QUMsIDB4RkZGRkIwLCAweEY4RDhGOCwgMHgwMDAwMDAsIDB4MDAwMDAwLFxuXTtcbiJdfQ==