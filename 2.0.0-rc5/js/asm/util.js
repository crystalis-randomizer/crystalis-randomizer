export function binarySearch(n, f) {
    if (!n)
        return ~0;
    const fa = f(0);
    const fb = f(n - 1);
    if (fa < 0)
        return ~0;
    if (fa === 0)
        return 0;
    if (fb > 0)
        return ~n;
    if (fb === 0)
        return n - 1;
    let a = 0;
    let b = n - 1;
    while (b - a > 1) {
        const m = (a + b) >> 1;
        const fm = f(m);
        if (fm > 0) {
            a = m;
        }
        else if (fm < 0) {
            b = m;
        }
        else {
            return m;
        }
    }
    return ~b;
}
export function binaryInsert(arr, f, t) {
    const x = f(t);
    const index = binarySearch(arr.length, i => x < f(arr[i]) ? -1 : 1);
    arr.splice(~index, 0, t);
}
export class SparseArray {
    constructor() {
        this._chunks = [];
        this._length = 0;
    }
    get length() { return this._length; }
    _find(target) {
        return binarySearch(this._chunks.length, (i) => {
            const [start, data] = this._chunks[i];
            if (target < start)
                return -1;
            if (target >= start + data.length)
                return 1;
            return 0;
        });
    }
    apply(target) {
        if (target.length < this._length)
            throw new Error(`Target too small.`);
        for (const [start, chunk] of this._chunks) {
            for (let i = 0; i < chunk.length; i++) {
                target[start + i] = chunk[i];
            }
        }
    }
    chunks() {
        return this._chunks;
    }
    get(index) {
        let i = this._find(index);
        if (i < 0)
            return undefined;
        const [start, data] = this._chunks[i];
        return data[index - start];
    }
    set(start, ...values) {
        this.setInternal(start, values);
    }
    setInternal(start, values) {
        var _a;
        if (!values.length)
            return;
        const end = start + values.length;
        this._length = Math.max(this._length, end);
        let i0 = this._find(start);
        let i1 = this._find(end);
        if (i0 >= 0 && i0 === i1) {
            const [s0, a0] = this._chunks[i0];
            for (let i = 0; i < values.length; i++) {
                a0[start + i - s0] = values[i];
            }
            return;
        }
        const e0 = this._chunks[~i0 - 1];
        if (e0 && (e0[0] + e0[1].length === start))
            i0 = ~i0 - 1;
        if (((_a = this._chunks[~i1]) === null || _a === void 0 ? void 0 : _a[0]) === end)
            i1 = ~i1;
        if (i0 >= 0) {
            const [s0, a0] = this._chunks[i0];
            if (i1 !== i0 || !Array.isArray(values)) {
                values = spliceHead(a0, start - s0, values);
            }
            else {
                values.unshift(...a0.slice(0, start - s0));
            }
            start = s0;
        }
        if (i1 >= 0) {
            const [s1, a1] = this._chunks[i1];
            values = spliceTail(values, end - s1, a1);
        }
        let s = i0 < 0 ? ~i0 : i0;
        let e = i1 < 0 ? ~i1 : i1;
        if (i1 >= 0)
            e++;
        if (!Array.isArray(values))
            values = Array.from(values);
        this._chunks.splice(s, e - s, [start, values]);
    }
    splice(start, length = 1) {
        const end = start + length;
        let i0 = this._find(start);
        let i1 = this._find(end);
        let e0 = i0 >= 0 ? this._chunks[i0] : undefined;
        let e1 = i1 >= 0 ? this._chunks[i1] : undefined;
        if (e0) {
            const l0 = start - e0[0];
            if (l0) {
                e0 = [e0[0], e0 === e1 ? e0[1].slice(0, l0) : arrayHead(e0[1], l0)];
            }
            else {
                e0 = undefined;
                i0 = ~i0;
            }
        }
        if (e1) {
            e1 = [end, arrayTail(e1[1], end - e1[0])];
            if (!e1[1].length) {
                e1 = undefined;
                i1 = ~i1;
            }
        }
        const entries = [];
        if (e0)
            entries.push(e0);
        if (e1)
            entries.push(e1);
        let s = i0 < 0 ? ~i0 : i0;
        let e = i1 < 0 ? ~i1 : i1;
        if (i1 >= 0)
            e++;
        this._chunks.splice(s, e - s, ...entries);
    }
    slice(start, end) {
        if (end <= start)
            return [];
        const i = this._find(start);
        if (i < 0)
            throw new Error(`Absent: ${start}`);
        const [s, a] = this._chunks[i];
        if (s + a.length < end)
            throw new Error(`Absent: ${s + a.length}`);
        return a.slice(start - s, end - s);
    }
}
export class SparseByteArray extends SparseArray {
    set(start, ...args) {
        this.setInternal(start, args[0] instanceof Uint8Array ?
            args[0] : Uint8Array.from(args));
    }
    search(needle, start, end) {
        return this.pattern(needle).search(start, end);
    }
    pattern(needle) {
        if (!needle.length)
            return { search: (start = 0) => start };
        const len = needle.length;
        const charTable = new Array(256).fill(len);
        for (let i = 0; i < needle.length; i++) {
            charTable[needle[i]] = len - 1 - i;
        }
        const offsetTable = [];
        let lastPrefixPos = len;
        for (let i = len; i > 0; --i) {
            if (isPrefix(i)) {
                lastPrefixPos = i;
            }
            offsetTable[len - i] = lastPrefixPos - i + len;
            for (let i = 0; i < len - 1; ++i) {
                const slen = suffixLength(i);
                offsetTable[slen] = len - 1 - i + slen;
            }
        }
        return { search: (start = 0, end = this._length) => {
                if (!this._chunks.length || end < start)
                    return -1;
                let k = this._find(start);
                let i0 = 0;
                if (k >= 0) {
                    i0 = start - this._chunks[k][0];
                }
                else {
                    k = ~k;
                }
                while (k < this._chunks.length) {
                    const [offset, haystack] = this._chunks[k++];
                    const i1 = Math.min(end - offset, haystack.length);
                    if (i1 < 0)
                        break;
                    for (let i = len - 1 + i0, j; i < i1;) {
                        for (j = len - 1; needle[j] === haystack[i]; --i, --j) {
                            if (j === 0)
                                return i + offset;
                        }
                        i += Math.max(offsetTable[len - 1 - j], charTable[haystack[i]]);
                    }
                    i0 = 0;
                }
                return -1;
            } };
        function isPrefix(p) {
            for (let i = p, j = 0; i < len; ++i, ++j) {
                if (needle[i] !== needle[j])
                    return false;
            }
            return true;
        }
        function suffixLength(p) {
            let out = 0;
            for (let i = p, j = len - 1; i >= 0 && needle[i] === needle[j]; --i, --j) {
                ++out;
            }
            return out;
        }
    }
    addOffset(offset) {
        const out = new SparseByteArray();
        for (const [start, data] of this._chunks) {
            out._chunks.push([start + offset, data]);
        }
        return out;
    }
    toIpsPatch() {
        let size = 8;
        for (const [, chunk] of this._chunks) {
            size += 5 + chunk.length;
        }
        const buffer = new Uint8Array(size);
        let i = 5;
        buffer[0] = 0x50;
        buffer[1] = 0x41;
        buffer[2] = 0x54;
        buffer[3] = 0x43;
        buffer[4] = 0x48;
        for (const [start, chunk] of this._chunks) {
            if (chunk.length > 0xffff)
                throw new Error(`Oops!`);
            buffer[i++] = start >>> 16;
            buffer[i++] = (start >>> 8) & 0xff;
            buffer[i++] = start & 0xff;
            buffer[i++] = chunk.length >>> 8;
            buffer[i++] = chunk.length & 0xff;
            buffer.subarray(i, i + chunk.length).set(chunk);
            i += chunk.length;
        }
        buffer[i] = 0x45;
        buffer[i + 1] = 0x4f;
        buffer[i + 2] = 0x46;
        return buffer;
    }
    toIpsHexString() {
        const bytes = [...this.toIpsPatch()];
        const lines = [];
        for (let i = 0; i < bytes.length; i += 16) {
            lines.push([i.toString(16).padStart(8, '0') + ':',
                ...bytes.slice(i, i + 16)
                    .map(x => x.toString(16).padStart(2, '0'))].join(' '));
        }
        return lines.join('\n');
    }
}
function spliceHead(a0, i, a1) {
    const l0 = a0.length;
    if (a1.length < l0 || !Array.isArray(a1)) {
        a0.splice(i, l0 - i, ...a1);
        return a0;
    }
    a1.unshift(...arrayHead(a0, i));
    return a1;
}
function spliceTail(a0, i, a1) {
    const l1 = a1.length;
    if (a0.length < l1 || !Array.isArray(a0)) {
        a1.splice(0, i, ...a0);
        return a1;
    }
    a0.push(...arrayTail(a1, i));
    return a0;
}
function arrayHead(arr, i) {
    const l = arr.length;
    if ((i << 1) < l) {
        return arr.slice(0, i);
    }
    arr.splice(i, l - i);
    return arr;
}
function arrayTail(arr, i) {
    const l = arr.length;
    if ((i << 1) < l) {
        arr.splice(0, i);
        return arr;
    }
    return arr.slice(i);
}
export class BitSet {
    constructor() {
        this.data = new Uint8Array(16);
    }
    add(i) {
        const byte = i >>> 3;
        if (byte >= this.data.length) {
            let newSize = this.data.length;
            while (newSize <= byte)
                newSize <<= 1;
            const newData = new Uint8Array(newSize);
            newData.subarray(0, this.data.length).set(this.data);
            this.data = newData;
        }
        this.data[byte] |= (1 << (i & 7));
    }
    delete(i) {
        const byte = i >>> 3;
        if (byte < this.data.length)
            this.data[byte] &= ~(1 << (i & 7));
    }
    has(i) {
        return Boolean((this.data[i >>> 3] || 0) & (1 << (i & 7)));
    }
}
export class IntervalSet {
    constructor() {
        this.data = [];
    }
    [Symbol.iterator]() {
        return this.data[Symbol.iterator]();
    }
    _find(v) {
        return binarySearch(this.data.length, (i) => {
            const entry = this.data[i];
            if (v < entry[0])
                return -1;
            if (v >= entry[1])
                return 1;
            return 0;
        });
    }
    has(x) {
        return this._find(x) >= 0;
    }
    add(start, end) {
        var _a, _b;
        let i0 = this._find(start);
        let i1 = this._find(end);
        if (((_a = this.data[~i0 - 1]) === null || _a === void 0 ? void 0 : _a[1]) === start)
            i0 = ~i0 - 1;
        if (((_b = this.data[~i1]) === null || _b === void 0 ? void 0 : _b[0]) === end)
            i1 = ~i1;
        const entry = [start, end];
        if (i0 >= 0)
            entry[0] = this.data[i0][0];
        if (i1 >= 0)
            entry[1] = this.data[i1][1];
        let s = i0 < 0 ? ~i0 : i0;
        let e = i1 < 0 ? ~i1 : i1;
        if (i1 >= 0)
            e++;
        this.data.splice(s, e - s, entry);
    }
    delete(start, end) {
        let i0 = this._find(start);
        let i1 = this._find(end);
        let e0 = i0 >= 0 ? this.data[i0] : undefined;
        let e1 = i1 >= 0 ? this.data[i1] : undefined;
        if (e0) {
            e0 = [e0[0], Math.min(e0[1], start)];
            if (e0[0] === e0[1]) {
                e0 = undefined;
                i0 = ~i0;
            }
        }
        if (e1) {
            e1 = [Math.max(e1[0], end), e1[1]];
            if (e1[0] === e1[1]) {
                e1 = undefined;
                i1 = ~i1;
            }
        }
        const entries = [];
        if (e0)
            entries.push(e0);
        if (e1)
            entries.push(e1);
        let s = i0 < 0 ? ~i0 : i0;
        let e = i1 < 0 ? ~i1 : i1;
        if (i1 >= 0)
            e++;
        this.data.splice(s, e - s, ...entries);
    }
    tail(x) {
        let index = this._find(x);
        if (index < 0)
            index = ~index;
        const data = this.data;
        return {
            [Symbol.iterator]() { return this; },
            next() {
                if (index >= data.length)
                    return { value: undefined, done: true };
                const e = data[index++];
                return { value: [Math.max(x, e[0]), e[1]], done: false };
            },
        };
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidXRpbC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3NyYy9qcy9hc20vdXRpbC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFDQSxNQUFNLFVBQVUsWUFBWSxDQUFDLENBQVMsRUFBRSxDQUF3QjtJQUM5RCxJQUFJLENBQUMsQ0FBQztRQUFFLE9BQU8sQ0FBQyxDQUFDLENBQUM7SUFDbEIsTUFBTSxFQUFFLEdBQUcsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDO0lBQ2hCLE1BQU0sRUFBRSxHQUFHLENBQUMsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUM7SUFDcEIsSUFBSSxFQUFFLEdBQUcsQ0FBQztRQUFFLE9BQU8sQ0FBQyxDQUFDLENBQUM7SUFDdEIsSUFBSSxFQUFFLEtBQUssQ0FBQztRQUFFLE9BQU8sQ0FBQyxDQUFDO0lBQ3ZCLElBQUksRUFBRSxHQUFHLENBQUM7UUFBRSxPQUFPLENBQUMsQ0FBQyxDQUFDO0lBQ3RCLElBQUksRUFBRSxLQUFLLENBQUM7UUFBRSxPQUFPLENBQUMsR0FBRyxDQUFDLENBQUM7SUFDM0IsSUFBSSxDQUFDLEdBQUcsQ0FBQyxDQUFDO0lBQ1YsSUFBSSxDQUFDLEdBQUcsQ0FBQyxHQUFHLENBQUMsQ0FBQztJQUNkLE9BQU8sQ0FBQyxHQUFHLENBQUMsR0FBRyxDQUFDLEVBQUU7UUFDaEIsTUFBTSxDQUFDLEdBQUcsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxDQUFDLElBQUksQ0FBQyxDQUFDO1FBQ3ZCLE1BQU0sRUFBRSxHQUFHLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQztRQUNoQixJQUFJLEVBQUUsR0FBRyxDQUFDLEVBQUU7WUFDVixDQUFDLEdBQUcsQ0FBQyxDQUFDO1NBQ1A7YUFBTSxJQUFJLEVBQUUsR0FBRyxDQUFDLEVBQUU7WUFDakIsQ0FBQyxHQUFHLENBQUMsQ0FBQztTQUNQO2FBQU07WUFDTCxPQUFPLENBQUMsQ0FBQztTQUNWO0tBQ0Y7SUFDRCxPQUFPLENBQUMsQ0FBQyxD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bGVtZW50IHdoZXJlIGZuIHJldHVybnMgMCwgb3Igfmluc2VydGlvbiBwb2ludFxuZXhwb3J0IGZ1bmN0aW9uIGJpbmFyeVNlYXJjaChuOiBudW1iZXIsIGY6IChpOiBudW1iZXIpID0+IG51bWJlcik6IG51bWJlciB7XG4gIGlmICghbikgcmV0dXJuIH4wO1xuICBjb25zdCBmYSA9IGYoMCk7XG4gIGNvbnN0IGZiID0gZihuIC0gMSk7XG4gIGlmIChmYSA8IDApIHJldHVybiB+MDtcbiAgaWYgKGZhID09PSAwKSByZXR1cm4gMDtcbiAgaWYgKGZiID4gMCkgcmV0dXJuIH5uO1xuICBpZiAoZmIgPT09IDApIHJldHVybiBuIC0gMTtcbiAgbGV0IGEgPSAwO1xuICBsZXQgYiA9IG4gLSAxO1xuICB3aGlsZSAoYiAtIGEgPiAxKSB7XG4gICAgY29uc3QgbSA9IChhICsgYikgPj4gMTtcbiAgICBjb25zdCBmbSA9IGYobSk7XG4gICAgaWYgKGZtID4gMCkge1xuICAgICAgYSA9IG07XG4gICAgfSBlbHNlIGlmIChmbSA8IDApIHtcbiAgICAgIGIgPSBtO1xuICAgIH0gZWxzZSB7XG4gICAgICByZXR1cm4gbTtcbiAgICB9XG4gIH1cbiAgcmV0dXJuIH5iO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gYmluYXJ5SW5zZXJ0PFQ+KGFycjogVFtdLCBmOiAodDogVCkgPT4gbnVtYmVyLCB0OiBUKSB7XG4gIGNvbnN0IHggPSBmKHQpO1xuICBjb25zdCBpbmRleCA9IGJpbmFyeVNlYXJjaChhcnIubGVuZ3RoLCBpID0+IHggPCBmKGFycltpXSkgPyAtMSA6IDEpO1xuICBhcnIuc3BsaWNlKH5pbmRleCwgMCwgdCk7XG59XG5cbmV4cG9ydCBjbGFzcyBTcGFyc2VBcnJheTxUPiB7XG4gIHByb3RlY3RlZCBfY2h1bmtzOiBBcnJheTxyZWFkb25seSBbbnVtYmVyLCBUW11dPiA9IFtdO1xuICBwcm90ZWN0ZWQgX2xlbmd0aDogbnVtYmVyID0gMDtcblxuICAvLyBOT1RFOiBsZW5ndGggaXMgYSBoaWdoIHdhdGVyIG1hcmsuXG4gIGdldCBsZW5ndGgoKSB7IHJldHVybiB0aGlzLl9sZW5ndGg7IH1cbiAgLy8gVE9ETyAtIHNldCBsZW5ndGggLSBtYXkgbmVlZCB0byBzcGxpY2VcbiAgLy8gIC0gYWx0ZXJuYXRpdmU6IHNocmluaygpIG1ldGhvZFxuXG4gIHByb3RlY3RlZCBfZmluZCh0YXJnZXQ6IG51bWJlcik6IG51bWJlciB7XG4gICAgcmV0dXJuIGJpbmFyeVNlYXJjaCh0aGlzLl9jaHVua3MubGVuZ3RoLCAoaTogbnVtYmVyKSA9PiB7XG4gICAgICBjb25zdCBbc3RhcnQsIGRhdGFdID0gdGhpcy5fY2h1bmtzW2ldO1xuICAgICAgaWYgKHRhcmdldCA8IHN0YXJ0KSByZXR1cm4gLTE7XG4gICAgICBpZiAodGFyZ2V0ID49IHN0YXJ0ICsgZGF0YS5sZW5ndGgpIHJldHVybiAxO1xuICAgICAgcmV0dXJuIDA7XG4gICAgfSk7XG4gIH1cblxuICBhcHBseSh0YXJnZXQ6IE11dGFibGVBcnJheUxpa2U8VD4pIHtcbiAgICBpZiAodGFyZ2V0Lmxlbmd0aCA8IHRoaXMuX2xlbmd0aCkgdGhyb3cgbmV3IEVycm9yKGBUYXJnZXQgdG9vIHNtYWxsLmApO1xuICAgIGZvciAoY29uc3QgW3N0YXJ0LCBjaHVua10gb2YgdGhpcy5fY2h1bmtzKSB7XG4gICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGNodW5rLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgIHRhcmdldFtzdGFydCArIGldID0gY2h1bmtbaV07XG4gICAgICB9XG4gICAgfVxuICB9XG5cbiAgY2h1bmtzKCk6IFJlYWRvbmx5QXJyYXk8cmVhZG9ubHkgW251bWJlciwgcmVhZG9ubHkgVFtdXT4ge1xuICAgIHJldHVybiB0aGlzLl9jaHVua3M7XG4gIH1cblxuICBnZXQoaW5kZXg6IG51bWJlcik6IFR8dW5kZWZpbmVkIHtcbiAgICBsZXQgaSA9IHRoaXMuX2ZpbmQoaW5kZXgpO1xuICAgIGlmIChpIDwgMCkgcmV0dXJuIHVuZGVmaW5lZDtcbiAgICBjb25zdCBbc3RhcnQsIGRhdGFdID0gdGhpcy5fY2h1bmtzW2ldO1xuICAgIHJldHVybiBkYXRhW2luZGV4IC0gc3RhcnRdO1xuICB9XG5cbiAgc2V0KHN0YXJ0OiBudW1iZXIsIC4uLnZhbHVlczogVFtdKSB7XG4gICAgdGhpcy5zZXRJbnRlcm5hbChzdGFydCwgdmFsdWVzKTtcbiAgfVxuXG4gIHByb3RlY3RlZCBzZXRJbnRlcm5hbChzdGFydDogbnVtYmVyLCB2YWx1ZXM6IEl0ZXJhYmxlQXJyYXlMaWtlPFQ+KSB7XG4gICAgaWYgKCF2YWx1ZXMubGVuZ3RoKSByZXR1cm47IC8vIG5vdGhpbmcgdG8gZG9cbiAgICBjb25zdCBlbmQgPSBzdGFydCArIHZhbHVlcy5sZW5ndGg7XG4gICAgdGhpcy5fbGVuZ3RoID0gTWF0aC5tYXgodGhpcy5fbGVuZ3RoLCBlbmQpO1xuICAgIGxldCBpMCA9IHRoaXMuX2ZpbmQoc3RhcnQpO1xuICAgIGxldCBpMSA9IHRoaXMuX2ZpbmQoZW5kKTtcbiAgICBpZiAoaTAgPj0gMCAmJiBpMCA9PT0gaTEpIHtcbiAgICAgIC8vIE9wdGltaXplIHRyaXZpYWwgY2FzZSBvZiBvdmVyd3JpdGluZyBhbHJlYWR5LWZpbGxlZCB2YWx1ZXNcbiAgICAgIGNvbnN0IFtzMCwgYTBdID0gdGhpcy5fY2h1bmtzW2kwXTtcbiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgdmFsdWVzLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgIGEwW3N0YXJ0ICsgaSAtIHMwXSA9IHZhbHVlc1tpXTtcbiAgICAgIH1cbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgY29uc3QgZTAgPSB0aGlzLl9jaHVua3NbfmkwIC0gMV07XG4gICAgaWYgKGUwICYmIChlMFswXSArIGUwWzFdLmxlbmd0aCA9PT0gc3RhcnQpKSBpMCA9IH5pMCAtIDE7XG4gICAgaWYgKHRoaXMuX2NodW5rc1t+aTFdPy5bMF0gPT09IGVuZCkgaTEgPSB+aTE7XG4gICAgaWYgKGkwID49IDApIHtcbiAgICAgIGNvbnN0IFtzMCwgYTBdID0gdGhpcy5fY2h1bmtzW2kwXTtcbiAgICAgIGlmIChpMSAhPT0gaTAgfHwgIUFycmF5LmlzQXJyYXkodmFsdWVzKSkge1xuICAgICAgICB2YWx1ZXMgPSBzcGxpY2VIZWFkKGEwLCBzdGFydCAtIHMwLCB2YWx1ZXMpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgdmFsdWVzLnVuc2hpZnQoLi4uYTAuc2xpY2UoMCwgc3RhcnQgLSBzMCkpO1xuICAgICAgfVxuICAgICAgc3RhcnQgPSBzMDtcbiAgICB9XG4gICAgaWYgKGkxID49IDApIHtcbiAgICAgIGNvbnN0IFtzMSwgYTFdID0gdGhpcy5fY2h1bmtzW2kxXTtcbiAgICAgIHZhbHVlcyA9IHNwbGljZVRhaWwodmFsdWVzLCBlbmQgLSBzMSwgYTEpXG4gICAgfVxuICAgIGxldCBzID0gaTAgPCAwID8gfmkwIDogaTA7XG4gICAgbGV0IGUgPSBpMSA8IDAgPyB+aTEgOiBpMTtcbiAgICBpZiAoaTEgPj0gMCkgZSsrO1xuICAgIGlmICghQXJyYXkuaXNBcnJheSh2YWx1ZXMpKSB2YWx1ZXMgPSBBcnJheS5mcm9tKHZhbHVlcyk7XG4gICAgdGhpcy5fY2h1bmtzLnNwbGljZShzLCBlIC0gcywgW3N0YXJ0LCB2YWx1ZXMgYXMgVFtdXSk7XG4gIH1cblxuICBzcGxpY2Uoc3RhcnQ6IG51bWJlciwgbGVuZ3RoID0gMSkge1xuICAgIGNvbnN0IGVuZCA9IHN0YXJ0ICsgbGVuZ3RoO1xuICAgIGxldCBpMCA9IHRoaXMuX2ZpbmQoc3RhcnQpO1xuICAgIGxldCBpMSA9IHRoaXMuX2ZpbmQoZW5kKTtcbiAgICBsZXQgZTAgPSBpMCA+PSAwID8gdGhpcy5fY2h1bmtzW2kwXSA6IHVuZGVmaW5lZDtcbiAgICBsZXQgZTEgPSBpMSA+PSAwID8gdGhpcy5fY2h1bmtzW2kxXSA6IHVuZGVmaW5lZDtcbiAgICBpZiAoZTApIHtcbiAgICAgIFxuICAgICAgY29uc3QgbDAgPSBzdGFydCAtIGUwWzBdO1xuICAgICAgaWYgKGwwKSB7XG4gICAgICAgIGUwID0gW2UwWzBdLCBlMCA9PT0gZTEgPyBlMFsxXS5zbGljZSgwLCBsMCkgOiBhcnJheUhlYWQoZTBbMV0sIGwwKV07XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBlMCA9IHVuZGVmaW5lZDtcbiAgICAgICAgaTAgPSB+aTA7XG4gICAgICB9XG4gICAgfVxuICAgIGlmIChlMSkge1xuICAgICAgZTEgPSBbZW5kLCBhcnJheVRhaWwoZTFbMV0sIGVuZCAtIGUxWzBdKV07XG4gICAgICBpZiAoIWUxWzFdLmxlbmd0aCkge1xuICAgICAgICBlMSA9IHVuZGVmaW5lZDtcbiAgICAgICAgaTEgPSB+aTE7XG4gICAgICB9XG4gICAgfVxuXG4gICAgY29uc3QgZW50cmllcyA9IFtdO1xuICAgIGlmIChlMCkgZW50cmllcy5wdXNoKGUwKTtcbiAgICBpZiAoZTEpIGVudHJpZXMucHVzaChlMSk7XG5cbiAgICBsZXQgcyA9IGkwIDwgMCA/IH5pMCA6IGkwO1xuICAgIGxldCBlID0gaTEgPCAwID8gfmkxIDogaTE7XG4gICAgaWYgKGkxID49IDApIGUrKztcbiAgICBcbiAgICB0aGlzLl9jaHVua3Muc3BsaWNlKHMsIGUgLSBzLCAuLi5lbnRyaWVzKTtcbiAgfVxuXG4gIHNsaWNlKHN0YXJ0OiBudW1iZXIsIGVuZDogbnVtYmVyKTogVFtdIHtcbiAgICBpZiAoZW5kIDw9IHN0YXJ0KSByZXR1cm4gW107XG4gICAgY29uc3QgaSA9IHRoaXMuX2ZpbmQoc3RhcnQpO1xuICAgIGlmIChpIDwgMCkgdGhyb3cgbmV3IEVycm9yKGBBYnNlbnQ6ICR7c3RhcnR9YCk7XG4gICAgY29uc3QgW3MsIGFdID0gdGhpcy5fY2h1bmtzW2ldO1xuICAgIGlmIChzICsgYS5sZW5ndGggPCBlbmQpIHRocm93IG5ldyBFcnJvcihgQWJzZW50OiAke3MgKyBhLmxlbmd0aH1gKTtcbiAgICByZXR1cm4gYS5zbGljZShzdGFydCAtIHMsIGVuZCAtIHMpO1xuICB9XG59XG5cbmludGVyZmFjZSBNdXRhYmxlQXJyYXlMaWtlPFQ+IHtcbiAgbGVuZ3RoOiBudW1iZXI7XG4gIFtpOiBudW1iZXJdOiBUO1xufVxuXG4vKiogU3BlY2lhbGl6YXRpb24gb2YgU3BhcnNlQXJyYXkgb3B0aW1pemVkIGZvciBlZmZpY2llbnQgc2VhcmNoLiAqL1xuZXhwb3J0IGNsYXNzIFNwYXJzZUJ5dGVBcnJheSBleHRlbmRzIFNwYXJzZUFycmF5PG51bWJlcj4ge1xuXG4gIHNldChzdGFydDogbnVtYmVyLCBhcnI6IFVpbnQ4QXJyYXkpOiB2b2lkO1xuICBzZXQoc3RhcnQ6IG51bWJlciwgLi4udmFsdWVzOiBudW1iZXJbXSk6IHZvaWQ7XG4gIHNldChzdGFydDogbnVtYmVyLCAuLi5hcmdzOiBBcnJheTxudW1iZXJ8VWludDhBcnJheT4pIHtcbiAgICB0aGlzLnNldEludGVybmFsKHN0YXJ0LCBhcmdzWzBdIGluc3RhbmNlb2YgVWludDhBcnJheSA/XG4gICAgICAgICAgICAgICAgICAgICBhcmdzWzBdIDogVWludDhBcnJheS5mcm9tKGFyZ3MgYXMgbnVtYmVyW10pKTtcbiAgfVxuXG4gIHNlYXJjaChuZWVkbGU6IEFycmF5TGlrZTxudW1iZXI+LCBzdGFydD86IG51bWJlciwgZW5kPzogbnVtYmVyKTogbnVtYmVyIHtcbiAgICByZXR1cm4gdGhpcy5wYXR0ZXJuKG5lZWRsZSkuc2VhcmNoKHN0YXJ0LCBlbmQpO1xuICB9XG5cbiAgLyoqIFBlcmZvcm0gYSBCb3llci1Nb29yZSBzZWFyY2guICovXG4gIHBhdHRlcm4obmVlZGxlOiBBcnJheUxpa2U8bnVtYmVyPik6IFNwYXJzZUJ5dGVBcnJheS5QYXR0ZXJuIHtcbiAgICAvLyBTdHVwaWQgdHJpdmlhbCBlZGdlIGNhc2VzIGZpcnN0XG4gICAgaWYgKCFuZWVkbGUubGVuZ3RoKSByZXR1cm4ge3NlYXJjaDogKHN0YXJ0ID0gMCkgPT4gc3RhcnR9O1xuICAgIGNvbnN0IGxlbiA9IG5lZWRsZS5sZW5ndGg7XG4gICAgLy8gQnVpbGQganVtcCB0YWJsZSBiYXNlZCBvbiBtaXNtYXRjaGVkIGNoYXIgaW5mb1xuICAgIGNvbnN0IGNoYXJUYWJsZTogbnVtYmVyW10gPSBuZXcgQXJyYXkoMjU2KS5maWxsKGxlbik7XG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPCBuZWVkbGUubGVuZ3RoOyBpKyspIHtcbiAgICAgIGNoYXJUYWJsZVtuZWVkbGVbaV1dID0gbGVuIC0gMSAtIGk7XG4gICAgfVxuICAgIC8vIEJ1aWxkIGp1bXAgdGFibGUgYmFzZWQgb24gc2NhbiBvZmZzZXQgZm9yIG1pc21hdGNoIChiYWQgY2hhciBydWxlKVxuICAgIGNvbnN0IG9mZnNldFRhYmxlOiBudW1iZXJbXSA9IFtdO1xuICAgIGxldCBsYXN0UHJlZml4UG9zID0gbGVuO1xuICAgIGZvciAobGV0IGkgPSBsZW47IGkgPiAwOyAtLWkpIHtcbiAgICAgIGlmIChpc1ByZWZpeChpKSkge1xuICAgICAgICBsYXN0UHJlZml4UG9zID0gaTtcbiAgICAgIH1cbiAgICAgIG9mZnNldFRhYmxlW2xlbiAtIGldID0gbGFzdFByZWZpeFBvcyAtIGkgKyBsZW47XG4gICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGxlbiAtIDE7ICsraSkge1xuICAgICAgICBjb25zdCBzbGVuID0gc3VmZml4TGVuZ3RoKGkpO1xuICAgICAgICBvZmZzZXRUYWJsZVtzbGVuXSA9IGxlbiAtIDEgLSBpICsgc2xlbjtcbiAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIHtzZWFyY2g6IChzdGFydCA9IDAsIGVuZCA9IHRoaXMuX2xlbmd0aCk6IG51bWJlciA9PiB7XG4gICAgICBpZiAoIXRoaXMuX2NodW5rcy5sZW5ndGggfHwgZW5kIDwgc3RhcnQpIHJldHVybiAtMTtcbiAgICAgIC8vIGhhbmRsZSBzdGFydCBwb3NpdGlvblxuICAgICAgbGV0IGsgPSB0aGlzLl9maW5kKHN0YXJ0KTtcbiAgICAgIGxldCBpMCA9IDA7XG4gICAgICBpZiAoayA+PSAwKSB7XG4gICAgICAgIGkwID0gc3RhcnQgLSB0aGlzLl9jaHVua3Nba11bMF07XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBrID0gfms7XG4gICAgICB9XG4gICAgICB3aGlsZSAoayA8IHRoaXMuX2NodW5rcy5sZW5ndGgpIHtcbiAgICAgICAgY29uc3QgW29mZnNldCwgaGF5c3RhY2tdID0gdGhpcy5fY2h1bmtzW2srK107XG4gICAgICAgIGNvbnN0IGkxID0gTWF0aC5taW4oZW5kIC0gb2Zmc2V0LCBoYXlzdGFjay5sZW5ndGgpO1xuICAgICAgICBpZiAoaTEgPCAwKSBicmVhaztcbiAgICAgICAgZm9yIChsZXQgaSA9IGxlbiAtIDEgKyBpMCwgajsgaSA8IGkxOykge1xuICAgICAgICAgIGZvciAoaiA9IGxlbiAtIDE7IG5lZWRsZVtqXSA9PT0gaGF5c3RhY2tbaV07IC0taSwgLS1qKSB7XG4gICAgICAgICAgICBpZiAoaiA9PT0gMCkgcmV0dXJuIGkgKyBvZmZzZXQ7XG4gICAgICAgICAgfVxuICAgICAgICAgIGkgKz0gTWF0aC5tYXgob2Zmc2V0VGFibGVbbGVuIC0gMSAtIGpdLCBjaGFyVGFibGVbaGF5c3RhY2tbaV1dKTtcbiAgICAgICAgfVxuICAgICAgICBpMCA9IDA7XG4gICAgICB9XG4gICAgICByZXR1cm4gLTE7XG4gICAgfX07XG5cbiAgICBmdW5jdGlvbiBpc1ByZWZpeChwOiBudW1iZXIpIHtcbiAgICAgIGZvciAobGV0IGkgPSBwLCBqID0gMDsgaSA8IGxlbjsgKytpLCArK2opIHtcbiAgICAgICAgaWYgKG5lZWRsZVtpXSAhPT0gbmVlZGxlW2pdKSByZXR1cm4gZmFsc2U7XG4gICAgICB9XG4gICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9XG4gICAgZnVuY3Rpb24gc3VmZml4TGVuZ3RoKHA6IG51bWJlcikge1xuICAgICAgbGV0IG91dCA9IDA7XG4gICAgICBmb3IgKGxldCBpID0gcCwgaiA9IGxlbiAtIDE7XG4gICAgICAgICAgIGkgPj0gMCAmJiBuZWVkbGVbaV0gPT09IG5lZWRsZVtqXTtcbiAgICAgICAgICAgLS1pLCAtLWopIHtcbiAgICAgICAgKytvdXQ7XG4gICAgICB9XG4gICAgICByZXR1cm4gb3V0O1xuICAgIH1cbiAgfVxuXG4gIGFkZE9mZnNldChvZmZzZXQ6IG51bWJlcik6IFNwYXJzZUJ5dGVBcnJheSB7XG4gICAgY29uc3Qgb3V0ID0gbmV3IFNwYXJzZUJ5dGVBcnJheSgpO1xuICAgIGZvciAoY29uc3QgW3N0YXJ0LCBkYXRhXSBvZiB0aGlzLl9jaHVua3MpIHtcbiAgICAgIG91dC5fY2h1bmtzLnB1c2goW3N0YXJ0ICsgb2Zmc2V0LCBkYXRhXSk7XG4gICAgfVxuICAgIHJldHVybiBvdXQ7XG4gIH1cblxuICB0b0lwc1BhdGNoKCk6IFVpbnQ4QXJyYXkge1xuICAgIGxldCBzaXplID0gODtcbiAgICBmb3IgKGNvbnN0IFssIGNodW5rXSBvZiB0aGlzLl9jaHVua3MpIHtcbiAgICAgIHNpemUgKz0gNSArIGNodW5rLmxlbmd0aDtcbiAgICB9XG4gICAgY29uc3QgYnVmZmVyID0gbmV3IFVpbnQ4QXJyYXkoc2l6ZSk7XG4gICAgbGV0IGkgPSA1O1xuICAgIGJ1ZmZlclswXSA9IDB4NTA7XG4gICAgYnVmZmVyWzFdID0gMHg0MTtcbiAgICBidWZmZXJbMl0gPSAweDU0O1xuICAgIGJ1ZmZlclszXSA9IDB4NDM7XG4gICAgYnVmZmVyWzRdID0gMHg0ODtcbiAgICBmb3IgKGNvbnN0IFtzdGFydCwgY2h1bmtdIG9mIHRoaXMuX2NodW5rcykge1xuICAgICAgaWYgKGNodW5rLmxlbmd0aCA+IDB4ZmZmZikgdGhyb3cgbmV3IEVycm9yKGBPb3BzIWApO1xuICAgICAgYnVmZmVyW2krK10gPSBzdGFydCA+Pj4gMTY7XG4gICAgICBidWZmZXJbaSsrXSA9IChzdGFydCA+Pj4gOCkgJiAweGZmO1xuICAgICAgYnVmZmVyW2krK10gPSBzdGFydCAmIDB4ZmY7XG4gICAgICBidWZmZXJbaSsrXSA9IGNodW5rLmxlbmd0aCA+Pj4gODtcbiAgICAgIGJ1ZmZlcltpKytdID0gY2h1bmsubGVuZ3RoICYgMHhmZjtcbiAgICAgIGJ1ZmZlci5zdWJhcnJheShpLCBpICsgY2h1bmsubGVuZ3RoKS5zZXQoY2h1bmspO1xuICAgICAgaSArPSBjaHVuay5sZW5ndGg7XG4gICAgfVxuICAgIGJ1ZmZlcltpXSA9IDB4NDU7XG4gICAgYnVmZmVyW2kgKyAxXSA9IDB4NGY7XG4gICAgYnVmZmVyW2kgKyAyXSA9IDB4NDY7XG4gICAgcmV0dXJuIGJ1ZmZlcjtcbiAgfVxuXG4gIHRvSXBzSGV4U3RyaW5nKCk6IHN0cmluZyB7XG4gICAgLy9yZXR1cm4gQXJyYXkuZnJvbSh0aGlzLnRvSXBzUGF0Y2goKSwgeCA9PiB4LnRvU3RyaW5nKDE2KS5wYWRTdGFydCgyLCAnMCcpKVxuICAgIC8vIE5PVEU6IHRoaXMgZm9ybWF0IGlzIGNvbXBhdGlibGUgd2l0aCBgeHhkIC1yIGZvby5pcHMuaGV4ID4gZm9vLmlwc2BcbiAgICBjb25zdCBieXRlcyA9IFsuLi50aGlzLnRvSXBzUGF0Y2goKV07XG4gICAgY29uc3QgbGluZXMgPSBbXTtcbiAgICBmb3IgKGxldCBpID0gMDsgaSA8IGJ5dGVzLmxlbmd0aDsgaSArPSAxNikge1xuICAgICAgbGluZXMucHVzaChbaS50b1N0cmluZygxNikucGFkU3RhcnQoOCwgJzAnKSArICc6JyxcbiAgICAgICAgICAgICAgICAgIC4uLmJ5dGVzLnNsaWNlKGksIGkgKyAxNilcbiAgICAgICAgICAgICAgICAgICAgICAubWFwKHggPT4geC50b1N0cmluZygxNikucGFkU3RhcnQoMiwgJzAnKSldLmpvaW4oJyAnKSk7XG4gICAgfVxuICAgIHJldHVybiBsaW5lcy5qb2luKCdcXG4nKTtcbiAgfVxufVxuXG5leHBvcnQgbmFtZXNwYWNlIFNwYXJzZUJ5dGVBcnJheSB7XG4gIGV4cG9ydCBpbnRlcmZhY2UgUGF0dGVybiB7XG4gICAgc2VhcmNoKHN0YXJ0PzogbnVtYmVyLCBlbmQ/OiBudW1iZXIpOiBudW1iZXI7XG4gIH1cbn1cblxuXG4vLyBIZWxwZXIgZnVuY3Rpb25zIHRvIGF2b2lkIGRvaW5nIGV4cGVuc2l2ZSBhcnJheSBvcGVyYXRpb25zLCBnaXZlbiB0aGVcbi8vIGFzc3VtcHRpb24gdGhhdCB3ZSBjYW4gZGVzdHJveSB0aGUgaW5wdXQuXG5mdW5jdGlvbiBzcGxpY2VIZWFkPFQ+KGEwOiBUW10sIGk6IG51bWJlciwgYTE6IEl0ZXJhYmxlQXJyYXlMaWtlPFQ+KTogVFtdIHtcbiAgY29uc3QgbDAgPSBhMC5sZW5ndGg7XG4gIGlmIChhMS5sZW5ndGggPCBsMCB8fCAhQXJyYXkuaXNBcnJheShhMSkpIHtcbiAgICBhMC5zcGxpY2UoaSwgbDAgLSBpLCAuLi5hMSk7XG4gICAgcmV0dXJuIGEwO1xuICB9XG4gIGExLnVuc2hpZnQoLi4uYXJyYXlIZWFkKGEwLCBpKSk7XG4gIHJldHVybiBhMTtcbn1cblxuZnVuY3Rpb24gc3BsaWNlVGFpbDxUPihhMDogSXRlcmFibGVBcnJheUxpa2U8VD4sIGk6IG51bWJlciwgYTE6IFRbXSk6IFRbXSB7XG4gIGNvbnN0IGwxID0gYTEubGVuZ3RoO1xuICBpZiAoYTAubGVuZ3RoIDwgbDEgfHwgIUFycmF5LmlzQXJyYXkoYTApKSB7XG4gICAgYTEuc3BsaWNlKDAsIGksIC4uLmEwKTtcbiAgICByZXR1cm4gYTE7XG4gIH1cbiAgYTAucHVzaCguLi5hcnJheVRhaWwoYTEsIGkpKTtcbiAgcmV0dXJuIGEwO1xufVxuXG50eXBlIEl0ZXJhYmxlQXJyYXlMaWtlPFQ+ID0gQXJyYXlMaWtlPFQ+ICYgSXRlcmFibGU8VD47XG5cbmZ1bmN0aW9uIGFycmF5SGVhZDxUPihhcnI6IFRbXSwgaTogbnVtYmVyKTogVFtdIHtcbiAgY29uc3QgbCA9IGFyci5sZW5ndGg7XG4gIGlmICgoaSA8PCAxKSA8IGwpIHtcbiAgICByZXR1cm4gYXJyLnNsaWNlKDAsIGkpO1xuICB9XG4gIGFyci5zcGxpY2UoaSwgbCAtIGkpO1xuICByZXR1cm4gYXJyO1xufVxuXG5mdW5jdGlvbiBhcnJheVRhaWw8VD4oYXJyOiBUW10sIGk6IG51bWJlcik6IFRbXSB7XG4gIGNvbnN0IGwgPSBhcnIubGVuZ3RoO1xuICBpZiAoKGkgPDwgMSkgPCBsKSB7XG4gICAgYXJyLnNwbGljZSgwLCBpKTtcbiAgICByZXR1cm4gYXJyO1xuICB9XG4gIHJldHVybiBhcnIuc2xpY2UoaSk7XG59XG5cbi8vIGV4cG9ydCBmdW5jdGlvbiBsaW5lYXJTZWFyY2g8VD4oVFtdIGhheXN0YWNrLCBUW10gbmVlZGxlLFxuLy8gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdGFydCA9IDAsIGVuZCA9IGhheXN0YWNrLmxlbmd0aCk6IG51bWJlciB7XG5cbi8vIH1cblxuZXhwb3J0IGNsYXNzIEJpdFNldCB7XG4gIHByaXZhdGUgZGF0YSA9IG5ldyBVaW50OEFycmF5KDE2KTtcblxuICBhZGQoaTogbnVtYmVyKSB7XG4gICAgY29uc3QgYnl0ZSA9IGkgPj4+IDM7XG4gICAgaWYgKGJ5dGUgPj0gdGhpcy5kYXRhLmxlbmd0aCkge1xuICAgICAgbGV0IG5ld1NpemUgPSB0aGlzLmRhdGEubGVuZ3RoO1xuICAgICAgd2hpbGUgKG5ld1NpemUgPD0gYnl0ZSkgbmV3U2l6ZSA8PD0gMTtcbiAgICAgIGNvbnN0IG5ld0RhdGEgPSBuZXcgVWludDhBcnJheShuZXdTaXplKTtcbiAgICAgIG5ld0RhdGEuc3ViYXJyYXkoMCwgdGhpcy5kYXRhLmxlbmd0aCkuc2V0KHRoaXMuZGF0YSk7XG4gICAgICB0aGlzLmRhdGEgPSBuZXdEYXRhO1xuICAgIH1cbiAgICB0aGlzLmRhdGFbYnl0ZV0gfD0gKDEgPDwgKGkgJiA3KSk7XG4gIH1cblxuICBkZWxldGUoaTogbnVtYmVyKSB7XG4gICAgY29uc3QgYnl0ZSA9IGkgPj4+IDM7XG4gICAgaWYgKGJ5dGUgPCB0aGlzLmRhdGEubGVuZ3RoKSB0aGlzLmRhdGFbYnl0ZV0gJj0gfigxIDw8IChpICYgNykpO1xuICB9XG5cbiAgaGFzKGk6IG51bWJlcik6IGJvb2xlYW4ge1xuICAgIHJldHVybiBCb29sZWFuKCh0aGlzLmRhdGFbaSA+Pj4gM10gfHwgMCkgJiAoMSA8PCAoaSAmIDcpKSk7XG4gIH1cbn1cblxuZXhwb3J0IGNsYXNzIEludGVydmFsU2V0IGltcGxlbWVudHMgSXRlcmFibGU8cmVhZG9ubHkgW251bWJlciwgbnVtYmVyXT4ge1xuICBwcml2YXRlIGRhdGE6IEFycmF5PFtudW1iZXIsIG51bWJlcl0+ID0gW107XG5cbiAgW1N5bWJvbC5pdGVyYXRvcl0oKSB7IFxuICAgIHJldHVybiB0aGlzLmRhdGFbU3ltYm9sLml0ZXJhdG9yXSgpO1xuICB9XG5cbiAgcHJpdmF0ZSBfZmluZCh2OiBudW1iZXIpOiBudW1iZXIge1xuICAgIHJldHVybiBiaW5hcnlTZWFyY2godGhpcy5kYXRhLmxlbmd0aCwgKGk6IG51bWJlcikgPT4ge1xuICAgICAgY29uc3QgZW50cnkgPSB0aGlzLmRhdGFbaV07XG4gICAgICAvL2lmICghZW50cnkpIGNvbnNvbGUubG9nKGksIHYpO1xuICAgICAgaWYgKHYgPCBlbnRyeVswXSkgcmV0dXJuIC0xO1xuICAgICAgaWYgKHYgPj0gZW50cnlbMV0pIHJldHVybiAxO1xuICAgICAgcmV0dXJuIDA7XG4gICAgfSk7XG4gIH1cblxuICBoYXMoeDogbnVtYmVyKSB7XG4gICAgcmV0dXJuIHRoaXMuX2ZpbmQoeCkgPj0gMDtcbiAgfVxuXG4gIGFkZChzdGFydDogbnVtYmVyLCBlbmQ6IG51bWJlcikge1xuICAgIGxldCBpMCA9IHRoaXMuX2ZpbmQoc3RhcnQpO1xuICAgIGxldCBpMSA9IHRoaXMuX2ZpbmQoZW5kKTtcbiAgICBpZiAodGhpcy5kYXRhW35pMCAtIDFdPy5bMV0gPT09IHN0YXJ0KSBpMCA9IH5pMCAtIDE7XG4gICAgaWYgKHRoaXMuZGF0YVt+aTFdPy5bMF0gPT09IGVuZCkgaTEgPSB+aTE7XG4gICAgY29uc3QgZW50cnk6IFtudW1iZXIsIG51bWJlcl0gPSBbc3RhcnQsIGVuZF07XG4gICAgaWYgKGkwID49IDApIGVudHJ5WzBdID0gdGhpcy5kYXRhW2kwXVswXTtcbiAgICBpZiAoaTEgPj0gMCkgZW50cnlbMV0gPSB0aGlzLmRhdGFbaTFdWzFdO1xuICAgIGxldCBzID0gaTAgPCAwID8gfmkwIDogaTA7XG4gICAgbGV0IGUgPSBpMSA8IDAgPyB+aTEgOiBpMTtcbiAgICBpZiAoaTEgPj0gMCkgZSsrO1xuICAgIHRoaXMuZGF0YS5zcGxpY2UocywgZSAtIHMsIGVudHJ5KTtcbiAgfVxuXG4gIGRlbGV0ZShzdGFydDogbnVtYmVyLCBlbmQ6IG51bWJlcikge1xuICAgIGxldCBpMCA9IHRoaXMuX2ZpbmQoc3RhcnQpO1xuICAgIGxldCBpMSA9IHRoaXMuX2ZpbmQoZW5kKTtcbiAgICBsZXQgZTAgPSBpMCA+PSAwID8gdGhpcy5kYXRhW2kwXSA6IHVuZGVmaW5lZDtcbiAgICBsZXQgZTEgPSBpMSA+PSAwID8gdGhpcy5kYXRhW2kxXSA6IHVuZGVmaW5lZDtcbiAgICBpZiAoZTApIHtcbiAgICAgIGUwID0gW2UwWzBdLCBNYXRoLm1pbihlMFsxXSwgc3RhcnQpXTtcbiAgICAgIGlmIChlMFswXSA9PT0gZTBbMV0pIHtcbiAgICAgICAgZTAgPSB1bmRlZmluZWQ7XG4gICAgICAgIGkwID0gfmkwO1xuICAgICAgfVxuICAgIH1cbiAgICBpZiAoZTEpIHtcbiAgICAgIGUxID0gW01hdGgubWF4KGUxWzBdLCBlbmQpLCBlMVsxXV07XG4gICAgICBpZiAoZTFbMF0gPT09IGUxWzFdKSB7XG4gICAgICAgIGUxID0gdW5kZWZpbmVkO1xuICAgICAgICBpMSA9IH5pMTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICBjb25zdCBlbnRyaWVzID0gW107XG4gICAgaWYgKGUwKSBlbnRyaWVzLnB1c2goZTApO1xuICAgIGlmIChlMSkgZW50cmllcy5wdXNoKGUxKTtcblxuICAgIGxldCBzID0gaTAgPCAwID8gfmkwIDogaTA7XG4gICAgbGV0IGUgPSBpMSA8IDAgPyB+aTEgOiBpMTtcbiAgICBpZiAoaTEgPj0gMCkgZSsrO1xuICAgIFxuICAgIHRoaXMuZGF0YS5zcGxpY2UocywgZSAtIHMsIC4uLmVudHJpZXMpO1xuICB9XG5cbiAgdGFpbCh4OiBudW1iZXIpOiBJdGVyYWJsZUl0ZXJhdG9yPHJlYWRvbmx5IFtudW1iZXIsIG51bWJlcl0+IHtcbiAgICBsZXQgaW5kZXggPSB0aGlzLl9maW5kKHgpO1xuICAgIGlmIChpbmRleCA8IDApIGluZGV4ID0gfmluZGV4O1xuICAgIGNvbnN0IGRhdGEgPSB0aGlzLmRhdGE7XG4gICAgcmV0dXJuIHtcbiAgICAgIFtTeW1ib2wuaXRlcmF0b3JdKCkgeyByZXR1cm4gdGhpczsgfSxcbiAgICAgIG5leHQoKSB7XG4gICAgICAgIGlmIChpbmRleCA+PSBkYXRhLmxlbmd0aCkgcmV0dXJuIHt2YWx1ZTogdW5kZWZpbmVkLCBkb25lOiB0cnVlfTtcbiAgICAgICAgY29uc3QgZSA9IGRhdGFbaW5kZXgrK107XG4gICAgICAgIHJldHVybiB7dmFsdWU6IFtNYXRoLm1heCh4LCBlWzBdKSwgZVsxXV0sIGRvbmU6IGZhbHNlfTtcbiAgICAgIH0sXG4gICAgfTtcbiAgfVxufVxuIl19