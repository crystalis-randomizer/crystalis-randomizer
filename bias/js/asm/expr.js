import { Token } from './token.js';
export var Expr;
(function (Expr) {
    function jsSource(e) {
        return e.source ?
            { source: { parent: e.source, file: 'js', line: 0, column: 0 } } : {};
    }
    function loByte(e) {
        return { op: '<', args: [e], ...jsSource(e) };
    }
    Expr.loByte = loByte;
    function hiByte(e) {
        return { op: '>', args: [e], ...jsSource(e) };
    }
    Expr.hiByte = hiByte;
    function traverse(expr, f) {
        function rec(e) {
            if (!e.args)
                return e;
            return { ...e, args: e.args.map(c => t(c, e)) };
        }
        ;
        function t(e, p) {
            const source = e.source;
            e = f(e, rec, p);
            if (source && !e.source)
                e.source = source;
            return e;
        }
        return t(expr);
    }
    Expr.traverse = traverse;
    function traversePost(expr, f) {
        return traverse(expr, (expr, rec) => f(rec(expr)));
    }
    Expr.traversePost = traversePost;
    function evaluate(expr) {
        var _a, _b, _c, _d;
        switch (expr.op) {
            case '.move':
            case 'im':
            case 'sym':
                return expr;
            case 'num':
                if (((_a = expr.meta) === null || _a === void 0 ? void 0 : _a.rel) && expr.meta.org != null) {
                    const { rel, ...meta } = expr.meta;
                    return { op: 'num', num: expr.num + meta.org, meta };
                }
                return expr;
            case '.max': return sameChunk(expr, Math.max);
            case '.min': return sameChunk(expr, Math.min);
            default:
        }
        if (((_b = expr.args) === null || _b === void 0 ? void 0 : _b.length) === 1) {
            switch (expr.op) {
                case '+': return expr.args[0];
                case '-': return unary(expr, x => -x);
                case '~': return unary(expr, x => ~x);
                case '!': return unary(expr, x => +!x);
                case '<': return unary(expr, x => x & 0xff);
                case '>': return unary(expr, x => (x >> 8) & 0xff);
                case '^': return (_d = num((_c = expr.args[0].meta) === null || _c === void 0 ? void 0 : _c.bank)) !== null && _d !== void 0 ? _d : expr;
                default: throw new Error(`Unknown unary operator: ${expr.op}`);
            }
        }
        switch (expr.op) {
            case '+': return plus(expr);
            case '-': return minus(expr);
            case '*': return binary(expr, (a, b) => a * b);
            case '/': return binary(expr, (a, b) => Math.floor(a / b));
            case '.mod': return binary(expr, (a, b) => a % b);
            case '&': return binary(expr, (a, b) => a & b);
            case '|': return binary(expr, (a, b) => a | b);
            case '^': return binary(expr, (a, b) => a ^ b);
            case '<<': return binary(expr, (a, b) => a << b);
            case '>>': return binary(expr, (a, b) => a >>> b);
            case '<': return binary(expr, (a, b) => +(a < b));
            case '<=': return binary(expr, (a, b) => +(a <= b));
            case '>': return binary(expr, (a, b) => +(a > b));
            case '>=': return binary(expr, (a, b) => +(a >= b));
            case '=': return binary(expr, (a, b) => +(a == b));
            case '<>': return binary(expr, (a, b) => +(a != b));
            case '&&': return binary(expr, (a, b) => a && b);
            case '||': return binary(expr, (a, b) => a || b);
            case '.xor': return binary(expr, (a, b) => !a && b || !b && a || 0);
            default: throw new Error(`Unknown operator: ${expr.op}`);
        }
    }
    Expr.evaluate = evaluate;
    function identifier(expr) {
        if (expr.op === 'sym' && expr.sym)
            return expr.sym;
        throw new Error(`Expected identifier but got op: ${expr.op}`);
    }
    Expr.identifier = identifier;
    function parseOnly(tokens, index = 0) {
        const [expr, i] = parse(tokens, index);
        if (i < tokens.length) {
            parse(tokens, index);
            throw new Error(`Garbage after expression: ${Token.nameAt(tokens[i])}`);
        }
        else if (!expr) {
            throw new Error(`No expression?`);
        }
        return expr;
    }
    Expr.parseOnly = parseOnly;
    function parse(tokens, index = 0) {
        const ops = [];
        const exprs = [];
        function popOp() {
            const [op, [, , arity]] = ops.pop();
            const args = exprs.splice(exprs.length - arity, arity);
            if (args.length !== arity)
                throw new Error('shunting parse failed?');
            exprs.push(fixSize({ op, args }));
        }
        let val = true;
        let i = index;
        for (; i < tokens.length; i++) {
            const front = tokens[i];
            if (val) {
                if (front.token === 'cs' || front.token === 'op') {
                    const mapped = NAME_MAP.get(front.str);
                    const prefix = PREFIXOPS.get(mapped !== null && mapped !== void 0 ? mapped : front.str);
                    if (prefix) {
                        ops.push([front.str, prefix]);
                    }
                    else if (front.token === 'cs') {
                        const op = front.str;
                        if (!FUNCTIONS.has(op)) {
                            throw new Error(`No such function: ${Token.nameAt(front)}`);
                        }
                        const next = tokens[i + 1];
                        if ((next === null || next === void 0 ? void 0 : next.token) !== 'lp') {
                            throw new Error(`Bad funcall: ${Token.nameAt(next !== null && next !== void 0 ? next : front)}`);
                        }
                        const close = Token.findBalanced(tokens, i + 1);
                        if (close < 0) {
                            throw new Error(`Never closed: ${Token.nameAt(next)}`);
                        }
                        const args = [];
                        for (const arg of Token.parseArgList(tokens, i + 2, close)) {
                            args.push(parseOnly(arg));
                        }
                        i = close;
                        exprs.push(fixSize({ op, args }));
                        val = false;
                    }
                    else if (Token.eq(front, Token.STAR)) {
                        exprs.push({ op: 'sym', sym: '*' });
                        val = false;
                    }
                    else {
                        throw new Error(`Unknown prefix operator: ${Token.nameAt(front)}`);
                    }
                }
                else if (front.token === 'lp') {
                    const close = Token.findBalanced(tokens, i);
                    if (close < 0) {
                        throw new Error(`No close paren: ${Token.nameAt(front)}`);
                    }
                    const e = parseOnly(tokens.slice(i + 1, close));
                    exprs.push(e);
                    i = close;
                    val = false;
                }
                else if (front.token === 'ident') {
                    exprs.push({ op: 'sym', sym: front.str });
                    val = false;
                }
                else if (front.token === 'num') {
                    const num = front.num;
                    exprs.push({ op: 'num', num, meta: size(num) });
                    val = false;
                }
                else {
                    throw new Error(`Bad expression token: ${Token.nameAt(front)}`);
                }
            }
            else {
                if (Token.eq(front, Token.COMMA)) {
                    break;
                }
                if (front.token === 'cs' || front.token === 'op') {
                    const mapped = NAME_MAP.get(front.str);
                    const op = BINOPS.get(mapped !== null && mapped !== void 0 ? mapped : front.str);
                    if (!op)
                        break;
                    while (ops.length) {
                        const top = ops[ops.length - 1];
                        const cmp = compareOp(top[1], op);
                        if (cmp < 0)
                            break;
                        if (cmp === 0) {
                            throw new Error(`Mixing ${top[0]} and ${front.str} needs explicit parens.${Token.at(front)}`);
                        }
                        popOp();
                    }
                    ops.push([front.str, op]);
                    val = true;
                }
                else {
                    break;
                }
            }
        }
        while (ops.length)
            popOp();
        if (exprs.length !== 1)
            throw new Error(`shunting parse failed?`);
        if (tokens[index].source)
            exprs[0].source = tokens[index].source;
        return [exprs[0], i];
    }
    Expr.parse = parse;
    function sameChunk(expr, f) {
        throw new Error();
    }
    function num(num) {
        if (num == null)
            return undefined;
        return { op: 'num', num, meta: size(num) };
    }
    function unary(expr, f) {
        const arg = expr.args[0];
        if (!isAbs(arg))
            return expr;
        const num = f(arg.num);
        return { op: 'num', num, meta: size(num) };
    }
    function binary(expr, f) {
        const [a, b] = expr.args;
        if (!isAbs(a) || !isAbs(b))
            return expr;
        const num = f(a.num, b.num);
        return { op: 'num', num, meta: size(num) };
    }
    function plus(expr) {
        var _a, _b, _c, _d, _e, _f;
        const [a, b] = expr.args;
        if (a.op !== 'num' || b.op !== 'num')
            return expr;
        const out = { op: 'num', num: a.num + b.num };
        if (a.meta || b.meta) {
            if (((_a = a.meta) === null || _a === void 0 ? void 0 : _a.rel) && ((_b = b.meta) === null || _b === void 0 ? void 0 : _b.rel))
                return expr;
            if ((_c = a.meta) === null || _c === void 0 ? void 0 : _c.rel) {
                out.meta = a.meta;
            }
            else if ((_d = b.meta) === null || _d === void 0 ? void 0 : _d.rel) {
                out.meta = b.meta;
            }
        }
        if (!((_e = out.meta) === null || _e === void 0 ? void 0 : _e.rel) && ((_f = out.meta) === null || _f === void 0 ? void 0 : _f.size) == null) {
            (out.meta || (out.meta = {})).size = size(out.num).size;
        }
        return out;
    }
    function minus(expr) {
        var _a, _b, _c, _d, _e;
        const [a, b] = expr.args;
        if (a.op !== 'num' || b.op !== 'num')
            return expr;
        const out = { op: 'num', num: a.num - b.num };
        if ((_a = b.meta) === null || _a === void 0 ? void 0 : _a.rel) {
            return ((_b = a.meta) === null || _b === void 0 ? void 0 : _b.rel) && a.meta.chunk === b.meta.chunk ? out : expr;
        }
        if ((_c = a.meta) === null || _c === void 0 ? void 0 : _c.rel)
            out.meta = a.meta;
        if (!((_d = out.meta) === null || _d === void 0 ? void 0 : _d.rel) && ((_e = out.meta) === null || _e === void 0 ? void 0 : _e.size) == null) {
            (out.meta || (out.meta = {})).size = size(out.num).size;
        }
        return out;
    }
    function isAbs(expr) {
        var _a;
        return expr.op === 'num' && !((_a = expr.meta) === null || _a === void 0 ? void 0 : _a.rel);
    }
})(Expr || (Expr = {}));
function compareOp(top, next) {
    if (top[0] > next[0])
        return 1;
    if (top[0] < next[0])
        return -1;
    if (top[1] !== next[1])
        return 0;
    return top[1];
}
const BINARY = 2;
const UNARY = 1;
export const BINOPS = new Map([
    ['*', [5, 4, BINARY]],
    ['/', [5, 4, BINARY]],
    ['.mod', [5, 3, BINARY]],
    ['&', [5, 2, BINARY]],
    ['^', [5, 1, BINARY]],
    ['<<', [5, 0, BINARY]],
    ['>>', [5, 0, BINARY]],
    ['+', [4, 2, BINARY]],
    ['-', [4, 2, BINARY]],
    ['|', [4, 1, BINARY]],
    ['<', [3, 0, BINARY]],
    ['<=', [3, 0, BINARY]],
    ['>', [3, 0, BINARY]],
    ['>=', [3, 0, BINARY]],
    ['=', [3, 0, BINARY]],
    ['<>', [3, 0, BINARY]],
    ['&&', [2, 3, BINARY]],
    ['.xor', [2, 2, BINARY]],
    ['||', [2, 1, BINARY]],
]);
const PREFIXOPS = new Map([
    ['+', [9, -1, UNARY]],
    ['-', [9, -1, UNARY]],
    ['~', [9, -1, UNARY]],
    ['<', [9, -1, UNARY]],
    ['>', [9, -1, UNARY]],
    ['^', [9, -1, UNARY]],
    ['!', [2, -1, UNARY]],
]);
const FUNCTIONS = new Set([
    '.byteat',
    '.wordat',
    '.max', '.min',
]);
const NAME_MAP = new Map([
    ['.bitand', '&'],
    ['.bitxor', '^'],
    ['.bitor', '|'],
    ['.shl', '<<'],
    ['.shr', '>>'],
    ['.and', '&&'],
    ['.or', '||'],
    ['.bitnot', '~'],
    ['.lobyte', '<'],
    ['.hibyte', '>'],
    ['.bankbyte', '^'],
    ['.not', '!'],
]);
const SIZE_TRANSFORMS = new Map([
    ['^', (...args) => args.length === 1 ? 1 : Math.max(...args)],
    ['<', () => 1],
    ['>', () => 1],
    ['!', () => 1],
    ['<=', () => 1],
    ['>=', () => 1],
    ['<>', () => 1],
    ['=', () => 1],
    ['&', Math.max],
    ['&&', Math.max],
    ['|', Math.max],
    ['||', Math.max],
    ['.xor', Math.max],
    ['.max', Math.max],
    ['.min', Math.max],
]);
function fixSize(expr) {
    const xform = SIZE_TRANSFORMS.get(expr.op);
    const size = xform === null || xform === void 0 ? void 0 : xform(...expr.args.map(e => { var _a; return Number((_a = e.meta) === null || _a === void 0 ? void 0 : _a.size); }));
    if (size)
        (expr.meta || (expr.meta = {})).size = size;
    return expr;
}
function size(num) {
    return { size: 0 <= num && num < 256 ? 1 : 2 };
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZXhwci5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3NyYy9qcy9hc20vZXhwci50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxPQUFPLEVBQWEsS0FBSyxFQUFDLE1BQU0sWUFBWSxDQUFDO0FBa0I3QyxNQUFNLEtBQVcsSUFBSSxDQTJVcEI7QUEzVUQsV0FBaUIsSUFBSTtJQUVuQixTQUFTLFFBQVEsQ0FBQyxDQUFPO1FBQ3ZCLE9BQU8sQ0FBQyxDQUFDLE1BQU0sQ0FBQyxDQUFDO1lBQ2IsRUFBQyxNQUFNLEVBQUUsRUFBQyxNQUFNLEVBQUUsQ0FBQyxDQUFDLE1BQU0sRUFBRSxJQUFJLEVBQUUsSUFBSSxFQUFFLElBQUksRUFBRSxDQUFDLEVBQUUsTUFBTSxFQUFFLENBQUMsRUFBQyxFQUFDLENBQUMsQ0FBQyxDQUFDLEVBQUUsQ0FBQztJQUN4RSxDQUFDO0lBR0QsU0FBZ0IsTUFBTSxDQUFDLENBQU87UUFDNUIsT0FBTyxFQUFDLEVBQUUsRUFBRSxHQUFHLEVBQUUsSUFBSSxFQUFFLENBQUMsQ0FBQyxDQUFDLEVBQUUsR0FBRyxRQUFRLENBQUMsQ0FBQyxDQUFDLEVBQUMsQ0FBQztJQUM5QyxDQUFDO0lBRmUsV0FBTSxTQUVyQixDQUFBO0lBRUQsU0FBZ0IsTUFBTSxDQUFDLENBQU87UUFDNUIsT0FBTyxFQUFDLEVBQUUsRUFBRSxHQUFHLEVBQUUsSUFBSSxFQUFFLENBQUMsQ0FBQyxDQUFDLEVBQUUsR0FBRyxRQUFRLENBQUMsQ0FBQyxDQUFDLEVBQUMsQ0FBQztJQUM5QyxDQUFDO0lBRmUsV0FBTSxTQUVyQixDQUFBO0lBc0JELFNBQWdCLFFBQVEsQ0FBQyxJQUFVLEVBQUUsQ0FBWTtRQUMvQyxTQUFTLEdBQUcsQ0FBQyxDQUFPO1lBQ2xCLElBQUksQ0FBQyxDQUFDLENBQUMsSUFBSTtnQkFBRSxPQUFPLENBQUMsQ0FBQztZQUN0QixPQUFPLEVBQUMsR0FBRyxDQUFDLEVBQUUsSUFBSSxFQUFFLENBQUMsQ0FBQyxJQUFJLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQyxFQUFDLENBQUM7UUFDaEQsQ0FBQztRQUFBLENBQUM7UUFDRixTQUFTLENBQUMsQ0FBQyxDQUFPLEVBQUUsQ0FBUTtZQUMxQixNQUFNLE1BQU0sR0FBRyxDQUFDLENBQUMsTUFBTSxDQUFDO1lBQ3hCLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQyxFQUFFLEdBQUcsRUFBRSxDQUFDLENBQUMsQ0FBQztZQUNqQixJQUFJLE1BQU0sSUFBSSxDQUFDLENBQUMsQ0FBQyxNQUFNO2dCQUFFLENBQUMsQ0FBQyxNQUFNLEdBQUcsTUFBTSxDQUFDO1lBQzNDLE9BQU8sQ0FBQyxDQUFDO1FBQ1gsQ0FBQztRQUNELE9BQU8sQ0FBQyxDQUFDLElBQUksQ0FBQyxDQUFDO0lBQ2pCLENBQUM7SUFaZSxhQUFRLFdBWXZCLENBQUE7SUFFRCxTQUFnQixZQUFZLENBQUMsSUFBVSxFQUFFLENBQU07UUFDN0MsT0FBTyxRQUFRLENBQUMsSUFBSSxFQUFFLENBQUMsSUFBSSxFQUFFLEdBQUcsRUFBRSxFQUFFLENBQUMsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLENBQUM7SUFDckQsQ0FBQztJQUZlLGlCQUFZLGVBRTNCLENBQUE7SUFFRCxTQUFnQixRQUFRLENBQUMsSUFBVTs7UUFDakMsUUFBUSxJQUFJLENBQUMsRUFBRSxFQUFFO1lBQ2YsS0FBSyxPQUFPLENBQUM7WUFDYixLQUFLLElBQUksQ0FBQztZQUNWLEtBQUssS0FBSztnQkFDUixPQUFPLElBQUksQ0FBQztZQUNkLEtBQUssS0FBSztnQkFDUixJQUFJLE9BQUEsSUFBSSxDQUFDLElBQUksMENBQUUsR0FBRyxLQUFJLElBQUksQ0FBQyxJQUFJLENBQUMsR0FBRyxJQUFJLElBQUksRUFBRTtvQkFFM0MsTUFBTSxFQUFDLEdBQUcsRUFBRSxHQUFHLElBQUksRUFBQyxHQUFHLElBQUksQ0FBQyxJQUFJLENBQUM7b0JBRWpDLE9BQU8sRUFBQyxFQUFFLEVBQUUsS0FBSyxFQUFFLEdBQUcsRUFBRSxJQUFJLENBQUMsR0FBSSxHQUFHLElBQUksQ0FBQyxHQUFJLEVBQUUsSUFBSSxFQUFDLENBQUM7aUJBQ3REO2dCQUNELE9BQU8sSUFBSSxDQUFDO1lBQ2QsS0FBSyxNQUFNLENBQUMsQ0FBQyxPQUFPLFNBQVMsQ0FBQyxJQUFJLEVBQUUsSUFBSSxDQUFDLEdBQUcsQ0FBQyxDQUFDO1lBQzlDLEtBQUssTUFBTSxDQUFDLENBQUMsT0FBTyxTQUFTLENBQUMsSUFBSSxFQUFFLElBQUksQ0FBQyxHQUFHLENBQUMsQ0FBQztZQUM5QyxRQUFRO1NBQ1Q7UUFHRCxJQUFJLE9BQUEsSUFBSSxDQUFDLElBQUksMENBQUUsTUFBTSxNQUFLLENBQUMsRUFBRTtZQUMzQixRQUFRLElBQUksQ0FBQyxFQUFFLEVBQUU7Z0JBQ2YsS0FBSyxHQUFHLENBQUMsQ0FBQyxPQUFPLElBQUksQ0FBQyxJQUFLLENBQUMsQ0FBQyxDQUFDLENBQUM7Z0JBQy9CLEtBQUssR0FBRyxDQUFDLENBQUMsT0FBTyxLQUFLLENBQUMsSUFBSSxFQUFFLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQztnQkFDdEMsS0FBSyxHQUFHLENBQUMsQ0FBQyxPQUFPLEtBQUssQ0FBQyxJQUFJLEVBQUUsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDO2dCQUN0QyxLQUFLLEdBQUcsQ0FBQyxDQUFDLE9BQU8sS0FBSyxDQUFDLElBQUksRUFBRSxDQUFDLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQztnQkFDdkMsS0FBSyxHQUFHLENBQUMsQ0FBQyxPQUFPLEtBQUssQ0FBQyxJQUFJLEVBQUUsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDLEdBQUcsSUFBSSxDQUFDLENBQUM7Z0JBQzVDLEtBQUssR0FBRyxDQUFDLENBQUMsT0FBTyxLQUFLLENBQUMsSUFBSSxFQUFFLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxDQUFDLEdBQUcsSUFBSSxDQUFDLENBQUM7Z0JBQ25ELEtBQUssR0FBRyxDQUFDLENBQUMsYUFBTyxHQUFHLE9BQUMsSUFBSSxDQUFDLElBQUssQ0FBQyxDQUFDLENBQUMsQ0FBQyxJQUFJLDBDQUFFLElBQUksQ0FBQyxtQ0FBSSxJQUFJLENBQUM7Z0JBQ3ZELE9BQU8sQ0FBQyxDQUFDLE1BQU0sSUFBSSxLQUFLLENBQUMsMkJBQTJCLElBQUksQ0FBQyxFQUFFLEVBQUUsQ0FBQyxDQUFDO2FBQ2hFO1NBQ0Y7UUFFRCxRQUFRLElBQUksQ0FBQyxFQUFFLEVBQUU7WUFDZixLQUFLLEdBQUcsQ0FBQyxDQUFDLE9BQU8sSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFDO1lBQzVCLEtBQUssR0FBRyxDQUFDLENBQUMsT0FBTyxLQUFLLENBQUMsSUFBSSxDQUFDLENBQUM7WUFDN0IsS0FBSyxHQUFHLENBQUMsQ0FBQyxPQUFPLE1BQU0sQ0FBQyxJQUFJLEVBQUUsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxFQUFFLEVBQUUsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUM7WUFDL0MsS0FBSyxHQUFHLENBQUMsQ0FBQyxPQUFPLE1BQU0sQ0FBQyxJQUFJLEVBQUUsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxFQUFFLEVBQUUsQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQyxDQUFDO1lBQzNELEtBQUssTUFBTSxDQUFDLENBQUMsT0FBTyxNQUFNLENBQUMsSUFBSSxFQUFFLENBQUMsQ0FBQyxFQUFFLENBQUMsRUFBRSxFQUFFLENBQUMsQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDO1lBQ2xELEtBQUssR0FBRyxDQUFDLENBQUMsT0FBTyxNQUFNLENBQUMsSUFBSSxFQUFFLENBQUMsQ0FBQyxFQUFFLENBQUMsRUFBRSxFQUFFLENBQUMsQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDO1lBQy9DLEtBQUssR0FBRyxDQUFDLENBQUMsT0FBTyxNQUFNLENBQUMsSUFBSSxFQUFFLENBQUMsQ0FBQyxFQUFFLENBQUMsRUFBRSxFQUFFLENBQUMsQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDO1lBQy9DLEtBQUssR0FBRyxDQUFDLENBQUMsT0FBTyxNQUFNLENBQUMsSUFBSSxFQUFFLENBQUMsQ0FBQyxFQUFFLENBQUMsRUFBRSxFQUFFLENBQUMsQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDO1lBQy9DLEtBQUssSUFBSSxDQUFDLENBQUMsT0FBTyxNQUFNLENBQUMsSUFBSSxFQUFFLENBQUMsQ0FBQyxFQUFFLENBQUMsRUFBRSxFQUFFLENBQUMsQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDO1lBQ2pELEtBQUssSUFBSSxDQUFDLENBQUMsT0FBTyxNQUFNLENBQUMsSUFBSSxFQUFFLENBQUMsQ0FBQyxFQUFFLENBQUMsRUFBRSxFQUFFLENBQUMsQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDO1lBQ2xELEtBQUssR0FBRyxDQUFDLENBQUMsT0FBTyxNQUFNLENBQUMsSUFBSSxFQUFFLENBQUMsQ0FBQyxFQUFFLENBQUMsRUFBRSxFQUFFLENBQUMsQ0FBQyxDQUFDLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQyxDQUFDO1lBQ2xELEtBQUssSUFBSSxDQUFDLENBQUMsT0FBTyxNQUFNLENBQUMsSUFBSSxFQUFFLENBQUMsQ0FBQyxFQUFFLENBQUMsRUFBRSxFQUFFLENBQUMsQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxDQUFDO1lBQ3BELEtBQUssR0FBRyxDQUFDLENBQUMsT0FBTyxNQUFNLENBQUMsSUFBSSxFQUFFLENBQUMsQ0FBQyxFQUFFLENBQUMsRUFBRSxFQUFFLENBQUMsQ0FBQyxDQUFDLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQyxDQUFDO1lBQ2xELEtBQUssSUFBSSxDQUFDLENBQUMsT0FBTyxNQUFNLENBQUMsSUFBSSxFQUFFLENBQUMsQ0FBQyxFQUFFLENBQUMsRUFBRSxFQUFFLENBQUMsQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxDQUFDO1lBQ3BELEtBQUssR0FBRyxDQUFDLENBQUMsT0FBTyxNQUFNLENBQUMsSUFBSSxFQUFFLENBQUMsQ0FBQyxFQUFFLENBQUMsRUFBRSxFQUFFLENBQUMsQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxDQUFDO1lBQ25ELEtBQUssSUFBSSxDQUFDLENBQUMsT0FBTyxNQUFNLENBQUMsSUFBSSxFQUFFLENBQUMsQ0FBQyxFQUFFLENBQUMsRUFBRSxFQUFFLENBQUMsQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxDQUFDO1lBQ3BELEtBQUssSUFBSSxDQUFDLENBQUMsT0FBTyxNQUFNLENBQUMsSUFBSSxFQUFFLENBQUMsQ0FBQyxFQUFFLENBQUMsRUFBRSxFQUFFLENBQUMsQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDO1lBQ2pELEtBQUssSUFBSSxDQUFDLENBQUMsT0FBTyxNQUFNLENBQUMsSUFBSSxFQUFFLENBQUMsQ0FBQyxFQUFFLENBQUMsRUFBRSxFQUFFLENBQUMsQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDO1lBQ2pELEtBQUssTUFBTSxDQUFDLENBQUMsT0FBTyxNQUFNLENBQUMsSUFBSSxFQUFFLENBQUMsQ0FBQyxFQUFFLENBQUMsRUFBRSxFQUFFLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQztZQUNwRSxPQUFPLENBQUMsQ0FBQyxNQUFNLElBQUksS0FBSyxDQUFDLHFCQUFxQixJQUFJLENBQUMsRUFBRSxFQUFFLENBQUMsQ0FBQztTQUMxRDtJQUNILENBQUM7SUF2RGUsYUFBUSxXQXVEdkIsQ0FBQTtJQUVELFNBQWdCLFVBQVUsQ0FBQyxJQUFVO1FBQ25DLElBQUksSUFBSSxDQUFDLEVBQUUsS0FBSyxLQUFLLElBQUksSUFBSSxDQUFDLEdBQUc7WUFBRSxPQUFPLElBQUksQ0FBQyxHQUFHLENBQUM7UUFDbkQsTUFBTSxJQUFJLEtBQUssQ0FBQyxtQ0FBbUMsSUFBSSxDQUFDLEVBQUUsRUFBRSxDQUFDLENBQUM7SUFDaEUsQ0FBQztJQUhlLGVBQVUsYUFHekIsQ0FBQTtJQW9CRCxTQUFnQixTQUFTLENBQUMsTUFBZSxFQUFFLEtBQUssR0FBRyxDQUFDO1FBQ2xELE1BQU0sQ0FBQyxJQUFJLEVBQUUsQ0FBQyxDQUFDLEdBQUcsS0FBSyxDQUFDLE1BQU0sRUFBRSxLQUFLLENBQUMsQ0FBQztRQUN2QyxJQUFJLENBQUMsR0FBRyxNQUFNLENBQUMsTUFBTSxFQUFFO1lBQ3JCLEtBQUssQ0FBQyxNQUFNLEVBQUUsS0FBSyxDQUFDLENBQUM7WUFDckIsTUFBTSxJQUFJLEtBQUssQ0FBQyw2QkFBNkIsS0FBSyxDQUFDLE1BQU0sQ0FBQyxNQUFNLENBQUMsQ0FBQyxDQUFDLENBQUMsRUFBRSxDQUFDLENBQUM7U0FDekU7YUFBTSxJQUFJLENBQUMsSUFBSSxFQUFFO1lBQ2hCLE1BQU0sSUFBSSxLQUFLLENBQUMsZ0JBQWdCLENBQUMsQ0FBQztTQUNuQztRQUNELE9BQU8sSUFBSSxDQUFDO0lBQ2QsQ0FBQztJQVRlLGNBQVMsWUFTeEIsQ0FBQTtJQUtELFNBQWdCLEtBQUssQ0FBQyxNQUFlLEVBQUUsS0FBSyxHQUFHLENBQUM7UUFHOUMsTUFBTSxHQUFHLEdBQTZCLEVBQUUsQ0FBQztRQUN6QyxNQUFNLEtBQUssR0FBVyxFQUFFLENBQUM7UUFFekIsU0FBUyxLQUFLO1lBQ1osTUFBTSxDQUFDLEVBQUUsRUFBRSxDQUFDLEVBQUMsRUFBRSxLQUFLLENBQUMsQ0FBQyxHQUFHLEdBQUcsQ0FBQyxHQUFHLEVBQUcsQ0FBQztZQUVwQyxNQUFNLElBQUksR0FBRyxLQUFLLENBQUMsTUFBTSxDQUFDLEtBQUssQ0FBQyxNQUFNLEdBQUcsS0FBSyxFQUFFLEtBQUssQ0FBQyxDQUFDO1lBQ3ZELElBQUksSUFBSSxDQUFDLE1BQU0sS0FBSyxLQUFLO2dCQUFFLE1BQU0sSUFBSSxLQUFLLENBQUMsd0JBQXdCLENBQUMsQ0FBQztZQUNyRSxLQUFLLENBQUMsSUFBSSxDQUFDLE9BQU8sQ0FBQyxFQUFDLEVBQUUsRUFBRSxJQUFJLEVBQUMsQ0FBQyxDQUFDLENBQUM7UUFDbEMsQ0FBQztRQUVELElBQUksR0FBRyxHQUFHLElBQUksQ0FBQztRQUNmLElBQUksQ0FBQyxHQUFHLEtBQUssQ0FBQztRQUNkLE9BQU8sQ0FBQyxHQUFHLE1BQU0sQ0FBQyxNQUFNLEVBQUUsQ0FBQyxFQUFFLEVBQUU7WUFDN0IsTUFBTSxLQUFLLEdBQUcsTUFBTSxDQUFDLENBQUMsQ0FBQyxDQUFDO1lBRXhCLElBQUksR0FBRyxFQUFFO2dCQUVQLElBQUksS0FBSyxDQUFDLEtBQUssS0FBSyxJQUFJLElBQUksS0FBSyxDQUFDLEtBQUssS0FBSyxJQUFJLEVBQUU7b0JBQ2hELE1BQU0sTUFBTSxHQUFHLFFBQVEsQ0FBQyxHQUFHLENBQUMsS0FBSyxDQUFDLEdBQUcsQ0FBQyxDQUFDO29CQUN2QyxNQUFNLE1BQU0sR0FBRyxTQUFTLENBQUMsR0FBRyxDQUFDLE1BQU0sYUFBTixNQUFNLGNBQU4sTUFBTSxHQUFJLEtBQUssQ0FBQyxHQUFHLENBQUMsQ0FBQztvQkFDbEQsSUFBSSxNQUFNLEVBQUU7d0JBQ1YsR0FBRyxDQUFDLElBQUksQ0FBQyxDQUFDLEtBQUssQ0FBQyxHQUFHLEVBQUUsTUFBTSxDQUFDLENBQUMsQ0FBQztxQkFDL0I7eUJBQU0sSUFBSSxLQUFLLENBQUMsS0FBSyxLQUFLLElBQUksRUFBRTt3QkFDL0IsTUFBTSxFQUFFLEdBQUcsS0FBSyxDQUFDLEdBQUcsQ0FBQzt3QkFDckIsSUFBSSxDQUFDLFNBQVMsQ0FBQyxHQUFHLENBQUMsRUFBRSxDQUFDLEVBQUU7NEJBQ3RCLE1BQU0sSUFBSSxLQUFLLENBQUMscUJBQXFCLEtBQUssQ0FBQyxNQUFNLENBQUMsS0FBSyxDQUFDLEVBQUUsQ0FBQyxDQUFDO3lCQUM3RDt3QkFDRCxNQUFNLElBQUksR0FBRyxNQUFNLENBQUMsQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDO3dCQUMzQixJQUFJLENBQUEsSUFBSSxhQUFKLElBQUksdUJBQUosSUFBSSxDQUFFLEtBQUssTUFBSyxJQUFJLEVBQUU7NEJBQ3hCLE1BQU0sSUFBSSxLQUFLLENBQUMsZ0JBQWdCLEtBQUssQ0FBQyxNQUFNLENBQUMsSUFBSSxhQUFKLElBQUksY0FBSixJQUFJLEdBQUksS0FBSyxDQUFDLEVBQUUsQ0FBQyxDQUFDO3lCQUNoRTt3QkFDRCxNQUFNLEtBQUssR0FBRyxLQUFLLENBQUMsWUFBWSxDQUFDLE1BQU0sRUFBRSxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUM7d0JBQ2hELElBQUksS0FBSyxHQUFHLENBQUMsRUFBRTs0QkFDYixNQUFNLElBQUksS0FBSyxDQUFDLGlCQUFpQixLQUFLLENBQUMsTUFBTSxDQUFDLElBQUksQ0FBQyxFQUFFLENBQUMsQ0FBQzt5QkFDeEQ7d0JBQ0QsTUFBTSxJQUFJLEdBQVcsRUFBRSxDQUFDO3dCQUN4QixLQUFLLE1BQU0sR0FBRyxJQUFJLEtBQUssQ0FBQyxZQUFZLENBQUMsTUFBTSxFQUFFLENBQUMsR0FBRyxDQUFDLEVBQUUsS0FBSyxDQUFDLEVBQUU7NEJBQzFELElBQUksQ0FBQyxJQUFJLENBQUMsU0FBUyxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUM7eUJBQzNCO3dCQUNELENBQUMsR0FBRyxLQUFLLENBQUM7d0JBQ1YsS0FBSyxDQUFDLElBQUksQ0FBQyxPQUFPLENBQUMsRUFBQyxFQUFFLEVBQUUsSUFBSSxFQUFDLENBQUMsQ0FBQyxDQUFDO3dCQUNoQyxHQUFHLEdBQUcsS0FBSyxDQUFDO3FCQUNiO3lCQUFNLElBQUksS0FBSyxDQUFDLEVBQUUsQ0FBQyxLQUFLLEVBQUUsS0FBSyxDQUFDLElBQUksQ0FBQyxFQUFFO3dCQUN0QyxLQUFLLENBQUMsSUFBSSxDQUFDLEVBQUMsRUFBRSxFQUFFLEtBQUssRUFBRSxHQUFHLEVBQUUsR0FBRyxFQUFDLENBQUMsQ0FBQzt3QkFDbEMsR0FBRyxHQUFHLEtBQUssQ0FBQztxQkFDYjt5QkFBTTt3QkFDTCxNQUFNLElBQUksS0FBSyxDQUFDLDRCQUE0QixLQUFLLENBQUMsTUFBTSxDQUFDLEtBQUssQ0FBQyxFQUFFLENBQUMsQ0FBQztxQkFDcEU7aUJBQ0Y7cUJBQU0sSUFBSSxLQUFLLENBQUMsS0FBSyxLQUFLLElBQUksRUFBRTtvQkFFL0IsTUFBTSxLQUFLLEdBQUcsS0FBSyxDQUFDLFlBQVksQ0FBQyxNQUFNLEVBQUUsQ0FBQyxDQUFDLENBQUM7b0JBQzVDLElBQUksS0FBSyxHQUFHLENBQUMsRUFBRTt3QkFDYixNQUFNLElBQUksS0FBSyxDQUFDLG1CQUFtQixLQUFLLENBQUMsTUFBTSxDQUFDLEtBQUssQ0FBQyxFQUFFLENBQUMsQ0FBQztxQkFDM0Q7b0JBQ0QsTUFBTSxDQUFDLEdBQUcsU0FBUyxDQUFDLE1BQU0sQ0FBQyxLQUFLLENBQUMsQ0FBQyxHQUFHLENBQUMsRUFBRSxLQUFLLENBQUMsQ0FBQyxDQUFDO29CQUNoRCxLQUFLLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxDQUFDO29CQUNkLENBQUMsR0FBRyxLQUFLLENBQUM7b0JBQ1YsR0FBRyxHQUFHLEtBQUssQ0FBQztpQkFDYjtxQkFBTSxJQUFJLEtBQUssQ0FBQyxLQUFLLEtBQUssT0FBTyxFQUFFO29CQUVsQyxLQUFLLENBQUMsSUFBSSxDQUFDLEVBQUMsRUFBRSxFQUFFLEtBQUssRUFBRSxHQUFHLEVBQUUsS0FBSyxDQUFDLEdBQUcsRUFBQyxDQUFDLENBQUM7b0JBRXhDLEdBQUcsR0FBRyxLQUFLLENBQUM7aUJBQ2I7cUJBQU0sSUFBSSxLQUFLLENBQUMsS0FBSyxLQUFLLEtBQUssRUFBRTtvQkFFaEMsTUFBTSxHQUFHLEdBQUcsS0FBSyxDQUFDLEdBQUcsQ0FBQztvQkFDdEIsS0FBSyxDQUFDLElBQUksQ0FBQyxFQUFDLEVBQUUsRUFBRSxLQUFLLEVBQUUsR0FBRyxFQUFFLElBQUksRUFBRSxJQUFJLENBQUMsR0FBRyxDQUFDLEVBQUMsQ0FBQyxDQUFDO29CQUM5QyxHQUFHLEdBQUcsS0FBSyxDQUFDO2lCQUNiO3FCQUFNO29CQUVMLE1BQU0sSUFBSSxLQUFLLENBQUMseUJBQXlCLEtBQUssQ0FBQyxNQUFNLENBQUMsS0FBSyxDQUFDLEVBQUUsQ0FBQyxDQUFDO2lCQUVqRTthQUNGO2lCQUFNO2dCQUVMLElBQUksS0FBSyxDQUFDLEVBQUUsQ0FBQyxLQUFLLEVBQUUsS0FBSyxDQUFDLEtBQUssQ0FBQyxFQUFxQztvQkFHbkUsTUFBTTtpQkFDUDtnQkFDRCxJQUFJLEtBQUssQ0FBQyxLQUFLLEtBQUssSUFBSSxJQUFJLEtBQUssQ0FBQyxLQUFLLEtBQUssSUFBSSxFQUFFO29CQUNoRCxNQUFNLE1BQU0sR0FBRyxRQUFRLENBQUMsR0FBRyxDQUFDLEtBQUssQ0FBQyxHQUFHLENBQUMsQ0FBQztvQkFDdkMsTUFBTSxFQUFFLEdBQUcsTUFBTSxDQUFDLEdBQUcsQ0FBQyxNQUFNLGFBQU4sTUFBTSxjQUFOLE1BQU0sR0FBSSxLQUFLLENBQUMsR0FBRyxDQUFDLENBQUM7b0JBQzNDLElBQUksQ0FBQyxFQUFFO3dCQUFFLE1BQU07b0JBRWYsT0FBTyxHQUFHLENBQUMsTUFBTSxFQUFFO3dCQUNqQixNQUFNLEdBQUcsR0FBRyxHQUFHLENBQUMsR0FBRyxDQUFDLE1BQU0sR0FBRyxDQUFDLENBQUMsQ0FBQzt3QkFDaEMsTUFBTSxHQUFHLEdBQUcsU0FBUyxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUMsRUFBRSxFQUFFLENBQUMsQ0FBQzt3QkFDbEMsSUFBSSxHQUFHLEdBQUcsQ0FBQzs0QkFBRSxNQUFNO3dCQUNuQixJQUFJLEdBQUcsS0FBSyxDQUFDLEVBQUU7NEJBQ2IsTUFBTSxJQUFJLEtBQUssQ0FDWCxVQUFVLEdBQUcsQ0FBQyxDQUFDLENBQUMsUUFBUSxLQUFLLENBQUMsR0FBRywwQkFDaEMsS0FBSyxDQUFDLEVBQUUsQ0FBQyxLQUFLLENBQUMsRUFBRSxDQUFDLENBQUM7eUJBQ3pCO3dCQUNELEtBQUssRUFBRSxDQUFDO3FCQUNUO29CQUNELEdBQUcsQ0FBQyxJQUFJLENBQUMsQ0FBQyxLQUFLLENBQUMsR0FBRyxFQUFFLEVBQUUsQ0FBQyxDQUFDLENBQUM7b0JBQzFCLEdBQUcsR0FBRyxJQUFJLENBQUM7aUJBQ1o7cUJBQU07b0JBR0wsTUFBTTtpQkFDUDthQUNGO1NBQ0Y7UUFHRCxPQUFPLEdBQUcsQ0FBQyxNQUFNO1lBQUUsS0FBSyxFQUFFLENBQUM7UUFFM0IsSUFBSSxLQUFLLENBQUMsTUFBTSxLQUFLLENBQUM7WUFBRSxNQUFNLElBQUksS0FBSyxDQUFDLHdCQUF3QixDQUFDLENBQUM7UUFDbEUsSUFBSSxNQUFNLENBQUMsS0FBSyxDQUFDLENBQUMsTUFBTTtZQUFFLEtBQUssQ0FBQyxDQUFDLENBQUMsQ0FBQyxNQUFNLEdBQUcsTUFBTSxDQUFDLEtBQUssQ0FBQyxDQUFDLE1BQU0sQ0FBQztRQUNqRSxPQUFPLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDO0lBQ3ZCLENBQUM7SUFwSGUsVUFBSyxRQW9IcEIsQ0FBQTtJQUtELFNBQVMsU0FBUyxDQUFDLElBQVUsRUFBRSxDQUFnQztRQUM3RCxNQUFNLElBQUksS0FBSyxFQUFFLENBQUM7SUFDcEIsQ0FBQztJQUVELFNBQVMsR0FBRyxDQUFDLEdBQXFCO1FBQ2hDLElBQUksR0FBRyxJQUFJLElBQUk7WUFBRSxPQUFPLFNBQVMsQ0FBQztRQUNsQyxPQUFPLEVBQUMsRUFBRSxFQUFFLEtBQUssRUFBRSxHQUFHLEVBQUUsSUFBSSxFQUFFLElBQUksQ0FBQyxHQUFHLENBQUMsRUFBQyxDQUFDO0lBQzNDLENBQUM7SUFFRCxTQUFTLEtBQUssQ0FBQyxJQUFVLEVBQUUsQ0FBd0I7UUFFakQsTUFBTSxHQUFHLEdBQUcsSUFBSSxDQUFDLElBQUssQ0FBQyxDQUFDLENBQUMsQ0FBQztRQUMxQixJQUFJLENBQUMsS0FBSyxDQUFDLEdBQUcsQ0FBQztZQUFFLE9BQU8sSUFBSSxDQUFDO1FBQzdCLE1BQU0sR0FBRyxHQUFHLENBQUMsQ0FBQyxHQUFHLENBQUMsR0FBSSxDQUFDLENBQUM7UUFDeEIsT0FBTyxFQUFDLEVBQUUsRUFBRSxLQUFLLEVBQUUsR0FBRyxFQUFFLElBQUksRUFBRSxJQUFJLENBQUMsR0FBRyxDQUFDLEVBQUMsQ0FBQztJQUMzQyxDQUFDO0lBRUQsU0FBUyxNQUFNLENBQUMsSUFBVSxFQUFFLENBQW1DO1FBRTdELE1BQU0sQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDLEdBQUcsSUFBSSxDQUFDLElBQUssQ0FBQztRQUMxQixJQUFJLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQztZQUFFLE9BQU8sSUFBSSxDQUFDO1FBQ3hDLE1BQU0sR0FBRyxHQUFHLENBQUMsQ0FBQyxDQUFDLENBQUMsR0FBSSxFQUFFLENBQUMsQ0FBQyxHQUFJLENBQUMsQ0FBQztRQUM5QixPQUFPLEVBQUMsRUFBRSxFQUFFLEtBQUssRUFBRSxHQUFHLEVBQUUsSUFBSSxFQUFFLElBQUksQ0FBQyxHQUFHLENBQUMsRUFBQyxDQUFDO0lBQzNDLENBQUM7SUFFRCxTQUFTLElBQUksQ0FBQyxJQUFVOztRQUV0QixNQUFNLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxHQUFHLElBQUksQ0FBQyxJQUFLLENBQUM7UUFDMUIsSUFBSSxDQUFDLENBQUMsRUFBRSxLQUFLLEtBQUssSUFBSSxDQUFDLENBQUMsRUFBRSxLQUFLLEtBQUs7WUFBRSxPQUFPLElBQUksQ0FBQztRQUNsRCxNQUFNLEdBQUcsR0FBUyxFQUFDLEVBQUUsRUFBRSxLQUFLLEVBQUUsR0FBRyxFQUFFLENBQUMsQ0FBQyxHQUFJLEdBQUcsQ0FBQyxDQUFDLEdBQUksRUFBQyxDQUFDO1FBQ3BELElBQUksQ0FBQyxDQUFDLElBQUksSUFBSSxDQUFDLENBQUMsSUFBSSxFQUFFO1lBQ3BCLElBQUksT0FBQSxDQUFDLENBQUMsSUFBSSwwQ0FBRSxHQUFHLFlBQUksQ0FBQyxDQUFDLElBQUksMENBQUUsR0FBRyxDQUFBO2dCQUFFLE9BQU8sSUFBSSxDQUFDO1lBQzVDLFVBQUksQ0FBQyxDQUFDLElBQUksMENBQUUsR0FBRyxFQUFFO2dCQUNmLEdBQUcsQ0FBQyxJQUFJLEdBQUcsQ0FBQyxDQUFDLElBQUksQ0FBQzthQUNuQjtpQkFBTSxVQUFJLENBQUMsQ0FBQyxJQUFJLDBDQUFFLEdBQUcsRUFBRTtnQkFDdEIsR0FBRyxDQUFDLElBQUksR0FBRyxDQUFDLENBQUMsSUFBSSxDQUFDO2FBQ25CO1NBQ0Y7UUFDRCxJQUFJLFFBQUMsR0FBRyxDQUFDLElBQUksMENBQUUsR0FBRyxDQUFBLElBQUksT0FBQSxHQUFHLENBQUMsSUFBSSwwQ0FBRSxJQUFJLEtBQUksSUFBSSxFQUFFO1lBQzVDLENBQUMsR0FBRyxDQUFDLElBQUksSUFBSSxDQUFDLEdBQUcsQ0FBQyxJQUFJLEdBQUcsRUFBRSxDQUFDLENBQUMsQ0FBQyxJQUFJLEdBQUcsSUFBSSxDQUFDLEdBQUcsQ0FBQyxHQUFJLENBQUMsQ0FBQyxJQUFJLENBQUM7U0FDMUQ7UUFDRCxPQUFPLEdBQUcsQ0FBQztJQUNiLENBQUM7SUFFRCxTQUFTLEtBQUssQ0FBQyxJQUFVOztRQUV2QixNQUFNLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxHQUFHLElBQUksQ0FBQyxJQUFLLENBQUM7UUFDMUIsSUFBSSxDQUFDLENBQUMsRUFBRSxLQUFLLEtBQUssSUFBSSxDQUFDLENBQUMsRUFBRSxLQUFLLEtBQUs7WUFBRSxPQUFPLElBQUksQ0FBQztRQUNsRCxNQUFNLEdBQUcsR0FBUyxFQUFDLEVBQUUsRUFBRSxLQUFLLEVBQUUsR0FBRyxFQUFFLENBQUMsQ0FBQyxHQUFJLEdBQUcsQ0FBQyxDQUFDLEdBQUksRUFBQyxDQUFDO1FBQ3BELFVBQUksQ0FBQyxDQUFDLElBQUksMENBQUUsR0FBRyxFQUFFO1lBQ2YsT0FBTyxPQUFBLENBQUMsQ0FBQyxJQUFJLDBDQUFFLEdBQUcsS0FBSSxDQUFDLENBQUMsSUFBSSxDQUFDLEtBQUssS0FBSyxDQUFDLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUM7U0FDbEU7UUFDRCxVQUFJLENBQUMsQ0FBQyxJQUFJLDBDQUFFLEdBQUc7WUFBRSxHQUFHLENBQUMsSUFBSSxHQUFHLENBQUMsQ0FBQyxJQUFJLENBQUM7UUFDbkMsSUFBSSxRQUFDLEdBQUcsQ0FBQyxJQUFJLDBDQUFFLEdBQUcsQ0FBQSxJQUFJLE9BQUEsR0FBRyxDQUFDLElBQUksMENBQUUsSUFBSSxLQUFJLElBQUksRUFBRTtZQUM1QyxDQUFDLEdBQUcsQ0FBQyxJQUFJLElBQUksQ0FBQyxHQUFHLENBQUMsSUFBSSxHQUFHLEVBQUUsQ0FBQyxDQUFDLENBQUMsSUFBSSxHQUFHLElBQUksQ0FBQyxHQUFHLENBQUMsR0FBSSxDQUFDLENBQUMsSUFBSSxDQUFDO1NBQzFEO1FBQ0QsT0FBTyxHQUFHLENBQUM7SUFDYixDQUFDO0lBRUQsU0FBUyxLQUFLLENBQUMsSUFBVTs7UUFDdkIsT0FBTyxJQUFJLENBQUMsRUFBRSxLQUFLLEtBQUssSUFBSSxRQUFDLElBQUksQ0FBQyxJQUFJLDBDQUFFLEdBQUcsQ0FBQSxDQUFDO0lBQzlDLENBQUM7QUFDSCxDQUFDLEVBM1VnQixJQUFJLEtBQUosSUFBSSxRQTJVcEI7QUFLRCxTQUFTLFNBQVMsQ0FBQyxHQUFpQixFQUFFLElBQWtCO0lBQ3RELElBQUksR0FBRyxDQUFDLENBQUMsQ0FBQyxHQUFHLElBQUksQ0FBQyxDQUFDLENBQUM7UUFBRSxPQUFPLENBQUMsQ0FBQztJQUMvQixJQUFJLEdBQUcsQ0FBQyxDQUFDLENBQUMsR0FBRyxJQUFJLENBQUMsQ0FBQyxDQUFDO1FBQUUsT0FBTyxDQUFDLENBQUMsQ0FBQztJQUNoQyxJQUFJLEdBQUcsQ0FBQyxDQUFDLENBQUMsS0FBSyxJQUFJLENBQUMsQ0FBQyxDQUFDO1FBQUUsT0FBTyxDQUFDLENBQUM7SUFDakMsT0FBTyxHQUFHLENBQUMsQ0FBQyxDQUFDLENBQUM7QUFDaEIsQ0FBQztBQUtELE1BQU0sTUFBTSxHQUFHLENBQUMsQ0FBQztBQUNqQixNQUFNLEtBQUssR0FBRyxDQUFDLENBQUM7QUFDaEIsTUFBTSxDQUFDLE1BQU0sTUFBTSxHQUFHLElBQUksR0FBRyxDQUF1QjtJQU1sRCxDQUFDLEdBQUcsRUFBRSxDQUFDLENBQUMsRUFBRSxDQUFDLEVBQUUsTUFBTSxDQUFDLENBQUM7SUFDckIsQ0FBQyxHQUFHLEVBQUUsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxFQUFFLE1BQU0sQ0FBQyxDQUFDO0lBQ3JCLENBQUMsTUFBTSxFQUFFLENBQUMsQ0FBQyxFQUFFLENBQUMsRUFBRSxNQUFNLENBQUMsQ0FBQztJQUN4QixDQUFDLEdBQUcsRUFBRSxDQUFDLENBQUMsRUFBRSxDQUFDLEVBQUUsTUFBTSxDQUFDLENBQUM7SUFDckIsQ0FBQyxHQUFHLEVBQUUsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxFQUFFLE1BQU0sQ0FBQyxDQUFDO0lBQ3JCLENBQUMsSUFBSSxFQUFFLENBQUMsQ0FBQyxFQUFFLENBQUMsRUFBRSxNQUFNLENBQUMsQ0FBQztJQUN0QixDQUFDLElBQUksRUFBRSxDQUFDLENBQUMsRUFBRSxDQUFDLEVBQUUsTUFBTSxDQUFDLENBQUM7SUFFdEIsQ0FBQyxHQUFHLEVBQUUsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxFQUFFLE1BQU0sQ0FBQyxDQUFDO0lBQ3JCLENBQUMsR0FBRyxFQUFFLENBQUMsQ0FBQyxFQUFFLENBQUMsRUFBRSxNQUFNLENBQUMsQ0FBQztJQUNyQixDQUFDLEdBQUcsRUFBRSxDQUFDLENBQUMsRUFBRSxDQUFDLEVBQUUsTUFBTSxDQUFDLENBQUM7SUFFckIsQ0FBQyxHQUFHLEVBQUUsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxFQUFFLE1BQU0sQ0FBQyxDQUFDO0lBQ3JCLENBQUMsSUFBSSxFQUFFLENBQUMsQ0FBQyxFQUFFLENBQUMsRUFBRSxNQUFNLENBQUMsQ0FBQztJQUN0QixDQUFDLEdBQUcsRUFBRSxDQUFDLENBQUMsRUFBRSxDQUFDLEVBQUUsTUFBTSxDQUFDLENBQUM7SUFDckIsQ0FBQyxJQUFJLEVBQUUsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxFQUFFLE1BQU0sQ0FBQyxDQUFDO0lBQ3RCLENBQUMsR0FBRyxFQUFFLENBQUMsQ0FBQyxFQUFFLENBQUMsRUFBRSxNQUFNLENBQUMsQ0FBQztJQUNyQixDQUFDLElBQUksRUFBRSxDQUFDLENBQUMsRUFBRSxDQUFDLEVBQUUsTUFBTSxDQUFDLENBQUM7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Q0FBQztJQUNoQixDQUFDLEdBQUcsRUFBRSxJQUFJLENBQUMsR0FBRyxDQUFDO0lBQ2YsQ0FBQyxJQUFJLEVBQUUsSUFBSSxDQUFDLEdBQUcsQ0FBQztJQUNoQixDQUFDLE1BQU0sRUFBRSxJQUFJLENBQUMsR0FBRyxDQUFDO0lBQ2xCLENBQUMsTUFBTSxFQUFFLElBQUksQ0FBQyxHQUFHLENBQUM7SUFDbEIsQ0FBQyxNQUFNLEVBQUUsSUFBSSxDQUFDLEdBQUcsQ0FBQztDQUNuQixDQUFDLENBQUM7QUFFSCxTQUFTLE9BQU8sQ0FBQyxJQUFVO0lBQ3pCLE1BQU0sS0FBSyxHQUFHLGVBQWUsQ0FBQyxHQUFHLENBQUMsSUFBSSxDQUFDLEVBQUUsQ0FBQyxDQUFDO0lBQzNDLE1BQU0sSUFBSSxHQUFHLEtBQUssYUFBTCxLQUFLLHVCQUFMLEtBQUssQ0FBRyxHQUFHLElBQUksQ0FBQyxJQUFLLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQyxFQUFFLFdBQUMsT0FBQSxNQUFNLE9BQUMsQ0FBQyxDQUFDLElBQUksMENBQUUsSUFBSSxDQUFDLENBQUEsRUFBQSxDQUFDLENBQUMsQ0FBQztJQUNuRSxJQUFJLElBQUk7UUFBRSxDQUFDLElBQUksQ0FBQyxJQUFJLElBQUksQ0FBQyxJQUFJLENBQUMsSUFBSSxHQUFHLEVBQUUsQ0FBQyxDQUFDLENBQUMsSUFBSSxHQUFHLElBQUksQ0FBQztJQUN0RCxPQUFPLElBQUksQ0FBQztBQUNkLENBQUM7QUFFRCxTQUFTLElBQUksQ0FBQyxHQUFXO0lBQ3ZCLE9BQU8sRUFBQyxJQUFJLEVBQUUsQ0FBQyxJQUFJLEdBQUcsSUFBSSxHQUFHLEdBQUcsR0FBRyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsRUFBQyxDQUFDO0FBQy9DLENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQge1NvdXJjZUluZm8sIFRva2VufSBmcm9tICcuL3Rva2VuLmpzJztcblxuZXhwb3J0IGludGVyZmFjZSBFeHByIHtcbiAgLy8gb3BlcmF0b3IgKGUuZy4gJysnIG9yICcubWF4Jykgb3IgJ3N5bScsICdudW0nLCBvciAnaW0nXG4gIC8vICAtIHN5bTogYW4gb2Zmc2V0IGludG8gdGhlIHN5bWJvbHMgYXJyYXkgKG9yIHRoZSBuYW1lIGluICdzeW0nKVxuICAvLyAgLSBudW06IGEgbnVtYmVyIGxpdGVyYWwsIG9yIGFuIG9mZnNldCBpbnRvIHRoZSBzeW1ib2xzIGFycmF5LlxuICAvLyAgLSBpbTogYW4gaW1wb3J0IGZyb20gYW5vdGhlciBvYmplY3QgZmlsZSAodXNlcyAnc3ltJykuXG4gIC8vIFRPRE8gLSB3aGF0IGFib3V0IGRpZmZlcmVudCBhZGRyZXNzIHR5cGVzPyBiYW5rIGhpbnQvZXRjP1xuICAvLyAgICAgIC0gZG9lcyBiYW5rIGhpbnQgbmVlZCB0byBnZXQgc3RvcmVkIGluIHRoZSBvYmplY3QgZmlsZT9cbiAgLy8gICAgICAgIC0gcHJvYmFibHkgbm90Li4uP1xuICBvcDogc3RyaW5nO1xuICBhcmdzPzogRXhwcltdO1xuICBudW0/OiBudW1iZXI7IC8vIG9ubHkgdXNlZCB3aGVuIG9wID09PSAnbnVtJ1xuICBtZXRhPzogRXhwci5NZXRhO1xuICBzeW0/OiBzdHJpbmc7IC8vIG9ubHkgdXNlZCB3aGVuIG9wID09PSAnc3ltJ1xuICBzb3VyY2U/OiBTb3VyY2VJbmZvO1xufVxuXG5leHBvcnQgbmFtZXNwYWNlIEV4cHIge1xuXG4gIGZ1bmN0aW9uIGpzU291cmNlKGU6IEV4cHIpOiB7c291cmNlPzogU291cmNlSW5mb30ge1xuICAgIHJldHVybiBlLnNvdXJjZSA/XG4gICAgICAgIHtzb3VyY2U6IHtwYXJlbnQ6IGUuc291cmNlLCBmaWxlOiAnanMnLCBsaW5lOiAwLCBjb2x1bW46IDB9fSA6IHt9O1xuICB9XG5cbiAgLyoqIEdpdmVuIGFuIEV4cHIsIHJldHVybnMgYSBuZXcgRXhwciBmb3IgdGhlIGxvdyBieXRlLiAqL1xuICBleHBvcnQgZnVuY3Rpb24gbG9CeXRlKGU6IEV4cHIpIHtcbiAgICByZXR1cm4ge29wOiAnPCcsIGFyZ3M6IFtlXSwgLi4uanNTb3VyY2UoZSl9O1xuICB9XG4gIC8qKiBHaXZlbiBhbiBFeHByLCByZXR1cm5zIGEgbmV3IEV4cHIgZm9yIHRoZSBoaWdoIGJ5dGUuICovXG4gIGV4cG9ydCBmdW5jdGlvbiBoaUJ5dGUoZTogRXhwcikge1xuICAgIHJldHVybiB7b3A6ICc+JywgYXJnczogW2VdLCAuLi5qc1NvdXJjZShlKX07XG4gIH1cblxuICAvKiogRXh0cmEgaW5mb3JtYXRpb24gZm9yICdudW0nIHZhbHVlcy4gKi9cbiAgZXhwb3J0IGludGVyZmFjZSBNZXRhIHtcbiAgICAvKiogV2hldGhlciB0aGlzIGlzIHJlbGF0aXZlIHRvIHRoZSBzdGFydCBvZiB0aGUgY2h1bmsuICovXG4gICAgcmVsPzogYm9vbGVhbjtcbiAgICAvKiogUmVsYXRpdmUgY2h1bmsgdGhlIHZhbHVlIGlzIGRlZmluZWQgaW4uICovXG4gICAgY2h1bms/OiBudW1iZXI7XG4gICAgLyoqIE9yZyB2YWx1ZSBvZiBjaHVuaywgaWYga25vd24uICovXG4gICAgb3JnPzogbnVtYmVyO1xuICAgIC8qKiBCYW5rIHZhbHVlIG9mIGNodW5rLCBpZiBrbm93bi4gKi9cbiAgICBiYW5rPzogbnVtYmVyO1xuICAgIC8qKiBPZmZzZXQgdmFsdWUgb2YgY2h1bmssIGlmIGtub3duLiAqL1xuICAgIG9mZnNldD86IG51bWJlcjtcbiAgICAvKiogU2l6ZSBoaW50IGZvciBudW1iZXIuICovXG4gICAgc2l6ZT86IG51bWJlcjtcbiAgfVxuXG4gIHR5cGUgUmVjID0gKGV4cHI6IEV4cHIpID0+IEV4cHI7IC8vIHJlY3Vyc2VzIGludG8gY2hpbGRyZW5cbiAgdHlwZSBUcmF2ZXJzZXIgPSAoZXhwcjogRXhwciwgcmVjOiBSZWMsIHBhcmVudD86IEV4cHIpID0+IEV4cHI7XG5cbiAgLyoqIFBlcmZvcm1zIGEgcG9zdC1vcmRlciB0cmF2ZXJzYWwuICovXG4gIGV4cG9ydCBmdW5jdGlvbiB0cmF2ZXJzZShleHByOiBFeHByLCBmOiBUcmF2ZXJzZXIpIHtcbiAgICBmdW5jdGlvbiByZWMoZTogRXhwcikge1xuICAgICAgaWYgKCFlLmFyZ3MpIHJldHVybiBlO1xuICAgICAgcmV0dXJuIHsuLi5lLCBhcmdzOiBlLmFyZ3MubWFwKGMgPT4gdChjLCBlKSl9O1xuICAgIH07XG4gICAgZnVuY3Rpb24gdChlOiBFeHByLCBwPzogRXhwcikge1xuICAgICAgY29uc3Qgc291cmNlID0gZS5zb3VyY2U7XG4gICAgICBlID0gZihlLCByZWMsIHApO1xuICAgICAgaWYgKHNvdXJjZSAmJiAhZS5zb3VyY2UpIGUuc291cmNlID0gc291cmNlO1xuICAgICAgcmV0dXJuIGU7XG4gICAgfVxuICAgIHJldHVybiB0KGV4cHIpO1xuICB9XG5cbiAgZXhwb3J0IGZ1bmN0aW9uIHRyYXZlcnNlUG9zdChleHByOiBFeHByLCBmOiBSZWMpOiBFeHByIHtcbiAgICByZXR1cm4gdHJhdmVyc2UoZXhwciwgKGV4cHIsIHJlYykgPT4gZihyZWMoZXhwcikpKTtcbiAgfVxuXG4gIGV4cG9ydCBmdW5jdGlvbiBldmFsdWF0ZShleHByOiBFeHByKTogRXhwciB7XG4gICAgc3dpdGNoIChleHByLm9wKSB7IC8vIHZhci1hcmcgZnVuY3Rpb25zXG4gICAgICBjYXNlICcubW92ZSc6XG4gICAgICBjYXNlICdpbSc6XG4gICAgICBjYXNlICdzeW0nOlxuICAgICAgICByZXR1cm4gZXhwcjtcbiAgICAgIGNhc2UgJ251bSc6XG4gICAgICAgIGlmIChleHByLm1ldGE/LnJlbCAmJiBleHByLm1ldGEub3JnICE9IG51bGwpIHtcbiAgICAgICAgICAvLyBSZW1vdmUgdGhlICdyZWwnIHRhZyBzaW5jZSBpdCdzIG5vIGxvbmdlciByZWxhdGl2ZS5cbiAgICAgICAgICBjb25zdCB7cmVsLCAuLi5tZXRhfSA9IGV4cHIubWV0YTtcbiAgICAgICAgICAvLyBUT0RPIC0gcHVsbCBzaXplIGZyb20gbWV0YT9cbiAgICAgICAgICByZXR1cm4ge29wOiAnbnVtJywgbnVtOiBleHByLm51bSEgKyBtZXRhLm9yZyEsIG1ldGF9O1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBleHByO1xuICAgICAgY2FzZSAnLm1heCc6IHJldHVybiBzYW1lQ2h1bmsoZXhwciwgTWF0aC5tYXgpO1xuICAgICAgY2FzZSAnLm1pbic6IHJldHVybiBzYW1lQ2h1bmsoZXhwciwgTWF0aC5taW4pO1xuICAgICAgZGVmYXVsdDogLy8gZmFsbCB0aHJvdWdoIHRvIGxhdGVyIGNoZWNrc1xuICAgIH1cblxuICAgIC8vIFNwZWNpYWwgY2FzZSBmb3IgdW5hcmllc1xuICAgIGlmIChleHByLmFyZ3M/Lmxlbmd0aCA9PT0gMSkge1xuICAgICAgc3dpdGNoIChleHByLm9wKSB7XG4gICAgICAgIGNhc2UgJysnOiByZXR1cm4gZXhwci5hcmdzIVswXTtcbiAgICAgICAgY2FzZSAnLSc6IHJldHVybiB1bmFyeShleHByLCB4ID0+IC14KTtcbiAgICAgICAgY2FzZSAnfic6IHJldHVybiB1bmFyeShleHByLCB4ID0+IH54KTtcbiAgICAgICAgY2FzZSAnISc6IHJldHVybiB1bmFyeShleHByLCB4ID0+ICsheCk7XG4gICAgICAgIGNhc2UgJzwnOiByZXR1cm4gdW5hcnkoZXhwciwgeCA9PiB4ICYgMHhmZik7XG4gICAgICAgIGNhc2UgJz4nOiByZXR1cm4gdW5hcnkoZXhwciwgeCA9PiAoeCA+PiA4KSAmIDB4ZmYpO1xuICAgICAgICBjYXNlICdeJzogcmV0dXJuIG51bShleHByLmFyZ3MhWzBdLm1ldGE/LmJhbmspID8/IGV4cHI7XG4gICAgICAgIGRlZmF1bHQ6IHRocm93IG5ldyBFcnJvcihgVW5rbm93biB1bmFyeSBvcGVyYXRvcjogJHtleHByLm9wfWApO1xuICAgICAgfVxuICAgIH1cblxuICAgIHN3aXRjaCAoZXhwci5vcCkge1xuICAgICAgY2FzZSAnKyc6IHJldHVybiBwbHVzKGV4cHIpO1xuICAgICAgY2FzZSAnLSc6IHJldHVybiBtaW51cyhleHByKTtcbiAgICAgIGNhc2UgJyonOiByZXR1cm4gYmluYXJ5KGV4cHIsIChhLCBiKSA9PiBhICogYik7XG4gICAgICBjYXNlICcvJzogcmV0dXJuIGJpbmFyeShleHByLCAoYSwgYikgPT4gTWF0aC5mbG9vcihhIC8gYikpO1xuICAgICAgY2FzZSAnLm1vZCc6IHJldHVybiBiaW5hcnkoZXhwciwgKGEsIGIpID0+IGEgJSBiKTtcbiAgICAgIGNhc2UgJyYnOiByZXR1cm4gYmluYXJ5KGV4cHIsIChhLCBiKSA9PiBhICYgYik7XG4gICAgICBjYXNlICd8JzogcmV0dXJuIGJpbmFyeShleHByLCAoYSwgYikgPT4gYSB8IGIpO1xuICAgICAgY2FzZSAnXic6IHJldHVybiBiaW5hcnkoZXhwciwgKGEsIGIpID0+IGEgXiBiKTtcbiAgICAgIGNhc2UgJzw8JzogcmV0dXJuIGJpbmFyeShleHByLCAoYSwgYikgPT4gYSA8PCBiKTtcbiAgICAgIGNhc2UgJz4+JzogcmV0dXJuIGJpbmFyeShleHByLCAoYSwgYikgPT4gYSA+Pj4gYik7XG4gICAgICBjYXNlICc8JzogcmV0dXJuIGJpbmFyeShleHByLCAoYSwgYikgPT4gKyhhIDwgYikpO1xuICAgICAgY2FzZSAnPD0nOiByZXR1cm4gYmluYXJ5KGV4cHIsIChhLCBiKSA9PiArKGEgPD0gYikpO1xuICAgICAgY2FzZSAnPic6IHJldHVybiBiaW5hcnkoZXhwciwgKGEsIGIpID0+ICsoYSA+IGIpKTtcbiAgICAgIGNhc2UgJz49JzogcmV0dXJuIGJpbmFyeShleHByLCAoYSwgYikgPT4gKyhhID49IGIpKTtcbiAgICAgIGNhc2UgJz0nOiByZXR1cm4gYmluYXJ5KGV4cHIsIChhLCBiKSA9PiArKGEgPT0gYikpO1xuICAgICAgY2FzZSAnPD4nOiByZXR1cm4gYmluYXJ5KGV4cHIsIChhLCBiKSA9PiArKGEgIT0gYikpO1xuICAgICAgY2FzZSAnJiYnOiByZXR1cm4gYmluYXJ5KGV4cHIsIChhLCBiKSA9PiBhICYmIGIpO1xuICAgICAgY2FzZSAnfHwnOiByZXR1cm4gYmluYXJ5KGV4cHIsIChhLCBiKSA9PiBhIHx8IGIpO1xuICAgICAgY2FzZSAnLnhvcic6IHJldHVybiBiaW5hcnkoZXhwciwgKGEsIGIpID0+ICFhICYmIGIgfHwgIWIgJiYgYSB8fCAwKTtcbiAgICAgIGRlZmF1bHQ6IHRocm93IG5ldyBFcnJvcihgVW5rbm93biBvcGVyYXRvcjogJHtleHByLm9wfWApO1xuICAgIH1cbiAgfVxuXG4gIGV4cG9ydCBmdW5jdGlvbiBpZGVudGlmaWVyKGV4cHI6IEV4cHIpOiBzdHJpbmcge1xuICAgIGlmIChleHByLm9wID09PSAnc3ltJyAmJiBleHByLnN5bSkgcmV0dXJuIGV4cHIuc3ltO1xuICAgIHRocm93IG5ldyBFcnJvcihgRXhwZWN0ZWQgaWRlbnRpZmllciBidXQgZ290IG9wOiAke2V4cHIub3B9YCk7XG4gIH1cblxuICAvLyAvKiogUmV0dXJucyB0aGUgaWRlbnRpZmllci4gKi9cbiAgLy8gZXhwb3J0IGZ1bmN0aW9uIGlkZW50aWZpZXIoZXhwcjogRXhwcik6IHN0cmluZyB7XG4gIC8vICAgY29uc3QgdGVybXM6IHN0cmluZ1tdID0gW107XG4gIC8vICAgYXBwZW5kKGV4cHIpO1xuICAvLyAgIHJldHVybiB0ZXJtcy5qb2luKCc6OicpO1xuICAvLyAgIGZ1bmN0aW9uIGFwcGVuZChlOiBFeHByKSB7XG4gIC8vICAgICBpZiAoZS5vcCA9PT0gJ2lkZW50Jykge1xuICAvLyAgICAgICB0ZXJtcy5wdXNoKGUuc3ltISk7XG4gIC8vICAgICB9IGVsc2UgaWYgKGUub3AgPT09ICc6OicpIHtcbiAgLy8gICAgICAgaWYgKGUuYXJncyEubGVuZ3RoID09PSAxKSB0ZXJtcy5wdXNoKCcnKTtcbiAgLy8gICAgICAgZS5hcmdzIS5mb3JFYWNoKGFwcGVuZCk7XG4gIC8vICAgICB9IGVsc2Uge1xuICAvLyAgICAgICB0aHJvdyBuZXcgRXJyb3IoYEV4cGVjdGVkIGlkZW50aWZpZXIgYnV0IGdvdCBvcDogJHtlLm9wfWApO1xuICAvLyAgICAgfVxuICAvLyAgIH1cbiAgLy8gfVxuXG4gIC8qKiBQYXJzZSBhIHNpbmdsZSBleHByZXNzaW9uLCBtdXN0IG9jY3VweSB0aGUgcmVzdCBvZiB0aGUgbGluZS4gKi9cbiAgZXhwb3J0IGZ1bmN0aW9uIHBhcnNlT25seSh0b2tlbnM6IFRva2VuW10sIGluZGV4ID0gMCk6IEV4cHIge1xuICAgIGNvbnN0IFtleHByLCBpXSA9IHBhcnNlKHRva2VucywgaW5kZXgpO1xuICAgIGlmIChpIDwgdG9rZW5zLmxlbmd0aCkge1xuICAgICAgcGFyc2UodG9rZW5zLCBpbmRleCk7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoYEdhcmJhZ2UgYWZ0ZXIgZXhwcmVzc2lvbjogJHtUb2tlbi5uYW1lQXQodG9rZW5zW2ldKX1gKTtcbiAgICB9IGVsc2UgaWYgKCFleHByKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoYE5vIGV4cHJlc3Npb24/YCk7XG4gICAgfVxuICAgIHJldHVybiBleHByO1xuICB9XG5cbiAgLy8gUmV0dXJucyBbdW5kZWZpbmVkLCAtMV0gaWYgYSBiYWQgcGFyc2UuXG4gIC8vIEdpdmUgdXAgb24gbm9ybWFsIHBhcnNpbmcsIGp1c3QgdXNlIGEgc2h1bnRpbmcgeWFyZCBhZ2Fpbi4uLlxuICAvLyAgLSBidXQgaGFuZGxlIHBhcmVucyByZWN1cnNpdmVseS5cbiAgZXhwb3J0IGZ1bmN0aW9uIHBhcnNlKHRva2VuczogVG9rZW5bXSwgaW5kZXggPSAwKTogW0V4cHJ8dW5kZWZpbmVkLCBudW1iZXJdIHtcbi8vY29uc29sZS5sb2coJ1BBUlNFOiB0b2tlbnM9JywgdG9rZW5zLCAnaW5kZXg9JywgaW5kZXgpO1xuLy90cnkgeyB0aHJvdyBuZXcgRXJyb3IoKTsgfSBjYXRjaCAoZSkgeyBjb25zb2xlLmxvZyhlLnN0YWNrKTsgfVxuICAgIGNvbnN0IG9wczogW3N0cmluZywgT3BlcmF0b3JNZXRhXVtdID0gW107XG4gICAgY29uc3QgZXhwcnM6IEV4cHJbXSA9IFtdO1xuXG4gICAgZnVuY3Rpb24gcG9wT3AoKSB7XG4gICAgICBjb25zdCBbb3AsIFssLCBhcml0eV1dID0gb3BzLnBvcCgpITtcbi8vY29uc29sZS5sb2coJ3BvcCcsIG9wLCBhcml0eSk7XG4gICAgICBjb25zdCBhcmdzID0gZXhwcnMuc3BsaWNlKGV4cHJzLmxlbmd0aCAtIGFyaXR5LCBhcml0eSk7XG4gICAgICBpZiAoYXJncy5sZW5ndGggIT09IGFyaXR5KSB0aHJvdyBuZXcgRXJyb3IoJ3NodW50aW5nIHBhcnNlIGZhaWxlZD8nKTtcbiAgICAgIGV4cHJzLnB1c2goZml4U2l6ZSh7b3AsIGFyZ3N9KSk7XG4gICAgfVxuXG4gICAgbGV0IHZhbCA9IHRydWU7XG4gICAgbGV0IGkgPSBpbmRleDtcbiAgICBmb3IgKDsgaSA8IHRva2Vucy5sZW5ndGg7IGkrKykge1xuICAgICAgY29uc3QgZnJvbnQgPSB0b2tlbnNbaV07XG4vL2NvbnNvbGUubG9nKCdleHByczonLGV4cHJzLCdvcHM6JyxvcHMsJ3RvazonLGZyb250KTtcbiAgICAgIGlmICh2YWwpIHtcbiAgICAgICAgLy8gbG9va2luZyBmb3IgYSB2YWx1ZTogbGl0ZXJhbCwgYmFsYW5jZWQgcGFyZW5zLCBvciBwcmVmaXggb3AuXG4gICAgICAgIGlmIChmcm9udC50b2tlbiA9PT0gJ2NzJyB8fCBmcm9udC50b2tlbiA9PT0gJ29wJykge1xuICAgICAgICAgIGNvbnN0IG1hcHBlZCA9IE5BTUVfTUFQLmdldChmcm9udC5zdHIpO1xuICAgICAgICAgIGNvbnN0IHByZWZpeCA9IFBSRUZJWE9QUy5nZXQobWFwcGVkID8/IGZyb250LnN0cik7XG4gICAgICAgICAgaWYgKHByZWZpeCkge1xuICAgICAgICAgICAgb3BzLnB1c2goW2Zyb250LnN0ciwgcHJlZml4XSk7XG4gICAgICAgICAgfSBlbHNlIGlmIChmcm9udC50b2tlbiA9PT0gJ2NzJykge1xuICAgICAgICAgICAgY29uc3Qgb3AgPSBmcm9udC5zdHI7XG4gICAgICAgICAgICBpZiAoIUZVTkNUSU9OUy5oYXMob3ApKSB7XG4gICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihgTm8gc3VjaCBmdW5jdGlvbjogJHtUb2tlbi5uYW1lQXQoZnJvbnQpfWApO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgY29uc3QgbmV4dCA9IHRva2Vuc1tpICsgMV07XG4gICAgICAgICAgICBpZiAobmV4dD8udG9rZW4gIT09ICdscCcpIHtcbiAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKGBCYWQgZnVuY2FsbDogJHtUb2tlbi5uYW1lQXQobmV4dCA/PyBmcm9udCl9YCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBjb25zdCBjbG9zZSA9IFRva2VuLmZpbmRCYWxhbmNlZCh0b2tlbnMsIGkgKyAxKTtcbiAgICAgICAgICAgIGlmIChjbG9zZSA8IDApIHtcbiAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKGBOZXZlciBjbG9zZWQ6ICR7VG9rZW4ubmFtZUF0KG5leHQpfWApO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgY29uc3QgYXJnczogRXhwcltdID0gW107XG4gICAgICAgICAgICBmb3IgKGNvbnN0IGFyZyBvZiBUb2tlbi5wYXJzZUFyZ0xpc3QodG9rZW5zLCBpICsgMiwgY2xvc2UpKSB7XG4gICAgICAgICAgICAgIGFyZ3MucHVzaChwYXJzZU9ubHkoYXJnKSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpID0gY2xvc2U7XG4gICAgICAgICAgICBleHBycy5wdXNoKGZpeFNpemUoe29wLCBhcmdzfSkpO1xuICAgICAgICAgICAgdmFsID0gZmFsc2U7XG4gICAgICAgICAgfSBlbHNlIGlmIChUb2tlbi5lcShmcm9udCwgVG9rZW4uU1RBUikpIHtcbiAgICAgICAgICAgIGV4cHJzLnB1c2goe29wOiAnc3ltJywgc3ltOiAnKid9KTtcbiAgICAgICAgICAgIHZhbCA9IGZhbHNlO1xuICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYFVua25vd24gcHJlZml4IG9wZXJhdG9yOiAke1Rva2VuLm5hbWVBdChmcm9udCl9YCk7XG4gICAgICAgICAgfVxuICAgICAgICB9IGVsc2UgaWYgKGZyb250LnRva2VuID09PSAnbHAnKSB7XG4gICAgICAgICAgLy8gZmluZCBiYWxhbmNlZCBwYXJlbnNcbiAgICAgICAgICBjb25zdCBjbG9zZSA9IFRva2VuLmZpbmRCYWxhbmNlZCh0b2tlbnMsIGkpO1xuICAgICAgICAgIGlmIChjbG9zZSA8IDApIHtcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihgTm8gY2xvc2UgcGFyZW46ICR7VG9rZW4ubmFtZUF0KGZyb250KX1gKTtcbiAgICAgICAgICB9IC8vIHJldHVybiBbdW5kZWZpbmVkLCAtMV07XG4gICAgICAgICAgY29uc3QgZSA9IHBhcnNlT25seSh0b2tlbnMuc2xpY2UoaSArIDEsIGNsb3NlKSk7XG4gICAgICAgICAgZXhwcnMucHVzaChlKTtcbiAgICAgICAgICBpID0gY2xvc2U7XG4gICAgICAgICAgdmFsID0gZmFsc2U7XG4gICAgICAgIH0gZWxzZSBpZiAoZnJvbnQudG9rZW4gPT09ICdpZGVudCcpIHtcbiAgICAgICAgICAvLyBhZGQgc3ltYm9sXG4gICAgICAgICAgZXhwcnMucHVzaCh7b3A6ICdzeW0nLCBzeW06IGZyb250LnN0cn0pO1xuICAgICAgICAgIC8vIFRPRE8gLSB1c2Ugc2NvcGUgaW5mb3JtYXRpb24gdG8gZGV0ZXJtaW5lIHNpemU/XG4gICAgICAgICAgdmFsID0gZmFsc2U7XG4gICAgICAgIH0gZWxzZSBpZiAoZnJvbnQudG9rZW4gPT09ICdudW0nKSB7XG4gICAgICAgICAgLy8gYWRkIG51bWJlclxuICAgICAgICAgIGNvbnN0IG51bSA9IGZyb250Lm51bTtcbiAgICAgICAgICBleHBycy5wdXNoKHtvcDogJ251bScsIG51bSwgbWV0YTogc2l6ZShudW0pfSk7XG4gICAgICAgICAgdmFsID0gZmFsc2U7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgLy8gYmFkIHRva2VuPz9cbiAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYEJhZCBleHByZXNzaW9uIHRva2VuOiAke1Rva2VuLm5hbWVBdChmcm9udCl9YCk7XG4gICAgICAgICAgLy8gcmV0dXJuIFt1bmRlZmluZWQsIC0xXTtcbiAgICAgICAgfVxuICAgICAgfSBlbHNlIHtcbiAgICAgICAgLy8gbG9va2luZyBmb3IgYW4gaW5maXggb3BlcmF0b3Igb3IgRU9MLlxuICAgICAgICBpZiAoVG9rZW4uZXEoZnJvbnQsIFRva2VuLkNPTU1BKSAvKiB8fCBUb2tlbi5lcShmcm9udCwgVG9rZW4uUlApICovKSB7XG4gICAgICAgICAgLy8gVE9ETyAtIGlzIHJwYXJlbiBva2F5PyB1c3VhbGx5IHNob3VsZCBoYXZlIGV4dHJhY3RlZCB0aGUgYmFsYW5jZWRcbiAgICAgICAgICAvLyBwYXJlbiBvdXQgZmlyc3Q/XG4gICAgICAgICAgYnJlYWs7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGZyb250LnRva2VuID09PSAnY3MnIHx8IGZyb250LnRva2VuID09PSAnb3AnKSB7XG4gICAgICAgICAgY29uc3QgbWFwcGVkID0gTkFNRV9NQVAuZ2V0KGZyb250LnN0cik7XG4gICAgICAgICAgY29uc3Qgb3AgPSBCSU5PUFMuZ2V0KG1hcHBlZCA/PyBmcm9udC5zdHIpO1xuICAgICAgICAgIGlmICghb3ApIGJyZWFrOyAvLyB3ZSdyZSBhdCB0aGUgZW5kLi4uPyAgb3IgaWYgbm8gb3AuXG4gICAgICAgICAgLy8gc2VlIGlmIGFueXRoaW5nIHRvIHRoZSBsZWZ0IGlzIGZhc3Rlci5cbiAgICAgICAgICB3aGlsZSAob3BzLmxlbmd0aCkge1xuICAgICAgICAgICAgY29uc3QgdG9wID0gb3BzW29wcy5sZW5ndGggLSAxXTtcbiAgICAgICAgICAgIGNvbnN0IGNtcCA9IGNvbXBhcmVPcCh0b3BbMV0sIG9wKTtcbiAgICAgICAgICAgIGlmIChjbXAgPCAwKSBicmVhaztcbiAgICAgICAgICAgIGlmIChjbXAgPT09IDApIHtcbiAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFxuICAgICAgICAgICAgICAgICAgYE1peGluZyAke3RvcFswXX0gYW5kICR7ZnJvbnQuc3RyfSBuZWVkcyBleHBsaWNpdCBwYXJlbnMuJHtcbiAgICAgICAgICAgICAgICAgICBUb2tlbi5hdChmcm9udCl9YCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBwb3BPcCgpO1xuICAgICAgICAgIH1cbiAgICAgICAgICBvcHMucHVzaChbZnJvbnQuc3RyLCBvcF0pO1xuICAgICAgICAgIHZhbCA9IHRydWU7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgLy90aHJvdyBuZXcgRXJyb3IoYEdhcmJhZ2UgYWZ0ZXIgZXhwcmVzc2lvbjogJHtUb2tlbi5uYW1lQXQoZnJvbnQpfWApO1xuLy9jb25zb2xlLmxvZygnYmFkIHZhbHVlJywgaSwgZnJvbnQpO1xuICAgICAgICAgIGJyZWFrO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuLy9jb25zb2xlLmxvZygnZXhwcnM6JyxleHBycywnb3BzOicsb3BzKTtcbiAgICAvLyBOb3cgcG9wIGFsbCB0aGUgb3BzXG4gICAgd2hpbGUgKG9wcy5sZW5ndGgpIHBvcE9wKCk7XG4vL2NvbnNvbGUubG9nKCdwb3N0LXBvcDonLCBleHBycyk7XG4gICAgaWYgKGV4cHJzLmxlbmd0aCAhPT0gMSkgdGhyb3cgbmV3IEVycm9yKGBzaHVudGluZyBwYXJzZSBmYWlsZWQ/YCk7XG4gICAgaWYgKHRva2Vuc1tpbmRleF0uc291cmNlKSBleHByc1swXS5zb3VyY2UgPSB0b2tlbnNbaW5kZXhdLnNvdXJjZTtcbiAgICByZXR1cm4gW2V4cHJzWzBdLCBpXTtcbiAgfVxuXG5cbiAgLy8gd29ya3Mgb24gYWJzb2x1dGUgbnVtYmVycywgb3IgcmVsYXRpdmUgbnVtYmVycyBpZiBhbGwgaW4gc2FtZSBjaHVuay5cbiAgLy8gbWF5IG5vdCBtaXggcmVsYXRpdmUgKyBhYnNvbHV0ZS5cbiAgZnVuY3Rpb24gc2FtZUNodW5rKGV4cHI6IEV4cHIsIGY6ICguLi5udW1zOiBudW1iZXJbXSkgPT4gbnVtYmVyKTogRXhwciB7XG4gICAgdGhyb3cgbmV3IEVycm9yKCk7XG4gIH1cblxuICBmdW5jdGlvbiBudW0obnVtOiBudW1iZXJ8dW5kZWZpbmVkKTogRXhwcnx1bmRlZmluZWQge1xuICAgIGlmIChudW0gPT0gbnVsbCkgcmV0dXJuIHVuZGVmaW5lZDtcbiAgICByZXR1cm4ge29wOiAnbnVtJywgbnVtLCBtZXRhOiBzaXplKG51bSl9O1xuICB9XG5cbiAgZnVuY3Rpb24gdW5hcnkoZXhwcjogRXhwciwgZjogKHg6IG51bWJlcikgPT4gbnVtYmVyKTogRXhwciB7XG4gICAgLy8gcmVxdWlyZSBhYnNvbHV0ZVxuICAgIGNvbnN0IGFyZyA9IGV4cHIuYXJncyFbMF07XG4gICAgaWYgKCFpc0FicyhhcmcpKSByZXR1cm4gZXhwcjtcbiAgICBjb25zdCBudW0gPSBmKGFyZy5udW0hKTtcbiAgICByZXR1cm4ge29wOiAnbnVtJywgbnVtLCBtZXRhOiBzaXplKG51bSl9O1xuICB9XG5cbiAgZnVuY3Rpb24gYmluYXJ5KGV4cHI6IEV4cHIsIGY6ICh4OiBudW1iZXIsIHk6IG51bWJlcikgPT4gbnVtYmVyKTogRXhwciB7XG4gICAgLy8gcmVxdWlyZSBib3RoIHRvIGJlIGFic29sdXRlXG4gICAgY29uc3QgW2EsIGJdID0gZXhwci5hcmdzITtcbiAgICBpZiAoIWlzQWJzKGEpIHx8ICFpc0FicyhiKSkgcmV0dXJuIGV4cHI7XG4gICAgY29uc3QgbnVtID0gZihhLm51bSEsIGIubnVtISk7XG4gICAgcmV0dXJuIHtvcDogJ251bScsIG51bSwgbWV0YTogc2l6ZShudW0pfTtcbiAgfVxuXG4gIGZ1bmN0aW9uIHBsdXMoZXhwcjogRXhwcik6IEV4cHIge1xuICAgIC8vIGFsbG93IHNvbWUgcmVsYXRpdmUsIGJ1dCBvbmx5IGlmIGFkZGluZyBhIG5vbi1hZGRyZXNzP1xuICAgIGNvbnN0IFthLCBiXSA9IGV4cHIuYXJncyE7XG4gICAgaWYgKGEub3AgIT09ICdudW0nIHx8IGIub3AgIT09ICdudW0nKSByZXR1cm4gZXhwcjtcbiAgICBjb25zdCBvdXQ6IEV4cHIgPSB7b3A6ICdudW0nLCBudW06IGEubnVtISArIGIubnVtIX07XG4gICAgaWYgKGEubWV0YSB8fCBiLm1ldGEpIHtcbiAgICAgIGlmIChhLm1ldGE/LnJlbCAmJiBiLm1ldGE/LnJlbCkgcmV0dXJuIGV4cHI7IC8vIGJhc2ljYWxseSBub25zZW5zZVxuICAgICAgaWYgKGEubWV0YT8ucmVsKSB7XG4gICAgICAgIG91dC5tZXRhID0gYS5tZXRhO1xuICAgICAgfSBlbHNlIGlmIChiLm1ldGE/LnJlbCkge1xuICAgICAgICBvdXQubWV0YSA9IGIubWV0YTtcbiAgICAgIH1cbiAgICB9XG4gICAgaWYgKCFvdXQubWV0YT8ucmVsICYmIG91dC5tZXRhPy5zaXplID09IG51bGwpIHtcbiAgICAgIChvdXQubWV0YSB8fCAob3V0Lm1ldGEgPSB7fSkpLnNpemUgPSBzaXplKG91dC5udW0hKS5zaXplO1xuICAgIH1cbiAgICByZXR1cm4gb3V0O1xuICB9XG5cbiAgZnVuY3Rpb24gbWludXMoZXhwcjogRXhwcik6IEV4cHIge1xuICAgIC8vIGFsbG93IHJlbCAtIHJlbCBmb3IgZGVsdGFcbiAgICBjb25zdCBbYSwgYl0gPSBleHByLmFyZ3MhO1xuICAgIGlmIChhLm9wICE9PSAnbnVtJyB8fCBiLm9wICE9PSAnbnVtJykgcmV0dXJuIGV4cHI7XG4gICAgY29uc3Qgb3V0OiBFeHByID0ge29wOiAnbnVtJywgbnVtOiBhLm51bSEgLSBiLm51bSF9O1xuICAgIGlmIChiLm1ldGE/LnJlbCkge1xuICAgICAgcmV0dXJuIGEubWV0YT8ucmVsICYmIGEubWV0YS5jaHVuayA9PT0gYi5tZXRhLmNodW5rID8gb3V0IDogZXhwcjtcbiAgICB9XG4gICAgaWYgKGEubWV0YT8ucmVsKSBvdXQubWV0YSA9IGEubWV0YTtcbiAgICBpZiAoIW91dC5tZXRhPy5yZWwgJiYgb3V0Lm1ldGE/LnNpemUgPT0gbnVsbCkge1xuICAgICAgKG91dC5tZXRhIHx8IChvdXQubWV0YSA9IHt9KSkuc2l6ZSA9IHNpemUob3V0Lm51bSEpLnNpemU7XG4gICAgfVxuICAgIHJldHVybiBvdXQ7XG4gIH1cblxuICBmdW5jdGlvbiBpc0FicyhleHByOiBFeHByKTogYm9vbGVhbiB7XG4gICAgcmV0dXJuIGV4cHIub3AgPT09ICdudW0nICYmICFleHByLm1ldGE/LnJlbDtcbiAgfVxufVxuXG5cblxuLy8gUmV0dXJucyA+MCBpZiB0b3AgaXMgZmFzdGVyLCA8MCBpZiB0b3AgaXMgc2xvd2VyLCBhbmQgMCBpZiBjYW4ndCBtaXhcbmZ1bmN0aW9uIGNvbXBhcmVPcCh0b3A6IE9wZXJhdG9yTWV0YSwgbmV4dDogT3BlcmF0b3JNZXRhKTogbnVtYmVyIHtcbiAgaWYgKHRvcFswXSA+IG5leHRbMF0pIHJldHVybiAxO1xuICBpZiAodG9wWzBdIDwgbmV4dFswXSkgcmV0dXJuIC0xO1xuICBpZiAodG9wWzFdICE9PSBuZXh0WzFdKSByZXR1cm4gMDtcbiAgcmV0dXJuIHRvcFsxXTtcbn1cblxuXG4vLyBwcmVjZWRlbmNlLCBhc3NvY2lhdGl2aXR5LCBhcml0eVxudHlwZSBPcGVyYXRvck1ldGEgPSByZWFkb25seSBbbnVtYmVyLCBudW1iZXIsIG51bWJlcl07XG5jb25zdCBCSU5BUlkgPSAyO1xuY29uc3QgVU5BUlkgPSAxO1xuZXhwb3J0IGNvbnN0IEJJTk9QUyA9IG5ldyBNYXA8c3RyaW5nLCBPcGVyYXRvck1ldGE+KFtcbiAgLy8gU2NvcGluZyBvcGVyYXRvclxuICAvLyBbJzo6JywgWzgsIDEsIEJJTkFSWV1dLFxuICAvLyBNZW1vcnkgaGludHNcbiAgLy9bJzonLCBbNiwgMF1dLFxuICAvLyBNdWx0aXBsaWNhdGl2ZSBvcGVyYXRvcnM6IG5vdGUgdGhhdCBiaXR3aXNlIGFuZCBhcml0aG1ldGljIGNhbm5vdCBhc3NvY2lhdGVcbiAgWycqJywgWzUsIDQsIEJJTkFSWV1dLFxuICBbJy8nLCBbNSwgNCwgQklOQVJZXV0sXG4gIFsnLm1vZCcsIFs1LCAzLCBCSU5BUlldXSxcbiAgWycmJywgWzUsIDIsIEJJTkFSWV1dLFxuICBbJ14nLCBbNSwgMSwgQklOQVJZXV0sXG4gIFsnPDwnLCBbNSwgMCwgQklOQVJZXV0sXG4gIFsnPj4nLCBbNSwgMCwgQklOQVJZXV0sXG4gIC8vIEFyaXRobWV0aWMgb3BlcmF0b3JzOiBub3RlIHRoYXQgYml0d2lzZSBhbmQgYXJpdGhtZXRpYyBjYW5ub3QgYXNzb2NpYXRlXG4gIFsnKycsIFs0LCAyLCBCSU5BUlldXSxcbiAgWyctJywgWzQsIDIsIEJJTkFSWV1dLFxuICBbJ3wnLCBbNCwgMSwgQklOQVJZXV0sXG4gIC8vIENvbXBhcmlzb24gb3BlcmF0b3JzXG4gIFsnPCcsIFszLCAwLCBCSU5BUlldXSxcbiAgWyc8PScsIFszLCAwLCBCSU5BUlldXSxcbiAgWyc+JywgWzMsIDAsIEJJTkFSWV1dLFxuICBbJz49JywgWzMsIDAsIEJJTkFSWV1dLFxuICBbJz0nLCBbMywgMCwgQklOQVJZXV0sXG4gIFsnPD4nLCBbMywgMCwgQklOQVJZXV0sXG4gIC8vIExvZ2ljYWwgb3BlcmF0b3JzOiBkaWZmZXJlbnQga2luZHMgY2Fubm90IGFzc29jaWF0ZVxuICBbJyYmJywgWzIsIDMsIEJJTkFSWV1dLFxuICBbJy54b3InLCBbMiwgMiwgQklOQVJZXV0sXG4gIFsnfHwnLCBbMiwgMSwgQklOQVJZXV0sXG4gIC8vIENvbW1hXG4gIC8vWycsJywgWzEsIDFdXSxcbl0pO1xuXG5jb25zdCBQUkVGSVhPUFMgPSBuZXcgTWFwPHN0cmluZywgT3BlcmF0b3JNZXRhPihbXG4gIC8vIFsnOjonLCBbOSwgLTEsIFVOQVJZXV0sIC8vIGdsb2JhbCBzY29wZVxuICBbJysnLCBbOSwgLTEsIFVOQVJZXV0sXG4gIFsnLScsIFs5LCAtMSwgVU5BUlldXSxcbiAgWyd+JywgWzksIC0xLCBVTkFSWV1dLFxuICBbJzwnLCBbOSwgLTEsIFVOQVJZXV0sXG4gIFsnPicsIFs5LCAtMSwgVU5BUlldXSxcbiAgWydeJywgWzksIC0xLCBVTkFSWV1dLFxuICBbJyEnLCBbMiwgLTEsIFVOQVJZXV0sXG5dKTtcblxuLy8gVE9ETyAtIHNraXAxIGFuZCBza2lwMiBtYWNyb3Ncbi8vIC5tYWNybyBza2lwMVxuLy8gICAuYnl0ZSAkMmNcbi8vIC5lbmRtYWNyb1xuLy8gLm1hY3JvIHNraXAyXG4vLyAgIC5ieXRlICQ0Y1xuLy8gICAuYXNzZXJ0IC5ieXRlYXQoKiArIDIpIDwgJDIwIC5vciBcXFxuLy8gICAgICAgICAgIC5ieXRlYXQoKiArIDIpID49ICQ2MCAub3IgXFxcbi8vICAgICAgICAgICAuYnl0ZWF0KCogKyAxKSAmICQwNyAuaW4gWzIsMyw0XVxuLy8gLmVuZG1hY3JvXG4vLyBOT1RFOiBkYW5nZXJvdXMgcmVhZHMgYXJlIDIwMDIsIDIwMDQsIDIwMDcgKHBsdXMgbWlycm9ycyksIDQwMTVcbi8vIFRoZW4gdGhlIGFzc2VtYmxlciBuZWVkcyB0byB1bmRlcnN0YW5kIHRoZSBmbG93IG9mIHRoZXNlIHR3byBvcHMuLi5cbi8vIG9yIGp1c3QgZGlzYXNzZW1ibGUgaXQgb24gdGhlIGZseT9cbmNvbnN0IEZVTkNUSU9OUyA9IG5ldyBTZXQ8c3RyaW5nPihbXG4gICcuYnl0ZWF0JyxcbiAgJy53b3JkYXQnLFxuICAnLm1heCcsICcubWluJyxcbl0pO1xuXG5jb25zdCBOQU1FX01BUCA9IG5ldyBNYXA8c3RyaW5nLCBzdHJpbmc+KFtcbiAgWycuYml0YW5kJywgJyYnXSxcbiAgWycuYml0eG9yJywgJ14nXSxcbiAgWycuYml0b3InLCAnfCddLFxuICBbJy5zaGwnLCAnPDwnXSxcbiAgWycuc2hyJywgJz4+J10sXG4gIFsnLmFuZCcsICcmJiddLFxuICBbJy5vcicsICd8fCddLFxuICBbJy5iaXRub3QnLCAnfiddLFxuICBbJy5sb2J5dGUnLCAnPCddLFxuICBbJy5oaWJ5dGUnLCAnPiddLFxuICBbJy5iYW5rYnl0ZScsICdeJ10sIC8vID8/PyBob3cgdG8gaW1wbGVtZW50IG9uIG51bWJlcj9cbiAgWycubm90JywgJyEnXSxcbl0pO1xuXG5jb25zdCBTSVpFX1RSQU5TRk9STVMgPSBuZXcgTWFwPHN0cmluZywgKC4uLmFyZ3M6IG51bWJlcltdKSA9PiBudW1iZXI+KFtcbiAgLy8gdW5hcnk6IGJhbmsgYnl0ZTsgYmluYXJ5OiBiaXR4b3JcbiAgWydeJywgKC4uLmFyZ3MpID0+IGFyZ3MubGVuZ3RoID09PSAxID8gMSA6IE1hdGgubWF4KC4uLmFyZ3MpXSxcbiAgWyc8JywgKCkgPT4gMV0sIC8vIHVuYXJ5IChsb2J5dGUpIGFuZCBiaW5hcnkgKGNtcCkgYm90aCBzaW5nbGUtYnl0ZVxuICBbJz4nLCAoKSA9PiAxXSwgLy8gdW5hcnkgKGhpYnl0ZSkgYW5kIGJpbmFyeSAoY21wKSBib3RoIHNpbmdsZS1ieXRlXG4gIFsnIScsICgpID0+IDFdLCAvLyBub3QgYWx3YXlzIDAgb3IgMVxuICBbJzw9JywgKCkgPT4gMV0sIC8vIGNtcFxuICBbJz49JywgKCkgPT4gMV0sIC8vIGNtcFxuICBbJzw+JywgKCkgPT4gMV0sIC8vIGNtcFxuICBbJz0nLCAoKSA9PiAxXSwgLy8gY21wXG4gIC8vIGJpdHdpc2UgYW5kIGxvZ2ljYWwgb3BlcmF0b3IgcmV0dXJuIG1heFxuICBbJyYnLCBNYXRoLm1heF0sXG4gIFsnJiYnLCBNYXRoLm1heF0sXG4gIFsnfCcsIE1hdGgubWF4XSxcbiAgWyd8fCcsIE1hdGgubWF4XSxcbiAgWycueG9yJywgTWF0aC5tYXhdLFxuICBbJy5tYXgnLCBNYXRoLm1heF0sXG4gIFsnLm1pbicsIE1hdGgubWF4XSwgLy8gY291bGQgdXNlIG1pbiwgYnV0IG1heSBub3QgYmUgc2FmZSB3LyBuZWdhdGl2ZXNcbl0pO1xuICBcbmZ1bmN0aW9uIGZpeFNpemUoZXhwcjogRXhwcik6IEV4cHIge1xuICBjb25zdCB4Zm9ybSA9IFNJWkVfVFJBTlNGT1JNUy5nZXQoZXhwci5vcCk7XG4gIGNvbnN0IHNpemUgPSB4Zm9ybT8uKC4uLmV4cHIuYXJncyEubWFwKGUgPT4gTnVtYmVyKGUubWV0YT8uc2l6ZSkpKTtcbiAgaWYgKHNpemUpIChleHByLm1ldGEgfHwgKGV4cHIubWV0YSA9IHt9KSkuc2l6ZSA9IHNpemU7XG4gIHJldHVybiBleHByO1xufVxuXG5mdW5jdGlvbiBzaXplKG51bTogbnVtYmVyKTogRXhwci5NZXRhIHtcbiAgcmV0dXJuIHtzaXplOiAwIDw9IG51bSAmJiBudW0gPCAyNTYgPyAxIDogMn07XG59XG5cbi8vIGZ1bmN0aW9uIGZhaWwobXNnOiBzdHJpbmcpOiBuZXZlciB7XG4vLyAgIHRocm93IG5ldyBFcnJvcihtc2cpO1xuLy8gfVxuIl19