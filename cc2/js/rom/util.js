export function upperCamelToSpaces(upperCamel) {
    return upperCamel.replace(/([a-z])([A-Z0-9])/g, '$1 $2')
        .replace(/Of/g, 'of')
        .replace(/_/g, ' - ');
}
export function lowerCamelToSpaces(lowerCamel) {
    return upperCamelToSpaces(lowerCamel).replace(/^./, (x) => x.toUpperCase());
}
export function seq(x, f = (i) => i) {
    return new Array(x).fill(0).map((_, i) => f(i));
}
export function slice(arr, start, len) {
    return arr.slice(start, start + len);
}
export function tuple(arr, start, len) {
    return Array.from(arr.slice(start, start + len));
}
export function signed(x) {
    return x < 0x80 ? x : x - 0x100;
}
export function unsigned(x) {
    return x < 0 ? x + 0x100 : x;
}
export function varSlice(arr, start, width, sentinel, end = Infinity, func) {
    if (!func)
        func = (x) => x;
    const out = [];
    while (start + width <= end && arr[start] !== sentinel) {
        out.push(func(arr.slice(start, start + width)));
        start += width;
    }
    return out;
}
export function addr(arr, i, offset = 0) {
    return (arr[i] | arr[i + 1] << 8) + offset;
}
export function group(width, arr, func) {
    if (!func)
        func = (x) => x;
    return seq(Math.max(0, Math.floor(arr.length / width)), i => func(slice(arr, i * width, width)));
}
export function reverseBits(x) {
    return ((x * 0x0802 & 0x22110) | (x * 0x8020 & 0x88440)) * 0x10101 >>> 16 & 0xff;
}
export function countBits(x) {
    x -= x >> 1 & 0x55;
    x = (x & 0x33) + (x >> 2 & 0x33);
    return (x + (x >> 4)) & 0xf;
}
export function hex(id) {
    return id != null ? id.toString(16).padStart(2, '0') : String(id);
}
export function hex3(id) {
    return id.toString(16).padStart(3, '0');
}
export function hex4(id) {
    return id.toString(16).padStart(4, '0');
}
export function hex5(id) {
    return id.toString(16).padStart(5, '0');
}
export function concatIterables(iters) {
    const out = [];
    for (const iter of iters) {
        for (const elem of iter) {
            out.push(elem);
        }
    }
    return out;
}
export function readBigEndian(data, offset) {
    return data[offset] << 8 | data[offset + 1];
}
export function readLittleEndian(data, offset) {
    return data[offset + 1] << 8 | data[offset];
}
export function readString(arr, address, end = 0) {
    const bytes = [];
    while (arr[address] != end) {
        bytes.push(arr[address++]);
    }
    return String.fromCharCode(...bytes);
}
export function readLengthDelimitedString(arr, address) {
    const length = arr[address];
    return String.fromCharCode(...arr.slice(address + 1, address + 1 + length));
}
export function writeLittleEndian(data, offset, value) {
    data[offset] = value & 0xff;
    data[offset + 1] = value >>> 8;
}
export function writeString(arr, address, str) {
    for (let i = 0, len = str.length; i < len; i++) {
        arr[address + i] = str.charCodeAt(i);
    }
}
export function write(data, offset, values) {
    data.subarray(offset, offset + values.length).set(values);
}
export class FlagListType {
    constructor(last, clear, nonEmpty = false) {
        this.last = last;
        this.clear = clear;
        this.nonEmpty = nonEmpty;
    }
    read(data, offset = 0) {
        const flags = [];
        while (true) {
            const hi = data[offset++];
            const lo = data[offset++];
            const flag = (hi & 3) << 8 | lo;
            const signed = hi & this.clear ? ~flag : flag;
            if (signed !== ~0)
                flags.push(signed);
            if (hi & this.last)
                return flags;
        }
    }
    bytes(flags) {
        flags = flags.filter(f => f !== ~0);
        if (this.nonEmpty && !flags.length)
            flags = [~0];
        const bytes = [];
        for (let i = 0; i < flags.length; i++) {
            let flag = flags[i];
            if (flag < 0)
                flag = (this.clear << 8) | ~flag;
            if (i === flags.length - 1)
                flag |= (this.last << 8);
            bytes.push(flag >>> 8);
            bytes.push(flag & 0xff);
        }
        return bytes;
    }
    write(data, flags, offset = 0) {
        const bytes = this.bytes(flags);
        for (let i = 0; i < bytes.length; i++) {
            data[i + offset] = bytes[i];
        }
    }
}
export const DIALOG_FLAGS = new FlagListType(0x40, 0x80);
export const ITEM_GET_FLAGS = new FlagListType(0x40, 0x80, true);
export const ITEM_USE_FLAGS = new FlagListType(0x40, 0x80, true);
export const ITEM_CONDITION_FLAGS = new FlagListType(0x80, 0x20, true);
export const SPAWN_CONDITION_FLAGS = new FlagListType(0x80, 0x20);
export function initializer() {
    const tag = Symbol();
    function f(...args) {
        return { tag, args };
    }
    f.commit = (instance, builder) => {
        for (const prop of Object.getOwnPropertyNames(instance)) {
            const value = instance[prop];
            if (value.tag !== tag)
                continue;
            instance[prop] = builder(prop, ...value.args);
        }
    };
    return f;
}
const PROP_TAG = Symbol('PROP_TAG');
const dataTupleMap = new WeakMap();
function dataTupleActualClass(arg) {
    let result = dataTupleMap.get(arg);
    if (!result) {
        result = class extends DataTuple {
        };
        Object.defineProperties(result, { name: { value: arg.name } });
        Object.assign(result, arg);
        Reflect.setPrototypeOf(result.prototype, arg.prototype);
        const proto = new arg();
        const descriptors = {};
        for (const [prop, descr] of Object.entries(proto)) {
            if (descr && descr[PROP_TAG]) {
                descriptors[prop] = descr;
            }
        }
        Object.defineProperties(result.prototype, descriptors);
        dataTupleMap.set(arg, result);
        dataTupleMap.set(result, result);
    }
    return result;
}
export class DataTuple {
    constructor(arg) {
        this.data = arg;
    }
    static of(inits) {
        return Object.assign(new (dataTupleActualClass(this))(new Array(this.size).fill(0)), inits);
    }
    static from(data, offset = 0) {
        const cls = dataTupleActualClass(this);
        const arg = !offset && data.length === this.size ?
            data : tuple(data, offset, this.size);
        return new cls(arg);
    }
    [Symbol.iterator]() {
        return this.data[Symbol.iterator]();
    }
    hex() {
        return Array.from(this.data, hex).join(' ');
    }
    clone() {
        return new this.constructor(this.data);
    }
    prop(...bits) {
        return {
            get() {
                let value = 0;
                for (const [index, mask = 0xff, shift = 0] of bits) {
                    const lsh = shift < 0 ? -shift : 0;
                    const rsh = shift < 0 ? 0 : shift;
                    value |= ((this.data[index] & mask) >>> rsh) << lsh;
                }
                return value;
            },
            set(value) {
                for (const [index, mask = 0xff, shift = 0] of bits) {
                    const lsh = shift < 0 ? -shift : 0;
                    const rsh = shift < 0 ? 0 : shift;
                    const v = (value >>> lsh) << rsh & mask;
                    this.data[index] = this.data[index] & ~mask | v;
                }
            },
            [PROP_TAG]: true,
        };
    }
    booleanProp(byte, bit) {
        return {
            get() {
                return Boolean(this.data[byte] & (1 << bit));
            },
            set(value) {
                const mask = 1 << bit;
                if (value) {
                    this.data[byte] |= mask;
                }
                else {
                    this.data[byte] &= ~mask;
                }
            },
            [PROP_TAG]: true,
        };
    }
}
export const watchArray = (arr, watch) => {
    const arrayChangeHandler = {
        get(target, property) {
            let v = target[property];
            if (property === 'subarray') {
                return (start, end) => {
                    const sub = target.subarray(start, end);
                    if (start <= watch && watch < end)
                        return watchArray(sub, watch - start);
                    return sub;
                };
            }
            else if (property === 'set') {
                return (val) => {
                    console.log(`Setting overlapping array ${watch}`);
                    debugger;
                    target.set(val);
                };
            }
            if (typeof v === 'function')
                v = v.bind(target);
            return v;
        },
        set(target, property, value, receiver) {
            if (property == watch) {
                console.log(`Writing ${watch.toString(16)}`);
                debugger;
            }
            target[property] = value;
            return true;
        },
    };
    return new Proxy(arr, arrayChangeHandler);
};
export class Segment {
    constructor(name, bank, org) {
        this.name = name;
        this.bank = bank;
        this.org = org;
    }
    get offset() {
        return (this.bank & 0x1f) << 13;
    }
}
Segment.$04 = new Segment('04', 0x04, 0x8000);
Segment.$05 = new Segment('05', 0x05, 0xa000);
Segment.$0a = new Segment('0a', 0x0a, 0x8000);
Segment.$0b = new Segment('0b', 0x0b, 0xa000);
Segment.$0c = new Segment('0c', 0x0c, 0x8000);
Segment.$0d = new Segment('0d', 0x0d, 0xa000);
Segment.$0e = new Segment('0e', 0x0e, 0x8000);
Segment.$0f = new Segment('0f', 0x0f, 0xa000);
Segment.$10 = new Segment('10', 0x10, 0x8000);
Segment.$14 = new Segment('14', 0x14, 0x8000);
Segment.$15 = new Segment('15', 0x15, 0xa000);
Segment.$16_a = new Segment('16:a', 0x16, 0xa000);
Segment.$17 = new Segment('17', 0x17, 0xa000);
Segment.$18 = new Segment('18', 0x18, 0x8000);
Segment.$19 = new Segment('19', 0x19, 0xa000);
Segment.$1a = new Segment('1a', 0x1a, 0x8000);
Segment.$1b = new Segment('1b', 0x1b, 0xa000);
Segment.$fe = new Segment('fe', 0x1e, 0xc000);
Segment.$ff = new Segment('ff', 0x1f, 0xe000);
export class Address {
    constructor(seg, delta) {
        this.seg = seg;
        this.delta = delta;
    }
    static of(segment, org) {
        return new Address(segment, org - segment.org);
    }
    get offset() {
        return this.seg.offset + this.delta;
    }
    get org() {
        return this.seg.org + this.delta;
    }
    get segment() {
        return this.seg.name;
    }
    plus(offset, nextSegment) {
        const newDelta = this.delta + offset;
        if (newDelta >= 0x2000) {
            if (!nextSegment)
                throw new Error(`Segment changed`);
            if (this.seg.org & 0x2000)
                throw new Error(`Bad segment cross`);
            return new Address(nextSegment, newDelta & 0x1fff);
        }
        return new Address(this.seg, newDelta);
    }
    minus(addr) {
        if (addr.seg !== this.seg)
            throw new Error(`Incompatible segments`);
        return this.delta - addr.delta;
    }
    read(data) {
        return data[this.offset];
    }
    readLittleEndian(data) {
        const off = this.offset;
        return data[off] | data[off + 1] << 8;
    }
    readAddress(data, ...segments) {
        const org = this.readLittleEndian(data);
        if (!segments.length)
            segments = [this.seg];
        for (const s of segments) {
            if ((org & 0xe000) === (s.org & 0xe000))
                return Address.of(s, org);
        }
        throw new Error(`Could not find valid segment for ${hex(org)}`);
    }
    loc(assembler, name) {
        assembler.segment(this.segment);
        assembler.org(this.org, name);
    }
}
export function free(a, seg, start, end) {
    a.segment(seg.name);
    a.org(start);
    a.free(end - start);
}
export function relocExportLabel(a, seg, name) {
    a.segment(...seg.map(s => s.name));
    a.reloc(name);
    a.label(name);
    a.export(name);
}
export function cloneArray(arr) {
    return [...arr];
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidXRpbC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3NyYy9qcy9yb20vdXRpbC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFFQSxNQUFNLFVBQVUsa0JBQWtCLENBQUMsVUFBa0I7SUFDbkQsT0FBTyxVQUFVLENBQUMsT0FBTyxDQUFDLG9CQUFvQixFQUFFLE9BQU8sQ0FBQztTQUNuRCxPQUFPLENBQUMsS0FBSyxFQUFFLElBQUksQ0FBQztTQUNwQixPQUFPLENBQUMsSUFBSSxFQUFFLEtBQUssQ0FBQyxDQUFDO0FBQzVCLENBQUM7QUFFRCxNQUFNLFVBQVUsa0JBQWtCLENBQUMsVUFBa0I7SUFDbkQsT0FBTyxrQkFBa0IsQ0FBQyxVQUFVLENBQUMsQ0FBQyxPQUFPLENBQUMsSUFBSSxFQUFFLENBQUMsQ0FBQyxFQUFFLEVBQUUsQ0FBQyxDQUFDLENBQUMsV0FBVyxFQUFFLENBQUMsQ0FBQztBQUM5RSxDQUFDO0FBT0QsTUFBTSxVQUFVLEdBQUcsQ0FBQyxDQUFTLEVBQUUsSUFBMkIsQ0FBQyxDQUFDLEVBQUUsRUFBRSxDQUFDLENBQUM7SUFDaEUsT0FBTyxJQUFJLEtBQUssQ0FBQyxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUMsRUFBRSxFQUFFLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUM7QUFDbEQsQ0FBQztBQVNELE1BQU0sVUFBVSxLQUFLLENBQXNCLEdBQU0sRUFBRSxLQUFhLEVBQUUsR0FBVztJQUMzRSxPQUFPLEdBQUcsQ0FBQyxLQUFLLENBQUMsS0FBSyxFQUFFLEtBQUssR0FBRyxHQUFHLENBQUMsQ0FBQztBQUN2QyxDQUFDO0FBTUQsTUFBTSxVQUFVLEtBQUssQ0FBSSxHQUFZLEVBQUUsS0FBYSxFQUFFLEdBQVc7SUFDL0QsT0FBTyxLQUFLLENBQUMsSUFBSSxDQUFDLEdBQUcsQ0FBQyxLQUFLLENBQUMsS0FBSyxF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LElBQUksRUFBRSxJQUFJLEVBQUUsTUFBTSxDQUFDLENBQUM7QUFDdEMsV0FBRyxHQUFHLElBQUksT0FBTyxDQUFDLElBQUksRUFBRSxJQUFJLEVBQUUsTUFBTSxDQUFDLENBQUM7QUFFdEMsV0FBRyxHQUFHLElBQUksT0FBTyxDQUFDLElBQUksRUFBRSxJQUFJLEVBQUUsTUFBTSxDQUFDLENBQUM7QUFDdEMsV0FBRyxHQUFHLElBQUksT0FBTyxDQUFDLElBQUksRUFBRSxJQUFJLEVBQUUsTUFBTSxDQUFDLENBQUM7QUFDdEMsV0FBRyxHQUFHLElBQUksT0FBTyxDQUFDLElBQUksRUFBRSxJQUFJLEVBQUUsTUFBTSxDQUFDLENBQUM7QUFDdEMsV0FBRyxHQUFHLElBQUksT0FBTyxDQUFDLElBQUksRUFBRSxJQUFJLEVBQUUsTUFBTSxDQUFDLENBQUM7QUFDdEMsV0FBRyxHQUFHLElBQUksT0FBTyxDQUFDLElBQUksRUFBRSxJQUFJLEVBQUUsTUFBTSxDQUFDLENBQUM7QUFDdEMsV0FBRyxHQUFHLElBQUksT0FBTyxDQUFDLElBQUksRUFBRSxJQUFJLEVBQUUsTUFBTSxDQUFDLENBQUM7QUFDdEMsV0FBRyxHQUFHLElBQUksT0FBTyxDQUFDLElBQUksRUFBRSxJQUFJLEVBQUUsTUFBTSxDQUFDLENBQUM7QUFFdEMsV0FBRyxHQUFHLElBQUksT0FBTyxDQUFDLElBQUksRUFBRSxJQUFJLEVBQUUsTUFBTSxDQUFDLENBQUM7QUFDdEMsV0FBRyxHQUFHLElBQUksT0FBTyxDQUFDLElBQUksRUFBRSxJQUFJLEVBQUUsTUFBTSxDQUFDLENBQUM7QUFDdEMsYUFBSyxHQUFHLElBQUksT0FBTyxDQUFDLE1BQU0sRUFBRSxJQUFJLEVBQUUsTUFBTSxDQUFDLENBQUM7QUFDMUMsV0FBRyxHQUFHLElBQUksT0FBTyxDQUFDLElBQUksRUFBRSxJQUFJLEVBQUUsTUFBTSxDQUFDLENBQUM7QUFDdEMsV0FBRyxHQUFHLElBQUksT0FBTyxDQUFDLElBQUksRUFBRSxJQUFJLEVBQUUsTUFBTSxDQUFDLENBQUM7QUFDdEMs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VSxDQUErQixHQUFNO0lBQzdELE9BQU8sQ0FBQyxHQUFHLEdBQUcsQ0FBZSxDQUFDO0FBQ2hDLENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyIvLyBHZW5lcmFsIHV0aWxpdGllcyBmb3Igcm9tIHBhY2thZ2UuXG5cbmV4cG9ydCBmdW5jdGlvbiB1cHBlckNhbWVsVG9TcGFjZXModXBwZXJDYW1lbDogc3RyaW5nKTogc3RyaW5nIHtcbiAgcmV0dXJuIHVwcGVyQ2FtZWwucmVwbGFjZSgvKFthLXpdKShbQS1aMC05XSkvZywgJyQxICQyJylcbiAgICAgIC5yZXBsYWNlKC9PZi9nLCAnb2YnKVxuICAgICAgLnJlcGxhY2UoL18vZywgJyAtICcpO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gbG93ZXJDYW1lbFRvU3BhY2VzKGxvd2VyQ2FtZWw6IHN0cmluZyk6IHN0cmluZyB7XG4gIHJldHVybiB1cHBlckNhbWVsVG9TcGFjZXMobG93ZXJDYW1lbCkucmVwbGFjZSgvXi4vLCAoeCkgPT4geC50b1VwcGVyQ2FzZSgpKTtcbn1cblxuLyoqIFJlbW92ZXMgcmVhZG9ubHkgZnJvbSBmaWVsZHMuICovXG5leHBvcnQgdHlwZSBNdXRhYmxlPFQ+ID0gey1yZWFkb25seSBbSyBpbiBrZXlvZihUKV06IFRbS119O1xuXG5leHBvcnQgZnVuY3Rpb24gc2VxKHg6IG51bWJlcik6IG51bWJlcltdO1xuZXhwb3J0IGZ1bmN0aW9uIHNlcTxUPih4OiBudW1iZXIsIGY/OiAoeDogbnVtYmVyKSA9PiBUKTogVFtdO1xuZXhwb3J0IGZ1bmN0aW9uIHNlcSh4OiBudW1iZXIsIGY6ICh4OiBudW1iZXIpID0+IG51bWJlciA9IChpKSA9PiBpKTogbnVtYmVyW10ge1xuICByZXR1cm4gbmV3IEFycmF5KHgpLmZpbGwoMCkubWFwKChfLCBpKSA9PiBmKGkpKTtcbn1cblxuZXhwb3J0IGludGVyZmFjZSBEYXRhPFQ+IHtcbiAgW2luZGV4OiBudW1iZXJdOiBUO1xuICBsZW5ndGg6IG51bWJlcjtcbiAgc2xpY2Uoc3RhcnQ6IG51bWJlciwgZW5kOiBudW1iZXIpOiB0aGlzO1xuICBbU3ltYm9sLml0ZXJhdG9yXSgpOiBJdGVyYXRvcjxUPjtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIHNsaWNlPFQgZXh0ZW5kcyBEYXRhPGFueT4+KGFycjogVCwgc3RhcnQ6IG51bWJlciwgbGVuOiBudW1iZXIpOiBUIHtcbiAgcmV0dXJuIGFyci5zbGljZShzdGFydCwgc3RhcnQgKyBsZW4pO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gdHVwbGU8VD4oYXJyOiBEYXRhPFQ+LCBzdGFydDogbnVtYmVyLCBsZW46IDIpOiBbVCwgVF07XG5leHBvcnQgZnVuY3Rpb24gdHVwbGU8VD4oYXJyOiBEYXRhPFQ+LCBzdGFydDogbnVtYmVyLCBsZW46IDMpOiBbVCwgVCwgVF07XG5leHBvcnQgZnVuY3Rpb24gdHVwbGU8VD4oYXJyOiBEYXRhPFQ+LCBzdGFydDogbnVtYmVyLCBsZW46IDQpOiBbVCwgVCwgVCwgVF07XG5leHBvcnQgZnVuY3Rpb24gdHVwbGU8VD4oYXJyOiBEYXRhPFQ+LCBzdGFydDogbnVtYmVyLCBsZW46IG51bWJlcik6IFRbXTtcbmV4cG9ydCBmdW5jdGlvbiB0dXBsZTxUPihhcnI6IERhdGE8VD4sIHN0YXJ0OiBudW1iZXIsIGxlbjogbnVtYmVyKTogVFtdIHtcbiAgcmV0dXJuIEFycmF5LmZyb20oYXJyLnNsaWNlKHN0YXJ0LCBzdGFydCArIGxlbikpO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gc2lnbmVkKHg6IG51bWJlcik6IG51bWJlciB7XG4gIHJldHVybiB4IDwgMHg4MCA/IHggOiB4IC0gMHgxMDA7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiB1bnNpZ25lZCh4OiBudW1iZXIpOiBudW1iZXIge1xuICByZXR1cm4geCA8IDAgPyB4ICsgMHgxMDAgOiB4O1xufVxuXG5leHBvcnQgZnVuY3Rpb24gdmFyU2xpY2U8VCBleHRlbmRzIERhdGE8bnVtYmVyPj4oYXJyOiBULFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0YXJ0OiBudW1iZXIsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgd2lkdGg6IG51bWJlcixcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZW50aW5lbDogbnVtYmVyLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVuZD86IG51bWJlcik6IFRbXTtcbmV4cG9ydCBmdW5jdGlvbiB2YXJTbGljZTxUIGV4dGVuZHMgRGF0YTxudW1iZXI+LCBVPihhcnI6IFQsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc3RhcnQ6IG51bWJlcixcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB3aWR0aDogbnVtYmVyLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlbnRpbmVsOiBudW1iZXIsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZW5kOiBudW1iZXIsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZnVuYzogKHNsaWNlOiBUKSA9PiBVKTogVVtdO1xuZXhwb3J0IGZ1bmN0aW9uIHZhclNsaWNlPFQgZXh0ZW5kcyBEYXRhPG51bWJlcj4sIFU+KGFycjogVCxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdGFydDogbnVtYmVyLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHdpZHRoOiBudW1iZXIsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2VudGluZWw6IG51bWJlcixcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbmQ6IG51bWJlciA9IEluZmluaXR5LFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZ1bmM/OiAoc2xpY2U6IFQpID0+IFUpOiBVW10ge1xuICBpZiAoIWZ1bmMpIGZ1bmMgPSAoeDogVCkgPT4geCBhcyBhbnk7XG4gIGNvbnN0IG91dCA9IFtdO1xuICB3aGlsZSAoc3RhcnQgKyB3aWR0aCA8PSBlbmQgJiYgYXJyW3N0YXJ0XSAhPT0gc2VudGluZWwpIHtcbiAgICBvdXQucHVzaChmdW5jIShhcnIuc2xpY2Uoc3RhcnQsIHN0YXJ0ICsgd2lkdGgpKSk7XG4gICAgc3RhcnQgKz0gd2lkdGg7XG4gIH1cbiAgcmV0dXJuIG91dDtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGFkZHIoYXJyOiBEYXRhPG51bWJlcj4sIGk6IG51bWJlciwgb2Zmc2V0OiBudW1iZXIgPSAwKTogbnVtYmVyIHtcbiAgcmV0dXJuIChhcnJbaV0gfCBhcnJbaSArIDFdIDw8IDgpICsgb2Zmc2V0O1xufVxuXG5leHBvcnQgZnVuY3Rpb24gZ3JvdXA8VCBleHRlbmRzIERhdGE8YW55Pj4od2lkdGg6IG51bWJlciwgYXJyOiBUKTogVFtdO1xuZXhwb3J0IGZ1bmN0aW9uIGdyb3VwPFQgZXh0ZW5kcyBEYXRhPGFueT4sIFU+KHdpZHRoOiBudW1iZXIsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYXJyOiBULFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZ1bmM6IChzbGljZTogVCkgPT4gVSk6IFVbXTtcblxuZXhwb3J0IGZ1bmN0aW9uIGdyb3VwPFQgZXh0ZW5kcyBEYXRhPGFueT4sIFU+KHdpZHRoOiBudW1iZXIsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYXJyOiBULFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZ1bmM/OiAoc2xpY2U6IFQpID0+IFUpOiBVW10ge1xuICBpZiAoIWZ1bmMpIGZ1bmMgPSAoeDogVCkgPT4geCBhcyBhbnk7XG4gIHJldHVybiBzZXEoXG4gICAgICBNYXRoLm1heCgwLCBNYXRoLmZsb29yKGFyci5sZW5ndGggLyB3aWR0aCkpLFxuICAgICAgaSA9PiBmdW5jIShzbGljZShhcnIsIGkgKiB3aWR0aCwgd2lkdGgpKSk7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiByZXZlcnNlQml0cyh4OiBudW1iZXIpOiBudW1iZXIge1xuICByZXR1cm4gKCh4ICogMHgwODAyICYgMHgyMjExMCkgfCAoeCAqIDB4ODAyMCAmIDB4ODg0NDApKSAqIDB4MTAxMDEgPj4+IDE2ICYgMHhmZjtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGNvdW50Qml0cyh4OiBudW1iZXIpOiBudW1iZXIge1xuICB4IC09IHggPj4gMSAmIDB4NTU7XG4gIHggPSAoeCAmIDB4MzMpICsgKHggPj4gMiAmIDB4MzMpO1xuICByZXR1cm4gKHggKyAoeCA+PiA0KSkgJiAweGY7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBoZXgoaWQ6IG51bWJlcik6IHN0cmluZyB7XG4gIHJldHVybiBpZCAhPSBudWxsID8gaWQudG9TdHJpbmcoMTYpLnBhZFN0YXJ0KDIsICcwJykgOiBTdHJpbmcoaWQpO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gaGV4MyhpZDogbnVtYmVyKTogc3RyaW5nIHtcbiAgcmV0dXJuIGlkLnRvU3RyaW5nKDE2KS5wYWRTdGFydCgzLCAnMCcpO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gaGV4NChpZDogbnVtYmVyKTogc3RyaW5nIHtcbiAgcmV0dXJuIGlkLnRvU3RyaW5nKDE2KS5wYWRTdGFydCg0LCAnMCcpO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gaGV4NShpZDogbnVtYmVyKTogc3RyaW5nIHtcbiAgcmV0dXJuIGlkLnRvU3RyaW5nKDE2KS5wYWRTdGFydCg1LCAnMCcpO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gY29uY2F0SXRlcmFibGVzKGl0ZXJzOiBJdGVyYWJsZTxudW1iZXI+W10pOiBudW1iZXJbXSB7XG4gIGNvbnN0IG91dDogbnVtYmVyW10gPSBbXTtcbiAgZm9yIChjb25zdCBpdGVyIG9mIGl0ZXJzKSB7XG4gICAgZm9yIChjb25zdCBlbGVtIG9mIGl0ZXIpIHtcbiAgICAgIG91dC5wdXNoKGVsZW0pO1xuICAgIH1cbiAgfVxuICByZXR1cm4gb3V0O1xuICAvLyByZXR1cm4gW10uY29uY2F0KC4uLml0ZXJzLm1hcChBcnJheS5mcm9tKSk7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiByZWFkQmlnRW5kaWFuKGRhdGE6IERhdGE8bnVtYmVyPiwgb2Zmc2V0OiBudW1iZXIpOiBudW1iZXIge1xuICByZXR1cm4gZGF0YVtvZmZzZXRdIDw8IDggfCBkYXRhW29mZnNldCArIDFdO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gcmVhZExpdHRsZUVuZGlhbihkYXRhOiBEYXRhPG51bWJlcj4sIG9mZnNldDogbnVtYmVyKTogbnVtYmVyIHtcbiAgcmV0dXJuIGRhdGFbb2Zmc2V0ICsgMV0gPDwgOCB8IGRhdGFbb2Zmc2V0XTtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIHJlYWRTdHJpbmcoYXJyOiBEYXRhPG51bWJlcj4sIGFkZHJlc3M6IG51bWJlciwgZW5kOiBudW1iZXIgPSAwKTogc3RyaW5nIHtcbiAgY29uc3QgYnl0ZXMgPSBbXTtcbiAgd2hpbGUgKGFyclthZGRyZXNzXSAhPSBlbmQpIHtcbiAgICBieXRlcy5wdXNoKGFyclthZGRyZXNzKytdKTtcbiAgfVxuICByZXR1cm4gU3RyaW5nLmZyb21DaGFyQ29kZSguLi5ieXRlcyk7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiByZWFkTGVuZ3RoRGVsaW1pdGVkU3RyaW5nKGFycjogRGF0YTxudW1iZXI+LCBhZGRyZXNzOiBudW1iZXIpOiBzdHJpbmcge1xuICBjb25zdCBsZW5ndGggPSBhcnJbYWRkcmVzc107XG4gIHJldHVybiBTdHJpbmcuZnJvbUNoYXJDb2RlKC4uLmFyci5zbGljZShhZGRyZXNzICsgMSwgYWRkcmVzcyArIDEgKyBsZW5ndGgpKTtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIHdyaXRlTGl0dGxlRW5kaWFuKGRhdGE6IERhdGE8bnVtYmVyPiwgb2Zmc2V0OiBudW1iZXIsIHZhbHVlOiBudW1iZXIpIHtcbiAgZGF0YVtvZmZzZXRdID0gdmFsdWUgJiAweGZmO1xuICBkYXRhW29mZnNldCArIDFdID0gdmFsdWUgPj4+IDg7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiB3cml0ZVN0cmluZyhhcnI6IERhdGE8bnVtYmVyPiwgYWRkcmVzczogbnVtYmVyLCBzdHI6IHN0cmluZykge1xuICBmb3IgKGxldCBpID0gMCwgbGVuID0gc3RyLmxlbmd0aDsgaSA8IGxlbjsgaSsrKSB7XG4gICAgYXJyW2FkZHJlc3MgKyBpXSA9IHN0ci5jaGFyQ29kZUF0KGkpO1xuICB9XG59XG5cbmV4cG9ydCBmdW5jdGlvbiB3cml0ZShkYXRhOiBVaW50OEFycmF5LCBvZmZzZXQ6IG51bWJlciwgdmFsdWVzOiBEYXRhPG51bWJlcj4pIHtcbiAgZGF0YS5zdWJhcnJheShvZmZzZXQsIG9mZnNldCArIHZhbHVlcy5sZW5ndGgpLnNldCh2YWx1ZXMpO1xufVxuXG5leHBvcnQgY2xhc3MgRmxhZ0xpc3RUeXBlIHtcbiAgY29uc3RydWN0b3IocmVhZG9ubHkgbGFzdDogbnVtYmVyLFxuICAgICAgICAgICAgICByZWFkb25seSBjbGVhcjogbnVtYmVyLFxuICAgICAgICAgICAgICByZWFkb25seSBub25FbXB0eTogYm9vbGVhbiA9IGZhbHNlKSB7fVxuXG4gIHJlYWQoZGF0YTogRGF0YTxudW1iZXI+LCBvZmZzZXQ6IG51bWJlciA9IDApOiBudW1iZXJbXSB7XG4gICAgLy8gVE9ETyAtIGRvIHdlIGV2ZXIgbmVlZCB0byBpbnZlcnQgY2xlYXIvbGFzdD8gIElmIHNvLCB1c2UgfiBhcyBzaWduYWwuXG4gICAgY29uc3QgZmxhZ3MgPSBbXTtcbiAgICB3aGlsZSAodHJ1ZSkge1xuICAgICAgY29uc3QgaGkgPSBkYXRhW29mZnNldCsrXTtcbiAgICAgIGNvbnN0IGxvID0gZGF0YVtvZmZzZXQrK107XG4gICAgICBjb25zdCBmbGFnID0gKGhpICYgMykgPDwgOCB8IGxvO1xuICAgICAgY29uc3Qgc2lnbmVkID0gaGkgJiB0aGlzLmNsZWFyID8gfmZsYWcgOiBmbGFnO1xuICAgICAgaWYgKHNpZ25lZCAhPT0gfjApIGZsYWdzLnB1c2goc2lnbmVkKTtcbiAgICAgIGlmIChoaSAmIHRoaXMubGFzdCkgcmV0dXJuIGZsYWdzO1xuICAgIH1cbiAgfVxuXG4gIGJ5dGVzKGZsYWdzOiBudW1iZXJbXSk6IG51bWJlcltdIHtcbiAgICBmbGFncyA9IGZsYWdzLmZpbHRlcihmID0+IGYgIT09IH4wKTtcbiAgICBpZiAodGhpcy5ub25FbXB0eSAmJiAhZmxhZ3MubGVuZ3RoKSBmbGFncyA9IFt+MF07XG4gICAgY29uc3QgYnl0ZXMgPSBbXTtcbiAgICBmb3IgKGxldCBpID0gMDsgaSA8IGZsYWdzLmxlbmd0aDsgaSsrKSB7XG4gICAgICBsZXQgZmxhZyA9IGZsYWdzW2ldO1xuICAgICAgaWYgKGZsYWcgPCAwKSBmbGFnID0gKHRoaXMuY2xlYXIgPDwgOCkgfCB+ZmxhZztcbiAgICAgIGlmIChpID09PSBmbGFncy5sZW5ndGggLSAxKSBmbGFnIHw9ICh0aGlzLmxhc3QgPDwgOCk7XG4gICAgICBieXRlcy5wdXNoKGZsYWcgPj4+IDgpO1xuICAgICAgYnl0ZXMucHVzaChmbGFnICYgMHhmZik7XG4gICAgfVxuICAgIHJldHVybiBieXRlcztcbiAgfVxuXG4gIHdyaXRlKGRhdGE6IERhdGE8bnVtYmVyPiwgZmxhZ3M6IG51bWJlcltdLCBvZmZzZXQ6IG51bWJlciA9IDApIHtcbiAgICBjb25zdCBieXRlcyA9IHRoaXMuYnl0ZXMoZmxhZ3MpO1xuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgYnl0ZXMubGVuZ3RoOyBpKyspIHtcbiAgICAgIGRhdGFbaSArIG9mZnNldF0gPSBieXRlc1tpXTtcbiAgICB9XG4gIH1cbn1cblxuZXhwb3J0IGNvbnN0IERJQUxPR19GTEFHUyA9IG5ldyBGbGFnTGlzdFR5cGUoMHg0MCwgMHg4MCk7XG5leHBvcnQgY29uc3QgSVRFTV9HRVRfRkxBR1MgPSBuZXcgRmxhZ0xpc3RUeXBlKDB4NDAsIDB4ODAsIHRydWUpO1xuZXhwb3J0IGNvbnN0IElURU1fVVNFX0ZMQUdTID0gbmV3IEZsYWdMaXN0VHlwZSgweDQwLCAweDgwLCB0cnVlKTtcbmV4cG9ydCBjb25zdCBJVEVNX0NPTkRJVElPTl9GTEFHUyA9IG5ldyBGbGFnTGlzdFR5cGUoMHg4MCwgMHgyMCwgdHJ1ZSk7XG5leHBvcnQgY29uc3QgU1BBV05fQ09ORElUSU9OX0ZMQUdTID0gbmV3IEZsYWdMaXN0VHlwZSgweDgwLCAweDIwKTtcblxuLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vL1xuXG5kZWNsYXJlIGNvbnN0IGluaXRpYWxUYWc6IHVuaXF1ZSBzeW1ib2w7XG5leHBvcnQgaW50ZXJmYWNlIEluaXRpYWwgeyBbaW5pdGlhbFRhZ106IG5ldmVyOyB9XG5leHBvcnQgdHlwZSBJbml0aWFsUHJvcHM8VCxcbiAgICBYID0ge1tQIGluIGtleW9mIFRdOiBUW1BdIGV4dGVuZHMgSW5pdGlhbCA/IFAgOiBuZXZlcn0+ID0gWFtrZXlvZiBYXTtcblxuLy8gSW1wbCAtIHF1ZXN0aW9uIC0gY2FuIHdlIGRvIHNvbWV0aGluZyBzaW1pbGFyIGZvciBEYXRhVHVwbGU/Pz9cblxuZXhwb3J0IGZ1bmN0aW9uIGluaXRpYWxpemVyPFAgZXh0ZW5kcyByZWFkb25seSBhbnlbXSwgVD4oKTogSW5pdGlhbGl6ZXI8UCwgVD4ge1xuICBjb25zdCB0YWcgPSBTeW1ib2woKTtcbiAgZnVuY3Rpb24gZiguLi5hcmdzOiBQKTogVCAmIEluaXRpYWwge1xuICAgIHJldHVybiB7dGFnLCBhcmdzfSBhcyBhbnk7IC8vIE5PVEU6IHRoaXMgaXMgYSBjb21wbGV0ZSBsaWUgZm9yIG5vdy5cbiAgfVxuICBmLmNvbW1pdCA9IChpbnN0YW5jZTogYW55LCBidWlsZGVyOiAocHJvcDogc3RyaW5nLCAuLi5hcmdzOiBQKSA9PiBUKSA9PiB7XG4gICAgZm9yIChjb25zdCBwcm9wIG9mIE9iamVjdC5nZXRPd25Qcm9wZXJ0eU5hbWVzKGluc3RhbmNlKSkge1xuICAgICAgY29uc3QgdmFsdWUgPSBpbnN0YW5jZVtwcm9wXTtcbiAgICAgIGlmICh2YWx1ZS50YWcgIT09IHRhZykgY29udGludWU7XG4gICAgICBpbnN0YW5jZVtwcm9wXSA9IGJ1aWxkZXIocHJvcCwgLi4udmFsdWUuYXJncyk7XG4gICAgfVxuICB9O1xuICByZXR1cm4gZjtcbn1cbmV4cG9ydCBpbnRlcmZhY2UgSW5pdGlhbGl6ZXI8UCBleHRlbmRzIHJlYWRvbmx5IGFueVtdLCBUPiB7XG4gICguLi5hcmdzOiBQKTogVDtcbiAgY29tbWl0KGluc3RhbmNlOiBhbnksIGJ1aWxkZXI6IChwcm9wOiBzdHJpbmcsIC4uLmFyZ3M6IFApID0+IFQpOiB2b2lkO1xufVxuXG4vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vXG5cbnR5cGUgTm9uTmV2ZXJQcm9wczxUPiA9ICh7W0sgaW4ga2V5b2YgVF06IFRbS10gZXh0ZW5kcyBuZXZlciA/IG5ldmVyIDogS30pW2tleW9mIFRdO1xuZXhwb3J0IHR5cGUgTm9uTmV2ZXI8VD4gPSBQaWNrPFQsIE5vbk5ldmVyUHJvcHM8VD4+O1xuXG4vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vXG5cbi8vIC8vIGludGVyZmFjZSBSZWFkb25seVNldDxWPiBleHRlbmRzIEl0ZXJhYmxlPFY+IHtcbi8vIC8vICAgaGFzKGVsZW06IFYpOiBib29sZWFuO1xuLy8gLy8gfVxuLy8gaW50ZXJmYWNlIEhhc0lkIHtcbi8vICAgaWQ6IG51bWJlcjtcbi8vIH1cblxuLy8gdHlwZSBDb2xsZWN0aW9uQmFzZTxLLCBWPiA9IHtbVCBpbiBrZXlvZiBLXTogVn0gJiBSZWFkb25seVNldDxWPjtcbi8vIHR5cGUgQ29sbGVjdGlvbkJhc2VJbmRleDxLLCBWIGV4dGVuZHMge2lkOiBudW1iZXJ9PiA9XG4vLyAgICAgQ29sbGVjdGlvbkJhc2U8SywgVj4gJiB7W2lkOiBudW1iZXJdOiBWfTtcbi8vIHR5cGUgQ29sbGVjdGlvbkJhc2VBcnJheTxLLCBWIGV4dGVuZHMge2lkOiBudW1iZXJ9PiA9XG4vLyAgICAge1tUIGluIGtleW9mIEtdOiBWfSAmIFJlYWRvbmx5QXJyYXk8Vj4gJiBJdGVyYWJsZTxWPjtcblxuLy8gdHlwZSBDb2xsZWN0aW9uTWFwcGVyPEssIFY+ID0gPFQgZXh0ZW5kcyBrZXlvZiBLPihlbGVtOiBLW1RdLCBrZXk6IFQpID0+IFY7XG4vLyBpbnRlcmZhY2UgQ29sbGVjdGlvbkN0b3I8SywgVj4ge1xuLy8gICBuZXcoZGF0YTogSywgbWFwcGVyOiBDb2xsZWN0aW9uTWFwcGVyPEssIFY+KTogQ29sbGVjdGlvbkJhc2U8SywgVj47XG4vLyB9XG4vLyBpbnRlcmZhY2UgQ29sbGVjdGlvbkN0b3JJbmRleDxLLCBWIGV4dGVuZHMge2lkOiBudW1iZXJ9PiB7XG4vLyAgIG5ldyhkYXRhOiBLLCBtYXBwZXI6IENvbGxlY3Rpb25NYXBwZXI8SywgVj4pOiBDb2xsZWN0aW9uQmFzZUluZGV4PEssIFY+O1xuLy8gfVxuLy8gaW50ZXJmYWNlIENvbGxlY3Rpb25DdG9yQXJyYXk8SywgViBleHRlbmRzIHtpZDogbnVtYmVyfT4ge1xuLy8gICBuZXcoZGF0YTogSywgbWFwcGVyOiBDb2xsZWN0aW9uTWFwcGVyPEssIFY+LCBpbml0aWFsU2l6ZT86IG51bWJlcik6XG4vLyAgICAgICBDb2xsZWN0aW9uQmFzZUFycmF5PEssIFY+O1xuLy8gfVxuXG4vLyAvLyBmdW5jdGlvbiBjb2xsZWN0aW9uQmFzZTxLLCBWPigpOiB7XG4vLyAvLyAgIG5ldyhkYXRhOiBLLCBtYXBwZXI6IENvbGxlY3Rpb25NYXBwZXI8SywgVj4pOiBDb2xsZWN0aW9uQmFzZTxLLCBWPlxuLy8gLy8gfSB7XG4vLyAvLyAgIHJldHVybiBjbGFzcyBleHRlbmRzIFNldDx1bmtub3duPiB7XG4vLyAvLyAgICAgY29uc3RydWN0b3IoZGF0YTogSywgbWFwcGVyOiA8VCBleHRlbmRzIGtleW9mIEs+KGVsZW06IEtbVF0sIGtleTogVCkgPT4gVikge1xuLy8gLy8gICAgICAgc3VwZXIoKTtcbi8vIC8vICAgICAgIGZvciAoY29uc3Qga2V5IGluIGRhdGEpIHtcbi8vIC8vICAgICAgICAgY29uc3QgdmFsdWUgPSBtYXBwZXIoZGF0YVtrZXldLCBrZXkpO1xuLy8gLy8gICAgICAgICBzdXBlci5hZGQoKHRoaXMgYXMgYW55KVtrZXldID0gdmFsdWUpO1xuLy8gLy8gICAgICAgICBpZiAoaW5kZXhlZCkgKHRoaXMgYXMgYW55KVsodmFsdWUgYXMgYW55KS5pZF0gPSB2YWx1ZTtcbi8vIC8vICAgICAgIH1cbi8vIC8vICAgICB9XG4vLyAvLyAgICAgYWRkKCk6IG5ldmVyIHsgdGhyb3cgbmV3IEVycm9yKCdub3QgaW1wbGVtZW50ZWQnKTsgfVxuLy8gLy8gICAgIGRlbGV0ZSgpOiBuZXZlciB7IHRocm93IG5ldyBFcnJvcignbm90IGltcGxlbWVudGVkJyk7IH1cbi8vIC8vICAgICBjbGVhcigpOiBuZXZlciB7IHRocm93IG5ldyBFcnJvcignbm90IGltcGxlbWVudGVkJyk7IH1cbi8vIC8vICAgfSBhcyBhbnk7XG4vLyAvLyB9XG5cbi8vIGV4cG9ydCBmdW5jdGlvbiBjb2xsZWN0aW9uQmFzZTxLLCBWIGV4dGVuZHMgSGFzSWQ+KGluZGV4ZWQ6IHRydWUpOiBDb2xsZWN0aW9uQ3RvckluZGV4PEssIFY+O1xuLy8gZXhwb3J0IGZ1bmN0aW9uIGNvbGxlY3Rpb25CYXNlPEssIFY+KGluZGV4ZWQ6IGJvb2xlYW4pOiBDb2xsZWN0aW9uQ3RvcjxLLCBWPiB7XG4vLyAgIHJldHVybiBjbGFzcyBleHRlbmRzIFNldDx1bmtub3duPiB7XG4vLyAgICAgY29uc3RydWN0b3IoZGF0YTogSywgbWFwcGVyOiA8VCBleHRlbmRzIGtleW9mIEs+KGVsZW06IEtbVF0sIGtleTogVCkgPT4gVikge1xuLy8gICAgICAgc3VwZXIoKTtcbi8vICAgICAgIGZvciAoY29uc3Qga2V5IGluIGRhdGEpIHtcbi8vICAgICAgICAgY29uc3QgdmFsdWUgPSBtYXBwZXIoZGF0YVtrZXldLCBrZXkpO1xuLy8gICAgICAgICBzdXBlci5hZGQoKHRoaXMgYXMgYW55KVtrZXldID0gdmFsdWUpO1xuLy8gICAgICAgICBpZiAoaW5kZXhlZCkgKHRoaXMgYXMgYW55KVsodmFsdWUgYXMgYW55KS5pZF0gPSB2YWx1ZTtcbi8vICAgICAgIH1cbi8vICAgICB9XG4vLyAgICAgYWRkKCk6IG5ldmVyIHsgdGhyb3cgbmV3IEVycm9yKCdub3QgaW1wbGVtZW50ZWQnKTsgfVxuLy8gICAgIGRlbGV0ZSgpOiBuZXZlciB7IHRocm93IG5ldyBFcnJvcignbm90IGltcGxlbWVudGVkJyk7IH1cbi8vICAgICBjbGVhcigpOiBuZXZlciB7IHRocm93IG5ldyBFcnJvcignbm90IGltcGxlbWVudGVkJyk7IH1cbi8vICAgfSBhcyBhbnk7XG4vLyB9XG5cbi8vIGV4cG9ydCBmdW5jdGlvbiBjb2xsZWN0aW9uQmFzZUFycmF5PEssIFYgZXh0ZW5kcyBIYXNJZD4oKTogQ29sbGVjdGlvbkN0b3JBcnJheTxLLCBWPiB7XG4vLyAgIHJldHVybiBjbGFzcyBleHRlbmRzIEFycmF5PHVua25vd24+IHtcbi8vICAgICBzdGF0aWMgZ2V0IFtTeW1ib2wuc3BlY2llc10oKSB7IHJldHVybiBBcnJheTsgfVxuLy8gICAgIGNvbnN0cnVjdG9yKGRhdGE6IEssXG4vLyAgICAgICAgICAgICAgICAgbWFwcGVyOiA8VCBleHRlbmRzIGtleW9mIEs+KGVsZW06IEtbVF0sIGtleTogVCkgPT4gVixcbi8vICAgICAgICAgICAgICAgICBpbml0aWFsU2l6ZSA9IDApIHtcbi8vICAgICAgIHN1cGVyKGluaXRpYWxTaXplKTtcbi8vICAgICAgIGZvciAoY29uc3Qga2V5IGluIGRhdGEpIHtcbi8vICAgICAgICAgY29uc3QgdmFsdWUgPSBtYXBwZXIoZGF0YVtrZXldLCBrZXkpO1xuLy8gICAgICAgICAodGhpcyBhcyBhbnkpW3ZhbHVlLmlkXSA9IHZhbHVlO1xuLy8gICAgICAgfVxuLy8gICAgIH1cbi8vICAgfSBhcyBhbnk7XG4vLyB9XG5cbi8vIC8vIGV4cG9ydCBjbGFzcyBDb2xsZWN0aW9uPEssIFY+IGV4dGVuZHMgY29sbGVjdGlvbkJhc2U8SywgVj4oKSBpbXBsZW1lbnRzIENvbGxlY3Rpb25CYXNlPEssIFY+IHt9XG4vLyAvLyBleHBvcnQgY2xhc3MgSW5kZXhlZENvbGxlY3Rpb248SywgViBleHRlbmRzIHtpZDogbnVtYmVyfT5cbi8vIC8vICAgICBleHRlbmRzIGNvbGxlY3Rpb25CYXNlPEssIFY+KHRydWUpIHt9XG4vLyAvLyBleHBvcnQgY2xhc3MgQXJyYXlDb2xsZWN0aW9uPEssIFYgZXh0ZW5kcyB7aWQ6IG51bWJlcn0+XG4vLyAvLyAgICAgZXh0ZW5kcyBjb2xsZWN0aW9uQmFzZUFycmF5PEssIFY+KCkge31cblxuLy8gLy8gdHlwZSBDb2xsZWN0aW9uQmFzZTxLLCBWPiA9IHtcbi8vIC8vICAgcmVhZG9ubHkgW1QgaW4ga2V5b2YgS106IFYsXG4gIFxuLy8gLy8gZXhwb3J0IGZ1bmN0aW9uIGNvbGxlY3Rpb25CYXNlPEssIFY+KCk6IHtuZXcoKToge1tUIGluIGtleW9mIEtdOiBWfX0ge1xuLy8gLy8gICByZXR1cm4gT2JqZWN0IGFzIHVua25vd24gYXMge25ldygpOiB7W1QgaW4ga2V5b2YgS106IFZ9fTtcbi8vIC8vIH1cblxuLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vL1xuXG5jb25zdCBQUk9QX1RBRyA9IFN5bWJvbCgnUFJPUF9UQUcnKTtcblxudHlwZSBTZXR0ZXJIZWxwZXI8WCwgWSwgWiwgQT4gPVxuICBaIGV4dGVuZHMgRnVuY3Rpb24gPyBuZXZlciA6XG4gICg8VD4oKSA9PiBUIGV4dGVuZHMgWCA/IDEgOiAyKSBleHRlbmRzXG4gICg8VD4oKSA9PiBUIGV4dGVuZHMgWSA/IDEgOiAyKSA/IEEgOiBuZXZlcjtcbnR5cGUgU2V0dGVyUHJvcHM8VD4gPSB7XG4gIFtQIGluIGtleW9mIFRdLT86IFNldHRlckhlbHBlcjx7W1EgaW4gUF06IFRbUF19LFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgey1yZWFkb25seSBbUSBpbiBQXTogVFtQXX0sIFRbUF0sIFA+XG59W2tleW9mIFRdO1xuLy8gTk9URTogVGhpcyBmb3JtIGdpdmVzIHRoZSBiZXN0IHRvb2x0aXAgbWVzc2FnZXMuXG50eXBlIFNldHRhYmxlPFQ+ID0gUGlja1BhcnRpYWw8VCwgU2V0dGVyUHJvcHM8VD4+O1xuaW50ZXJmYWNlIERhdGFUdXBsZUN0b3I8VCBleHRlbmRzIERhdGFUdXBsZT4ge1xuICBuZXcoYXJnOiBuZXZlcik6IFQ7IC8vIE5PVEU6IGl0J3MgYWN0dWFsbHkgZGF0YTogRGF0YTxudW1iZXI+XG4gIHNpemU6IG51bWJlcjtcbn1cbnR5cGUgUGlja1BhcnRpYWw8VCwgSyBleHRlbmRzIGtleW9mIFQ+ID0ge1tQIGluIEtdPzogVFtQXX07XG5cbmNvbnN0IGRhdGFUdXBsZU1hcCA9IG5ldyBXZWFrTWFwKCk7XG5cbmZ1bmN0aW9uIGRhdGFUdXBsZUFjdHVhbENsYXNzPFQgZXh0ZW5kcyBEYXRhVHVwbGVDdG9yPGFueT4+KGFyZzogVCk6IFQge1xuICBsZXQgcmVzdWx0ID0gZGF0YVR1cGxlTWFwLmdldChhcmcpO1xuICBpZiAoIXJlc3VsdCkge1xuICAgIC8vIE1ha2UgYSBuZXcgZGlyZWN0IHN1YnR5cGUgb2YgRGF0YVR1cGxlLCBidXQgbWFrZSBpdCBsb29rIGxpa2UgYXJnLlxuICAgIHJlc3VsdCA9IGNsYXNzIGV4dGVuZHMgRGF0YVR1cGxlIHt9O1xuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0aWVzKHJlc3VsdCwge25hbWU6IHt2YWx1ZTogYXJnLm5hbWV9fSk7XG4gICAgT2JqZWN0LmFzc2lnbihyZXN1bHQsIGFyZyk7IC8vIGNvcHkgc3RhdGljIHByb3BlcnRpZXMgdG8gZW5zdXJlIGN0b3Igc2tpcHBlZFxuICAgIFJlZmxlY3Quc2V0UHJvdG90eXBlT2YocmVzdWx0LnByb3RvdHlwZSwgYXJnLnByb3RvdHlwZSk7XG4gICAgLy8gUmVmbGVjdCBvbiBhbiBhY3R1YWwgaW5zdGFuY2UgdG8gZmluZCB0aGUgcHJvcHMuXG4gICAgY29uc3QgcHJvdG8gPSBuZXcgKGFyZyBhcyBhbnkpKCk7XG4gICAgY29uc3QgZGVzY3JpcHRvcnM6IGFueSA9IHt9O1xuICAgIGZvciAoY29uc3QgW3Byb3AsIGRlc2NyXSBvZiBPYmplY3QuZW50cmllcyhwcm90bykpIHtcbiAgICAgIGlmIChkZXNjciAmJiAoZGVzY3IgYXMge1tQUk9QX1RBR106IGJvb2xlYW59KVtQUk9QX1RBR10pIHtcbiAgICAgICAgZGVzY3JpcHRvcnNbcHJvcF0gPSBkZXNjcjtcbiAgICAgIH1cbiAgICB9XG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnRpZXMocmVzdWx0LnByb3RvdHlwZSwgZGVzY3JpcHRvcnMpO1xuICAgIC8vIEZpbmFsbHkgYWRkIGl0IHRvIHRoZSBtYXAgZm9yIGJvdGggYXJnIGFuZCByZXN1bHQuXG4gICAgZGF0YVR1cGxlTWFwLnNldChhcmcsIHJlc3VsdCk7XG4gICAgZGF0YVR1cGxlTWFwLnNldChyZXN1bHQsIHJlc3VsdCk7XG4gIH1cbiAgcmV0dXJuIHJlc3VsdDtcbn1cblxuZXhwb3J0IGFic3RyYWN0IGNsYXNzIERhdGFUdXBsZSBpbXBsZW1lbnRzIEl0ZXJhYmxlPG51bWJlcj4ge1xuICBzdGF0aWMgc2l6ZTogbnVtYmVyO1xuXG4gIHJlYWRvbmx5IGRhdGE6IERhdGE8bnVtYmVyPjtcbiAgY29uc3RydWN0b3IoYXJnOiBuZXZlcikge1xuICAgIHRoaXMuZGF0YSA9IGFyZztcbiAgfVxuXG4gIHN0YXRpYyBvZjxUIGV4dGVuZHMgRGF0YVR1cGxlPih0aGlzOiBEYXRhVHVwbGVDdG9yPFQ+LFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaW5pdHM6IFNldHRhYmxlPFQ+KTogVCB7XG4gICAgcmV0dXJuIE9iamVjdC5hc3NpZ24oXG4gICAgICAgIG5ldyAoZGF0YVR1cGxlQWN0dWFsQ2xhc3ModGhpcykgYXMgYW55KShuZXcgQXJyYXkodGhpcy5zaXplKS5maWxsKDApKSxcbiAgICAgICAgaW5pdHMpO1xuICB9XG5cbiAgc3RhdGljIGZyb208VCBleHRlbmRzIERhdGFUdXBsZT4odGhpczogRGF0YVR1cGxlQ3RvcjxUPixcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGF0YTogRGF0YTxudW1iZXI+LCBvZmZzZXQgPSAwKTogVCB7XG4gICAgY29uc3QgY2xzOiBhbnkgPSBkYXRhVHVwbGVBY3R1YWxDbGFzcyh0aGlzKTtcbiAgICBjb25zdCBhcmcgPVxuICAgICAgICAhb2Zmc2V0ICYmIGRhdGEubGVuZ3RoID09PSB0aGlzLnNpemUgP1xuICAgICAgICBkYXRhIDogdHVwbGUoZGF0YSwgb2Zmc2V0LCB0aGlzLnNpemUpO1xuICAgIHJldHVybiBuZXcgY2xzKGFyZyk7XG4gIH1cblxuICBbU3ltYm9sLml0ZXJhdG9yXSgpOiBJdGVyYXRvcjxudW1iZXI+IHtcbiAgICByZXR1cm4gKHRoaXMuZGF0YSBhcyBudW1iZXJbXSlbU3ltYm9sLml0ZXJhdG9yXSgpO1xuICB9XG5cbiAgaGV4KCk6IHN0cmluZyB7XG4gICAgcmV0dXJuIEFycmF5LmZyb20odGhpcy5kYXRhLCBoZXgpLmpvaW4oJyAnKTtcbiAgfVxuXG4gIGNsb25lKCk6IHRoaXMge1xuICAgIHJldHVybiBuZXcgKHRoaXMuY29uc3RydWN0b3IgYXMgYW55KSh0aGlzLmRhdGEpO1xuICB9XG5cbiAgcHJvdGVjdGVkIHByb3AoLi4uYml0czogW251bWJlciwgbnVtYmVyPywgbnVtYmVyP11bXSk6IG51bWJlciB7XG4gICAgcmV0dXJuIHtcbiAgICAgIGdldCh0aGlzOiBEYXRhVHVwbGUpOiBudW1iZXIge1xuICAgICAgICBsZXQgdmFsdWUgPSAwO1xuICAgICAgICBmb3IgKGNvbnN0IFtpbmRleCwgbWFzayA9IDB4ZmYsIHNoaWZ0ID0gMF0gb2YgYml0cykge1xuICAgICAgICAgIGNvbnN0IGxzaCA9IHNoaWZ0IDwgMCA/IC1zaGlmdCA6IDA7XG4gICAgICAgICAgY29uc3QgcnNoID0gc2hpZnQgPCAwID8gMCA6IHNoaWZ0O1xuICAgICAgICAgIHZhbHVlIHw9ICgodGhpcy5kYXRhW2luZGV4XSAmIG1hc2spID4+PiByc2gpIDw8IGxzaDtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gdmFsdWU7XG4gICAgICB9LFxuICAgICAgc2V0KHRoaXM6IERhdGFUdXBsZSwgdmFsdWU6IG51bWJlcikge1xuICAgICAgICBmb3IgKGNvbnN0IFtpbmRleCwgbWFzayA9IDB4ZmYsIHNoaWZ0ID0gMF0gb2YgYml0cykge1xuICAgICAgICAgIGNvbnN0IGxzaCA9IHNoaWZ0IDwgMCA/IC1zaGlmdCA6IDA7XG4gICAgICAgICAgY29uc3QgcnNoID0gc2hpZnQgPCAwID8gMCA6IHNoaWZ0O1xuICAgICAgICAgIGNvbnN0IHYgPSAodmFsdWUgPj4+IGxzaCkgPDwgcnNoICYgbWFzaztcbiAgICAgICAgICB0aGlzLmRhdGFbaW5kZXhdID0gdGhpcy5kYXRhW2luZGV4XSAmIH5tYXNrIHwgdjtcbiAgICAgICAgfVxuICAgICAgfSxcbiAgICAgIFtQUk9QX1RBR106IHRydWUsXG4gICAgfSBhcyB1bmtub3duIGFzIG51bWJlcjtcbiAgfVxuXG4gIHByb3RlY3RlZCBib29sZWFuUHJvcChieXRlOiBudW1iZXIsIGJpdDogbnVtYmVyKTogYm9vbGVhbiB7XG4gICAgcmV0dXJuIHtcbiAgICAgIGdldCh0aGlzOiBEYXRhVHVwbGUpOiBib29sZWFuIHtcbiAgICAgICAgcmV0dXJuIEJvb2xlYW4odGhpcy5kYXRhW2J5dGVdICYgKDEgPDwgYml0KSk7XG4gICAgICB9LFxuICAgICAgc2V0KHRoaXM6IERhdGFUdXBsZSwgdmFsdWU6IGJvb2xlYW4pIHtcbiAgICAgICAgY29uc3QgbWFzayA9IDEgPDwgYml0O1xuICAgICAgICBpZiAodmFsdWUpIHtcbiAgICAgICAgICB0aGlzLmRhdGFbYnl0ZV0gfD0gbWFzaztcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICB0aGlzLmRhdGFbYnl0ZV0gJj0gfm1hc2s7XG4gICAgICAgIH1cbiAgICAgIH0sXG4gICAgICBbUFJPUF9UQUddOiB0cnVlLFxuICAgIH0gYXMgdW5rbm93biBhcyBib29sZWFuO1xuICB9XG59ICBcblxuXG5cblxuLy8gaW50ZXJmYWNlIEdldFNldDxVPiB7XG4vLyAgIGdldCgpOiBVO1xuLy8gICBzZXQoYXJnOiBVKTogdm9pZDtcbi8vIH1cblxuLy8gdHlwZSBEYXRhVHVwbGVTdWI8VD4gPVxuLy8gICAgIHtbSyBpbiBrZXlvZiBUXTogVFtLXSBleHRlbmRzIEdldFNldDxpbmZlciBVPiA/IFUgOlxuLy8gICAgICAgICAgICAgICAgICAgICAgVFtLXSBleHRlbmRzIHt2YWx1ZTogKGluZmVyIFcpfSA/IFcgOlxuLy8gICAgICAgICAgICAgICAgICAgICAgVFtLXSBleHRlbmRzICguLi5hcmdzOiBhbnlbXSkgPT4gdm9pZCA/IFRbS10gOiBuZXZlcn0gJiBEYXRhVHVwbGU7XG5cbi8vIC8vIE5vdGU6IGl0IHdvdWxkIGJlIG5pY2UgZm9yIHRoZSBmaW5hbCBUW0tdIGJlbG93IHRvIGJlICduZXZlcicsIGJ1dFxuLy8gLy8gdGhpcyBmYWlscyBiZWNhdXNlIGFsbCBvYmplY3RzIGhhdmUgYW4gaW1wbGljaXQgdG9TdHJpbmcsIHdoaWNoIHdvdWxkXG4vLyAvLyBvdGhlcndpc2UgbmVlZCB0byBiZSB7dG9TdHJpbmc/OiB1bmRlZmluZWR9IGZvciBzb21lIHJlYXNvbi5cbi8vIHR5cGUgRGF0YVR1cGxlSW5pdHM8XG4vLyAgIFQsIEsgPSB7W1AgaW4ga2V5b2YgVF06IFRbUF0gZXh0ZW5kcyB7c2V0KGFyZzogaW5mZXIgVSk6IHZvaWR9ID8gVSA6IG5ldmVyfT5cbi8vICAgPSB7W1AgaW4gTm9uTmV2ZXJQcm9wczxLPl0/OiBLW1BdfTtcblxuLy8gaW50ZXJmYWNlIERhdGFUdXBsZUN0b3I8VD4ge1xuLy8gICBuZXcoZGF0YT86IERhdGE8bnVtYmVyPik6IERhdGFUdXBsZVN1YjxUPjtcbi8vICAgb2Y8ViBleHRlbmRzIERhdGFUdXBsZUN0b3I8VD4+KHRoaXM6IFYsIGluaXRzOiBEYXRhVHVwbGVJbml0czxUPik6IEluc3RhbmNlVHlwZTxWPjtcbi8vICAgZnJvbTxWIGV4dGVuZHMgRGF0YVR1cGxlQ3RvcjxUPj4oZGF0YTogRGF0YTxudW1iZXI+LCBvZmZzZXQ6IG51bWJlcik6IEluc3RhbmNlVHlwZTxWPjtcbi8vIH1cblxuZXhwb3J0IGNvbnN0IHdhdGNoQXJyYXkgPSAoYXJyOiBEYXRhPHVua25vd24+LCB3YXRjaDogbnVtYmVyKSA9PiB7XG4gIGNvbnN0IGFycmF5Q2hhbmdlSGFuZGxlciA9IHtcbiAgICBnZXQodGFyZ2V0OiBhbnksIHByb3BlcnR5OiBzdHJpbmcgfCBudW1iZXIpIHtcbiAgICAgIC8vIGNvbnNvbGUubG9nKCdnZXR0aW5nICcgKyBwcm9wZXJ0eSArICcgZm9yICcgKyB0YXJnZXQpO1xuICAgICAgLy8gcHJvcGVydHkgaXMgaW5kZXggaW4gdGhpcyBjYXNlXG4gICAgICBsZXQgdiA9IHRhcmdldFtwcm9wZXJ0eV07XG4gICAgICBpZiAocHJvcGVydHkgPT09ICdzdWJhcnJheScpIHtcbiAgICAgICAgcmV0dXJuIChzdGFydDogbnVtYmVyLCBlbmQ6IG51bWJlcikgPT4ge1xuICAgICAgICAgIGNvbnN0IHN1YiA9IHRhcmdldC5zdWJhcnJheShzdGFydCwgZW5kKTtcbiAgICAgICAgICBpZiAoc3RhcnQgPD0gd2F0Y2ggJiYgd2F0Y2ggPCBlbmQpIHJldHVybiB3YXRjaEFycmF5KHN1Yiwgd2F0Y2ggLSBzdGFydCk7XG4gICAgICAgICAgcmV0dXJuIHN1YjtcbiAgICAgICAgfTtcbiAgICAgIH0gZWxzZSBpZiAocHJvcGVydHkgPT09ICdzZXQnKSB7XG4gICAgICAgIHJldHVybiAodmFsOiBEYXRhPHVua25vd24+KSA9PiB7XG4gICAgICAgICAgY29uc29sZS5sb2coYFNldHRpbmcgb3ZlcmxhcHBpbmcgYXJyYXkgJHt3YXRjaH1gKTtcbiAgICAgICAgICAvLyB0aHJvdyBuZXcgRXJyb3IoJycpO1xuICAgICAgICAgIGRlYnVnZ2VyO1xuICAgICAgICAgIHRhcmdldC5zZXQodmFsKTtcbiAgICAgICAgfTtcbiAgICAgIH1cbiAgICAgIGlmICh0eXBlb2YgdiA9PT0gJ2Z1bmN0aW9uJykgdiA9IHYuYmluZCh0YXJnZXQpO1xuICAgICAgcmV0dXJuIHY7XG4gICAgfSxcbiAgICBzZXQodGFyZ2V0OiBhbnksIHByb3BlcnR5OiBzdHJpbmcgfCBudW1iZXIsIHZhbHVlOiBhbnksIHJlY2VpdmVyOiBhbnkpIHtcbiAgICAgIC8vIGNvbnNvbGUubG9nKCdzZXR0aW5nICcgKyBwcm9wZXJ0eSArICcgZm9yICcvKiArIHRhcmdldCovICsgJyB3aXRoIHZhbHVlICcgKyB2YWx1ZSk7XG4gICAgICAvLyB0c2xpbnQ6ZGlzYWJsZS1uZXh0LWxpbmU6dHJpcGxlLWVxdWFsc1xuICAgICAgaWYgKHByb3BlcnR5ID09IHdhdGNoKSB7XG4gICAgICAgIGNvbnNvbGUubG9nKGBXcml0aW5nICR7d2F0Y2gudG9TdHJpbmcoMTYpfWApO1xuICAgICAgICAvLyB0aHJvdyBuZXcgRXJyb3IoJycpO1xuICAgICAgICBkZWJ1Z2dlcjtcbiAgICAgIH1cbiAgICAgIHRhcmdldFtwcm9wZXJ0eV0gPSB2YWx1ZTtcbiAgICAgIC8vIHlvdSBoYXZlIHRvIHJldHVybiB0cnVlIHRvIGFjY2VwdCB0aGUgY2hhbmdlc1xuICAgICAgcmV0dXJuIHRydWU7XG4gICAgfSxcbiAgfTtcbiAgcmV0dXJuIG5ldyBQcm94eShhcnIsIGFycmF5Q2hhbmdlSGFuZGxlcik7XG59O1xuXG5leHBvcnQgdHlwZSBXcml0YWJsZTxUPiA9IHstcmVhZG9ubHkgW0sgaW4ga2V5b2YgVF06IFRbS119O1xuXG5leHBvcnQgY2xhc3MgU2VnbWVudCB7XG4gIGNvbnN0cnVjdG9yKHJlYWRvbmx5IG5hbWU6IHN0cmluZyxcbiAgICAgICAgICAgICAgcmVhZG9ubHkgYmFuazogbnVtYmVyLFxuICAgICAgICAgICAgICByZWFkb25seSBvcmc6IG51bWJlcikge31cblxuICBnZXQgb2Zmc2V0KCk6IG51bWJlciB7XG4gICAgLy8gVE9ETyAtIG9mZnNldCBkZXBlbmRzIG9uIGV4cGFuc2lvbiBvciBub3QgZm9yIGZpeGVkIGJhbmtzXG4gICAgLy8gSXQgc2hvdWxkIHByb2JhYmx5IG9ubHkgYmUgdXNlZCBmb3IgUkVBRElORywgc28gd2UgdXNlIDFmXG4gICAgcmV0dXJuICh0aGlzLmJhbmsgJiAweDFmKSA8PCAxMztcbiAgfVxuXG4gIHN0YXRpYyByZWFkb25seSAkMDQgPSBuZXcgU2VnbWVudCgnMDQnLCAweDA0LCAweDgwMDApO1xuICBzdGF0aWMgcmVhZG9ubHkgJDA1ID0gbmV3IFNlZ21lbnQoJzA1JywgMHgwNSwgMHhhMDAwKTtcblxuICBzdGF0aWMgcmVhZG9ubHkgJDBhID0gbmV3IFNlZ21lbnQoJzBhJywgMHgwYSwgMHg4MDAwKTtcbiAgc3RhdGljIHJlYWRvbmx5ICQwYiA9IG5ldyBTZWdtZW50KCcwYicsIDB4MGIsIDB4YTAwMCk7XG4gIHN0YXRpYyByZWFkb25seSAkMGMgPSBuZXcgU2VnbWVudCgnMGMnLCAweDBjLCAweDgwMDApO1xuICBzdGF0aWMgcmVhZG9ubHkgJDBkID0gbmV3IFNlZ21lbnQoJzBkJywgMHgwZCwgMHhhMDAwKTtcbiAgc3RhdGljIHJlYWRvbmx5ICQwZSA9IG5ldyBTZWdtZW50KCcwZScsIDB4MGUsIDB4ODAwMCk7XG4gIHN0YXRpYyByZWFkb25seSAkMGYgPSBuZXcgU2VnbWVudCgnMGYnLCAweDBmLCAweGEwMDApO1xuICBzdGF0aWMgcmVhZG9ubHkgJDEwID0gbmV3IFNlZ21lbnQoJzEwJywgMHgxMCwgMHg4MDAwKTtcblxuICBzdGF0aWMgcmVhZG9ubHkgJDE0ID0gbmV3IFNlZ21lbnQoJzE0JywgMHgxNCwgMHg4MDAwKTtcbiAgc3RhdGljIHJlYWRvbmx5ICQxNSA9IG5ldyBTZWdtZW50KCcxNScsIDB4MTUsIDB4YTAwMCk7XG4gIHN0YXRpYyByZWFkb25seSAkMTZfYSA9IG5ldyBTZWdtZW50KCcxNjphJywgMHgxNiwgMHhhMDAwKTsgLy8gTk9URTogYW5vbWFsb3VzXG4gIHN0YXRpYyByZWFkb25seSAkMTcgPSBuZXcgU2VnbWVudCgnMTcnLCAweDE3LCAweGEwMDApO1xuICBzdGF0aWMgcmVhZG9ubHkgJDE4ID0gbmV3IFNlZ21lbnQoJzE4JywgMHgxOCwgMHg4MDAwKTtcbiAgc3RhdGljIHJlYWRvbmx5ICQxOSA9IG5ldyBTZWdtZW50KCcxOScsIDB4MTksIDB4YTAwMCk7XG4gIHN0YXRpYyByZWFkb25seSAkMWEgPSBuZXcgU2VnbWVudCgnMWEnLCAweDFhLCAweDgwMDApO1xuICBzdGF0aWMgcmVhZG9ubHkgJDFiID0gbmV3IFNlZ21lbnQoJzFiJywgMHgxYiwgMHhhMDAwKTtcblxuICBzdGF0aWMgcmVhZG9ubHkgJGZlID0gbmV3IFNlZ21lbnQoJ2ZlJywgMHgxZSwgMHhjMDAwKTtcbiAgc3RhdGljIHJlYWRvbmx5ICRmZiA9IG5ldyBTZWdtZW50KCdmZicsIDB4MWYsIDB4ZTAwMCk7XG59XG5cbi8vIFRPRE8gLSBpdCBtYXkgYmUgYSBtaXN0YWtlIHRvIHVzZSBzZWdtZW50IHN0cmluZ3MgaGVyZT9cbi8vICAgICAgLSB3ZSdsbCBzZWUgaWYgdGhhdCBjb21lcyBiYWNrIHRvIGJ5dGUgdXMgbGF0ZXIuXG5leHBvcnQgY2xhc3MgQWRkcmVzcyB7XG4gIHN0YXRpYyBvZihzZWdtZW50OiBTZWdtZW50LCBvcmc6IG51bWJlcikge1xuICAgIHJldHVybiBuZXcgQWRkcmVzcyhzZWdtZW50LCBvcmcgLSBzZWdtZW50Lm9yZyk7XG4gIH1cblxuICBwcml2YXRlIGNvbnN0cnVjdG9yKHJlYWRvbmx5IHNlZzogU2VnbWVudCwgcmVhZG9ubHkgZGVsdGE6IG51bWJlcikge31cblxuICBnZXQgb2Zmc2V0KCkge1xuICAgIHJldHVybiB0aGlzLnNlZy5vZmZzZXQgKyB0aGlzLmRlbHRhO1xuICB9XG4gIGdldCBvcmcoKSB7XG4gICAgcmV0dXJuIHRoaXMuc2VnLm9yZyArIHRoaXMuZGVsdGE7XG4gIH1cbiAgZ2V0IHNlZ21lbnQoKSB7XG4gICAgcmV0dXJuIHRoaXMuc2VnLm5hbWU7XG4gIH1cbiAgcGx1cyhvZmZzZXQ6IG51bWJlciwgbmV4dFNlZ21lbnQ/OiBTZWdtZW50KSB7XG4gICAgY29uc3QgbmV3RGVsdGEgPSB0aGlzLmRlbHRhICsgb2Zmc2V0O1xuICAgIGlmIChuZXdEZWx0YSA+PSAweDIwMDApIHtcbiAgICAgIGlmICghbmV4dFNlZ21lbnQpIHRocm93IG5ldyBFcnJvcihgU2VnbWVudCBjaGFuZ2VkYCk7XG4gICAgICBpZiAodGhpcy5zZWcub3JnICYgMHgyMDAwKSB0aHJvdyBuZXcgRXJyb3IoYEJhZCBzZWdtZW50IGNyb3NzYCk7XG4gICAgICByZXR1cm4gbmV3IEFkZHJlc3MobmV4dFNlZ21lbnQsIG5ld0RlbHRhICYgMHgxZmZmKTtcbiAgICB9XG4gICAgcmV0dXJuIG5ldyBBZGRyZXNzKHRoaXMuc2VnLCBuZXdEZWx0YSk7XG4gIH1cbiAgbWludXMoYWRkcjogQWRkcmVzcykge1xuICAgIGlmIChhZGRyLnNlZyAhPT0gdGhpcy5zZWcpIHRocm93IG5ldyBFcnJvcihgSW5jb21wYXRpYmxlIHNlZ21lbnRzYCk7XG4gICAgcmV0dXJuIHRoaXMuZGVsdGEgLSBhZGRyLmRlbHRhO1xuICB9XG4gIHJlYWQ8VD4oZGF0YTogRGF0YTxUPik6IFQge1xuICAgIHJldHVybiBkYXRhW3RoaXMub2Zmc2V0XTtcbiAgfVxuICByZWFkTGl0dGxlRW5kaWFuKGRhdGE6IERhdGE8bnVtYmVyPik6IG51bWJlciB7XG4gICAgY29uc3Qgb2ZmID0gdGhpcy5vZmZzZXQ7XG4gICAgcmV0dXJuIGRhdGFbb2ZmXSB8IGRhdGFbb2ZmICsgMV0gPDwgODtcbiAgfVxuICByZWFkQWRkcmVzcyhkYXRhOiBEYXRhPG51bWJlcj4sIC4uLnNlZ21lbnRzOiBTZWdtZW50W10pOiBBZGRyZXNzIHtcbiAgICBjb25zdCBvcmcgPSB0aGlzLnJlYWRMaXR0bGVFbmRpYW4oZGF0YSk7XG4gICAgaWYgKCFzZWdtZW50cy5sZW5ndGgpIHNlZ21lbnRzID0gW3RoaXMuc2VnXTtcbiAgICAvLyBGaWd1cmUgb3V0IHdoaWNoIHNlZ21lbnQgaXQncyBpbi5cbiAgICBmb3IgKGNvbnN0IHMgb2Ygc2VnbWVudHMpIHtcbiAgICAgIGlmICgob3JnICYgMHhlMDAwKSA9PT0gKHMub3JnICYgMHhlMDAwKSkgcmV0dXJuIEFkZHJlc3Mub2Yocywgb3JnKTtcbiAgICB9XG4gICAgdGhyb3cgbmV3IEVycm9yKGBDb3VsZCBub3QgZmluZCB2YWxpZCBzZWdtZW50IGZvciAke2hleChvcmcpfWApO1xuICB9XG4gIGxvYyhhc3NlbWJsZXI6IElBc3NlbWJsZXIsIG5hbWU/OiBzdHJpbmcpIHtcbiAgICBhc3NlbWJsZXIuc2VnbWVudCh0aGlzLnNlZ21lbnQpO1xuICAgIGFzc2VtYmxlci5vcmcodGhpcy5vcmcsIG5hbWUpO1xuICB9XG4gIC8vIGxvY1dpZGUoYXNzZW1ibGVyOiBJQXNzZW1ibGVyLCBuYW1lPzogc3RyaW5nKSB7XG4gIC8vICAgYXNzZW1ibGVyLnNlZ21lbnQodGhpcy5zZWdtZW50LCBoZXgodGhpcy5zZWcgXiAxKSk7XG4gIC8vICAgYXNzZW1ibGVyLm9yZyh0aGlzLm9yZywgbmFtZSk7XG4gIC8vIH1cbiAgLy8gbG9jRml4ZWQoYXNzZW1ibGVyOiBJQXNzZW1ibGVyLCBuYW1lPzogc3RyaW5nKSB7XG4gIC8vICAgYXNzZW1ibGVyLnNlZ21lbnQodGhpcy5zZWdtZW50LCAnZmUnLCAnZmYnKTtcbiAgLy8gICBhc3NlbWJsZXIub3JnKHRoaXMub3JnLCBuYW1lKTtcbiAgLy8gfVxuICAvLyBsb2NXaWRlRml4ZWQoYXNzZW1ibGVyOiBJQXNzZW1ibGVyLCBuYW1lPzogc3RyaW5nKSB7XG4gIC8vICAgYXNzZW1ibGVyLnNlZ21lbnQodGhpcy5zZWdtZW50LCBoZXgodGhpcy5zZWcgXiAxKSwgJ2ZlJywgJ2ZmJyk7XG4gIC8vICAgYXNzZW1ibGVyLm9yZyh0aGlzLm9yZywgbmFtZSk7XG4gIC8vIH1cbn1cblxuaW50ZXJmYWNlIElBc3NlbWJsZXIge1xuICBzZWdtZW50KC4uLnM6IHN0cmluZ1tdKTogdm9pZDtcbiAgb3JnKG86IG51bWJlciwgbj86IHN0cmluZyk6IHZvaWQ7XG4gIGZyZWUoc2l6ZTogbnVtYmVyKTogdm9pZDtcbiAgcmVsb2MobmFtZT86IHN0cmluZyk6IHZvaWQ7XG4gIGxhYmVsKG5hbWU6IHN0cmluZyk6IHZvaWQ7XG4gIGV4cG9ydChuYW1lOiBzdHJpbmcpOiB2b2lkO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gZnJlZShhOiBJQXNzZW1ibGVyLCBzZWc6IFNlZ21lbnQsIHN0YXJ0OiBudW1iZXIsIGVuZDogbnVtYmVyKSB7XG4gIGEuc2VnbWVudChzZWcubmFtZSk7XG4gIGEub3JnKHN0YXJ0KTtcbiAgYS5mcmVlKGVuZCAtIHN0YXJ0KTtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIHJlbG9jRXhwb3J0TGFiZWwoYTogSUFzc2VtYmxlciwgc2VnOiBTZWdtZW50W10sIG5hbWU6IHN0cmluZykge1xuICBhLnNlZ21lbnQoLi4uc2VnLm1hcChzID0+IHMubmFtZSkpO1xuICBhLnJlbG9jKG5hbWUpO1xuICBhLmxhYmVsKG5hbWUpO1xuICBhLmV4cG9ydChuYW1lKTtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGNsb25lQXJyYXk8VCBleHRlbmRzIFJlYWRvbmx5QXJyYXk8YW55Pj4oYXJyOiBUKTogTXV0YWJsZTxUPiB7XG4gIHJldHVybiBbLi4uYXJyXSBhcyBNdXRhYmxlPFQ+O1xufVxuIl19