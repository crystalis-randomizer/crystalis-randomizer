const ITEMS = new Map([
    ['Sword of Wind', ['Sord of Wind', 'Sowrd of Wind', 'Sword of Wien']],
    ['Sword of Fire', ['Sword of Frirer']],
    ['Sword of Water', ['Horde of Otters']],
    ['Sword of Thunder', ['Sorg of Chunker']],
    ['Flame Bracelet', ['Fame Bracelet']],
    ['Storm Bracelet', ['Stom Bracelet']],
    ['Sacred Shield', ['Scared Shield']],
    ['Bow of Truth', ['Bow of Strewth']],
    ['Statue of Onyx', ['Statue of Onxy']],
    ['Ivory Statue', ['Ivory Statute']],
    ['Fog Lamp', ['Frog Lamp', 'Smog Lamp', 'Dog Lamp', 'Bog Lamp', 'Fog Lump']],
    ['Glowing Lamp', ['Glowing Lump']],
    ['Key to Stxy', ['Key to Styx']],
    ['Insect Flute', ['Bug Flute', 'Bug Whistle']],
    ['Flute of Lime', ['Flute of Grime']],
    ['Iron Necklace', ['I Ron Necklace']],
    ['Shield Ring', ['Sho Ring']],
    ['Deo\'s Pendant', ['Rabbit Necklace', 'Bunny Pendant']],
    ['Speed Boots', ['Hermes Sandals']],
    ['Rabbit Boots', ['Deo\'s Boots', 'Jumping Boots', 'Rabid Boots']],
    ['Alarm Flute', ['Pocket Rooster', 'Alarm Clock']],
    ['Shell Flute', ['Conch Shell', 'Dolphin Flute']],
    ['Eye Glasses', ['3D Glasses', 'X-Ray Goggles']],
    ['Kirisa Plant', ['Kilika Plant']],
    ['Refresh', ['Refresherize', 'Cure', 'Cura', 'Curaga']],
    ['Recover', ['Recoverize', 'Esuna']],
    ['Paralysis', ['Paralycize', 'Stop', 'Pew Pew']],
    ['Telepathy', ['Telepathize', 'Clairvoyance', 'ESP', 'Head Talk']],
    ['Teleport', ['Teleportate', 'Warp', 'Go']],
    ['Change', ['Changeify', 'Transform', 'Disguise']],
    ['Barrier', ['Barrierize', 'Protect', 'Wall', 'Shield']],
    ['Flight', ['Flyify', 'Blight', 'Super Jump']],
    ['Fruit of Lime', ['Fruit of Crime', 'Gold Needle', 'Soft']],
    ['Medical Herb', ['Potion', 'Hi Potion']],
    ['Fruit of Repun', ['Anti-Slime Pill', 'Maiden\'s Kiss']],
]);
const CHARACTERS = new Map([
    ['Aryllis', ['Mimic Queen']],
    ['Akahana', ['Steve', 'Jerkahana']],
    ['Asina', ['Athena']],
    ['Azteca', ['Steve']],
    ['Clark', ['Steve', 'Fred']],
    ['Deo', ['Steve']],
    ['Kelbesque', ['Linebacker']],
    ['Kensu', ['Steve', 'Jerksu']],
    ['Karmine', ['Slimelord']],
    ['Nadare', ['Steve']],
    ['Mado', ['Steve']],
    ['Rage', ['Steve']],
    ['Sabera', ['Flamelord']],
    ['Stom', ['Steve']],
    ['Tornel', ['Steve']],
    ['Zebu', ['Steve', 'Pervy Old Man']],
]);
const MONSTERS = new Map([
    ['Poison Slime', ['Mattrick Slime']],
    ['Mud Golem', ['Bear']],
    ['Axe Wereboar', ['The Axeman']],
    ['Pillbug', ['Tomato']],
    ['Ice Golem', ['Polar Bear']],
    ['Flail Guy', ['Kfal\'s Dude']],
    ['Flail Knight', ['Kfal\'s Knight']],
    ['Flying Plant', ['Obnoxious Turnip']],
    ['Beholder', ['Floating Eye']],
    ['Burt', ['Bert', 'Bort', 'Sorceror']],
    ['Mummy', ['Tornel Hugger']],
    ['Robot Sentry', ['C-3PO', 'T-1000', 'Johnny 5']],
    ['Robot Enforcer', ['ED-209', 'R2-D2', 'Agent Smith']],
    ['Robocopter', ['Cylon Drone', 'Megatron', 'Vision']],
    ['DYNA', ['GLaDOS', 'HAL-9000', 'Multivac']],
]);
export function misspell(rom, flags, random) {
    if (!flags.communityJokes())
        return;
    misspellItems(rom, flags, random);
    misspellCharacters(rom, random);
    misspellEnemies(rom, random);
}
function misspellItems(rom, flags, random) {
    if (flags.unidentifiedItems())
        return;
    if ('sphereAnalysis' in globalThis)
        return;
    const items = random.next() < 0.05 ? rom.items :
        [rom.items[random.nextInt(0x48)]];
    for (const item of items) {
        if (!item)
            continue;
        const newName = ITEMS.get(item.messageName) || [];
        const index = Math.floor(random.nextInt(3 * newName.length + 1) / 3);
        if (index < newName.length) {
            item.messageName = item.menuName = newName[index];
        }
        else if (item.messageName === item.menuName) {
            item.messageName = item.menuName = transpose(item.messageName, random);
        }
    }
}
function transpose(str, random) {
    const name = str.split('');
    const pos = random.nextInt(name.length - 1);
    if (name[pos] === ' ' || name[pos + 1] === ' ') {
        return str;
    }
    else if (name[pos].toUpperCase() === name[pos]) {
        name.splice(pos + 1, 1);
    }
    else {
        [name[pos], name[pos + 1]] = [name[pos + 1], name[pos]];
    }
    return name.join('');
}
function replaceCharacterName(rom, replaceFn) {
    for (const bank of rom.messages.parts) {
        for (const msg of bank) {
            msg.text = replaceFn(msg.text);
        }
    }
    rom.messages.personNames = rom.messages.personNames.map(replaceFn);
    replaceEnemyName(rom, replaceFn);
}
function replace(orig, newName) {
    return (text) => {
        if (!text.includes(orig))
            return text;
        return text.split(orig).join(newName);
    };
}
function replaceEnemyName(rom, replaceFn) {
    for (const obj of rom.objects) {
        if (obj.displayName)
            obj.displayName = replaceFn(obj.displayName);
    }
}
function misspellCharacters(rom, random) {
    const choices = [...CHARACTERS].flatMap(([k, vs]) => ['', ...vs, ...vs].map(v => [k, v]));
    const [orig, next] = random.pick(choices);
    const newName = next || transpose(orig, random);
    if (newName === orig)
        return;
    replaceCharacterName(rom, replace(orig, newName));
}
function misspellEnemies(rom, random) {
    for (let i = 0; i < 10; i++) {
        const [origName, choices] = random.pick([...MONSTERS]);
        const next = random.pick(['', ...choices, ...choices, ...choices]);
        const newName = next || transpose(origName, random);
        if (newName === origName)
            continue;
        replaceCharacterName(rom, replace(origName, newName));
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibWlzc3BlbGwuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi9zcmMvanMvcGFzcy9taXNzcGVsbC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFJQSxNQUFNLEtBQUssR0FBa0MsSUFBSSxHQUFHLENBQUM7SUFDbkQsQ0FBQyxlQUFlLEVBQUUsQ0FBQyxjQUFjLEVBQUUsZUFBZSxFQUFFLGVBQWUsQ0FBQyxDQUFDO0lBQ3JFLENBQUMsZUFBZSxFQUFFLENBQUMsaUJBQWlCLENBQUMsQ0FBQztJQUN0QyxDQUFDLGdCQUFnQixFQUFFLENBQUMsaUJBQWlCLENBQUMsQ0FBQztJQUN2QyxDQUFDLGtCQUFrQixFQUFFLENBQUMsaUJBQWlCLENBQUMsQ0FBQztJQUN6QyxDQUFDLGdCQUFnQixFQUFFLENBQUMsZUFBZSxDQUFDLENBQUM7SUFDckMsQ0FBQyxnQkFBZ0IsRUFBRSxDQUFDLGVBQWUsQ0FBQyxDQUFDO0lBQ3JDLENBQUMsZUFBZSxFQUFFLENBQUMsZUFBZSxDQUFDLENBQUM7SUFDcEMsQ0FBQyxjQUFjLEVBQUUsQ0FBQyxnQkFBZ0IsQ0FBQyxDQUFDO0lBQ3BDLENBQUMsZ0JBQWdCLEVBQUUsQ0FBQyxnQkFBZ0IsQ0FBQyxDQUFDO0lBQ3RDLENBQUMsY0FBYyxFQUFFLENBQUMsZUFBZSxDQUFDLENBQUM7SUFDbkMsQ0FBQyxVQUFVLEVBQUUsQ0FBQyxXQUFXLEVBQUUsV0FBVyxFQUFFLFVBQVUsRUFBRSxVQUFVLEVBQUUsVUFBVSxDQUFDLENBQUM7SUFDNUUsQ0FBQyxjQUFjLEVBQUUsQ0FBQyxjQUFjLENBQUMsQ0FBQztJQUNsQyxDQUFDLGFBQWEsRUFBRSxDQUFDLGFBQWEsQ0FBQyxDQUFDO0lBQ2hDLENBQUMsY0FBYyxFQUFFLENBQUMsV0FBVyxFQUFFLGFBQWEsQ0FBQyxDQUFDO0lBQzlDLENBQUMsZUFBZSxFQUFFLENBQUMsZ0JBQWdCLENBQUMsQ0FBQztJQUNyQyxDQUFDLGVBQWUsRUFBRSxDQUFDLGdCQUFnQixDQUFD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QUMsV0FBVyxHQUFHLElBQUksQ0FBQyxRQUFRLEdBQUcsU0FBUyxDQUFDLElBQUksQ0FBQyxXQUFXLEVBQUUsTUFBTSxDQUFDLENBQUM7U0FDeEU7S0FDRjtBQUNILENBQUM7QUFFRCxTQUFTLFNBQVMsQ0FBQyxHQUFXLEVBQUUsTUFBYztJQUM1QyxNQUFNLElBQUksR0FBRyxHQUFHLENBQUMsS0FBSyxDQUFDLEVBQUUsQ0FBQyxDQUFDO0lBQzNCLE1BQU0sR0FBRyxHQUFHLE1BQU0sQ0FBQyxPQUFPLENBQUMsSUFBSSxDQUFDLE1BQU0sR0FBRyxDQUFDLENBQUMsQ0FBQztJQUM1QyxJQUFJLElBQUksQ0FBQyxHQUFHLENBQUMsS0FBSyxHQUFHLElBQUksSUFBSSxDQUFDLEdBQUcsR0FBRyxDQUFDLENBQUMsS0FBSyxHQUFHLEVBQUU7UUFFOUMsT0FBTyxHQUFHLENBQUM7S0FDWjtTQUFNLElBQUksSUFBSSxDQUFDLEdBQUcsQ0FBQyxDQUFDLFdBQVcsRUFBRSxLQUFLLElBQUksQ0FBQyxHQUFHLENBQUMsRUFBRTtRQUVoRCxJQUFJLENBQUMsTUFBTSxDQUFDLEdBQUcsR0FBRyxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUM7S0FDekI7U0FBTTtRQUVMLENBQUMsSUFBSSxDQUFDLEdBQUcsQ0FBQyxFQUFFLElBQUksQ0FBQyxHQUFHLEdBQUcsQ0FBQyxDQUFDLENBQUMsR0FBRyxDQUFDLElBQUksQ0FBQyxHQUFHLEdBQUcsQ0FBQyxDQUFDLEVBQUUsSUFBSSxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUM7S0FDekQ7SUFDRCxPQUFPLElBQUksQ0FBQyxJQUFJLENBQUMsRUFBRSxDQUFDLENBQUM7QUFDdkIsQ0FBQztBQVVELFNBQVMsb0JBQW9CLENBQUMsR0FBUSxFQUFFLFNBQW9CO0lBQzFELEtBQUssTUFBTSxJQUFJLElBQUksR0FBRyxDQUFDLFFBQVEsQ0FBQyxLQUFLLEVBQUU7UUFDckMsS0FBSyxNQUFNLEdBQUcsSUFBSSxJQUFJLEVBQUU7WUFDdEIsR0FBRyxDQUFDLElBQUksR0FBRyxTQUFTLENBQUMsR0FBRyxDQUFDLElBQUksQ0FBQyxDQUFDO1NBQ2hDO0tBQ0Y7SUFDRCxHQUFHLENBQUMsUUFBUSxDQUFDLFdBQVcsR0FBRyxHQUFHLENBQUMsUUFBUSxDQUFDLFdBQVcsQ0FBQyxHQUFHLENBQUMsU0FBUyxDQUFDLENBQUM7SUFDbkUsZ0JBQWdCLENBQUMsR0FBRyxFQUFFLFNBQVMsQ0FBQyxDQUFDO0FBQ25DLENBQUM7QUFFRCxTQUFTLE9BQU8sQ0FBQyxJQUFZLEVBQUUsT0FBZTtJQUM1QyxPQUFPLENBQUMsSUFBWSxFQUFFLEVBQUU7UUFDdEIsSUFBSSxDQUFDLElBQUksQ0FBQyxRQUFRLENBQUMsSUFBSSxDQUFDO1lBQUUsT0FBTyxJQUFJLENBQUM7UUFDdEMsT0FBTyxJQUFJLENBQUMsS0FBSyxDQUFDLElBQUksQ0FBQyxDQUFDLElBQUksQ0FBQyxPQUFPLENBQUMsQ0FBQztJQUN4QyxDQUFDLENBQUM7QUFDSixDQUFDO0FBRUQsU0FBUyxnQkFBZ0IsQ0FBQyxHQUFRLEVBQUUsU0FBb0I7SUFDdEQsS0FBSyxNQUFNLEdBQUcsSUFBSSxHQUFHLENBQUMsT0FBTyxFQUFFO1FBQzdCLElBQUksR0FBRyxDQUFDLFdBQVc7WUFBRSxHQUFHLENBQUMsV0FBVyxHQUFHLFNBQVMsQ0FBQyxHQUFHLENBQUMsV0FBVyxDQUFDLENBQUM7S0FDbkU7QUFDSCxDQUFDO0FBRUQsU0FBUyxrQkFBa0IsQ0FBQyxHQUFRLEVBQUUsTUFBYztJQUdsRCxNQUFNLE9BQU8sR0FDVCxDQUFDLEdBQUcsVUFBVSxDQUFDLENBQUMsT0FBTyxDQUFDLENBQUMsQ0FBQyxDQUFDLEVBQUUsRUFBRSxDQUFDLEVBQUUsRUFBRSxDQUFDLENBQUMsRUFBRSxFQUFFLEdBQUcsRUFBRSxFQUFFLEdBQUcsRUFBRSxDQUFDLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDO0lBQzlFLE1BQU0sQ0FBQyxJQUFJLEVBQUUsSUFBSSxDQUFDLEdBQUcsTUFBTSxDQUFDLElBQUksQ0FBQyxPQUFPLENBQUMsQ0FBQztJQUMxQyxNQUFNLE9BQU8sR0FBRyxJQUFJLElBQUksU0FBUyxDQUFDLElBQUksRUFBRSxNQUFNLENBQUMsQ0FBQztJQUNoRCxJQUFJLE9BQU8sS0FBSyxJQUFJO1FBQUUsT0FBTztJQUM3QixvQkFBb0IsQ0FBQyxHQUFHLEVBQUUsT0FBTyxDQUFDLElBQUksRUFBRSxPQUFPLENBQUMsQ0FBQyxDQUFDO0FBQ3BELENBQUM7QUFFRCxTQUFTLGVBQWUsQ0FBQyxHQUFRLEVBQUUsTUFBYztJQUMvQyxLQUFLLElBQUksQ0FBQyxHQUFHLENBQUMsRUFBRSxDQUFDLEdBQUcsRUFBRSxFQUFFLENBQUMsRUFBRSxFQUFFO1FBRTNCLE1BQU0sQ0FBQyxRQUFRLEVBQUUsT0FBTyxDQUFDLEdBQUcsTUFBTSxDQUFDLElBQUksQ0FBQyxDQUFDLEdBQUcsUUFBUSxDQUFDLENBQUMsQ0FBQztRQUN2RCxNQUFNLElBQUksR0FBRyxNQUFNLENBQUMsSUFBSSxDQUFDLENBQUMsRUFBRSxFQUFFLEdBQUcsT0FBTyxFQUFFLEdBQUcsT0FBTyxFQUFFLEdBQUcsT0FBTyxDQUFDLENBQUMsQ0FBQztRQUNuRSxNQUFNLE9BQU8sR0FBRyxJQUFJLElBQUksU0FBUyxDQUFDLFFBQVEsRUFBRSxNQUFNLENBQUMsQ0FBQztRQUNwRCxJQUFJLE9BQU8sS0FBSyxRQUFRO1lBQUUsU0FBUztRQUNuQyxvQkFBb0IsQ0FBQyxHQUFHLEVBQUUsT0FBTyxDQUFDLFFBQVEsRUFBRSxPQUFPLENBQUMsQ0FBQyxDQUFDO0tBQ3ZEO0FBQ0gsQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7RmxhZ1NldH0gZnJvbSAnLi4vZmxhZ3NldC5qcyc7XG5pbXBvcnQge1JhbmRvbX0gZnJvbSAnLi4vcmFuZG9tLmpzJztcbmltcG9ydCB7Um9tfSBmcm9tICcuLi9yb20uanMnO1xuXG5jb25zdCBJVEVNUzogUmVhZG9ubHlNYXA8c3RyaW5nLCBzdHJpbmdbXT4gPSBuZXcgTWFwKFtcbiAgWydTd29yZCBvZiBXaW5kJywgWydTb3JkIG9mIFdpbmQnLCAnU293cmQgb2YgV2luZCcsICdTd29yZCBvZiBXaWVuJ11dLFxuICBbJ1N3b3JkIG9mIEZpcmUnLCBbJ1N3b3JkIG9mIEZyaXJlciddXSxcbiAgWydTd29yZCBvZiBXYXRlcicsIFsnSG9yZGUgb2YgT3R0ZXJzJ11dLFxuICBbJ1N3b3JkIG9mIFRodW5kZXInLCBbJ1Nvcmcgb2YgQ2h1bmtlciddXSxcbiAgWydGbGFtZSBCcmFjZWxldCcsIFsnRmFtZSBCcmFjZWxldCddXSxcbiAgWydTdG9ybSBCcmFjZWxldCcsIFsnU3RvbSBCcmFjZWxldCddXSxcbiAgWydTYWNyZWQgU2hpZWxkJywgWydTY2FyZWQgU2hpZWxkJ11dLFxuICBbJ0JvdyBvZiBUcnV0aCcsIFsnQm93IG9mIFN0cmV3dGgnXV0sXG4gIFsnU3RhdHVlIG9mIE9ueXgnLCBbJ1N0YXR1ZSBvZiBPbnh5J11dLFxuICBbJ0l2b3J5IFN0YXR1ZScsIFsnSXZvcnkgU3RhdHV0ZSddXSxcbiAgWydGb2cgTGFtcCcsIFsnRnJvZyBMYW1wJywgJ1Ntb2cgTGFtcCcsICdEb2cgTGFtcCcsICdCb2cgTGFtcCcsICdGb2cgTHVtcCddXSxcbiAgWydHbG93aW5nIExhbXAnLCBbJ0dsb3dpbmcgTHVtcCddXSxcbiAgWydLZXkgdG8gU3R4eScsIFsnS2V5IHRvIFN0eXgnXV0sXG4gIFsnSW5zZWN0IEZsdXRlJywgWydCdWcgRmx1dGUnLCAnQnVnIFdoaXN0bGUnXV0sXG4gIFsnRmx1dGUgb2YgTGltZScsIFsnRmx1dGUgb2YgR3JpbWUnXV0sXG4gIFsnSXJvbiBOZWNrbGFjZScsIFsnSSBSb24gTmVja2xhY2UnXV0sXG4gIFsnU2hpZWxkIFJpbmcnLCBbJ1NobyBSaW5nJ11dLFxuICBbJ0Rlb1xcJ3MgUGVuZGFudCcsIFsnUmFiYml0IE5lY2tsYWNlJywgJ0J1bm55IFBlbmRhbnQnXV0sXG4gIFsnU3BlZWQgQm9vdHMnLCBbJ0hlcm1lcyBTYW5kYWxzJ11dLFxuICBbJ1JhYmJpdCBCb290cycsIFsnRGVvXFwncyBCb290cycsICdKdW1waW5nIEJvb3RzJywgJ1JhYmlkIEJvb3RzJ11dLFxuICBbJ0FsYXJtIEZsdXRlJywgWydQb2NrZXQgUm9vc3RlcicsICdBbGFybSBDbG9jayddXSxcbiAgWydTaGVsbCBGbHV0ZScsIFsnQ29uY2ggU2hlbGwnLCAnRG9scGhpbiBGbHV0ZSddXSxcbiAgWydFeWUgR2xhc3NlcycsIFsnM0QgR2xhc3NlcycsICdYLVJheSBHb2dnbGVzJ11dLFxuICBbJ0tpcmlzYSBQbGFudCcsIFsnS2lsaWthIFBsYW50J11dLFxuICBbJ1JlZnJlc2gnLCBbJ1JlZnJlc2hlcml6ZScsICdDdXJlJywgJ0N1cmEnLCAnQ3VyYWdhJ11dLFxuICBbJ1JlY292ZXInLCBbJ1JlY292ZXJpemUnLCAnRXN1bmEnXV0sXG4gIFsnUGFyYWx5c2lzJywgWydQYXJhbHljaXplJywgJ1N0b3AnLCAnUGV3IFBldyddXSxcbiAgWydUZWxlcGF0aHknLCBbJ1RlbGVwYXRoaXplJywgJ0NsYWlydm95YW5jZScsICdFU1AnLCAnSGVhZCBUYWxrJ11dLFxuICBbJ1RlbGVwb3J0JywgWydUZWxlcG9ydGF0ZScsICdXYXJwJywgJ0dvJ11dLFxuICBbJ0NoYW5nZScsIFsnQ2hhbmdlaWZ5JywgJ1RyYW5zZm9ybScsICdEaXNndWlzZSddXSxcbiAgWydCYXJyaWVyJywgWydCYXJyaWVyaXplJywgJ1Byb3RlY3QnLCAnV2FsbCcsICdTaGllbGQnXV0sXG4gIFsnRmxpZ2h0JywgWydGbHlpZnknLCAnQmxpZ2h0JywgJ1N1cGVyIEp1bXAnXV0sXG4gIFsnRnJ1aXQgb2YgTGltZScsIFsnRnJ1aXQgb2YgQ3JpbWUnLCAnR29sZCBOZWVkbGUnLCAnU29mdCddXSxcbiAgWydNZWRpY2FsIEhlcmInLCBbJ1BvdGlvbicsICdIaSBQb3Rpb24nXV0sXG4gIFsnRnJ1aXQgb2YgUmVwdW4nLCBbJ0FudGktU2xpbWUgUGlsbCcsICdNYWlkZW5cXCdzIEtpc3MnXV0sXG5dKTtcblxuY29uc3QgQ0hBUkFDVEVSUzogUmVhZG9ubHlNYXA8c3RyaW5nLCBzdHJpbmdbXT4gPSBuZXcgTWFwKFtcbiAgWydBcnlsbGlzJywgWydNaW1pYyBRdWVlbiddXSxcbiAgWydBa2FoYW5hJywgWydTdGV2ZScsICdKZXJrYWhhbmEnXV0sXG4gIFsnQXNpbmEnLCBbJ0F0aGVuYSddXSxcbiAgWydBenRlY2EnLCBbJ1N0ZXZlJ11dLFxuICBbJ0NsYXJrJywgWydTdGV2ZScsICdGcmVkJ11dLFxuICBbJ0RlbycsIFsnU3RldmUnXV0sXG4gIFsnS2VsYmVzcXVlJywgWydMaW5lYmFja2VyJ11dLCAvLyBOT1RFOiBhbHNvIGNoYW5nZSBpbiBkaXNwbGF5TmFtZXNcbiAgWydLZW5zdScsIFsnU3RldmUnLCAnSmVya3N1J11dLFxuICBbJ0thcm1pbmUnLCBbJ1NsaW1lbG9yZCddXSxcbiAgWydOYWRhcmUnLCBbJ1N0ZXZlJ11dLFxuICBbJ01hZG8nLCBbJ1N0ZXZlJ11dLFxuICBbJ1JhZ2UnLCBbJ1N0ZXZlJ11dLFxuICBbJ1NhYmVyYScsIFsnRmxhbWVsb3JkJ11dLFxuICBbJ1N0b20nLCBbJ1N0ZXZlJ11dLFxuICBbJ1Rvcm5lbCcsIFsnU3RldmUnXV0sXG4gIFsnWmVidScsIFsnU3RldmUnLCAnUGVydnkgT2xkIE1hbiddXSxcbl0pO1xuXG5jb25zdCBNT05TVEVSUzogUmVhZG9ubHlNYXA8c3RyaW5nLCBzdHJpbmdbXT4gPSBuZXcgTWFwKFtcbiAgWydQb2lzb24gU2xpbWUnLCBbJ01hdHRyaWNrIFNsaW1lJ11dLFxuICBbJ011ZCBHb2xlbScsIFsnQmVhciddXSxcbiAgWydBeGUgV2VyZWJvYXInLCBbJ1RoZSBBeGVtYW4nXV0sXG4gIFsnUGlsbGJ1ZycsIFsnVG9tYXRvJ11dLFxuICBbJ0ljZSBHb2xlbScsIFsnUG9sYXIgQmVhciddXSxcbiAgWydGbGFpbCBHdXknLCBbJ0tmYWxcXCdzIER1ZGUnXV0sXG4gIFsnRmxhaWwgS25pZ2h0JywgWydLZmFsXFwncyBLbmlnaHQnXV0sXG4gIFsnRmx5aW5nIFBsYW50JywgWydPYm5veGlvdXMgVHVybmlwJ11dLFxuICBbJ0JlaG9sZGVyJywgWydGbG9hdGluZyBFeWUnXV0sXG4gIFsnQnVydCcsIFsnQmVydCcsICdCb3J0JywgJ1NvcmNlcm9yJ11dLFxuICBbJ011bW15JywgWydUb3JuZWwgSHVnZ2VyJ11dLFxuICBbJ1JvYm90IFNlbnRyeScsIFsnQy0zUE8nLCAnVC0xMDAwJywgJ0pvaG5ueSA1J11dLFxuICBbJ1JvYm90IEVuZm9yY2VyJywgWydFRC0yMDknLCAnUjItRDInLCAnQWdlbnQgU21pdGgnXV0sXG4gIFsnUm9ib2NvcHRlcicsIFsnQ3lsb24gRHJvbmUnLCAnTWVnYXRyb24nLCAnVmlzaW9uJ11dLFxuICBbJ0RZTkEnLCBbJ0dMYURPUycsICdIQUwtOTAwMCcsICdNdWx0aXZhYyddXSxcbl0pO1xuXG5leHBvcnQgZnVuY3Rpb24gbWlzc3BlbGwocm9tOiBSb20sIGZsYWdzOiBGbGFnU2V0LCByYW5kb206IFJhbmRvbSkge1xuICBpZiAoIWZsYWdzLmNvbW11bml0eUpva2VzKCkpIHJldHVybjtcbiAgbWlzc3BlbGxJdGVtcyhyb20sIGZsYWdzLCByYW5kb20pO1xuICBtaXNzcGVsbENoYXJhY3RlcnMocm9tLCByYW5kb20pO1xuICBtaXNzcGVsbEVuZW1pZXMocm9tLCByYW5kb20pO1xufVxuXG5mdW5jdGlvbiBtaXNzcGVsbEl0ZW1zKHJvbTogUm9tLCBmbGFnczogRmxhZ1NldCwgcmFuZG9tOiBSYW5kb20pIHtcbiAgaWYgKGZsYWdzLnVuaWRlbnRpZmllZEl0ZW1zKCkpIHJldHVybjtcbiAgaWYgKCdzcGhlcmVBbmFseXNpcycgaW4gZ2xvYmFsVGhpcykgcmV0dXJuOyAvLyBza2lwIHRoaXMgd2hlbiBhbmFseXppbmdcbiAgLy8gUGljayBhIHNpbmdsZSBpdGVtIHRvIG1pc3NwZWxsLiAgNSUgY2hhbmNlIG9mIG1pc3NwZWxsaW5nIF9ldmVyeXRoaW5nXy5cblxuICAvLyBUT0RPOiBNYXliZSBzd2FwIGl2b3J5IHN0YXR1ZSBmb3IgZmx1dGUgb2YgcmVwdW4sIGFuZCBpbnNlY3RcbiAgLy8gZmx1dGUgZm9yIGluc2VjdCBmaWd1cmluZSAob3IgbWF5YmUgbW9zcXVpdG8gaGVyYik/ICBTaG91bGQgd2VcbiAgLy8gb25seSBkbyB0aGlzIGlmIHdlJ3JlIG5vdCBzaHVmZmxpbmcgdHJhZGUtaW5zP1xuXG4gIGNvbnN0IGl0ZW1zID0gcmFuZG9tLm5leHQoKSA8IDAuMDUgPyByb20uaXRlbXMgOlxuICAgICAgW3JvbS5pdGVtc1tyYW5kb20ubmV4dEludCgweDQ4KV1dO1xuICBmb3IgKGNvbnN0IGl0ZW0gb2YgaXRlbXMpIHtcbiAgICBpZiAoIWl0ZW0pIGNvbnRpbnVlO1xuICAgIGNvbnN0IG5ld05hbWUgPSBJVEVNUy5nZXQoaXRlbS5tZXNzYWdlTmFtZSkgfHwgW107XG4gICAgLy8gVXNlIGN1c3RvbSBtaXNzcGVsbGluZyAzeCBtb3JlIG9mdGVuIHRoYW4gYSByYW5kb20gb25lXG4gICAgY29uc3QgaW5kZXggPSBNYXRoLmZsb29yKHJhbmRvbS5uZXh0SW50KDMgKiBuZXdOYW1lLmxlbmd0aCArIDEpIC8gMyk7XG4gICAgaWYgKGluZGV4IDwgbmV3TmFtZS5sZW5ndGgpIHtcbiAgICAgIC8vIFVzZSBvbmUgb2YgdGhlIGN1c3RvbSBtaXNzcGVsbGluZ3NcbiAgICAgIGl0ZW0ubWVzc2FnZU5hbWUgPSBpdGVtLm1lbnVOYW1lID0gbmV3TmFtZVtpbmRleF07XG4gICAgfSBlbHNlIGlmIChpdGVtLm1lc3NhZ2VOYW1lID09PSBpdGVtLm1lbnVOYW1lKSB7XG4gICAgICAvLyBNYWtlIGEgcmFuZG9tIGVycm9yIGJ5IHN3YXBwaW5nIHR3byBsZXR0ZXJzIG9yIGRlbGV0aW5nIG9uZSBsZXR0ZXIuXG4gICAgICBpdGVtLm1lc3NhZ2VOYW1lID0gaXRlbS5tZW51TmFtZSA9IHRyYW5zcG9zZShpdGVtLm1lc3NhZ2VOYW1lLCByYW5kb20pO1xuICAgIH1cbiAgfVxufVxuXG5mdW5jdGlvbiB0cmFuc3Bvc2Uoc3RyOiBzdHJpbmcsIHJhbmRvbTogUmFuZG9tKTogc3RyaW5nIHtcbiAgY29uc3QgbmFtZSA9IHN0ci5zcGxpdCgnJyk7XG4gIGNvbnN0IHBvcyA9IHJhbmRvbS5uZXh0SW50KG5hbWUubGVuZ3RoIC0gMSk7XG4gIGlmIChuYW1lW3Bvc10gPT09ICcgJyB8fCBuYW1lW3BvcyArIDFdID09PSAnICcpIHtcbiAgICAvLyBOb3QgbXVjaCB3ZSBjYW4gZG8gd2l0aCBhIHNwYWNlLCBzbyBqdXN0IGdpdmUgdXAuXG4gICAgcmV0dXJuIHN0cjtcbiAgfSBlbHNlIGlmIChuYW1lW3Bvc10udG9VcHBlckNhc2UoKSA9PT0gbmFtZVtwb3NdKSB7XG4gICAgLy8gRG9uJ3Qgc3dhcCB1cHBlcmNhc2UgbGV0dGVycyB3aXRoIHRoZSBvbmUgYWZ0ZXI6IGluc3RlYWQgZGVsZXRlIG5leHRcbiAgICBuYW1lLnNwbGljZShwb3MgKyAxLCAxKTtcbiAgfSBlbHNlIHtcbiAgICAvLyBTd2FwIHR3byBhZGphY2VudCBsZXR0ZXJzXG4gICAgW25hbWVbcG9zXSwgbmFtZVtwb3MgKyAxXV0gPSBbbmFtZVtwb3MgKyAxXSwgbmFtZVtwb3NdXTtcbiAgfVxuICByZXR1cm4gbmFtZS5qb2luKCcnKTtcbn1cblxuLy8gVE9ETyAtIHVwZGF0ZSB0eXBlc2NyaXB0IHZlcnNpb24vY29uZmlnXG5kZWNsYXJlIGdsb2JhbCB7XG4gIGludGVyZmFjZSBBcnJheTxUPiB7XG4gICAgZmxhdE1hcDxWPihjYjogKHZhbHVlOiBULCBpbmRleDogbnVtYmVyKSA9PiByZWFkb25seSBWW10pOiBWW107XG4gIH1cbn1cblxudHlwZSBSZXBsYWNlRm4gPSAoYXJnOiBzdHJpbmcpID0+IHN0cmluZztcbmZ1bmN0aW9uIHJlcGxhY2VDaGFyYWN0ZXJOYW1lKHJvbTogUm9tLCByZXBsYWNlRm46IFJlcGxhY2VGbikge1xuICBmb3IgKGNvbnN0IGJhbmsgb2Ygcm9tLm1lc3NhZ2VzLnBhcnRzKSB7XG4gICAgZm9yIChjb25zdCBtc2cgb2YgYmFuaykge1xuICAgICAgbXNnLnRleHQgPSByZXBsYWNlRm4obXNnLnRleHQpO1xuICAgIH1cbiAgfVxuICByb20ubWVzc2FnZXMucGVyc29uTmFtZXMgPSByb20ubWVzc2FnZXMucGVyc29uTmFtZXMubWFwKHJlcGxhY2VGbik7XG4gIHJlcGxhY2VFbmVteU5hbWUocm9tLCByZXBsYWNlRm4pO1xufVxuXG5mdW5jdGlvbiByZXBsYWNlKG9yaWc6IHN0cmluZywgbmV3TmFtZTogc3RyaW5nKTogUmVwbGFjZUZuIHtcbiAgcmV0dXJuICh0ZXh0OiBzdHJpbmcpID0+IHtcbiAgICBpZiAoIXRleHQuaW5jbHVkZXMob3JpZykpIHJldHVybiB0ZXh0O1xuICAgIHJldHVybiB0ZXh0LnNwbGl0KG9yaWcpLmpvaW4obmV3TmFtZSk7XG4gIH07XG59XG5cbmZ1bmN0aW9uIHJlcGxhY2VFbmVteU5hbWUocm9tOiBSb20sIHJlcGxhY2VGbjogUmVwbGFjZUZuKSB7XG4gIGZvciAoY29uc3Qgb2JqIG9mIHJvbS5vYmplY3RzKSB7XG4gICAgaWYgKG9iai5kaXNwbGF5TmFtZSkgb2JqLmRpc3BsYXlOYW1lID0gcmVwbGFjZUZuKG9iai5kaXNwbGF5TmFtZSk7XG4gIH1cbn1cblxuZnVuY3Rpb24gbWlzc3BlbGxDaGFyYWN0ZXJzKHJvbTogUm9tLCByYW5kb206IFJhbmRvbSkge1xuICAvLyBGbGF0dGVuIHRoZSBtYXAgc28gdGhhdCBjaGFyYWN0ZXJzIHdpdGggbW9yZSBvcHRpb25zIGdldFxuICAvLyBvdmVycmVwcmVzZW50ZWQuICBBbHNvIGFkZCBhIFwicmFuZG9tIHRyYW5zcG9zaXRpb25cIiBvcHRpb24uXG4gIGNvbnN0IGNob2ljZXM6IFtzdHJpbmcsIHN0cmluZ11bXSA9XG4gICAgICBbLi4uQ0hBUkFDVEVSU10uZmxhdE1hcCgoW2ssIHZzXSkgPT4gWycnLCAuLi52cywgLi4udnNdLm1hcCh2ID0+IFtrLCB2XSkpO1xuICBjb25zdCBbb3JpZywgbmV4dF0gPSByYW5kb20ucGljayhjaG9pY2VzKTtcbiAgY29uc3QgbmV3TmFtZSA9IG5leHQgfHwgdHJhbnNwb3NlKG9yaWcsIHJhbmRvbSk7XG4gIGlmIChuZXdOYW1lID09PSBvcmlnKSByZXR1cm47XG4gIHJlcGxhY2VDaGFyYWN0ZXJOYW1lKHJvbSwgcmVwbGFjZShvcmlnLCBuZXdOYW1lKSk7XG59XG5cbmZ1bmN0aW9uIG1pc3NwZWxsRW5lbWllcyhyb206IFJvbSwgcmFuZG9tOiBSYW5kb20pIHtcbiAgZm9yIChsZXQgaSA9IDA7IGkgPCAxMDsgaSsrKSB7XG4gICAgLy8gUGljayBhbiBlbmVteSBmaXJzdFxuICAgIGNvbnN0IFtvcmlnTmFtZSwgY2hvaWNlc10gPSByYW5kb20ucGljayhbLi4uTU9OU1RFUlNdKTtcbiAgICBjb25zdCBuZXh0ID0gcmFuZG9tLnBpY2soWycnLCAuLi5jaG9pY2VzLCAuLi5jaG9pY2VzLCAuLi5jaG9pY2VzXSk7XG4gICAgY29uc3QgbmV3TmFtZSA9IG5leHQgfHwgdHJhbnNwb3NlKG9yaWdOYW1lLCByYW5kb20pO1xuICAgIGlmIChuZXdOYW1lID09PSBvcmlnTmFtZSkgY29udGludWU7XG4gICAgcmVwbGFjZUNoYXJhY3Rlck5hbWUocm9tLCByZXBsYWNlKG9yaWdOYW1lLCBuZXdOYW1lKSk7XG4gIH1cbn1cblxuLy8gVE9ETzogbWlzc3BlbGwgbW9uc3RlcnMgKGUuZy4gZmxhaWxzIC0+IGtmYWwncyBwZW9wbGUpXG4vLyBUT0RPOiByZW5hbWUgY2hhcmFjdGVycyAoZS5nLiB0byBTdGV2ZSlcbiJdfQ==