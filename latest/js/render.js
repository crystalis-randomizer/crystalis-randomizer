import { CharacterSet } from './characters.js';
import { FlagSection, Preset } from './flagset.js';
export function renderPresets(presets) {
    let first = true;
    for (const { name, flagString, description } of Preset.all()) {
        const h2 = document.createElement('h2');
        h2.textContent = name;
        presets.appendChild(h2);
        const p = document.createElement('p');
        p.innerHTML = description;
        presets.appendChild(p);
        const apply = document.createElement('a');
        apply.textContent = flagString;
        apply.classList.add('button');
        apply.classList.add('preset-flags');
        apply.dataset['flags'] = flagString;
        if (flagString.length > 48)
            apply.classList.add('small');
        if (first)
            apply.dataset['defaultPreset'] = 'true';
        first = false;
        presets.appendChild(apply);
    }
}
export function renderOptions(options) {
    for (const { name, description, flags } of FlagSection.all()) {
        const h2 = document.createElement('h2');
        h2.textContent = name;
        options.appendChild(h2);
        if (description) {
            const p = document.createElement('p');
            p.innerHTML = description;
            options.appendChild(p);
        }
        const div = document.createElement('div');
        div.classList.add('flag-list');
        options.appendChild(div);
        for (const flagObj of flags.values()) {
            const { flag, opts: { hard, name, text } } = flagObj;
            const flagDiv = document.createElement('div');
            flagDiv.textContent = `${flag}: ${name}`;
            flagDiv.classList.add('checkbox');
            if (hard)
                flagDiv.classList.add('hard');
            if (text) {
                const textDiv = document.createElement('div');
                textDiv.classList.add('flag-body');
                textDiv.innerHTML = text;
                flagDiv.appendChild(textDiv);
            }
            div.appendChild(flagDiv);
        }
    }
}
export function renderCharacters(options) {
    const simeaReplacements = CharacterSet.simea();
    for (const { name, image, chrData, description } of simeaReplacements.values()) {
        const container = document.createElement('div');
        container.className = "flex-row";
        container.style.width = '100%';
        const input = document.createElement('input');
        input.type = 'radio';
        input.name = 'simea-replacement';
        input.id = `simea-replacement-${name}`;
        input.value = name;
        input.style.display = 'none';
        if (chrData.length == 0) {
            input.checked = true;
        }
        container.appendChild(input);
        const label = document.createElement('label');
        label.className = "sprite-replacement";
        label.htmlFor = `simea-replacement-${name}`;
        const img = document.createElement('img');
        img.src = image;
        img.style.float = "left";
        label.appendChild(img);
        const title = document.createElement('div');
        title.textContent = name;
        title.className = "title";
        label.appendChild(title);
        if (description) {
            const desc = document.createElement('div');
            desc.innerHTML = description;
            desc.className = "desc";
            label.appendChild(desc);
        }
        container.appendChild(label);
        options.appendChild(container);
    }
}
export function renderRaceFlags(options, flagset) {
    for (const { name, description, flags } of FlagSection.all()) {
        let any = false;
        const h2 = document.createElement('h2');
        h2.textContent = name;
        const p = description ? document.createElement('p') : null;
        if (p)
            p.innerHTML = description;
        const div = document.createElement('div');
        div.classList.add('flag-list');
        for (const flagObj of flags.values()) {
            const { flag, opts: { hard, name, text } } = flagObj;
            if (!flagset.check(flagObj))
                continue;
            any = true;
            const flagDiv = document.createElement('div');
            flagDiv.textContent = `${flag}: ${name}`;
            flagDiv.classList.add('checkbox');
            if (hard)
                flagDiv.classList.add('hard');
            if (text) {
                const textDiv = document.createElement('div');
                textDiv.classList.add('flag-body');
                textDiv.innerHTML = text;
                flagDiv.appendChild(textDiv);
            }
            div.appendChild(flagDiv);
        }
        if (any) {
            options.appendChild(h2);
            if (p)
                options.appendChild(p);
            options.appendChild(div);
        }
    }
}
;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicmVuZGVyLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vc3JjL2pzL3JlbmRlci50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFFQSxPQUFPLEVBQUUsWUFBWSxFQUFFLE1BQU0saUJBQWlCLENBQUM7QUFDL0MsT0FBTyxFQUFDLFdBQVcsRUFBVyxNQUFNLEVBQUMsTUFBTSxjQUFjLENBQUM7QUFFMUQsTUFBTSxVQUFVLGFBQWEsQ0FBQyxPQUFvQjtJQUNoRCxJQUFJLEtBQUssR0FBRyxJQUFJLENBQUM7SUFDakIsS0FBSyxNQUFNLEVBQUMsSUFBSSxFQUFFLFVBQVUsRUFBRSxXQUFXLEVBQUMsSUFBSSxNQUFNLENBQUMsR0FBRyxFQUFFLEVBQUU7UUFDMUQsTUFBTSxFQUFFLEdBQUcsUUFBUSxDQUFDLGFBQWEsQ0FBQyxJQUFJLENBQUMsQ0FBQztRQUN4QyxFQUFFLENBQUMsV0FBVyxHQUFHLElBQUksQ0FBQztRQUN0QixPQUFPLENBQUMsV0FBVyxDQUFDLEVBQUUsQ0FBQyxDQUFDO1FBQ3hCLE1BQU0sQ0FBQyxHQUFHLFFBQVEsQ0FBQyxhQUFhLENBQUMsR0FBRyxDQUFDLENBQUM7UUFDdEMsQ0FBQyxDQUFDLFNBQVMsR0FBRyxXQUFXLENBQUM7UUFDMUIsT0FBTyxDQUFDLFdBQVcsQ0FBQyxDQUFDLENBQUMsQ0FBQztRQVF2QixNQUFNLEtBQUssR0FBRyxRQUFRLENBQUMsYUFBYSxDQUFDLEdBQUcsQ0FBQyxDQUFDO1FBQzFDLEtBQUssQ0FBQyxXQUFXLEdBQUcsVUFBVSxDQUFDO1FBQy9CLEtBQUssQ0FBQyxTQUFTLENBQUMsR0FBRyxDQUFDLFFBQVEsQ0FBQyxDQUFDO1FBQzlCLEtBQUssQ0FBQyxTQUFTLENBQUMsR0FBRyxDQUFDLGNBQWMsQ0FBQyxDQUFDO1FBQ3BDLEtBQUssQ0FBQyxPQUFPLENBQUMsT0FBTyxDQUFDLEdBQUcsVUFBVSxDQUFDO1FBQ3BDLElBQUksVUFBVSxDQUFDLE1BQU0sR0FBRyxFQUFFO1lBQUUsS0FB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T0FBTyxHQUFHLFFBQVEsQ0FBQyxhQUFhLENBQUMsS0FBSyxDQUFDLENBQUM7WUFDOUMsT0FBTyxDQUFDLFdBQVcsR0FBRyxHQUFHLElBQUksS0FBSyxJQUFJLEVBQUUsQ0FBQztZQUN6QyxPQUFPLENBQUMsU0FBUyxDQUFDLEdBQUcsQ0FBQyxVQUFVLENBQUMsQ0FBQztZQUNsQyxJQUFJLElBQUk7Z0JBQUUsT0FBTyxDQUFDLFNBQVMsQ0FBQyxHQUFHLENBQUMsTUFBTSxDQUFDLENBQUM7WUFDeEMsSUFBSSxJQUFJLEVBQUU7Z0JBQ1IsTUFBTSxPQUFPLEdBQUcsUUFBUSxDQUFDLGFBQWEsQ0FBQyxLQUFLLENBQUMsQ0FBQztnQkFDOUMsT0FBTyxDQUFDLFNBQVMsQ0FBQyxHQUFHLENBQUMsV0FBVyxDQUFDLENBQUM7Z0JBQ25DLE9BQU8sQ0FBQyxTQUFTLEdBQUcsSUFBSSxDQUFDO2dCQUN6QixPQUFPLENBQUMsV0FBVyxDQUFDLE9BQU8sQ0FBQyxDQUFDO2FBQzlCO1lBQ0QsR0FBRyxDQUFDLFdBQVcsQ0FBQyxPQUFPLENBQUMsQ0FBQztTQUMxQjtRQUNELElBQUksR0FBRyxFQUFFO1lBQ1AsT0FBTyxDQUFDLFdBQVcsQ0FBQyxFQUFFLENBQUMsQ0FBQztZQUN4QixJQUFJLENBQUM7Z0JBQUUsT0FBTyxDQUFDLFdBQVcsQ0FBQyxDQUFDLENBQUMsQ0FBQztZQUM5QixPQUFPLENBQUMsV0FBVyxDQUFDLEdBQUcsQ0FBQyxDQUFDO1NBQzFCO0tBQ0Y7QUFDSCxDQUFDO0FBQUEsQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbIi8vIFV0aWxpdGllcyBmb3IgcmVuZGVyaW5nIGZsYWdzLlxuXG5pbXBvcnQgeyBDaGFyYWN0ZXJTZXQgfSBmcm9tICcuL2NoYXJhY3RlcnMuanMnO1xuaW1wb3J0IHtGbGFnU2VjdGlvbiwgRmxhZ1NldCwgUHJlc2V0fSBmcm9tICcuL2ZsYWdzZXQuanMnO1xuXG5leHBvcnQgZnVuY3Rpb24gcmVuZGVyUHJlc2V0cyhwcmVzZXRzOiBIVE1MRWxlbWVudCkge1xuICBsZXQgZmlyc3QgPSB0cnVlO1xuICBmb3IgKGNvbnN0IHtuYW1lLCBmbGFnU3RyaW5nLCBkZXNjcmlwdGlvbn0gb2YgUHJlc2V0LmFsbCgpKSB7XG4gICAgY29uc3QgaDIgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdoMicpO1xuICAgIGgyLnRleHRDb250ZW50ID0gbmFtZTtcbiAgICBwcmVzZXRzLmFwcGVuZENoaWxkKGgyKTtcbiAgICBjb25zdCBwID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgncCcpO1xuICAgIHAuaW5uZXJIVE1MID0gZGVzY3JpcHRpb247IC8vIE5PVEU6IG1haW5seSBmb3IgaXRhbGljcyBhbmQgYm9sZFxuICAgIHByZXNldHMuYXBwZW5kQ2hpbGQocCk7XG4gICAgLy9jb25zdCBkaXYgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcbiAgICAvL2Rpdi5jbGFzc0xpc3QuYWRkKCdmbGV4LXJvdycpO1xuICAgIC8vcHJlc2V0cy5hcHBlbmRDaGlsZChkaXYpO1xuICAgIC8vY29uc3QgZmxhZ0RpdiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xuICAgIC8vZmxhZ0Rpdi50ZXh0Q29udGVudCA9IGZsYWdzO1xuICAgIC8vZmxhZ0Rpdi5jbGFzc0xpc3QuYWRkKCdwcmVzZXQtZmxhZ3MnKTtcbiAgICAvL2Rpdi5hcHBlbmRDaGlsZChmbGFnRGl2KTtcbiAgICBjb25zdCBhcHBseSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2EnKTtcbiAgICBhcHBseS50ZXh0Q29udGVudCA9IGZsYWdTdHJpbmc7IC8vJ0FwcGx5JztcbiAgICBhcHBseS5jbGFzc0xpc3QuYWRkKCdidXR0b24nKTtcbiAgICBhcHBseS5jbGFzc0xpc3QuYWRkKCdwcmVzZXQtZmxhZ3MnKTtcbiAgICBhcHBseS5kYXRhc2V0WydmbGFncyddID0gZmxhZ1N0cmluZztcbiAgICBpZiAoZmxhZ1N0cmluZy5sZW5ndGggPiA0OCkgYXBwbHkuY2xhc3NMaXN0LmFkZCgnc21hbGwnKTtcbiAgICBpZiAoZmlyc3QpIGFwcGx5LmRhdGFzZXRbJ2RlZmF1bHRQcmVzZXQnXSA9ICd0cnVlJztcbiAgICBmaXJzdCA9IGZhbHNlO1xuICAgIHByZXNldHMuYXBwZW5kQ2hpbGQoYXBwbHkpO1xuICB9XG59XG5cbmV4cG9ydCBmdW5jdGlvbiByZW5kZXJPcHRpb25zKG9wdGlvbnM6IEhUTUxFbGVtZW50KSB7XG4gIGZvciAoY29uc3Qge25hbWUsIGRlc2NyaXB0aW9uLCBmbGFnc30gb2YgRmxhZ1NlY3Rpb24uYWxsKCkpIHtcbiAgICBjb25zdCBoMiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2gyJyk7XG4gICAgaDIudGV4dENvbnRlbnQgPSBuYW1lO1xuXG4gICAgb3B0aW9ucy5hcHBlbmRDaGlsZChoMik7XG4gICAgaWYgKGRlc2NyaXB0aW9uKSB7XG4gICAgICBjb25zdCBwID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgncCcpO1xuICAgICAgcC5pbm5lckhUTUwgPSBkZXNjcmlwdGlvbjsgLy8gTk9URTogbWFpbmx5IGZvciBpdGFsaWNzIGFuZCBib2xkXG4gICAgICBvcHRpb25zLmFwcGVuZENoaWxkKHApO1xuICAgIH1cbiAgICBjb25zdCBkaXYgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcbiAgICBkaXYuY2xhc3NMaXN0LmFkZCgnZmxhZy1saXN0Jyk7XG4gICAgb3B0aW9ucy5hcHBlbmRDaGlsZChkaXYpO1xuICAgIGZvciAoY29uc3QgZmxhZ09iaiBvZiBmbGFncy52YWx1ZXMoKSkge1xuICAgICAgY29uc3Qge2ZsYWcsIG9wdHM6IHtoYXJkLCBuYW1lLCB0ZXh0fX0gPSBmbGFnT2JqO1xuICAgICAgY29uc3QgZmxhZ0RpdiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xuICAgICAgZmxhZ0Rpdi50ZXh0Q29udGVudCA9IGAke2ZsYWd9OiAke25hbWV9YDtcbiAgICAgIGZsYWdEaXYuY2xhc3NMaXN0LmFkZCgnY2hlY2tib3gnKTtcbiAgICAgIGlmIChoYXJkKSBmbGFnRGl2LmNsYXNzTGlzdC5hZGQoJ2hhcmQnKTtcbiAgICAgIGlmICh0ZXh0KSB7XG4gICAgICAgIGNvbnN0IHRleHREaXYgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcbiAgICAgICAgdGV4dERpdi5jbGFzc0xpc3QuYWRkKCdmbGFnLWJvZHknKTtcbiAgICAgICAgdGV4dERpdi5pbm5lckhUTUwgPSB0ZXh0O1xuICAgICAgICBmbGFnRGl2LmFwcGVuZENoaWxkKHRleHREaXYpO1xuICAgICAgfVxuICAgICAgZGl2LmFwcGVuZENoaWxkKGZsYWdEaXYpO1xuICAgIH1cbiAgfVxufVxuXG5leHBvcnQgZnVuY3Rpb24gcmVuZGVyQ2hhcmFjdGVycyhvcHRpb25zOiBIVE1MRWxlbWVudCkge1xuICBjb25zdCBzaW1lYVJlcGxhY2VtZW50cyA9IENoYXJhY3RlclNldC5zaW1lYSgpO1xuICBmb3IgKGNvbnN0IHtuYW1lLCBpbWFnZSwgY2hyRGF0YSwgZGVzY3JpcHRpb259IG9mIHNpbWVhUmVwbGFjZW1lbnRzLnZhbHVlcygpKSB7XG4gICAgY29uc3QgY29udGFpbmVyID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XG4gICAgY29udGFpbmVyLmNsYXNzTmFtZSA9IFwiZmxleC1yb3dcIjtcbiAgICBjb250YWluZXIuc3R5bGUud2lkdGggPSAnMTAwJSc7XG4gICAgY29uc3QgaW5wdXQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdpbnB1dCcpO1xuICAgIGlucHV0LnR5cGUgPSAncmFkaW8nO1xuICAgIGlucHV0Lm5hbWUgPSAnc2ltZWEtcmVwbGFjZW1lbnQnXG4gICAgaW5wdXQuaWQgPSBgc2ltZWEtcmVwbGFjZW1lbnQtJHtuYW1lfWA7XG4gICAgaW5wdXQudmFsdWUgPSBuYW1lO1xuICAgIGlucHV0LnN0eWxlLmRpc3BsYXkgPSAnbm9uZSc7XG4gICAgaWYgKGNockRhdGEubGVuZ3RoID09IDApIHtcbiAgICAgIGlucHV0LmNoZWNrZWQgPSB0cnVlO1xuICAgIH1cbiAgICBjb250YWluZXIuYXBwZW5kQ2hpbGQoaW5wdXQpO1xuICAgIGNvbnN0IGxhYmVsID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnbGFiZWwnKTtcbiAgICBsYWJlbC5jbGFzc05hbWUgPSBcInNwcml0ZS1yZXBsYWNlbWVudFwiO1xuICAgIGxhYmVsLmh0bWxGb3IgPSBgc2ltZWEtcmVwbGFjZW1lbnQtJHtuYW1lfWA7XG4gICAgY29uc3QgaW1nID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnaW1nJyk7XG4gICAgaW1nLnNyYyA9IGltYWdlO1xuICAgIGltZy5zdHlsZS5mbG9hdCA9IFwibGVmdFwiO1xuICAgIGxhYmVsLmFwcGVuZENoaWxkKGltZyk7XG5cbiAgICBjb25zdCB0aXRsZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xuICAgIHRpdGxlLnRleHRDb250ZW50ID0gbmFtZTtcbiAgICB0aXRsZS5jbGFzc05hbWUgPSBcInRpdGxlXCI7XG4gICAgbGFiZWwuYXBwZW5kQ2hpbGQodGl0bGUpO1xuXG4gICAgaWYgKGRlc2NyaXB0aW9uKSB7XG4gICAgICBjb25zdCBkZXNjID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XG4gICAgICBkZXNjLmlubmVySFRNTCA9IGRlc2NyaXB0aW9uOyAvLyBOT1RFOiBtYWlubHkgZm9yIGl0YWxpY3MgYW5kIGJvbGRcbiAgICAgIGRlc2MuY2xhc3NOYW1lID0gXCJkZXNjXCI7XG4gICAgICBsYWJlbC5hcHBlbmRDaGlsZChkZXNjKTtcbiAgICB9XG4gICAgY29udGFpbmVyLmFwcGVuZENoaWxkKGxhYmVsKTtcbiAgICBvcHRpb25zLmFwcGVuZENoaWxkKGNvbnRhaW5lcik7XG4gIH1cbn1cblxuZXhwb3J0IGZ1bmN0aW9uIHJlbmRlclJhY2VGbGFncyhvcHRpb25zOiBIVE1MRWxlbWVudCwgZmxhZ3NldDogRmxhZ1NldCkge1xuICBmb3IgKGNvbnN0IHtuYW1lLCBkZXNjcmlwdGlvbiwgZmxhZ3N9IG9mIEZsYWdTZWN0aW9uLmFsbCgpKSB7XG4gICAgbGV0IGFueSA9IGZhbHNlO1xuICAgIGNvbnN0IGgyID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnaDInKTtcbiAgICBoMi50ZXh0Q29udGVudCA9IG5hbWU7XG4gICAgY29uc3QgcCA9IGRlc2NyaXB0aW9uID8gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgncCcpIDogbnVsbDtcbiAgICBpZiAocCkgcC5pbm5lckhUTUwgPSBkZXNjcmlwdGlvbiE7IC8vIE5PVEU6IG1haW5seSBmb3IgaXRhbGljcyBhbmQgYm9sZFxuICAgIGNvbnN0IGRpdiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xuICAgIGRpdi5jbGFzc0xpc3QuYWRkKCdmbGFnLWxpc3QnKTtcbiAgICBmb3IgKGNvbnN0IGZsYWdPYmogb2YgZmxhZ3MudmFsdWVzKCkpIHtcbiAgICAgIGNvbnN0IHtmbGFnLCBvcHRzOiB7aGFyZCwgbmFtZSwgdGV4dH19ID0gZmxhZ09iajtcbiAgICAgIGlmICghZmxhZ3NldC5jaGVjayhmbGFnT2JqKSkgY29udGludWU7XG4gICAgICBhbnkgPSB0cnVlO1xuICAgICAgY29uc3QgZmxhZ0RpdiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xuICAgICAgZmxhZ0Rpdi50ZXh0Q29udGVudCA9IGAke2ZsYWd9OiAke25hbWV9YDtcbiAgICAgIGZsYWdEaXYuY2xhc3NMaXN0LmFkZCgnY2hlY2tib3gnKTtcbiAgICAgIGlmIChoYXJkKSBmbGFnRGl2LmNsYXNzTGlzdC5hZGQoJ2hhcmQnKTtcbiAgICAgIGlmICh0ZXh0KSB7XG4gICAgICAgIGNvbnN0IHRleHREaXYgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcbiAgICAgICAgdGV4dERpdi5jbGFzc0xpc3QuYWRkKCdmbGFnLWJvZHknKTtcbiAgICAgICAgdGV4dERpdi5pbm5lckhUTUwgPSB0ZXh0O1xuICAgICAgICBmbGFnRGl2LmFwcGVuZENoaWxkKHRleHREaXYpO1xuICAgICAgfVxuICAgICAgZGl2LmFwcGVuZENoaWxkKGZsYWdEaXYpO1xuICAgIH1cbiAgICBpZiAoYW55KSB7XG4gICAgICBvcHRpb25zLmFwcGVuZENoaWxkKGgyKTtcbiAgICAgIGlmIChwKSBvcHRpb25zLmFwcGVuZENoaWxkKHApO1xuICAgICAgb3B0aW9ucy5hcHBlbmRDaGlsZChkaXYpO1xuICAgIH1cbiAgfVxufTtcbiJdfQ==