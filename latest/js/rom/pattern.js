import { Entity } from './entity.js';
import { reverseBits, seq, tuple } from './util.js';
export class Pattern extends Entity {
    constructor(rom, id, pixels) {
        super(rom, id);
        this.pixels = pixels || tuple(rom.chr, id << 4, 16);
    }
    pixelAt(y, x) {
        return (this.pixels[y | 8] >> x & 1) << 1 | (this.pixels[y] >> x & 1);
    }
    flipH() {
        return new Pattern(this.rom, -1, this.pixels.map(reverseBits));
    }
    flipV() {
        return new Pattern(this.rom, -1, seq(16, y => this.pixels[y & 8 | ~y & 7]));
    }
    flip(type) {
        let p = this;
        if (type & Flip.HORIZONTAL)
            p = p.flipH();
        if (type & Flip.VERTICAL)
            p = p.flipV();
        return p;
    }
    write() {
        const a = this.id << 4;
        this.rom.chr.subarray(a, a + 16).set(this.pixels);
        return [];
    }
}
export class Patterns {
    constructor(rom) {
        this._all = [];
        this._all = seq(rom.chr.length >> 4, i => new Pattern(rom, i));
    }
    get(page, tile_idx) {
        if (!tile_idx) {
            return this._all[page];
        }
        return this._all[page | tile_idx];
    }
    set(page, tile_idx, pixels) {
        this._all[page | tile_idx].pixels = pixels;
    }
    [Symbol.iterator]() {
        return this._all[Symbol.iterator]();
    }
}
Patterns.HUD_LF = parsePattern(`
    |L     ..|
    |L.    .#|
    |L.  FF.#|
    |L.  F..#|
    |LLL FF.#|
    | ...F..#|
    |    F ..|
    |    .   |
  `, { ' ': 2, 'L': 1, 'F': 1, '#': 1, '.': 3 });
Patterns.HUD_PW = parsePattern(`
    |PPP     |
    |P..P.   |
    |PPP.    |
    |P..     |
    |P.w.w.w |
    | .w.w.w |
    |  .w.w. |
    |   . .  |
  `, { ' ': 2, 'P': 1, 'w': 1, '.': 3 });
Patterns.HUD_EY = parsePattern(`
    |EEE     |
    |E...    |
    |EEE Y.Y.|
    |E...Y.Y.|
    |EEE  Y. |
    | ... Y. |
    |     Y. |
    |        |
  `, { ' ': 2, 'E': 1, 'Y': 1, '#': 1, '.': 3 });
Patterns.HUD_LV = parsePattern(`
    |        |
    |L       |
    |L.      |
    |L.  v.v.|
    |L.  v.v.|
    |LLL  v. |
    | ... v. |
    |     .  |
  `, { ' ': 2, 'L': 1, 'v': 1, '.': 3 });
Patterns.HUD_DL = parsePattern(`
    |        |
    |DD      |
    |D.D.L   |
    |D.D.L.  |
    |D.D.L.  |
    |DD. L.  |
    | .  LLL |
    |     ...|
  `, { ' ': 2, 'D': 1, 'L': 1, '.': 3 });
Patterns.HUD_MP = parsePattern(`
    |M.  M   |
    |MM.MM.  |
    |M.M.M.  |
    |M. .PPP |
    |M. .P..P|
    |    PPP.|
    |    P.. |
    |    P.  |
  `, { ' ': 2, 'M': 1, 'P': 1, '.': 3 });
Patterns.HUD_EX = parsePattern(`
    |EEE     |
    |E...    |
    |EEE     |
    |E...    |
    |EEE x.x.|
    | ... x. |
    |    x.x.|
    |     . .|
  `, { ' ': 2, 'E': 1, 'x': 1, '.': 3 });
Patterns.HUD_CLOSE_RIGHT = parsePattern(`
    |________|
    |____oooo|
    |____o...|
    |__ooo...|
    |__o....o|
    |__o....o|
    |__o..oo |
    |__o..o  |
  `, { ' ': 0, '.': 1, '_': 2, 'o': 3 });
Patterns.HUD_CLOSE_LEFT = parsePattern(`
    |________|
    |oooo____|
    |...o____|
    |...ooo__|
    |o....o__|
    |o....o__|
    | oo..o__|
    |  o..o__|
  `, { ' ': 0, '.': 1, '_': 2, 'o': 3 });
function parsePattern(data, key) {
    const text = data.trim().replace(/^[^|]*\||\|[^|]*$/mg, '').replace(/\n/g, '');
    if (text.length !== 64)
        throw new Error(`Bad CHR tile: ${text}`);
    const arr = new Array(16).fill(0);
    for (let i = 0, c = ''; c = text.charAt(i); ++i) {
        const off = i >>> 3;
        const lo = off;
        const hi = off | 8;
        const col = ~i & 7;
        const val = key[c] || 0;
        if (val & 1) {
            arr[lo] |= 1 << col;
        }
        if (val & 2) {
            arr[hi] |= 1 << col;
        }
    }
    return arr;
}
export var Flip;
(function (Flip) {
    Flip[Flip["HORIZONTAL"] = 64] = "HORIZONTAL";
    Flip[Flip["VERTICAL"] = 128] = "VERTICAL";
})(Flip || (Flip = {}));
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicGF0dGVybi5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3NyYy9qcy9yb20vcGF0dGVybi50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFFQSxPQUFPLEVBQUMsTUFBTSxFQUFDLE1BQU0sYUFBYSxDQUFDO0FBQ25DLE9BQU8sRUFBQyxXQUFXLEVBQUUsR0FBRyxFQUFFLEtBQUssRUFBQyxNQUFNLFdBQVcsQ0FBQztBQUVsRCxNQUFNLE9BQU8sT0FBUSxTQUFRLE1BQU07SUFJakMsWUFBWSxHQUFRLEVBQUUsRUFBVSxFQUFFLE1BQWlCO1FBQ2pELEtBQUssQ0FBQyxHQUFHLEVBQUUsRUFBRSxDQUFDLENBQUM7UUFDZixJQUFJLENBQUMsTUFBTSxHQUFHLE1BQU0sSUFBSSxLQUFLLENBQUMsR0FBRyxDQUFDLEdBQUcsRUFBRSxFQUFFLElBQUksQ0FBQyxFQUFFLEVBQUUsQ0FBQyxDQUFDO0lBQ3RELENBQUM7SUFHRCxPQUFPLENBQUMsQ0FBUyxFQUFFLENBQVM7UUFDMUIsT0FBTyxDQUFDLElBQUksQ0FBQyxNQUFNLENBQUMsQ0FBQyxHQUFHLENBQUMsQ0FBQyxJQUFJLENBQUMsR0FBRyxDQUFDLENBQUMsSUFBSSxDQUFDLEdBQUcsQ0FBQyxJQUFJLENBQUMsTUFBTSxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQztJQUN4RSxDQUFDO0lBRUQsS0FBSztRQUNILE9BQU8sSUFBSSxPQUFPLENBQUMsSUFBSSxDQUFDLEdBQUcsRUFBRSxDQUFDLENBQUMsRUFBRSxJQUFJLENBQUMsTUFBTSxDQUFDLEdBQUcsQ0FBQyxXQUFXLENBQUMsQ0FBQyxDQUFDO0lBQ2pFLENBQUM7SUFFRCxLQUFLO1FBQ0gsT0FBTyxJQUFJLE9BQU8sQ0FBQyxJQUFJLENBQUMsR0FBRyxFQUFFLENBQUMsQ0FBQyxFQUFFLEdBQUcsQ0FBQyxFQUFFLEVBQUUsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxJQUFJLENBQUMsTUFBTSxDQUFDLENBQUMsR0FBRyxDQUFDLEdBQUcsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDO0lBQzlFLENBQUM7SUFFRCxJQUFJLENBQUMsSUFBVTtRQUNiLElBQUksQ0FBQyxHQUFZLElBQUksQ0FBQztRQUN0QixJQUFJLElBQUksR0FBRyxJQUFJLENBQUMsVUFBVTtZQUFFLENBQUMsR0FBRyxDQUFDLENBQUMsS0FBSyxFQUFFLENBQUM7UUFDMUMsSUFBSSxJQUFJLEdBQUcsSUFBSSxDQUFDLFFBQVE7WUFBRSxDQUFDLEdBQUcsQ0FBQyxDQUFDLEtBQUssRUFBRSxDQUFDO1FBQ3hDLE9BQU8sQ0FBQyxDQUFDO0lBQ1gsQ0FBQztJQUVELEtBQUs7UUFFSCxNQUFNLENBQUMsR0FBRyxJQUFJLENBQUMsRUFBRSxJQUFJLENBQUMsQ0FBQztRQUN2QixJQUFJLENBQUMsR0FBRyxDQUFDLEdBQUcsQ0FBQyxRQUFRLENBQUMsQ0FBQyxFQUFFLENBQUMsR0FBRyxFQUFFLENBQUMsQ0FBQyxHQUFHLENBQUMsSUFBSSxDQUFDLE1BQU0sQ0FBQyxDQUFDO1FBQ2xELE9BQU8sRUFBRSxDQUFDO0lBQ1osQ0FBQztDQUNGO0FBRTJCLE1BQU0sT0FBTyxRQUFRO0lBYy9DLFlBQVksR0FBUTtRQWJaLFNBQUksR0FBYyxFQUFFLENBQUM7UUFjM0IsSUFBSSxDQUFDLElBQUksR0FBRyxHQUFHLENBQUMsR0FBRyxDQUFDLEdBQUcsQ0FBQyxNQUFNLElBQUksQ0FBQyxFQUFFLENBQUMsQ0FBQyxFQUFFLENBQUMsSUFBSSxPQUFPLENBQUMsR0FBRyxFQUFFLENBQUMsQ0FBQyxDQUFDLENBQUM7SUFDakUsQ0FBQztJQWJELEdBQUcsQ0FBQyxJQUFZLEVBQUUsUUFBaUI7UUFDakMsSUFBSSxDQUFDLFFBQVEsRUFBRTtZQUNiLE9BQU8sSUFBSSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQztTQUN4QjtRQUNELE9BQU8sSUFBSSxDQUFDLElBQUksQ0FBQyxJQUFJLEdBQUcsUUFBUSxDQUFDLENBQUM7SUFDcEMsQ0FBQztJQUVELEdBQUcsQ0FBQyxJQUFZLEVBQUUsUUFBZ0IsRUFBRSxNQUFnQjtRQUNsRCxJQUFJLENBQUMsSUFBSSxDQUFDLElBQUksR0FBRyxRQUFRLENBQUMsQ0FBQyxNQUFNLEdBQUcsTUFBTSxDQUFDO0lBQzdDLENBQUM7SUFNRCxDQUFDLE1BQU0sQ0FBQyxRQUFRLENBQUM7UUFDZixPQUFPLElBQUksQ0FBQyxJQUFJLENBQUMsTUFBTSxDQUFDLFFBQVEsQ0FBQyxFQUFFLENBQUM7SUFDdEMsQ0FBQzs7QUFFc0IsZUFBTSxHQUFHLFlBQVksQ0FBQzs7Ozs7Ozs7O0dBUzVDLEVBQUUsRUFBQyxHQUFHLEVBQUUsQ0FBQyxFQUFFLEdBQUcsRUFBRSxDQUFDLEVBQUUsR0FBRyxFQUFFLENBQUMsRUFBRSxHQUFHLEVBQUUsQ0FBQyxFQUFFLEdBQUcsRUFBRSxDQUFDLEVBQUMsQ0FBQyxDQUFDO0FBQ3RCLGVBQU0sR0FBRyxZQUFZLENBQUM7Ozs7Ozs7OztHQVM1QyxFQUFFLEVBQUMsR0FBRyxFQUFFLENBQUMsRUFBRSxHQUFHLEVBQUUsQ0FBQyxFQUFFLEdBQUcsRUFBRSxDQUFDLEVBQUUsR0FBRyxFQUFFLENBQUMsRUFBQyxDQUFDLENBQUM7QUFDZCxlQUFNLEdBQUcsWUFBWSxDQUFDOzs7Ozs7Ozs7R0FTNUMsRUFBRSxFQUFDLEdBQUcsRUFBRSxDQUFDLEVBQUUsR0FBRyxFQUFFLENBQUMsRUFBRSxHQUFHLEVBQUUsQ0FBQyxFQUFFLEdBQUcsRUFBRSxDQUFDLEVBQUUsR0FBRyxFQUFFLENBQUMsRUFBQyxDQUFDLENBQUM7QUFDdEIsZUFBTSxHQUFHLFlBQVksQ0FBQzs7Ozs7Ozs7O0dBUzVDLEVBQUUsRUFBQyxHQUFHLEVBQUUsQ0FBQyxFQUFFLEdBQUcsRUFBRSxDQUFDLEVBQUUsR0FBRyxFQUFFLENBQUMsRUFBRSxHQUFHLEVBQUUsQ0FBQyxFQUFDLENBQUMsQ0FBQztBQUNkLGVBQU0sR0FBRyxZQUFZLENBQUM7Ozs7Ozs7OztHQVM1QyxFQUFFLEVBQUMsR0FBRyxFQUFFLENBQUMsRUFBRSxHQUFHLEVBQUUsQ0FBQyxFQUFFLEdBQUcsRUFBRSxDQUFDLEVBQUUsR0FBRyxFQUFFLENBQUMsRUFBQyxDQUFDLENBQUM7QUFDZCxlQUFNLEdBQUcsWUFBWSxDQUFDOzs7Ozs7Ozs7R0FTNUMsRUFBRSxFQUFDLEdBQUcsRUFBRSxDQUFDLEVBQUUsR0FBRyxFQUFFLENBQUMsRUFBRSxHQUFHLEVBQUUsQ0FBQyxFQUFFLEdBQUcsRUFBRSxDQUFDLEVBQUMsQ0FBQyxDQUFDO0FBQ2QsZUFBTSxHQUFHLFlBQVksQ0FBQzs7Ozs7Ozs7O0dBUzVDLEVBQUUsRUFBQyxHQUFHLEVBQUUsQ0FBQyxFQUFFLEdBQUcsRUFBRSxDQUFDLEVBQUUsR0FBRyxFQUFFLENBQUMsRUFBRSxHQUFHLEVBQUUsQ0FBQyxFQUFDLENBQUMsQ0FBQztBQUNkLHdCQUFlLEdBQUcsWUFBWSxDQUFDOzs7Ozs7Ozs7R0FTckQsRUFBRSxFQUFDLEdBQUcsRUFBRSxDQUFDLEVBQUUsR0FBRyxFQUFFLENBQUMsRUFBRSxHQUFHLEVBQUUsQ0FBQyxFQUFFLEdBQUcsRUFBRSxDQUFDLEVBQUMsQ0FBQyxDQUFDO0FBQ2QsdUJBQWMsR0FBRyxZQUFZLENBQUM7Ozs7Ozs7OztHQVNwRCxFQUFFLEVBQUMsR0FBRyxFQUFFLENBQUMsRUFBRSxHQUFHLEVBQUUsQ0FBQyxFQUFFLEdBQUcsRUFBRSxDQUFDLEVBQUUsR0FBRyxFQUFFLENBQUMsRUFBQyxDQUFDLENBQUM7QUFHdkMsU0FBUyxZQUFZLENBQUMsSUFBWSxFQUFFLEdBQTJCO0lBQzdELE1BQU0sSUFBSSxHQUFHLElBQUksQ0FBQyxJQUFJLEVBQUUsQ0FBQyxPQUFPLENBQUMscUJBQXFCLEVBQUUsRUFBRSxDQUFDLENBQUMsT0FBTyxDQUFDLEtBQUssRUFBRSxFQUFFLENBQUMsQ0FBQztJQUMvRSxJQUFJLElBQUksQ0FBQyxNQUFNLEtBQUssRUFBRTtRQUFFLE1BQU0sSUFBSSxLQUFLLENBQUMsaUJBQWlCLElBQUksRUFBRSxDQUFDLENBQUM7SUFDakUsTUFBTSxHQUFHLEdBQWEsSUFBSSxLQUFLLENBQUMsRUFBRSxDQUFDLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxDQUFDO0lBQzVDLEtBQUssSUFBSSxDQUFDLEdBQUcsQ0FBQyxFQUFFLENBQUMsR0FBRyxFQUFFLEVBQUUsQ0FBQyxHQUFHLElBQUksQ0FBQyxNQUFNLENBQUMsQ0FBQyxDQUFDLEVBQUUsRUFBRSxDQUFDLEVBQUU7UUFDL0MsTUFBTSxHQUFHLEdBQUcsQ0FBQyxLQUFLLENBQUMsQ0FBQztRQUNwQixNQUFNLEVBQUUsR0FBRyxHQUFHLENBQUM7UUFDZixNQUFNLEVBQUUsR0FBRyxHQUFHLEdBQUcsQ0FBQyxDQUFDO1FBQ25CLE1BQU0sR0FBRyxHQUFHLENBQUMsQ0FBQyxHQUFHLENBQUMsQ0FBQztRQUNuQixNQUFNLEdBQUcsR0FBRyxHQUFHLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxDQUFDO1FBQ3hCLElBQUksR0FBRyxHQUFHLENBQUMsRUFBRTtZQUNYLEdBQUcsQ0FBQyxFQUFFLENBQUMsSUFBSSxDQUFDLElBQUksR0FBRyxDQUFDO1NBQ3JCO1FBQ0QsSUFBSSxHQUFHLEdBQUcsQ0FBQyxFQUFFO1lBQ1gsR0FBRyxDQUFDLEVBQUUsQ0FBQyxJQUFJLENBQUMsSUFBSSxHQUFHLENBQUM7U0FDckI7S0FDRjtJQUNELE9BQU8sR0FBRyxDQUFDO0FBQ2IsQ0FBQztBQUVELE1BQU0sQ0FBTixJQUFZLElBR1g7QUFIRCxXQUFZLElBQUk7SUFDZCw0Q0FBaUIsQ0FBQTtJQUNqQix5Q0FBZSxDQUFBO0FBQ2pCLENBQUMsRUFIVyxJQUFJLEtBQUosSUFBSSxRQUdmIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHtNb2R1bGV9IGZyb20gJy4uL2FzbS9tb2R1bGUuanMnO1xuaW1wb3J0IHtSb219IGZyb20gJy4uL3JvbS5qcyc7XG5pbXBvcnQge0VudGl0eX0gZnJvbSAnLi9lbnRpdHkuanMnO1xuaW1wb3J0IHtyZXZlcnNlQml0cywgc2VxLCB0dXBsZX0gZnJvbSAnLi91dGlsLmpzJztcblxuZXhwb3J0IGNsYXNzIFBhdHRlcm4gZXh0ZW5kcyBFbnRpdHkge1xuXG4gIHBpeGVsczogbnVtYmVyW107XG5cbiAgY29uc3RydWN0b3Iocm9tOiBSb20sIGlkOiBudW1iZXIsIHBpeGVscz86IG51bWJlcltdKSB7XG4gICAgc3VwZXIocm9tLCBpZCk7XG4gICAgdGhpcy5waXhlbHMgPSBwaXhlbHMgfHwgdHVwbGUocm9tLmNociwgaWQgPDwgNCwgMTYpO1xuICB9XG5cbiAgLy8gVGFrZXMgeCBhbmQgeSBmcm9tIDAuLjcsIHJldHVybnMgYSBjb2xvciAwLi4zLlxuICBwaXhlbEF0KHk6IG51bWJlciwgeDogbnVtYmVyKTogbnVtYmVyIHtcbiAgICByZXR1cm4gKHRoaXMucGl4ZWxzW3kgfCA4XSA+PiB4ICYgMSkgPDwgMSB8ICh0aGlzLnBpeGVsc1t5XSA+PiB4ICYgMSk7XG4gIH1cblxuICBmbGlwSCgpOiBQYXR0ZXJuIHtcbiAgICByZXR1cm4gbmV3IFBhdHRlcm4odGhpcy5yb20sIC0xLCB0aGlzLnBpeGVscy5tYXAocmV2ZXJzZUJpdHMpKTtcbiAgfVxuXG4gIGZsaXBWKCk6IFBhdHRlcm4ge1xuICAgIHJldHVybiBuZXcgUGF0dGVybih0aGlzLnJvbSwgLTEsIHNlcSgxNiwgeSA9PiB0aGlzLnBpeGVsc1t5ICYgOCB8IH55ICYgN10pKTtcbiAgfVxuXG4gIGZsaXAodHlwZTogRmxpcCk6IFBhdHRlcm4ge1xuICAgIGxldCBwOiBQYXR0ZXJuID0gdGhpcztcbiAgICBpZiAodHlwZSAmIEZsaXAuSE9SSVpPTlRBTCkgcCA9IHAuZmxpcEgoKTtcbiAgICBpZiAodHlwZSAmIEZsaXAuVkVSVElDQUwpIHAgPSBwLmZsaXBWKCk7XG4gICAgcmV0dXJuIHA7XG4gIH1cblxuICB3cml0ZSgpOiBNb2R1bGVbXSB7XG4gICAgLy8gVE9ETzogaW50ZWdyYXRlIENIUiBhcyBhIHNlcGFyYXRlIG91dHB1dC9vZmZzZXQgaW4gbGlua2VyP1xuICAgIGNvbnN0IGEgPSB0aGlzLmlkIDw8IDQ7XG4gICAgdGhpcy5yb20uY2hyLnN1YmFycmF5KGEsIGEgKyAxNikuc2V0KHRoaXMucGl4ZWxzKTtcbiAgICByZXR1cm4gW107XG4gIH1cbn1cblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGV4cG9ydCBjbGFzcyBQYXR0ZXJucyBpbXBsZW1lbnRzIEl0ZXJhYmxlPFBhdHRlcm4+IHtcbiAgcHJpdmF0ZSBfYWxsOiBQYXR0ZXJuW10gPSBbXTtcblxuICBnZXQocGFnZTogbnVtYmVyLCB0aWxlX2lkeD86IG51bWJlcik6IFBhdHRlcm4ge1xuICAgIGlmICghdGlsZV9pZHgpIHtcbiAgICAgIHJldHVybiB0aGlzLl9hbGxbcGFnZV07XG4gICAgfVxuICAgIHJldHVybiB0aGlzLl9hbGxbcGFnZSB8IHRpbGVfaWR4XTtcbiAgfVxuXG4gIHNldChwYWdlOiBudW1iZXIsIHRpbGVfaWR4OiBudW1iZXIsIHBpeGVsczogbnVtYmVyW10pIHtcbiAgICB0aGlzLl9hbGxbcGFnZSB8IHRpbGVfaWR4XS5waXhlbHMgPSBwaXhlbHM7XG4gIH1cblxuICBjb25zdHJ1Y3Rvcihyb206IFJvbSkge1xuICAgIHRoaXMuX2FsbCA9IHNlcShyb20uY2hyLmxlbmd0aCA+PiA0LCBpID0+IG5ldyBQYXR0ZXJuKHJvbSwgaSkpO1xuICB9XG5cbiAgW1N5bWJvbC5pdGVyYXRvcl0oKSB7XG4gICAgcmV0dXJuIHRoaXMuX2FsbFtTeW1ib2wuaXRlcmF0b3JdKCk7XG4gIH1cblxuICBwdWJsaWMgc3RhdGljIHJlYWRvbmx5IEhVRF9MRiA9IHBhcnNlUGF0dGVybihgXG4gICAgfEwgICAgIC4ufFxuICAgIHxMLiAgICAuI3xcbiAgICB8TC4gIEZGLiN8XG4gICAgfEwuICBGLi4jfFxuICAgIHxMTEwgRkYuI3xcbiAgICB8IC4uLkYuLiN8XG4gICAgfCAgICBGIC4ufFxuICAgIHwgICAgLiAgIHxcbiAgYCwgeycgJzogMiwgJ0wnOiAxLCAnRic6IDEsICcjJzogMSwgJy4nOiAzfSk7XG4gIHB1YmxpYyBzdGF0aWMgcmVhZG9ubHkgSFVEX1BXID0gcGFyc2VQYXR0ZXJuKGBcbiAgICB8UFBQICAgICB8XG4gICAgfFAuLlAuICAgfFxuICAgIHxQUFAuICAgIHxcbiAgICB8UC4uICAgICB8XG4gICAgfFAudy53LncgfFxuICAgIHwgLncudy53IHxcbiAgICB8ICAudy53LiB8XG4gICAgfCAgIC4gLiAgfFxuICBgLCB7JyAnOiAyLCAnUCc6IDEsICd3JzogMSwgJy4nOiAzfSk7XG4gIHB1YmxpYyBzdGF0aWMgcmVhZG9ubHkgSFVEX0VZID0gcGFyc2VQYXR0ZXJuKGBcbiAgICB8RUVFICAgICB8XG4gICAgfEUuLi4gICAgfFxuICAgIHxFRUUgWS5ZLnxcbiAgICB8RS4uLlkuWS58XG4gICAgfEVFRSAgWS4gfFxuICAgIHwgLi4uIFkuIHxcbiAgICB8ICAgICBZLiB8XG4gICAgfCAgICAgICAgfFxuICBgLCB7JyAnOiAyLCAnRSc6IDEsICdZJzogMSwgJyMnOiAxLCAnLic6IDN9KTtcbiAgcHVibGljIHN0YXRpYyByZWFkb25seSBIVURfTFYgPSBwYXJzZVBhdHRlcm4oYFxuICAgIHwgICAgICAgIHxcbiAgICB8TCAgICAgICB8XG4gICAgfEwuICAgICAgfFxuICAgIHxMLiAgdi52LnxcbiAgICB8TC4gIHYudi58XG4gICAgfExMTCAgdi4gfFxuICAgIHwgLi4uIHYuIHxcbiAgICB8ICAgICAuICB8XG4gIGAsIHsnICc6IDIsICdMJzogMSwgJ3YnOiAxLCAnLic6IDN9KTtcbiAgcHVibGljIHN0YXRpYyByZWFkb25seSBIVURfREwgPSBwYXJzZVBhdHRlcm4oYFxuICAgIHwgICAgICAgIHxcbiAgICB8REQgICAgICB8XG4gICAgfEQuRC5MICAgfFxuICAgIHxELkQuTC4gIHxcbiAgICB8RC5ELkwuICB8XG4gICAgfERELiBMLiAgfFxuICAgIHwgLiAgTExMIHxcbiAgICB8ICAgICAuLi58XG4gIGAsIHsnICc6IDIsICdEJzogMSwgJ0wnOiAxLCAnLic6IDN9KTtcbiAgcHVibGljIHN0YXRpYyByZWFkb25seSBIVURfTVAgPSBwYXJzZVBhdHRlcm4oYFxuICAgIHxNLiAgTSAgIHxcbiAgICB8TU0uTU0uICB8XG4gICAgfE0uTS5NLiAgfFxuICAgIHxNLiAuUFBQIHxcbiAgICB8TS4gLlAuLlB8XG4gICAgfCAgICBQUFAufFxuICAgIHwgICAgUC4uIHxcbiAgICB8ICAgIFAuICB8XG4gIGAsIHsnICc6IDIsICdNJzogMSwgJ1AnOiAxLCAnLic6IDN9KTtcbiAgcHVibGljIHN0YXRpYyByZWFkb25seSBIVURfRVggPSBwYXJzZVBhdHRlcm4oYFxuICAgIHxFRUUgICAgIHxcbiAgICB8RS4uLiAgICB8XG4gICAgfEVFRSAgICAgfFxuICAgIHxFLi4uICAgIHxcbiAgICB8RUVFIHgueC58XG4gICAgfCAuLi4geC4gfFxuICAgIHwgICAgeC54LnxcbiAgICB8ICAgICAuIC58XG4gIGAsIHsnICc6IDIsICdFJzogMSwgJ3gnOiAxLCAnLic6IDN9KTtcbiAgcHVibGljIHN0YXRpYyByZWFkb25seSBIVURfQ0xPU0VfUklHSFQgPSBwYXJzZVBhdHRlcm4oYFxuICAgIHxfX19fX19fX3xcbiAgICB8X19fX29vb298XG4gICAgfF9fX19vLi4ufFxuICAgIHxfX29vby4uLnxcbiAgICB8X19vLi4uLm98XG4gICAgfF9fby4uLi5vfFxuICAgIHxfX28uLm9vIHxcbiAgICB8X19vLi5vICB8XG4gIGAsIHsnICc6IDAsICcuJzogMSwgJ18nOiAyLCAnbyc6IDN9KTtcbiAgcHVibGljIHN0YXRpYyByZWFkb25seSBIVURfQ0xPU0VfTEVGVCA9IHBhcnNlUGF0dGVybihgXG4gICAgfF9fX19fX19ffFxuICAgIHxvb29vX19fX3xcbiAgICB8Li4ub19fX198XG4gICAgfC4uLm9vb19ffFxuICAgIHxvLi4uLm9fX3xcbiAgICB8by4uLi5vX198XG4gICAgfCBvby4ub19ffFxuICAgIHwgIG8uLm9fX3xcbiAgYCwgeycgJzogMCwgJy4nOiAxLCAnXyc6IDIsICdvJzogM30pO1xufVxuXG5mdW5jdGlvbiBwYXJzZVBhdHRlcm4oZGF0YTogU3RyaW5nLCBrZXk6IFJlY29yZDxzdHJpbmcsIG51bWJlcj4pOiBudW1iZXJbXSB7XG4gIGNvbnN0IHRleHQgPSBkYXRhLnRyaW0oKS5yZXBsYWNlKC9eW158XSpcXHx8XFx8W158XSokL21nLCAnJykucmVwbGFjZSgvXFxuL2csICcnKTtcbiAgaWYgKHRleHQubGVuZ3RoICE9PSA2NCkgdGhyb3cgbmV3IEVycm9yKGBCYWQgQ0hSIHRpbGU6ICR7dGV4dH1gKTtcbiAgY29uc3QgYXJyOiBudW1iZXJbXSA9IG5ldyBBcnJheSgxNikuZmlsbCgwKTtcbiAgZm9yIChsZXQgaSA9IDAsIGMgPSAnJzsgYyA9IHRleHQuY2hhckF0KGkpOyArK2kpIHtcbiAgICBjb25zdCBvZmYgPSBpID4+PiAzO1xuICAgIGNvbnN0IGxvID0gb2ZmO1xuICAgIGNvbnN0IGhpID0gb2ZmIHwgODtcbiAgICBjb25zdCBjb2wgPSB+aSAmIDc7XG4gICAgY29uc3QgdmFsID0ga2V5W2NdIHx8IDA7XG4gICAgaWYgKHZhbCAmIDEpIHtcbiAgICAgIGFycltsb10gfD0gMSA8PCBjb2w7XG4gICAgfVxuICAgIGlmICh2YWwgJiAyKSB7XG4gICAgICBhcnJbaGldIHw9IDEgPDwgY29sO1xuICAgIH1cbiAgfVxuICByZXR1cm4gYXJyO1xufVxuXG5leHBvcnQgZW51bSBGbGlwIHtcbiAgSE9SSVpPTlRBTCA9IDB4NDAsXG4gIFZFUlRJQ0FMID0gMHg4MCxcbn1cbiJdfQ==