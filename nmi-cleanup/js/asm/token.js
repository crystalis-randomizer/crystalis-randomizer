import { assertNever } from '../util.js';
export var TokenSource;
(function (TokenSource) {
    class Abstract {
        next() {
            while (true) {
                if (!this.sink)
                    this.sink = this.pump();
                const { value, done } = this.sink.next();
                if (!done)
                    return value;
                this.sink = undefined;
            }
        }
    }
    TokenSource.Abstract = Abstract;
    function concat(...sources) {
        let source;
        return {
            next: () => {
                while (true) {
                    if (!source)
                        source = sources.shift();
                    if (!source)
                        return undefined;
                    const line = source.next();
                    if (line)
                        return line;
                    source = undefined;
                }
            },
        };
    }
    TokenSource.concat = concat;
})(TokenSource || (TokenSource = {}));
export var Token;
(function (Token) {
    Token.LB = { token: 'lb' };
    Token.LC = { token: 'lc' };
    Token.LP = { token: 'lp' };
    Token.RB = { token: 'rb' };
    Token.RC = { token: 'rc' };
    Token.RP = { token: 'rp' };
    Token.EOL = { token: 'eol' };
    Token.EOF = { token: 'eof' };
    Token.DEFINE = { token: 'cs', str: '.define' };
    Token.DOT_EOL = { token: 'cs', str: '.eol' };
    Token.ELSE = { token: 'cs', str: '.else' };
    Token.ELSEIF = { token: 'cs', str: '.elseif' };
    Token.ENDIF = { token: 'cs', str: '.endif' };
    Token.ENDMAC = { token: 'cs', str: '.endmac' };
    Token.ENDMACRO = { token: 'cs', str: '.endmacro' };
    Token.ENDREP = { token: 'cs', str: '.endrep' };
    Token.ENDREPEAT = { token: 'cs', str: '.endrepeat' };
    Token.ENDPROC = { token: 'cs', str: '.endproc' };
    Token.ENDSCOPE = { token: 'cs', str: '.endscope' };
    Token.LOCAL = { token: 'cs', str: '.local' };
    Token.MACRO = { token: 'cs', str: '.macro' };
    Token.REPEAT = { token: 'cs', str: '.repeat' };
    Token.SET = { token: 'cs', str: '.set' };
    Token.SKIP = { token: 'cs', str: '.skip' };
    Token.BYTE = { token: 'cs', str: '.byte' };
    Token.WORD = { token: 'cs', str: '.word' };
    Token.COLON = { token: 'op', str: ':' };
    Token.COMMA = { token: 'op', str: ',' };
    Token.STAR = { token: 'op', str: '*' };
    Token.IMMEDIATE = { token: 'op', str: '#' };
    Token.ASSIGN = { token: 'op', str: '=' };
    function match(left, right) {
        if (left.token !== right.token)
            return false;
        if (left.token === 'num' || left.token === 'str')
            return true;
        if (left.str !== right.str)
            return false;
        return true;
    }
    Token.match = match;
    function eq(left, right) {
        if (!left || !right)
            return false;
        if (left.token !== right.token)
            return false;
        if (left.token === 'grp')
            return false;
        if (left.str !== right.str)
            return false;
        if (left.num !== right.num)
            return false;
        return true;
    }
    Token.eq = eq;
    function name(arg) {
        switch (arg.token) {
            case 'num': return `NUM[$${arg.num.toString(16)}]`;
            case 'str': return `STR[$${arg.str}]`;
            case 'lb': return `[`;
            case 'rb': return `]`;
            case 'grp': return `{`;
            case 'lc': return `{`;
            case 'rc': return `}`;
            case 'lp': return `(`;
            case 'rp': return `)`;
            case 'eol': return `EOL`;
            case 'eof': return `EOF`;
            case 'ident':
                return arg.str;
            case 'cs':
            case 'op':
                return `${arg.str.toUpperCase()}`;
            default:
                assertNever(arg);
        }
    }
    Token.name = name;
    function at(arg) {
        const s = arg.source;
        if (!s)
            return '';
        const parent = s.parent ? at({ source: s.parent }) : '';
        return `\n  at ${s.file}:${s.line}:${s.column}${parent}`;
    }
    Token.at = at;
    function nameAt(arg) {
        return name(arg) + at(arg);
    }
    Token.nameAt = nameAt;
    function expectEol(token, name = 'end of line') {
        if (token)
            throw new Error(`Expected ${name}: ${Token.nameAt(token)}`);
    }
    Token.expectEol = expectEol;
    function expect(want, token, prev) {
        if (!token) {
            if (!prev)
                throw new Error(`Expected ${name(want)}`);
            throw new Error(`Expected ${name(want)} after ${nameAt(token)}`);
        }
        if (!eq(want, token)) {
            throw new Error(`Expected ${name(want)}: ${nameAt(token)}`);
        }
    }
    Token.expect = expect;
    function expectIdentifier(token, prev) {
        return expectStringToken('ident', 'identifier', token, prev);
    }
    Token.expectIdentifier = expectIdentifier;
    function expectString(token, prev) {
        return expectStringToken('str', 'constant string', token, prev);
    }
    Token.expectString = expectString;
    function expectStringToken(want, name, token, prev) {
        if (!token) {
            if (!prev)
                throw new Error(`Expected ${name}`);
            throw new Error(`Expected ${name} after ${nameAt(prev)}`);
        }
        if (token.token !== want) {
            throw new Error(`Expected ${name}: ${nameAt(token)}`);
        }
        return token.str;
    }
    function identsFromCList(list) {
        if (!list.length)
            return [];
        const out = [];
        for (let i = 0; i <= list.length; i += 2) {
            const ident = list[i];
            if ((ident === null || ident === void 0 ? void 0 : ident.token) !== 'ident') {
                if (ident)
                    throw new Error(`Expected identifier: ${nameAt(ident)}`);
                const last = list[list.length - 1];
                throw new Error(`Expected identifier after ${nameAt(last)}`);
            }
            else if (i + 1 < list.length && !eq(list[i + 1], Token.COMMA)) {
                const sep = list[i + 1];
                throw new Error(`Expected comma: ${nameAt(sep)}`);
            }
            out.push(ident.str);
        }
        return out;
    }
    Token.identsFromCList = identsFromCList;
    function findBalanced(tokens, i) {
        const open = tokens[i++].token;
        if (open !== 'lp' && open !== 'lb')
            throw new Error(`non-grouping token`);
        const close = open === 'lp' ? 'rp' : 'rb';
        let depth = 1;
        for (; i < tokens.length; i++) {
            const tok = tokens[i].token;
            depth += Number(tok === open) - Number(tok === close);
            if (!depth)
                return i;
        }
        return -1;
    }
    Token.findBalanced = findBalanced;
    function parseArgList(tokens, start = 0, end = tokens.length) {
        let arg = [];
        const args = [arg];
        let parens = 0;
        for (let i = start; i < end; i++) {
            const token = tokens[i];
            if (!parens && eq(token, Token.COMMA)) {
                args.push(arg = []);
            }
            else {
                arg.push(token);
                if (eq(token, Token.LP))
                    parens++;
                if (eq(token, Token.RP)) {
                    if (--parens < 0)
                        throw new Error(`Unbalanced paren${at(token)}`);
                }
            }
        }
        return args;
    }
    Token.parseArgList = parseArgList;
    function parseAttrList(tokens, start) {
        const out = new Map();
        let key;
        let val = [];
        if (start >= tokens.length)
            return out;
        if (!eq(tokens[start], Token.COLON)) {
            throw new Error(`Unexpected: ${nameAt(tokens[start])}`);
        }
        for (let i = start + 1; i < tokens.length; i++) {
            const tok = tokens[i];
            if (eq(tok, Token.COLON)) {
                if (key == null)
                    throw new Error(`Missing key${at(tok)}`);
                out.set(key, val);
                key = undefined;
                val = [];
            }
            else if (key == null) {
                key = expectIdentifier(tok);
            }
            else {
                val.push(tok);
            }
        }
        if (key != null) {
            out.set(key, val);
        }
        else {
            expectIdentifier(undefined, tokens[tokens.length - 1]);
        }
        return out;
    }
    Token.parseAttrList = parseAttrList;
    function findComma(tokens, start) {
        const index = find(tokens, Token.COMMA, start);
        return index < 0 ? tokens.length : index;
    }
    Token.findComma = findComma;
    function find(tokens, want, start) {
        for (let i = start; i < tokens.length; i++) {
            if (eq(tokens[i], want))
                return i;
        }
        return -1;
    }
    Token.find = find;
    function count(ts) {
        let total = 0;
        for (const t of ts) {
            if (t.token === 'grp') {
                total += 2 + count(t.inner);
            }
            else {
                total++;
            }
        }
        return total;
    }
    Token.count = count;
    function isRegister(t, reg) {
        return t.token === 'ident' && t.str.toLowerCase() === reg;
    }
    Token.isRegister = isRegister;
    function str(t) {
        switch (t.token) {
            case 'cs':
            case 'ident':
            case 'str':
            case 'op':
                return t.str;
        }
        throw new Error(`Non-string token: ${Token.nameAt(t)}`);
    }
    Token.str = str;
    function strip(t) {
        delete t.source;
        return t;
    }
    Token.strip = strip;
})(Token || (Token = {}));
export const TOKENFUNCS = new Set([
    '.blank',
    '.const',
    '.defined',
    '.left',
    '.match',
    '.mid',
    '.right',
    '.tcount',
    '.xmatch',
]);
export const DIRECTIVES = [
    '.define',
    '.else',
    '.elseif',
    '.endif',
    '.endmacro',
    '.endproc',
    '.endscope',
    '.ident',
    '.if',
    '.ifblank',
    '.ifdef',
    '.ifnblank',
    '.ifndef',
    '.ifnref',
    '.ifref',
    '.include',
    '.local',
    '.macro',
    '.proc',
    '.scope',
    '.skip',
];
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidG9rZW4uanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi9zcmMvanMvYXNtL3Rva2VuLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLE9BQU8sRUFBQyxXQUFXLEVBQUMsTUFBTSxZQUFZLENBQUM7QUFNdkMsTUFBTSxLQUFXLFdBQVcsQ0F3QzNCO0FBeENELFdBQWlCLFdBQVc7SUFNMUIsTUFBc0IsUUFBUTtRQVU1QixJQUFJO1lBQ0YsT0FBTyxJQUFJLEVBQUU7Z0JBQ1gsSUFBSSxDQUFDLElBQUksQ0FBQyxJQUFJO29CQUFFLElBQUksQ0FBQyxJQUFJLEdBQUcsSUFBSSxDQUFDLElBQUksRUFBRSxDQUFDO2dCQUN4QyxNQUFNLEVBQUMsS0FBSyxFQUFFLElBQUksRUFBQyxHQUFHLElBQUksQ0FBQyxJQUFJLENBQUMsSUFBSSxFQUFFLENBQUM7Z0JBQ3ZDLElBQUksQ0FBQyxJQUFJO29CQUFFLE9BQU8sS0FBSyxDQUFDO2dCQUN4QixJQUFJLENBQUMsSUFBSSxHQUFHLFNBQVMsQ0FBQzthQUN2QjtRQUNILENBQUM7S0FDRjtJQWxCcUIsb0JBQVEsV0FrQjdCLENBQUE7SUFFRCxTQUFnQixNQUFNLENBQUMsR0FBRyxPQUFzQjtRQUM5QyxJQUFJLE1BQTZCLENBQUM7UUFDbEMsT0FBTztZQUNMLElBQUksRUFBRSxHQUFzQixFQUFFO2dCQUM1QixPQUFPLElBQUksRUFBRTtvQkFDWCxJQUFJLENBQUMsTUFBTTt3QkFBRSxNQUFNLEdBQUcsT0FBTyxDQUFDLEtBQUssRUFBRSxDQUFDO29CQUN0QyxJQUFJLENBQUMsTUFBTTt3QkFBRSxPQUFPLFNBQVMsQ0FBQztvQkFDOUIsTUFBTSxJQUFJLEdBQUcsTUFBTSxDQUFDLElBQUksRUFBRSxDQUFDO29CQUMzQixJQUFJLElBQUk7d0JBQUUsT0FBTyxJQUFJLENBQUM7b0JBQ3RCLE1BQU0sR0FBRyxTQUFTLENBQUM7aUJBQ3BCO1lBQ0gsQ0FBQztTQUNGLENBQUM7SUFDSixDQUFDO0lBYmUsa0JBQU0sU0FhckIsQ0FBQTtBQUNILENBQUMsRUF4Q2dCLFdBQVcsS0FBWCxXQUFXLFFBd0MzQjtBQXVDRCxNQUFNLEtBQVcsS0FBSyxDQWtSckI7QUFsUkQsV0FBaUIsS0FBSztJQUVQLFFBQUUsR0FBVSxFQUFDLEtBQUssRUFBRSxJQUFJLEVBQUMsQ0FBQztJQUMxQixRQUFFLEdBQVUsRUFBQyxLQUFLLEVBQUUsSUFBSSxFQUFDLENBQUM7SUFDMUIsUUFBRSxHQUFVLEVBQUMsS0FBSyxFQUFFLElBQUksRUFBQyxDQUFDO0lBQzFCLFFBQUUsR0FBVSxFQUFDLEtBQUssRUFBRSxJQUFJLEVBQUMsQ0FBQztJQUMxQixRQUFFLEdBQVUsRUFBQyxLQUFLLEVBQUUsSUFBSSxFQUFDLENBQUM7SUFDMUIsUUFBRSxHQUFVLEVBQUMsS0FBSyxFQUFFLElBQUksRUFBQyxDQUFDO0lBQzFCLFNBQUcsR0FBVSxFQUFDLEtBQUssRUFBRSxLQUFLLEVBQUMsQ0FBQztJQUM1QixTQUFHLEdBQVUsRUFBQyxLQUFLLEVBQUUsS0FBSyxFQUFDLENBQUM7SUFFNUIsWUFBTSxHQUFVLEVBQUMsS0FBSyxFQUFFLElBQUksRUFBRSxHQUFHLEVBQUUsU0FBUyxFQUFDLENBQUM7SUFDOUMsYUFBTyxHQUFVLEVBQUMsS0FBSyxFQUFFLElBQUksRUFBRSxHQUFHLEVBQUUsTUFBTSxFQUFDLENBQUM7SUFDNUMsVUFBSSxHQUFVLEVBQUMsS0FBSyxFQUFFLElBQUksRUFBRSxHQUFHLEVBQUUsT0FBTyxFQUFDLENBQUM7SUFDMUMsWUFBTSxHQUFVLEVBQUMsS0FBSyxFQUFFLElBQUksRUFBRSxHQUFHLEVBQUUsU0FBUyxFQUFDLENBQUM7SUFDOUMsV0FBSyxHQUFVLEVBQUMsS0FBSyxFQUFFLElBQUksRUFBRSxHQUFHLEVBQUUsUUFBUSxFQUFDLENBQUM7SUFDNUMsWUFBTSxHQUFVLEVBQUMsS0FBSyxFQUFFLElBQUksRUFBRSxHQUFHLEVBQUUsU0FBUyxFQUFDLENBQUM7SUFDOUMsY0FBUSxHQUFVLEVBQUMsS0FBSyxFQUFFLElBQUksRUFBRSxHQUFHLEVBQUUsV0FBVyxFQUFDLENBQUM7SUFDbEQsWUFBTSxHQUFVLEVBQUMsS0FBSyxFQUFFLElBQUksRUFBRSxHQUFHLEVBQUUsU0FBUyxFQUFDLENBQUM7SUFDOUMsZUFBUyxHQUFVLEVBQUMsS0FBSyxFQUFFLElBQUksRUFBRSxHQUFHLEVBQUUsWUFBWSxFQUFDLENBQUM7SUFDcEQsYUFBTyxHQUFVLEVBQUMsS0FBSyxFQUFFLElBQUksRUFBRSxHQUFHLEVBQUUsVUFBVSxFQUFDLENBQUM7SUFDaEQsY0FBUSxHQUFVLEVBQUMsS0FBSyxFQUFFLElBQUksRUFBRSxHQUFHLEVBQUUsV0FBVyxFQUFDLENBQUM7SUFDbEQsV0FBSyxHQUFVLEVBQUMsS0FBSyxFQUFFLElBQUksRUFBRSxHQUFHLEVBQUUsUUFBUSxFQUFDLENBQUM7SUFDNUMsV0FBSyxHQUFVLEVBQUMsS0FBSyxFQUFFLElBQUksRUFBRSxHQUFHLEVBQUUsUUFBUSxFQUFDLENBQUM7SUFDNUMsWUFBTSxHQUFVLEVBQUMsS0FBSyxFQUFFLElBQUksRUFBRSxHQUFHLEVBQUUsU0FBUyxFQUFDLENBQUM7SUFDOUMsU0FBRyxHQUFVLEVBQUMsS0FBSyxFQUFFLElBQUksRUFBRSxHQUFHLEVBQUUsTUFBTSxFQUFDLENBQUM7SUFDeEMsVUFBSSxHQUFVLEVBQUMsS0FBSyxFQUFFLElBQUksRUFBRSxHQUFHLEVBQUUsT0FBTyxFQUFDLENBQUM7SUFHMUMsVUFBSSxHQUFVLEVBQUMsS0FBSyxFQUFFLElBQUksRUFBRSxHQUFHLEVBQUUsT0FBTyxFQUFDLENBQUM7SUFDMUMsVUFBSSxHQUFVLEVBQUMsS0FBSyxFQUFFLElBQUksRUFBRSxHQUFHLEVBQUUsT0FBTyxFQUFDLENBQUM7SUFHMUMsV0FBSyxHQUFVLEVBQUMsS0FBSyxFQUFFLElBQUksRUFBRSxHQUFHLEVBQUUsR0FBRyxFQUFDLENBQUM7SUFFdkMsV0FBSyxHQUFVLEVBQUMsS0FBSyxFQUFFLElBQUksRUFBRSxHQUFHLEVBQUUsR0FBRyxFQUFDLENBQUM7SUFDdkMsVUFB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QUMsQ0FBQztJQUNYLENBQUM7SUFIZSxXQUFLLFFBR3BCLENBQUE7QUFDSCxDQUFDLEVBbFJnQixLQUFLLEtBQUwsS0FBSyxRQWtSckI7QUFhRCxNQUFNLENBQUMsTUFBTSxVQUFVLEdBQUcsSUFBSSxHQUFHLENBQUM7SUFDaEMsUUFBUTtJQUNSLFFBQVE7SUFDUixVQUFVO0lBQ1YsT0FBTztJQUNQLFFBQVE7SUFDUixNQUFNO0lBQ04sUUFBUTtJQUNSLFNBQVM7SUFDVCxTQUFTO0NBQ1YsQ0FBQyxDQUFDO0FBRUgsTUFBTSxDQUFDLE1BQU0sVUFBVSxHQUFHO0lBQ3hCLFNBQVM7SUFDVCxPQUFPO0lBQ1AsU0FBUztJQUNULFFBQVE7SUFDUixXQUFXO0lBQ1gsVUFBVTtJQUNWLFdBQVc7SUFDWCxRQUFRO0lBQ1IsS0FBSztJQUNMLFVBQVU7SUFDVixRQUFRO0lBQ1IsV0FBVztJQUNYLFNBQVM7SUFDVCxTQUFTO0lBQ1QsUUFBUTtJQUNSLFVBQVU7SUFDVixRQUFRO0lBQ1IsUUFBUTtJQUNSLE9BQU87SUFDUCxRQUFRO0lBQ1IsT0FBTztDQUNDLENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQge2Fzc2VydE5ldmVyfSBmcm9tICcuLi91dGlsLmpzJztcblxuZXhwb3J0IGludGVyZmFjZSBUb2tlblNvdXJjZSB7XG4gIG5leHQoKTogVG9rZW5bXXx1bmRlZmluZWQ7XG59XG5cbmV4cG9ydCBuYW1lc3BhY2UgVG9rZW5Tb3VyY2Uge1xuICBleHBvcnQgaW50ZXJmYWNlIEFzeW5jIHtcbiAgICBuZXh0QXN5bmMoKTogUHJvbWlzZTxUb2tlbltdfHVuZGVmaW5lZD47XG4gIH1cblxuICAvLyBUT0RPIC0gY29uc2lkZXIgbW92aW5nIGludG8gYSBuYW1lc3BhY2U/XG4gIGV4cG9ydCBhYnN0cmFjdCBjbGFzcyBBYnN0cmFjdCBpbXBsZW1lbnRzIFRva2VuU291cmNlIHtcbiAgICAvLyBUT0RPIC0gbW92ZSBwdW1wKCkgaW50byBoZXJlLCByZWZhY3RvciBQcmVwcm9jZXNzb3IgYXMgYSBUb2tlblNvdXJjZVxuICAgIC8vIFRPRE8gLSByZW5hbWUgUHJvY2Vzc29yIGludG8gQXNzZW1ibGVyLCBmaXggdXAgdGhlIGNsdW5reSBtZXRob2RzXG4gICAgLy8gICAgICAtIGFkZCBsaW5lKFRva2VuW10pLCB0b2tlbnMoVG9rZW5Tb3VyY2UpIGFuZCBhc3luY1Rva2VucyhBVFMpXG4gICAgLy8gICAgICAgIHRoZSBsYXR0ZXIgcmV0dXJucyBQcm9taXNlPHZvaWQ+IGFuZCBtdXN0IGJlIGF3YWl0ZWQuXG4gICAgLy8gRGVsZWdhdGUgdGhlIFxuICAgIHByaXZhdGUgc2luazogSXRlcmF0b3I8VG9rZW5bXXx1bmRlZmluZWQ+fHVuZGVmaW5lZDtcblxuICAgIGFic3RyYWN0IHB1bXAoKTogR2VuZXJhdG9yPFRva2VuW118dW5kZWZpbmVkPjtcblxuICAgIG5leHQoKTogVG9rZW5bXXx1bmRlZmluZWQge1xuICAgICAgd2hpbGUgKHRydWUpIHtcbiAgICAgICAgaWYgKCF0aGlzLnNpbmspIHRoaXMuc2luayA9IHRoaXMucHVtcCgpO1xuICAgICAgICBjb25zdCB7dmFsdWUsIGRvbmV9ID0gdGhpcy5zaW5rLm5leHQoKTtcbiAgICAgICAgaWYgKCFkb25lKSByZXR1cm4gdmFsdWU7XG4gICAgICAgIHRoaXMuc2luayA9IHVuZGVmaW5lZDtcbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICBleHBvcnQgZnVuY3Rpb24gY29uY2F0KC4uLnNvdXJjZXM6IFRva2VuU291cmNlW10pOiBUb2tlblNvdXJjZSB7XG4gICAgbGV0IHNvdXJjZTogVG9rZW5Tb3VyY2V8dW5kZWZpbmVkO1xuICAgIHJldHVybiB7XG4gICAgICBuZXh0OiAoKTogVG9rZW5bXXx1bmRlZmluZWQgPT4ge1xuICAgICAgICB3aGlsZSAodHJ1ZSkge1xuICAgICAgICAgIGlmICghc291cmNlKSBzb3VyY2UgPSBzb3VyY2VzLnNoaWZ0KCk7XG4gICAgICAgICAgaWYgKCFzb3VyY2UpIHJldHVybiB1bmRlZmluZWQ7XG4gICAgICAgICAgY29uc3QgbGluZSA9IHNvdXJjZS5uZXh0KCk7XG4gICAgICAgICAgaWYgKGxpbmUpIHJldHVybiBsaW5lO1xuICAgICAgICAgIHNvdXJjZSA9IHVuZGVmaW5lZDtcbiAgICAgICAgfVxuICAgICAgfSxcbiAgICB9O1xuICB9XG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgU291cmNlSW5mbyB7XG4gIGZpbGU6IHN0cmluZztcbiAgbGluZTogbnVtYmVyO1xuICBjb2x1bW46IG51bWJlcjtcbiAgcGFyZW50PzogU291cmNlSW5mbzsgLy8gbWFjcm8tZXhwYW5zaW9uIHN0YWNrLi4uXG59XG5cbmV4cG9ydCB0eXBlIEdyb3VwVG9rID0gJ2dycCc7XG5leHBvcnQgdHlwZSBTdHJpbmdUb2sgPSAnaWRlbnQnIHwgJ29wJyB8ICdjcycgfCAnc3RyJztcbmV4cG9ydCB0eXBlIE51bWJlclRvayA9ICdudW0nO1xuZXhwb3J0IHR5cGUgTnVsbFRvayA9ICdsYicgfCAnbGMnIHwgJ2xwJyB8ICdyYicgfCAncmMnIHwgJ3JwJyB8ICdlb2wnIHwgJ2VvZic7XG5cbi8vIE5PVEU6IFRoaXMgaXMgbm90IHRva2VuaXplZCBpbml0aWFsbHksIGJ1dCBpcyBhZGRlZCAqdmVyeSogZWFybHkgZm9yXG4vLyBjdXJseS1icmFjZSBncm91cHMgc2luY2UgYmFzaWNhbGx5IGV2ZXJ5dGhpbmcgd2FudHMgdG8gc2tpcCBvdmVyIHRoZW1cbi8vIGluIGEgc2luZ2xlIGdvLiAgV2UgZG9uJ3QgdHJlYXQgYW55IG90aGVyIGdyb3VwaW5nIG9wZXJhdG9ycyBhcyBzdHJvbmdseS5cbmV4cG9ydCBpbnRlcmZhY2UgR3JvdXBUb2tlbiB7XG4gIHRva2VuOiBHcm91cFRvaztcbiAgaW5uZXI6IFRva2VuW107XG4gIHNvdXJjZT86IFNvdXJjZUluZm87XG59XG5leHBvcnQgaW50ZXJmYWNlIFN0cmluZ1Rva2VuIHtcbiAgdG9rZW46IFN0cmluZ1RvaztcbiAgc3RyOiBzdHJpbmc7XG4gIHNvdXJjZT86IFNvdXJjZUluZm87XG59XG5leHBvcnQgaW50ZXJmYWNlIE51bWJlclRva2VuIHtcbiAgdG9rZW46IE51bWJlclRvaztcbiAgbnVtOiBudW1iZXI7XG4gIHNvdXJjZT86IFNvdXJjZUluZm87XG59XG5leHBvcnQgaW50ZXJmYWNlIE51bGxhcnlUb2tlbiB7XG4gIHRva2VuOiBOdWxsVG9rO1xuICBzb3VyY2U/OiBTb3VyY2VJbmZvO1xufVxuXG5leHBvcnQgdHlwZSBUb2tlbiA9IEdyb3VwVG9rZW4gfCBTdHJpbmdUb2tlbiB8IE51bWJlclRva2VuIHwgTnVsbGFyeVRva2VuO1xuXG5leHBvcnQgbmFtZXNwYWNlIFRva2VuIHtcbiAgLy8gR3JvdXBpbmcgdG9rZW5zXG4gIGV4cG9ydCBjb25zdCBMQjogVG9rZW4gPSB7dG9rZW46ICdsYid9O1xuICBleHBvcnQgY29uc3QgTEM6IFRva2VuID0ge3Rva2VuOiAnbGMnfTtcbiAgZXhwb3J0IGNvbnN0IExQOiBUb2tlbiA9IHt0b2tlbjogJ2xwJ307XG4gIGV4cG9ydCBjb25zdCBSQjogVG9rZW4gPSB7dG9rZW46ICdyYid9O1xuICBleHBvcnQgY29uc3QgUkM6IFRva2VuID0ge3Rva2VuOiAncmMnfTtcbiAgZXhwb3J0IGNvbnN0IFJQOiBUb2tlbiA9IHt0b2tlbjogJ3JwJ307XG4gIGV4cG9ydCBjb25zdCBFT0w6IFRva2VuID0ge3Rva2VuOiAnZW9sJ307XG4gIGV4cG9ydCBjb25zdCBFT0Y6IFRva2VuID0ge3Rva2VuOiAnZW9mJ307XG4gIC8vIEltcG9ydGFudCBtYWNybyBleHBhbnNpb24gdG9rZW5zXG4gIGV4cG9ydCBjb25zdCBERUZJTkU6IFRva2VuID0ge3Rva2VuOiAnY3MnLCBzdHI6ICcuZGVmaW5lJ307XG4gIGV4cG9ydCBjb25zdCBET1RfRU9MOiBUb2tlbiA9IHt0b2tlbjogJ2NzJywgc3RyOiAnLmVvbCd9O1xuICBleHBvcnQgY29uc3QgRUxTRTogVG9rZW4gPSB7dG9rZW46ICdjcycsIHN0cjogJy5lbHNlJ307XG4gIGV4cG9ydCBjb25zdCBFTFNFSUY6IFRva2VuID0ge3Rva2VuOiAnY3MnLCBzdHI6ICcuZWxzZWlmJ307XG4gIGV4cG9ydCBjb25zdCBFTkRJRjogVG9rZW4gPSB7dG9rZW46ICdjcycsIHN0cjogJy5lbmRpZid9O1xuICBleHBvcnQgY29uc3QgRU5ETUFDOiBUb2tlbiA9IHt0b2tlbjogJ2NzJywgc3RyOiAnLmVuZG1hYyd9O1xuICBleHBvcnQgY29uc3QgRU5ETUFDUk86IFRva2VuID0ge3Rva2VuOiAnY3MnLCBzdHI6ICcuZW5kbWFjcm8nfTtcbiAgZXhwb3J0IGNvbnN0IEVORFJFUDogVG9rZW4gPSB7dG9rZW46ICdjcycsIHN0cjogJy5lbmRyZXAnfTtcbiAgZXhwb3J0IGNvbnN0IEVORFJFUEVBVDogVG9rZW4gPSB7dG9rZW46ICdjcycsIHN0cjogJy5lbmRyZXBlYXQnfTtcbiAgZXhwb3J0IGNvbnN0IEVORFBST0M6IFRva2VuID0ge3Rva2VuOiAnY3MnLCBzdHI6ICcuZW5kcHJvYyd9O1xuICBleHBvcnQgY29uc3QgRU5EU0NPUEU6IFRva2VuID0ge3Rva2VuOiAnY3MnLCBzdHI6ICcuZW5kc2NvcGUnfTtcbiAgZXhwb3J0IGNvbnN0IExPQ0FMOiBUb2tlbiA9IHt0b2tlbjogJ2NzJywgc3RyOiAnLmxvY2FsJ307XG4gIGV4cG9ydCBjb25zdCBNQUNSTzogVG9rZW4gPSB7dG9rZW46ICdjcycsIHN0cjogJy5tYWNybyd9O1xuICBleHBvcnQgY29uc3QgUkVQRUFUOiBUb2tlbiA9IHt0b2tlbjogJ2NzJywgc3RyOiAnLnJlcGVhdCd9O1xuICBleHBvcnQgY29uc3QgU0VUOiBUb2tlbiA9IHt0b2tlbjogJ2NzJywgc3RyOiAnLnNldCd9O1xuICBleHBvcnQgY29uc3QgU0tJUDogVG9rZW4gPSB7dG9rZW46ICdjcycsIHN0cjogJy5za2lwJ307XG5cbiAgLy8gVG9rZW5zIHdlIG1hdGNoXG4gIGV4cG9ydCBjb25zdCBCWVRFOiBUb2tlbiA9IHt0b2tlbjogJ2NzJywgc3RyOiAnLmJ5dGUnfTtcbiAgZXhwb3J0IGNvbnN0IFdPUkQ6IFRva2VuID0ge3Rva2VuOiAnY3MnLCBzdHI6ICcud29yZCd9O1xuXG4gIC8vIEltcG9ydGFudCBvcGVyYXRvciB0b2tlbnNcbiAgZXhwb3J0IGNvbnN0IENPTE9OOiBUb2tlbiA9IHt0b2tlbjogJ29wJywgc3RyOiAnOid9O1xuICAvL2V4cG9ydCBjb25zdCBEQ09MT046IFRva2VuID0ge3Rva2VuOiAnb3AnLCBzdHI6ICc6Oid9O1xuICBleHBvcnQgY29uc3QgQ09NTUE6IFRva2VuID0ge3Rva2VuOiAnb3AnLCBzdHI6ICcsJ307XG4gIGV4cG9ydCBjb25zdCBTVEFSOiBUb2tlbiA9IHt0b2tlbjogJ29wJywgc3RyOiAnKid9O1xuICBleHBvcnQgY29uc3QgSU1NRURJQVRFOiBUb2tlbiA9IHt0b2tlbjogJ29wJywgc3RyOiAnIyd9O1xuICBleHBvcnQgY29uc3QgQVNTSUdOOiBUb2tlbiA9IHt0b2tlbjogJ29wJywgc3RyOiAnPSd9O1xuXG4gIGV4cG9ydCBmdW5jdGlvbiBtYXRjaChsZWZ0OiBUb2tlbiwgcmlnaHQ6IFRva2VuKTogYm9vbGVhbiB7XG4gICAgaWYgKGxlZnQudG9rZW4gIT09IHJpZ2h0LnRva2VuKSByZXR1cm4gZmFsc2U7XG4gICAgaWYgKGxlZnQudG9rZW4gPT09ICdudW0nIHx8IGxlZnQudG9rZW4gPT09ICdzdHInKSByZXR1cm4gdHJ1ZTtcbiAgICBpZiAoKGxlZnQgYXMgU3RyaW5nVG9rZW4pLnN0ciAhPT0gKHJpZ2h0IGFzIFN0cmluZ1Rva2VuKS5zdHIpIHJldHVybiBmYWxzZTtcbiAgICAvLyBOT1RFOiBkb24ndCBjb21wYXJlIG51bSBiZWNhdXNlICdudW0nIGFscmVhZHkgZWFybHktcmV0dXJuZWQuXG4gICAgcmV0dXJuIHRydWU7XG4gIH1cblxuICBleHBvcnQgZnVuY3Rpb24gZXEobGVmdDogVG9rZW58dW5kZWZpbmVkLCByaWdodDogVG9rZW58dW5kZWZpbmVkKTogYm9vbGVhbiB7XG4gICAgaWYgKCFsZWZ0IHx8ICFyaWdodCkgcmV0dXJuIGZhbHNlO1xuICAgIGlmIChsZWZ0LnRva2VuICE9PSByaWdodC50b2tlbikgcmV0dXJuIGZhbHNlO1xuICAgIGlmIChsZWZ0LnRva2VuID09PSAnZ3JwJykgcmV0dXJuIGZhbHNlOyAvLyBkb24ndCBjaGVjayBncm91cHMuXG4gICAgaWYgKChsZWZ0IGFzIFN0cmluZ1Rva2VuKS5zdHIgIT09IChyaWdodCBhcyBTdHJpbmdUb2tlbikuc3RyKSByZXR1cm4gZmFsc2U7XG4gICAgaWYgKChsZWZ0IGFzIE51bWJlclRva2VuKS5udW0gIT09IChyaWdodCBhcyBOdW1iZXJUb2tlbikubnVtKSByZXR1cm4gZmFsc2U7XG4gICAgcmV0dXJuIHRydWU7XG4gIH1cblxuICBleHBvcnQgZnVuY3Rpb24gbmFtZShhcmc6IFRva2VuKTogc3RyaW5nIHtcbiAgICBzd2l0Y2ggKGFyZy50b2tlbikge1xuICAgICAgY2FzZSAnbnVtJzogcmV0dXJuIGBOVU1bJCR7YXJnLm51bS50b1N0cmluZygxNil9XWA7XG4gICAgICBjYXNlICdzdHInOiByZXR1cm4gYFNUUlskJHthcmcuc3RyfV1gO1xuICAgICAgY2FzZSAnbGInOiByZXR1cm4gYFtgO1xuICAgICAgY2FzZSAncmInOiByZXR1cm4gYF1gO1xuICAgICAgY2FzZSAnZ3JwJzogcmV0dXJuIGB7YDtcbiAgICAgIGNhc2UgJ2xjJzogcmV0dXJuIGB7YDtcbiAgICAgIGNhc2UgJ3JjJzogcmV0dXJuIGB9YDtcbiAgICAgIGNhc2UgJ2xwJzogcmV0dXJuIGAoYDtcbiAgICAgIGNhc2UgJ3JwJzogcmV0dXJuIGApYDtcbiAgICAgIGNhc2UgJ2VvbCc6IHJldHVybiBgRU9MYDtcbiAgICAgIGNhc2UgJ2VvZic6IHJldHVybiBgRU9GYDtcbiAgICAgIGNhc2UgJ2lkZW50JzpcbiAgICAgICAgcmV0dXJuIGFyZy5zdHI7XG4gICAgICBjYXNlICdjcyc6XG4gICAgICBjYXNlICdvcCc6XG4gICAgICAgIHJldHVybiBgJHthcmcuc3RyLnRvVXBwZXJDYXNlKCl9YDtcbiAgICAgIGRlZmF1bHQ6XG4gICAgICAgIGFzc2VydE5ldmVyKGFyZyk7XG4gICAgfVxuICB9XG5cbiAgZXhwb3J0IGZ1bmN0aW9uIGF0KGFyZzoge3NvdXJjZT86IFNvdXJjZUluZm99KTogc3RyaW5nIHtcbiAgICBjb25zdCBzID0gYXJnLnNvdXJjZTtcbiAgICBpZiAoIXMpIHJldHVybiAnJztcbiAgICBjb25zdCBwYXJlbnQgPSBzLnBhcmVudCA/IGF0KHtzb3VyY2U6IHMucGFyZW50fSkgOiAnJztcbiAgICByZXR1cm4gYFxcbiAgYXQgJHtzLmZpbGV9OiR7cy5saW5lfToke3MuY29sdW1ufSR7cGFyZW50fWA7XG4gICAgLy8gVE9ETyAtIGRlZmluaXRpb24gdnMgdXNhZ2U/XG4gIH1cblxuICBleHBvcnQgZnVuY3Rpb24gbmFtZUF0KGFyZzogVG9rZW4pOiBzdHJpbmcge1xuICAgIHJldHVybiBuYW1lKGFyZykgKyBhdChhcmcpO1xuICB9XG5cbiAgZXhwb3J0IGZ1bmN0aW9uIGV4cGVjdEVvbCh0b2tlbjogVG9rZW58dW5kZWZpbmVkLCBuYW1lID0gJ2VuZCBvZiBsaW5lJykge1xuICAgIGlmICh0b2tlbikgdGhyb3cgbmV3IEVycm9yKGBFeHBlY3RlZCAke25hbWV9OiAke1Rva2VuLm5hbWVBdCh0b2tlbil9YCk7XG4gIH1cblxuICBleHBvcnQgZnVuY3Rpb24gZXhwZWN0KHdhbnQ6IFRva2VuLCB0b2tlbjogVG9rZW4sIHByZXY/OiBUb2tlbikge1xuICAgIGlmICghdG9rZW4pIHtcbiAgICAgIGlmICghcHJldikgdGhyb3cgbmV3IEVycm9yKGBFeHBlY3RlZCAke25hbWUod2FudCl9YCk7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoYEV4cGVjdGVkICR7bmFtZSh3YW50KX0gYWZ0ZXIgJHtuYW1lQXQodG9rZW4pfWApO1xuICAgIH1cbiAgICBpZiAoIWVxKHdhbnQsIHRva2VuKSkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKGBFeHBlY3RlZCAke25hbWUod2FudCl9OiAke25hbWVBdCh0b2tlbil9YCk7XG4gICAgfVxuICB9XG5cbiAgZXhwb3J0IGZ1bmN0aW9uIGV4cGVjdElkZW50aWZpZXIodG9rZW46IFRva2VufHVuZGVmaW5lZCxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcHJldj86IFRva2VuKTogc3RyaW5nIHtcbiAgICByZXR1cm4gZXhwZWN0U3RyaW5nVG9rZW4oJ2lkZW50JywgJ2lkZW50aWZpZXInLCB0b2tlbiwgcHJldik7XG4gIH1cblxuICBleHBvcnQgZnVuY3Rpb24gZXhwZWN0U3RyaW5nKHRva2VuOiBUb2tlbnx1bmRlZmluZWQsIHByZXY/OiBUb2tlbik6IHN0cmluZyB7XG4gICAgcmV0dXJuIGV4cGVjdFN0cmluZ1Rva2VuKCdzdHInLCAnY29uc3RhbnQgc3RyaW5nJywgdG9rZW4sIHByZXYpO1xuICB9XG5cbiAgZnVuY3Rpb24gZXhwZWN0U3RyaW5nVG9rZW4od2FudDogU3RyaW5nVG9rLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICBuYW1lOiBzdHJpbmcsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRva2VuOiBUb2tlbnx1bmRlZmluZWQsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgIHByZXY/OiBUb2tlbik6IHN0cmluZyB7XG4gICAgaWYgKCF0b2tlbikge1xuICAgICAgaWYgKCFwcmV2KSB0aHJvdyBuZXcgRXJyb3IoYEV4cGVjdGVkICR7bmFtZX1gKTtcbiAgICAgIHRocm93IG5ldyBFcnJvcihgRXhwZWN0ZWQgJHtuYW1lfSBhZnRlciAke25hbWVBdChwcmV2KX1gKTtcbiAgICB9XG4gICAgaWYgKHRva2VuLnRva2VuICE9PSB3YW50KSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoYEV4cGVjdGVkICR7bmFtZX06ICR7bmFtZUF0KHRva2VuKX1gKTtcbiAgICB9XG4gICAgcmV0dXJuIHRva2VuLnN0cjtcbiAgfVxuICAgIFxuICAvLyBleHBvcnQgZnVuY3Rpb24gZmFpbCh0b2tlbjogVG9rZW4sIG1zZzogc3RyaW5nKTogbmV2ZXIge1xuICAvLyAgIGlmIFxuICAvLyAgIHRocm93IG5ldyBFcnJvcihtc2cgKyBcblxuICAvLyB9XG5cbiAgLyoqXG4gICAqIEdpdmVuIGEgY29tbWEtc2VwYXJhdGVkIGxpc3Qgb2YgaWRlbnRpZmllcnMsIHJldHVybiB0aGVcbiAgICogaWRlbnRpZmllcnMgYXMgYSBsaXN0IG9mIHN0cmluZ3MuICBUaHJvd3MgYW4gZXJyb3IgaWZcbiAgICogdGhlIGlucHV0IGlzIG5vdCBhY3R1YWxseSBhIGNvbW1hLXNlcGFyYXRlZCBsaXN0LlxuICAgKi9cbiAgZXhwb3J0IGZ1bmN0aW9uIGlkZW50c0Zyb21DTGlzdChsaXN0OiBUb2tlbltdKTogc3RyaW5nW10ge1xuICAgIGlmICghbGlzdC5sZW5ndGgpIHJldHVybiBbXTtcbiAgICBjb25zdCBvdXQ6IHN0cmluZ1tdID0gW107XG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPD0gbGlzdC5sZW5ndGg7IGkgKz0gMikge1xuICAgICAgY29uc3QgaWRlbnQgPSBsaXN0W2ldO1xuICAgICAgaWYgKGlkZW50Py50b2tlbiAhPT0gJ2lkZW50Jykge1xuICAgICAgICBpZiAoaWRlbnQpIHRocm93IG5ldyBFcnJvcihgRXhwZWN0ZWQgaWRlbnRpZmllcjogJHtuYW1lQXQoaWRlbnQpfWApO1xuICAgICAgICBjb25zdCBsYXN0ID0gbGlzdFtsaXN0Lmxlbmd0aCAtIDFdO1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYEV4cGVjdGVkIGlkZW50aWZpZXIgYWZ0ZXIgJHtuYW1lQXQobGFzdCl9YCk7XG4gICAgICB9IGVsc2UgaWYgKGkgKyAxIDwgbGlzdC5sZW5ndGggJiYgIWVxKGxpc3RbaSArIDFdLCBDT01NQSkpIHtcbiAgICAgICAgY29uc3Qgc2VwID0gbGlzdFtpICsgMV07XG4gICAgICAgIHRocm93IG5ldyBFcnJvcihgRXhwZWN0ZWQgY29tbWE6ICR7bmFtZUF0KHNlcCl9YCk7XG4gICAgICB9XG4gICAgICBvdXQucHVzaChpZGVudC5zdHIpO1xuICAgIH1cbiAgICByZXR1cm4gb3V0O1xuICB9XG5cbiAgLyoqIEZpbmRzIGEgYmFsYW5jZWQgcGFyZW4vYnJhY2tldDogcmV0dXJucyBpdHMgaW5kZXgsIG9yIC0xLiAqL1xuICBleHBvcnQgZnVuY3Rpb24gZmluZEJhbGFuY2VkKHRva2VuczogVG9rZW5bXSwgaTogbnVtYmVyKTogbnVtYmVyIHtcbiAgICBjb25zdCBvcGVuID0gdG9rZW5zW2krK10udG9rZW47XG4gICAgaWYgKG9wZW4gIT09ICdscCcgJiYgb3BlbiAhPT0gJ2xiJykgdGhyb3cgbmV3IEVycm9yKGBub24tZ3JvdXBpbmcgdG9rZW5gKTtcbiAgICBjb25zdCBjbG9zZSA9IG9wZW4gPT09ICdscCcgPyAncnAnIDogJ3JiJztcbiAgICBsZXQgZGVwdGggPSAxO1xuICAgIGZvciAoOyBpIDwgdG9rZW5zLmxlbmd0aDsgaSsrKSB7XG4gICAgICBjb25zdCB0b2sgPSB0b2tlbnNbaV0udG9rZW47XG4gICAgICBkZXB0aCArPSBOdW1iZXIodG9rID09PSBvcGVuKSAtIE51bWJlcih0b2sgPT09IGNsb3NlKTtcbiAgICAgIGlmICghZGVwdGgpIHJldHVybiBpO1xuICAgIH1cbiAgICByZXR1cm4gLTE7XG4gIH1cblxuICAvKipcbiAgICogU3BsaXRzIG9uIGNvbW1hcyBub3QgZW5jbG9zZWQgaW4gYmFsYW5jZWQgcGFyZW5zLiAgQnJhY2VzIGFyZVxuICAgKiBpZ25vcmVkL25vdCBhbGxvd2VkIGF0IHRoaXMgcG9pbnQuICBUaGlzIGlzIGludGVuZGVkIGZvciBhcml0aG1ldGljLlxuICAgKi9cbiAgZXhwb3J0IGZ1bmN0aW9uIHBhcnNlQXJnTGlzdCh0b2tlbnM6IFRva2VuW10sXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc3RhcnQgPSAwLCBlbmQgPSB0b2tlbnMubGVuZ3RoKTogVG9rZW5bXVtdIHtcbiAgICBsZXQgYXJnOiBUb2tlbltdID0gW107XG4gICAgY29uc3QgYXJncyA9IFthcmddO1xuICAgIGxldCBwYXJlbnMgPSAwO1xuICAgIGZvciAobGV0IGkgPSBzdGFydDsgaSA8IGVuZDsgaSsrKSB7XG4gICAgICBjb25zdCB0b2tlbiA9IHRva2Vuc1tpXTtcbiAgICAgIGlmICghcGFyZW5zICYmIGVxKHRva2VuLCBDT01NQSkpIHtcbiAgICAgICAgYXJncy5wdXNoKGFyZyA9IFtdKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGFyZy5wdXNoKHRva2VuKTtcbiAgICAgICAgaWYgKGVxKHRva2VuLCBMUCkpIHBhcmVucysrO1xuICAgICAgICBpZiAoZXEodG9rZW4sIFJQKSkge1xuICAgICAgICAgIGlmICgtLXBhcmVucyA8IDApIHRocm93IG5ldyBFcnJvcihgVW5iYWxhbmNlZCBwYXJlbiR7YXQodG9rZW4pfWApO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuICAgIHJldHVybiBhcmdzO1xuICB9XG5cbiAgZXhwb3J0IGZ1bmN0aW9uIHBhcnNlQXR0ckxpc3QodG9rZW5zOiBUb2tlbltdLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdGFydDogbnVtYmVyKTogTWFwPHN0cmluZywgVG9rZW5bXT4ge1xuICAgIC8vIEV4cGVjdCBhIGNvbG9uLi4uXG4gICAgLy8gVE9ETyAtIGFsbG93IGNvbG9uIGluc2lkZSBiYWxhbmNlZCBwYXJlbnM/IGFsbG93IGEgc2luZ2xlIGdyb3VwP1xuICAgIC8vICAgLnNlZ21lbnQgXCJmb29cIiA6YmFyIHtmb286YmFyfSA6YmF6XG4gICAgY29uc3Qgb3V0ID0gbmV3IE1hcDxzdHJpbmcsIFRva2VuW10+KCk7XG4gICAgbGV0IGtleTogc3RyaW5nfHVuZGVmaW5lZDtcbiAgICBsZXQgdmFsOiBUb2tlbltdID0gW107XG4gICAgaWYgKHN0YXJ0ID49IHRva2Vucy5sZW5ndGgpIHJldHVybiBvdXQ7XG4gICAgaWYgKCFlcSh0b2tlbnNbc3RhcnRdLCBDT0xPTikpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcihgVW5leHBlY3RlZDogJHtuYW1lQXQodG9rZW5zW3N0YXJ0XSl9YCk7XG4gICAgfVxuICAgIGZvciAobGV0IGkgPSBzdGFydCArIDE7IGkgPCB0b2tlbnMubGVuZ3RoOyBpKyspIHtcbiAgICAgIGNvbnN0IHRvayA9IHRva2Vuc1tpXTtcbiAgICAgIGlmIChlcSh0b2ssIENPTE9OKSkge1xuICAgICAgICBpZiAoa2V5ID09IG51bGwpIHRocm93IG5ldyBFcnJvcihgTWlzc2luZyBrZXkke2F0KHRvayl9YCk7XG4gICAgICAgIG91dC5zZXQoa2V5LCB2YWwpO1xuICAgICAgICBrZXkgPSB1bmRlZmluZWQ7XG4gICAgICAgIHZhbCA9IFtdO1xuICAgICAgfSBlbHNlIGlmIChrZXkgPT0gbnVsbCkge1xuICAgICAgICBrZXkgPSBleHBlY3RJZGVudGlmaWVyKHRvayk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICB2YWwucHVzaCh0b2spO1xuICAgICAgfVxuICAgIH1cbiAgICBpZiAoa2V5ICE9IG51bGwpIHtcbiAgICAgIG91dC5zZXQoa2V5LCB2YWwpO1xuICAgIH0gZWxzZSB7XG4gICAgICBleHBlY3RJZGVudGlmaWVyKHVuZGVmaW5lZCwgdG9rZW5zW3Rva2Vucy5sZW5ndGggLSAxXSk7XG4gICAgfVxuICAgIHJldHVybiBvdXQ7XG4gIH1cblxuICAvKiogRmluZHMgYSBjb21tYSBvciBFT0wuICovXG4gIGV4cG9ydCBmdW5jdGlvbiBmaW5kQ29tbWEodG9rZW5zOiBUb2tlbltdLCBzdGFydDogbnVtYmVyKTogbnVtYmVyIHtcbiAgICBjb25zdCBpbmRleCA9IGZpbmQodG9rZW5zLCBDT01NQSwgc3RhcnQpO1xuICAgIHJldHVybiBpbmRleCA8IDAgPyB0b2tlbnMubGVuZ3RoIDogaW5kZXg7XG4gIH1cblxuICAvKiogRmluZHMgYSB0b2tlbiwgb3IgLTEgaWYgbm90IGZvdW5kLiAqL1xuICBleHBvcnQgZnVuY3Rpb24gZmluZCh0b2tlbnM6IFRva2VuW10sIHdhbnQ6IFRva2VuLCBzdGFydDogbnVtYmVyKTogbnVtYmVyIHtcbiAgICBmb3IgKGxldCBpID0gc3RhcnQ7IGkgPCB0b2tlbnMubGVuZ3RoOyBpKyspIHtcbiAgICAgIGlmIChlcSh0b2tlbnNbaV0sIHdhbnQpKSByZXR1cm4gaTtcbiAgICB9XG4gICAgcmV0dXJuIC0xO1xuICB9XG5cbiAgZXhwb3J0IGZ1bmN0aW9uIGNvdW50KHRzOiBUb2tlbltdKTogbnVtYmVyIHtcbiAgICBsZXQgdG90YWwgPSAwO1xuICAgIGZvciAoY29uc3QgdCBvZiB0cykge1xuICAgICAgaWYgKHQudG9rZW4gPT09ICdncnAnKSB7XG4gICAgICAgIHRvdGFsICs9IDIgKyBjb3VudCh0LmlubmVyKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHRvdGFsKys7XG4gICAgICB9XG4gICAgfVxuICAgIHJldHVybiB0b3RhbDtcbiAgfVxuXG4gIGV4cG9ydCBmdW5jdGlvbiBpc1JlZ2lzdGVyKHQ6IFRva2VuLCByZWc6ICdhJ3wneCd8J3knKTogYm9vbGVhbiB7XG4gICAgcmV0dXJuIHQudG9rZW4gPT09ICdpZGVudCcgJiYgdC5zdHIudG9Mb3dlckNhc2UoKSA9PT0gcmVnO1xuICB9XG5cbiAgZXhwb3J0IGZ1bmN0aW9uIHN0cih0OiBUb2tlbikge1xuICAgIHN3aXRjaCAodC50b2tlbikge1xuICAgICAgY2FzZSAnY3MnOlxuICAgICAgY2FzZSAnaWRlbnQnOlxuICAgICAgY2FzZSAnc3RyJzpcbiAgICAgIGNhc2UgJ29wJzpcbiAgICAgICAgcmV0dXJuIHQuc3RyO1xuICAgIH1cbiAgICB0aHJvdyBuZXcgRXJyb3IoYE5vbi1zdHJpbmcgdG9rZW46ICR7VG9rZW4ubmFtZUF0KHQpfWApO1xuICB9XG5cbiAgZXhwb3J0IGZ1bmN0aW9uIHN0cmlwKHQ6IFRva2VuKTogVG9rZW4ge1xuICAgIGRlbGV0ZSB0LnNvdXJjZTtcbiAgICByZXR1cm4gdDtcbiAgfVxufVxuXG4vLyBpbnRlcmZhY2UgRXhwciB7XG4vLyAgIC8vIG9wZXJhdG9yLCBmdW5jdGlvbiBuYW1lLCAnKCknLCAne30nLCAnbnVtJywgJ3N0cicsICdpZGVudCdcbi8vICAgb3A6IHN0cmluZztcbi8vICAgLy8gb25lIGFyZyBmb3IgYSB1bmFyeSwgdHdvIGZvciBiaW5hcnksIG9yIE4gZm9yIGNvbW1hIG9yIGZ1bmN0aW9uXG4vLyAgIGFyZ3M6IEV4cHJbXTtcbi8vICAgLy8gaWYgb3AgPT09ICdudW0nXG4vLyAgIG51bTogbnVtYmVyO1xuLy8gICAvLyBpZiBvcCA9PT0gJ3N0cicgb3IgJ2lkZW50J1xuLy8gICBzdHI6IHN0cmluZztcbi8vIH1cblxuZXhwb3J0IGNvbnN0IFRPS0VORlVOQ1MgPSBuZXcgU2V0KFtcbiAgJy5ibGFuaycsXG4gICcuY29uc3QnLFxuICAnLmRlZmluZWQnLCAvLyAuZGVmID9cbiAgJy5sZWZ0JyxcbiAgJy5tYXRjaCcsXG4gICcubWlkJyxcbiAgJy5yaWdodCcsXG4gICcudGNvdW50JyxcbiAgJy54bWF0Y2gnLFxuXSk7XG5cbmV4cG9ydCBjb25zdCBESVJFQ1RJVkVTID0gW1xuICAnLmRlZmluZScsXG4gICcuZWxzZScsXG4gICcuZWxzZWlmJyxcbiAgJy5lbmRpZicsXG4gICcuZW5kbWFjcm8nLFxuICAnLmVuZHByb2MnLFxuICAnLmVuZHNjb3BlJyxcbiAgJy5pZGVudCcsXG4gICcuaWYnLFxuICAnLmlmYmxhbmsnLFxuICAnLmlmZGVmJyxcbiAgJy5pZm5ibGFuaycsXG4gICcuaWZuZGVmJyxcbiAgJy5pZm5yZWYnLFxuICAnLmlmcmVmJyxcbiAgJy5pbmNsdWRlJyxcbiAgJy5sb2NhbCcsXG4gICcubWFjcm8nLFxuICAnLnByb2MnLFxuICAnLnNjb3BlJyxcbiAgJy5za2lwJyxcbl0gYXMgY29uc3Q7XG4iXX0=