import { DefaultMap } from './util.js';
export class UnionFind {
    constructor() {
        this.data = new Map();
        this.sizes = new Map();
    }
    find(elem) {
        if (elem !== elem)
            throw ('nan');
        if (!this.data.has(elem)) {
            this.data.set(elem, elem);
            this.sizes.set(elem, 1);
        }
        let next;
        while (!Object.is((next = this.data.get(elem)), elem)) {
            this.data.set(elem, elem = this.data.get(next));
        }
        return elem;
    }
    union(elems) {
        this.find(elems[0]);
        for (let i = 1; i < elems.length; i++) {
            if (elems[i] !== elems[i])
                throw ('nan');
            this.unionInternal(elems[0], elems[i]);
        }
    }
    unionInternal(a, b) {
        a = this.find(a);
        b = this.find(b);
        if (a === b)
            return;
        const sa = this.sizes.get(a);
        const sb = this.sizes.get(b);
        if (sa < sb) {
            this.sizes.set(b, sa + sb);
            this.data.set(a, b);
        }
        else {
            this.sizes.set(a, sa + sb);
            this.data.set(b, a);
        }
    }
    sets() {
        const sets = new Map();
        for (const elem of this.data.keys()) {
            const root = this.find(elem);
            let set = sets.get(root);
            if (!set)
                sets.set(root, set = new Set());
            set.add(elem);
        }
        return [...sets.values()];
    }
    map() {
        const sets = new DefaultMap(() => new Set());
        for (const elem of this.data.keys()) {
            let set = sets.get(this.find(elem));
            sets.set(elem, set);
            set.add(elem);
        }
        return sets;
    }
    roots() {
        const roots = new Set();
        for (const elem of this.data.keys()) {
            roots.add(this.find(elem));
        }
        return [...roots];
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidW5pb25maW5kLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vc3JjL2pzL3VuaW9uZmluZC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxPQUFPLEVBQUMsVUFBVSxFQUFDLE1BQU0sV0FBVyxDQUFDO0FBRXJDLE1BQU0sT0FBTyxTQUFTO0lBQXRCO1FBRW1CLFNBQUksR0FBYyxJQUFJLEdBQUcsRUFBRSxDQUFDO1FBQzVCLFVBQUssR0FBbUIsSUFBSSxHQUFHLEVBQUUsQ0FBQztJQW9FckQsQ0FBQztJQWpFQyxJQUFJLENBQUMsSUFBTztRQUNWLElBQUksSUFBSSxLQUFLLElBQUk7WUFBRSxNQUFLLENBQUMsS0FBSyxDQUFDLENBQUM7UUFDaEMsSUFBSSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsR0FBRyxDQUFDLElBQUksQ0FBQyxFQUFFO1lBQ3hCLElBQUksQ0FBQyxJQUFJLENBQUMsR0FBRyxDQUFDLElBQUksRUFBRSxJQUFJLENBQUMsQ0FBQztZQUMxQixJQUFJLENBQUMsS0FBSyxDQUFDLEdBQUcsQ0FBQyxJQUFJLEVBQUUsQ0FBQyxDQUFDLENBQUM7U0FDekI7UUFDRCxJQUFJLElBQU8sQ0FBQztRQUNaLE9BQU8sQ0FBQyxNQUFNLENBQUMsRUFBRSxDQUFDLENBQUMsSUFBSSxHQUFHLElBQUksQ0FBQyxJQUFJLENBQUMsR0FBRyxDQUFDLElBQUksQ0FBRSxDQUFDLEVBQUUsSUFBSSxDQUFDLEVBQUU7WUFDdEQsSUFBSSxDQUFDLElBQUksQ0FBQyxHQUFHLENBQUMsSUFBSSxFQUFFLElBQUksR0FBRyxJQUFJLENBQUMsSUFBSSxDQUFDLEdBQUcsQ0FBQyxJQUFJLENBQUUsQ0FBQyxDQUFDO1NBQ2xEO1FBQ0QsT0FBTyxJQUFJLENBQUM7SUFDZCxDQUFDO0lBRUQsS0FBSyxDQUFDLEtBQVU7UUFDZCxJQUFJLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDO1FBQ3BCLEtBQUssSUFBSSxD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LElBQUksQ0FBQyxDQUFDLENBQUM7U0FDNUI7UUFDRCxPQUFPLENBQUMsR0FBRyxLQUFLLENBQUMsQ0FBQztJQUNwQixDQUFDO0NBQ0YiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQge0RlZmF1bHRNYXB9IGZyb20gJy4vdXRpbC5qcyc7XG5cbmV4cG9ydCBjbGFzcyBVbmlvbkZpbmQ8VD4ge1xuXG4gIHByaXZhdGUgcmVhZG9ubHkgZGF0YTogTWFwPFQsIFQ+ID0gbmV3IE1hcCgpO1xuICBwcml2YXRlIHJlYWRvbmx5IHNpemVzOiBNYXA8VCwgbnVtYmVyPiA9IG5ldyBNYXAoKTtcblxuICAvKiogUmV0dXJucyB0aGUgY2Fub25pY2FsIGVsZW1lbnQgZm9yIHRoZSBnaXZlbiBlbnRyeS4gKi9cbiAgZmluZChlbGVtOiBUKTogVCB7XG4gICAgaWYgKGVsZW0gIT09IGVsZW0pIHRocm93KCduYW4nKTtcbiAgICBpZiAoIXRoaXMuZGF0YS5oYXMoZWxlbSkpIHtcbiAgICAgIHRoaXMuZGF0YS5zZXQoZWxlbSwgZWxlbSk7XG4gICAgICB0aGlzLnNpemVzLnNldChlbGVtLCAxKTtcbiAgICB9XG4gICAgbGV0IG5leHQ6IFQ7XG4gICAgd2hpbGUgKCFPYmplY3QuaXMoKG5leHQgPSB0aGlzLmRhdGEuZ2V0KGVsZW0pISksIGVsZW0pKSB7XG4gICAgICB0aGlzLmRhdGEuc2V0KGVsZW0sIGVsZW0gPSB0aGlzLmRhdGEuZ2V0KG5leHQpISk7XG4gICAgfVxuICAgIHJldHVybiBlbGVtO1xuICB9XG5cbiAgdW5pb24oZWxlbXM6IFRbXSkge1xuICAgIHRoaXMuZmluZChlbGVtc1swXSk7XG4gICAgZm9yIChsZXQgaSA9IDE7IGkgPCBlbGVtcy5sZW5ndGg7IGkrKykge1xuICAgICAgaWYgKGVsZW1zW2ldICE9PSBlbGVtc1tpXSkgdGhyb3coJ25hbicpO1xuICAgICAgdGhpcy51bmlvbkludGVybmFsKGVsZW1zWzBdLCBlbGVtc1tpXSk7XG4gICAgfVxuICB9XG5cbiAgcHJpdmF0ZSB1bmlvbkludGVybmFsKGE6IFQsIGI6IFQpIHtcbiAgICBhID0gdGhpcy5maW5kKGEpO1xuICAgIGIgPSB0aGlzLmZpbmQoYik7XG4gICAgaWYgKGEgPT09IGIpIHJldHVybjtcbiAgICBjb25zdCBzYSA9IHRoaXMuc2l6ZXMuZ2V0KGEpITtcbiAgICBjb25zdCBzYiA9IHRoaXMuc2l6ZXMuZ2V0KGIpITtcbiAgICBpZiAoc2EgPCBzYikge1xuICAgICAgdGhpcy5zaXplcy5zZXQoYiwgc2EgKyBzYik7XG4gICAgICB0aGlzLmRhdGEuc2V0KGEsIGIpO1xuICAgIH0gZWxzZSB7XG4gICAgICB0aGlzLnNpemVzLnNldChhLCBzYSArIHNiKTtcbiAgICAgIHRoaXMuZGF0YS5zZXQoYiwgYSk7XG4gICAgfVxuICB9XG5cbiAgc2V0cygpOiBTZXQ8VD5bXSB7XG4gICAgY29uc3Qgc2V0cyA9IG5ldyBNYXA8VCwgU2V0PFQ+PigpO1xuICAgIGZvciAoY29uc3QgZWxlbSBvZiB0aGlzLmRhdGEua2V5cygpKSB7XG4gICAgICBjb25zdCByb290ID0gdGhpcy5maW5kKGVsZW0pO1xuICAgICAgbGV0IHNldCA9IHNldHMuZ2V0KHJvb3QpO1xuICAgICAgaWYgKCFzZXQpIHNldHMuc2V0KHJvb3QsIHNldCA9IG5ldyBTZXQ8VD4oKSk7XG4gICAgICBzZXQuYWRkKGVsZW0pO1xuICAgIH1cbiAgICByZXR1cm4gWy4uLnNldHMudmFsdWVzKCldO1xuICB9XG5cbiAgLyoqIEByZXR1cm4gbWFwIG9mIGFsbCBlbGVtZW50cyB0byB0aGVpciBlcXVpdmFsZW5jZSBzZXQuICovXG4gIG1hcCgpOiBNYXA8VCwgU2V0PFQ+PiB7XG4gICAgY29uc3Qgc2V0cyA9IG5ldyBEZWZhdWx0TWFwPFQsIFNldDxUPj4oKCkgPT4gbmV3IFNldCgpKTtcbiAgICBmb3IgKGNvbnN0IGVsZW0gb2YgdGhpcy5kYXRhLmtleXMoKSkge1xuICAgICAgbGV0IHNldCA9IHNldHMuZ2V0KHRoaXMuZmluZChlbGVtKSk7XG4gICAgICBzZXRzLnNldChlbGVtLCBzZXQpO1xuICAgICAgc2V0LmFkZChlbGVtKTtcbiAgICB9XG4gICAgcmV0dXJuIHNldHM7XG4gIH1cblxuICByb290cygpOiBUW10ge1xuICAgIGNvbnN0IHJvb3RzID0gbmV3IFNldDxUPigpO1xuICAgIGZvciAoY29uc3QgZWxlbSBvZiB0aGlzLmRhdGEua2V5cygpKSB7XG4gICAgICByb290cy5hZGQodGhpcy5maW5kKGVsZW0pKTtcbiAgICB9XG4gICAgcmV0dXJuIFsuLi5yb290c107XG4gIH1cbn1cbiJdfQ==