import{a as N,b as H,c as I,d as v,f as b,g as $,h as B,i as O,j,k as T,l as P,m as _,n as w,o as q,p as R,q as V}from"./chunk-E4XRHSNR.js";import{R as U}from"./chunk-KKWSL4TA.js";function z(e){let t=!0;for(let{name:n,flagString:a,description:s}of H.all()){let o=document.createElement("h2");o.textContent=n,e.appendChild(o);let r=document.createElement("p");r.innerHTML=s,e.appendChild(r);let l=document.createElement("a");l.textContent=a,l.classList.add("button"),l.classList.add("preset-flags"),l.dataset.flags=a,a.length>48&&l.classList.add("small"),t&&(l.dataset.defaultPreset="true"),t=!1,e.appendChild(l)}}function J(e){for(let{name:t,description:n,flags:a}of I.all()){let s=document.createElement("h2");if(s.textContent=t,e.appendChild(s),n){let r=document.createElement("p");r.innerHTML=n,e.appendChild(r)}let o=document.createElement("div");o.classList.add("flag-list"),e.appendChild(o);for(let r of a.values()){let{flag:l,opts:{hard:i,name:u,text:E}}=r,g=document.createElement("div");if(g.textContent=`${l}: ${u}`,g.classList.add("checkbox"),i&&g.classList.add("hard"),E){let c=document.createElement("div");c.classList.add("flag-body"),c.innerHTML=E,g.appendChild(c)}o.appendChild(g)}}}async function K(e){let t=w.get("simea");for(let n of t.values()){let a=document.createElement("div");A(a,await n),e.appendChild(a)}}function A(e,t){e.className="flex-row",e.style.width="100%";let n=document.createElement("input");n.type="radio",n.name="simea-replacement",n.id=`simea-replacement-${t.name}`,n.value=t.name,n.style.display="none",t.name=="Simea"&&(n.checked=!0),e.appendChild(n);let a=document.createElement("label");a.className="sprite-replacement",a.htmlFor=`simea-replacement-${t.name}`;let s=document.createElement("img");s.width=112,s.height=98,s.style.float="left",P(t.nssdata).then(r=>s.src=r),a.appendChild(s);let o=document.createElement("div");if(o.textContent=t.name,o.className="title",a.appendChild(o),t.description){let r=document.createElement("div");r.innerHTML=t.description,r.className="desc",a.appendChild(r)}e.appendChild(a)}function W(e,t){for(let{name:n,description:a,flags:s}of I.all()){let o=!1,r=document.createElement("h2");r.textContent=n;let l=a?document.createElement("p"):null;l&&(l.innerHTML=a);let i=document.createElement("div");i.classList.add("flag-list");for(let u of s.values()){let{flag:E,opts:{hard:g,name:c,text:d}}=u;if(!t.check(u))continue;o=!0;let m=document.createElement("div");if(m.textContent=`${E}: ${c}`,m.classList.add("checkbox"),g&&m.classList.add("hard"),d){let C=document.createElement("div");C.classList.add("flag-body"),C.innerHTML=d,m.appendChild(C)}i.appendChild(m)}o&&(e.appendChild(r),l&&e.appendChild(l),e.appendChild(i))}}var L=class{constructor(){this.tasks=0,this.completed=0}addTasks(t){this.tasks+=t}addCompleted(t){this.completed+=t}value(){return this.tasks&&this.completed/this.tasks}};var p,f,x,F,re=!1,M=!1;window.global=window;var Z=typeof CR_PERMALINK=="boolean"&&CR_PERMALINK;function S(e,...t){(window.ga||(()=>{}))("gtag_UA_131783670_1."+e,...t)}var le=()=>{re=!0,se(),ae(),k(!1),ne(),window.addEventListener("popstate",e=>{k(!1)}),document.body.addEventListener("click",te),ee()},de=()=>{if(Z&&document.body.classList.add("permalink"),document.getElementById("race")==null){le(),W(document.getElementById("flags"),p);for(let e of[...document.getElementsByClassName("checkbox")])Q(e);for(let e of document.querySelectorAll('.flag-list > input[type="checkbox"]'))e.checked=!0,e.disabled=!0;return}z(document.getElementById("presets")),J(document.getElementById("select-options")),K(document.getElementById("simea-sprite-options")).then(()=>{ae()}),se(),k(!0),p||document.querySelector("[data-default-preset]").click();for(let e of[...document.getElementsByClassName("checkbox")])Q(e);if(y(),ce(),document.body.addEventListener("click",te),window.addEventListener("popstate",e=>{e.state?(p=new v(e.state.flags),f=e.state.seed):k(!0)}),M){let e=document.createElement("section");e.classList.add("expandable");let t=document.createElement("h1");t.textContent="Debug",e.appendChild(t);let n=document.createElement("div");n.id="debug",e.appendChild(n),document.querySelector("main").appendChild(e)}ee()},ee=()=>{if(O!=="latest"){let e=Z?"":"Current version: ";for(let t of document.getElementsByClassName("version"))t.textContent=`${e}${B} (${j.toDateString()})`}if(T){let e=document.querySelector("nav"),t=document.createElement("a");t.textContent="Older",t.href=`/sha/${T}`,t.style.float="right",e.appendChild(t)}document.body.classList.add("js-works"),document.body.classList.remove("js-broken"),b=="rc"?(document.body.classList.add("release-candidate"),document.body.classList.add("versioned")):b=="stable"&&document.body.classList.add("versioned")},ce=()=>{let e=document.getElementById("seed"),t=()=>{f=e.value,y()};e.addEventListener("keyup",t),e.addEventListener("change",t)},k=e=>{for(let t of location.hash.substring(1).split("&")){let[n,a]=t.split("=");a=decodeURIComponent(a),n==="flags"&&(p=new v(a)),n==="seed"&&(f=decodeURIComponent(a)),n==="race"&&document.body.classList.add("race"),n==="debug"&&(M=!0);for(let s of document.querySelectorAll("[data-flags]"))s.addEventListener("click",()=>{p=new v(s.dataset.flags),$=="unstable"&&p.set("Ds",!0),y()})}};async function te(e){let t=e.target,n=`${B}: ${p}`,a=new Date().getTime();for(;t;){if(t.tagName==="H1"&&t.parentElement.classList.contains("expandable")){t.parentElement.classList.toggle("expanded");break}else if(t.id==="preset-apply"){S("send","event","custom-preset"),p=new v(document.getElementById("flagstring").value),y();break}else if(t.id==="new-seed"){S("send","event","Main","new-seed"),f=Math.floor(Math.random()*4294967296).toString(16),y();break}else if(t.id==="generate"){S("send","event","Main","generate",n);let s=R(f),[o,r]=await X(s);if(S("send","timing","Main","generate",new Date().getTime()-a,n),!o)break;let l=F.replace(/\.nes|$/,["_",s.toString(16).padStart(8,0),"_",r.toString(16).padStart(8,0),".nes"].join(""));ie(o,l);break}else if(t.id==="spoiler"){S("send","event","Main","spoiler",n),await X(R(f)),S("send","timing","Main","spoiler",new Date().getTime()-a,n);break}t=t.parentElement}}var G=(e,t,n)=>{let a=[];for(let s=0;s<n;s++)a.push(String.fromCharCode(e[t+2*s]));return a.join("")},X=async e=>{for(let c of document.getElementsByClassName("seed-out"))c.textContent=e.toString(16).padStart(8,"0");let t=document.getElementById("progress"),n=new L,a=x.slice(),s=!1,o=new v(String(p));document.body.classList.add("shuffling");let r=p.check("Ds")?{}:void 0,l=()=>{s||(t.value=n.value(),setTimeout(l,120))};l();let i,u,E=document.querySelector('input[name="simea-replacement"]:checked').value,g=await w.get("simea").get(E);try{[i,u]=await V(a,e,o,[g],r,n)}catch(c){let d=c.name==="UsageError";document.body.classList.add(d?"invalid":"failure");let m=document.getElementById(d?"invalid-text":"error-text");throw m.textContent=d?c.message:c.stack,m.parentElement.parentElement.scrollIntoViewIfNeeded(),document.getElementById("checksum").textContent="SHUFFLE FAILED!",c}if(u<0)return document.getElementById("checksum").textContent=`SHUFFLE FAILED! ${u}`,[null,null];if(s=!0,document.body.classList.remove("shuffling"),r&&r.spoiler){let c=r.spoiler;c.flags&&h("spoiler-flags",[c.flags]),h("spoiler-items",D(c.slots.filter(d=>d),d=>d.item)),h("spoiler-route",c.route),h("spoiler-mazes",D(c.mazes,d=>d.location).map(({name:d,maze:m})=>`${d}:
${m}`)),h("spoiler-trades",c.trades.map(({item:d,npc:m})=>`${m}: ${d}`).sort()),h("spoiler-item-names",c.unidentifiedItems.map(({oldName:d,newName:m})=>`${m}: ${d}`).sort()),h("spoiler-walls",D(c.walls,d=>d.location).map(({location:d,oldElement:m,newElement:C})=>`${d}${m===3?" (iron)":""}: ${["wind","fire","water","thunder"][C]}`)),h("spoiler-wild-warps",c.wildWarps.map(({name:d})=>d)),h("spoiler-houses",c.houses.map(({house:d,town:m})=>`${d}: ${m}`.replace(/\s*-\s*/g," ")))}return document.getElementById("checksum").textContent=G(i,161941,4)+G(i,161942,4),[i,u]};function D(e,t){return[...e].sort((n,a)=>{let s=t(n),o=t(a);return s<o?-1:s>o?1:0})}var h=(e,t)=>{let n=document.getElementById(e);for(;n.children.length;)n.lastChild.remove();for(let a of t){let s=document.createElement("li");s.textContent=a,n.appendChild(s)}n.previousElementSibling.classList.toggle("empty-spoiler",!t.length)},Q=e=>{let t=e.getElementsByClassName("flag-body")[0];t&&t.remove();let[n,a]=e.textContent.split(/:\s*/),s=document.createElement("input");s.type="checkbox",s.id=`flag-${n}`,s.dataset.flag=n,s.dataset.mode="false",e.parentElement.insertBefore(s,e);let o=document.createElement("label");o.textContent=n,o.htmlFor=s.id,e.parentElement.insertBefore(o,e);let r=document.createElement("div");e.parentElement.insertBefore(r,e);let l=document.createElement("label");l.textContent=a,l.htmlFor=s.id,r.appendChild(l),t&&r.appendChild(t),e.classList.contains("hard")&&(o.classList.add("hard"),l.classList.add("hard"),l.textContent+=" *"),e.remove(),s.addEventListener("change",()=>{window.FLAGS=p;let i=p.toggle(n);i?i===!0?(s.checked=!0,o.textContent=n):(s.checked=!0,o.textContent=`${n[0]}${i}${n.substring(1)}`):(s.checked=!1,o.textContent=n),y()})},y=()=>{document.body.classList.remove("failure"),document.body.classList.remove("invalid");for(let n of document.querySelectorAll("input[data-flag]")){let a=n.dataset.flag,s=p.get(a);n.checked=s!==!1;let o=typeof s=="boolean"?"":s;n.nextElementSibling.textContent=`${a[0]}${o}${a.substring(1)}`}let e=String(p).replace(/ /g,"");document.getElementById("seed").value=f||"";let t=["#flags=",e];if(f&&t.push("&seed=",encodeURIComponent(f)),M&&t.push("&debug"),history.replaceState({flags:String(p),seed:f},"",String(window.location).replace(/#.*/,"")+t.join("")),b=="stable"||b=="rc"){let n=f||Math.floor(Math.random()*4294967296).toString(16),a=$,s=e;document.getElementById("race").href=`/${a}/race#flags=${s}&seed=${n}`}ne()},ne=()=>{let e=String(p);document.body.classList.toggle("spoiled",p.check("Ds")),document.body.classList.toggle("debug-mode",/D/.test(e));for(let t of document.getElementsByClassName("flagstring-out"))t.textContent=e},se=()=>{let e=window.localStorage.getItem("name"),t=window.localStorage.getItem("rom"),n=document.getElementById("pick-file"),a=()=>{document.body.classList.add("rom-uploaded"),document.body.classList.toggle("rom-broken",N(x)!=U)};e&&t&&(F=e,x=Uint8Array.from(new Array(t.length/2).fill(0).map((s,o)=>Number.parseInt(t[2*o]+t[2*o+1],16))),a()),n.addEventListener("change",()=>{let s=n.files[0],o=new FileReader;o.addEventListener("loadend",()=>{let r=new Uint8Array(o.result),l=16+(r[6]&4?512:0)+(r[4]<<14)+(r[5]<<13),i=r.slice(0,l),u=Array.from(i,E=>E.toString(16).padStart(2,0)).join("");x=i,window.localStorage.setItem("rom",u),window.localStorage.setItem("name",s.name),a(),F=s.name}),o.readAsArrayBuffer(s)})},Y=()=>{let e=window.localStorage.getItem("simea-replacement"),t=window.localStorage.getItem("simea-replacement-custom")||"{}",n=JSON.parse(t),a=document.getElementById("simea-sprite-custom");a.innerHTML="";for(let[s,o]of Object.entries(n)){w.get("simea").set(o.name,Promise.resolve(o)),A(a,o);let r=document.getElementById(`simea-replacement-${o.name}`);r.addEventListener("change",l=>{window.localStorage.setItem("simea-replacement",l.target.value)}),r.value==e&&(r.checked=!0)}},ae=()=>{let e=window.localStorage.getItem("simea-replacement"),t=document.getElementsByName("simea-replacement");for(let a of t)a.value==e&&(a.checked=!0);t.forEach(a=>{a.addEventListener("change",s=>{window.localStorage.setItem("simea-replacement",s.target.value)})}),Y();let n=document.getElementById("upload-sprite");n.addEventListener("change",()=>{let a=n.files[0],s=new FileReader;s.addEventListener("loadend",()=>{let o=window.localStorage.getItem("simea-replacement-custom")||"{}",r=JSON.parse(o),l=s.result,i=a.name.replace(/\.[^/.]+$/,"").replaceAll(/_/g," ");_.init(i,"simea",q(a.name,l),`Loaded on ${new Date().toLocaleString()}`).then(u=>{r[i]=u,window.localStorage.setItem("simea-replacement-custom",JSON.stringify(r)),Y()}),n.value=""}),s.readAsText(a)})},ie=(e,t)=>{let n=document.createElement("a");document.body.appendChild(n),n.style="display: none";let a=new Blob([e],{type:"octet/stream"}),s=window.URL.createObjectURL(a);n.href=s,n.download=t,n.click(),window.URL.revokeObjectURL(s),n.remove()};de();
