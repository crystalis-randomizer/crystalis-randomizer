import{a as Z,b as Fe,c as Q,d as M,e as x,f as Y,j as I,k as $,l as D,m as te,n as ne,o as P,p as Ue,q as se,r as F,s as k,t as ae,u as re,v as z,w as ie,x as Ae}from"./chunk-KNA2XUGX.js";import{a as T,b as G,c as K,ua as ee,va as Ne}from"./chunk-B33TVQCT.js";var le={};G(le,{MarcFile:()=>m,createIPSFromFiles:()=>$e,parseIPSFile:()=>Me});function R(){this.records=[],this.truncate=!1}function Me(e){var t=new R;for(e.seek(5);!e.isEOF();){var n=e.readU24();if(n===4542278){if(e.isEOF())break;if(e.offset+3===e.fileSize){t.truncate=e.readU24();break}}var s=e.readU16();s===0?t.addRLERecord(n,e.readU16(),e.readU8()):t.addSimpleRecord(n,e.readBytes(s))}return t}function $e(e,t){var n=new R;t.fileSize<e.fileSize&&(n.truncate=t.fileSize);for(var s={type:3735928559,startOffset:0,length:0};!t.isEOF();){var a=e.isEOF()?0:e.readU8(),i=t.readU8();if(a!==i){for(var l=!0,o=[],f=t.offset-1;a!==i&&o.length<65535&&(o.push(i),i!==o[0]&&(l=!1),!(t.isEOF()||o.length===65535));)a=e.isEOF()?0:e.readU8(),i=t.readU8();var c=f-(s.offset+s.length);if(s.type===1&&c<6&&s.length+c+o.length<65535)if(l&&o.length>6)e.seek(f),t.seek(f),s={type:3735928559,startOffset:0,length:0};else{for(;c--;)s.data.push(t._u8array[s.offset+s.length]),s.length++;s.data=s.data.concat(o),s.length=s.data.length}else{if(f>=16777216)throw new Error("files are too big for IPS format");l&&o.length>2?n.addRLERecord(f,o.length,o[0]):n.addSimpleRecord(f,o),s=n.records[n.records.length-1]}}}if(t.fileSize>e.fileSize){var p=n.records[n.records.length-1],u=p.offset+p.length;u<t.fileSize&&n.addSimpleRecord(t.fileSize-1,[0])}return n}function m(e,t){if(typeof e=="object"&&e.files&&(e=e.files[0]),this.littleEndian=!1,this.offset=0,this._lastRead=null,typeof e=="object"&&e.name&&e.size){if(typeof window.FileReader!="function")throw new Error("Incompatible Browser");this.fileName=e.name,this.fileType=e.type,this.fileSize=e.size,this._fileReader=new FileReader,this._fileReader.marcFile=this,this._fileReader.addEventListener("load",function(){this.marcFile._u8array=new Uint8Array(this.result),this.marcFile._dataView=new DataView(this.result),t&&t.call()},!1),this._fileReader.readAsArrayBuffer(e)}else if(typeof e=="object"&&typeof e.fileName=="string"&&typeof e.littleEndian=="boolean"){this.fileName=e.fileName,this.fileType=e.fileType,this.fileSize=e.fileSize;var n=new ArrayBuffer(e);this._u8array=new Uint8Array(this.fileType),this._dataView=new DataView(this.fileType),e.copyToFile(this,0),t&&t.call()}else if(typeof e=="object"&&typeof e.byteLength=="number")this.fileName="file.bin",this.fileType="application/octet-stream",this.fileSize=e.byteLength,typeof e.buffer<"u"&&(e=e.buffer),this._u8array=new Uint8Array(e),this._dataView=new DataView(e),t&&t.call();else if(typeof e=="number"){this.fileName="file.bin",this.fileType="application/octet-stream",this.fileSize=e;var n=new ArrayBuffer(e);this._u8array=new Uint8Array(n),this._dataView=new DataView(n),t&&t.call()}else throw new Error("Invalid source")}var Oe,oe,de=T(()=>{Oe="PATCH";R.prototype.addSimpleRecord=function(e,t){this.records.push({offset:e,type:1,length:t.length,data:t})};R.prototype.addRLERecord=function(e,t,n){this.records.push({offset:e,type:0,length:t,byte:n})};R.prototype.toString=function(){nSimpleRecords=0,nRLERecords=0;for(var e=0;e<this.records.length;e++)this.records[e].type===0?nRLERecords++:nSimpleRecords++;var t="Simple records: "+nSimpleRecords;return t+=`
RLE records: `+nRLERecords,t+=`
Total records: `+this.records.length,this.truncate&&(t+=`
Truncate at: 0x`+this.truncate.toString(16)),t};R.prototype.export=function(e){for(var t=5,n=0;n<this.records.length;n++)this.records[n].type===0?t+=3+2+2+1:t+=3+2+this.records[n].data.length;t+=3,this.truncate&&(t+=3);let s=new m(t);s.fileName=e+".ips",s.writeString(Oe);for(var n=0;n<this.records.length;n++){var a=this.records[n];s.writeU24(a.offset),a.type===0?(s.writeU16(0),s.writeU16(a.length),s.writeU8(a.byte)):(s.writeU16(a.data.length),s.writeBytes(a.data))}return s.writeString("EOF"),a.truncate&&s.writeU24(a.truncate),s};R.prototype.apply=function(e){if(this.truncate)this.truncate>e.fileSize?(tempFile=new m(this.truncate),e.copyToFile(tempFile,0,e.fileSize,0)):tempFile=e.slice(0,this.truncate);else{for(var t=e.fileSize,n=0;n<this.records.length;n++){var s=this.records[n];s.type===0?s.offset+s.length>t&&(t=s.offset+s.length):s.offset+s.data.length>t&&(t=s.offset+s.data.length)}t===e.fileSize?tempFile=e.slice(0,e.fileSize):(tempFile=new m(t),e.copyToFile(tempFile,0))}e.seek(0);for(var n=0;n<this.records.length;n++)if(tempFile.seek(this.records[n].offset),this.records[n].type===0)for(var a=0;a<this.records[n].length;a++)tempFile.writeU8(this.records[n].byte);else tempFile.writeBytes(this.records[n].data);return tempFile};m.IS_MACHINE_LITTLE_ENDIAN=function(){var e=new ArrayBuffer(2);return new DataView(e).setInt16(0,256,!0),new Int16Array(e)[0]===256}();m.prototype.seek=function(e){this.offset=e};m.prototype.skip=function(e){this.offset+=e};m.prototype.isEOF=function(){return!(this.offset<this.fileSize)};m.prototype.slice=function(e,t){t=t||this.fileSize-e;var n;return typeof this._u8array.buffer.slice<"u"?(n=new m(0),n.fileSize=t,n._u8array=new Uint8Array(this._u8array.buffer.slice(e,e+t))):(n=new m(t),this.copyToFile(n,e,t,0)),n.fileName=this.fileName,n.fileType=this.fileType,n.littleEndian=this.littleEndian,n};m.prototype.copyToFile=function(e,t,n,s){typeof s>"u"&&(s=t),n=n||this.fileSize-t;for(var a=0;a<n;a++)e._u8array[s+a]=this._u8array[t+a]};m.prototype.save=function(){var e;try{e=new Blob([this._u8array],{type:this.fileType})}catch(n){if(window.BlobBuilder=window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder||window.MSBlobBuilder,n.name==="InvalidStateError"&&window.BlobBuilder){var t=new BlobBuilder;t.append(this._u8array.buffer),e=t.getBlob(this.fileType)}else throw new Error("Incompatible Browser")}oe(e,this.fileName)};m.prototype.getExtension=function(){var e=this.fileName?this.fileName.toLowerCase().match(/\.(\w+)$/):"";return e?e[1]:""};m.prototype.readU8=function(){return this._lastRead=this._u8array[this.offset],this.offset++,this._lastRead};m.prototype.readU16=function(){return this.littleEndian?this._lastRead=this._u8array[this.offset]+(this._u8array[this.offset+1]<<8):this._lastRead=(this._u8array[this.offset]<<8)+this._u8array[this.offset+1],this.offset+=2,this._lastRead>>>0};m.prototype.readU24=function(){return this.littleEndian?this._lastRead=this._u8array[this.offset]+(this._u8array[this.offset+1]<<8)+(this._u8array[this.offset+2]<<16):this._lastRead=(this._u8array[this.offset]<<16)+(this._u8array[this.offset+1]<<8)+this._u8array[this.offset+2],this.offset+=3,this._lastRead>>>0};m.prototype.readU32=function(){return this.littleEndian?this._lastRead=this._u8array[this.offset]+(this._u8array[this.offset+1]<<8)+(this._u8array[this.offset+2]<<16)+(this._u8array[this.offset+3]<<24):this._lastRead=(this._u8array[this.offset]<<24)+(this._u8array[this.offset+1]<<16)+(this._u8array[this.offset+2]<<8)+this._u8array[this.offset+3],this.offset+=4,this._lastRead>>>0};m.prototype.readBytes=function(e){this._lastRead=new Array(e);for(var t=0;t<e;t++)this._lastRead[t]=this._u8array[this.offset+t];return this.offset+=e,this._lastRead};m.prototype.readString=function(e){this._lastRead="";for(var t=0;t<e&&this.offset+t<this.fileSize&&this._u8array[this.offset+t]>0;t++)this._lastRead=this._lastRead+String.fromCharCode(this._u8array[this.offset+t]);return this.offset+=e,this._lastRead};m.prototype.writeU8=function(e){this._u8array[this.offset]=e,this.offset++};m.prototype.writeU16=function(e){this.littleEndian?(this._u8array[this.offset]=e&255,this._u8array[this.offset+1]=e>>8):(this._u8array[this.offset]=e>>8,this._u8array[this.offset+1]=e&255),this.offset+=2};m.prototype.writeU24=function(e){this.littleEndian?(this._u8array[this.offset]=e&255,this._u8array[this.offset+1]=(e&65280)>>8,this._u8array[this.offset+2]=(e&16711680)>>16):(this._u8array[this.offset]=(e&16711680)>>16,this._u8array[this.offset+1]=(e&65280)>>8,this._u8array[this.offset+2]=e&255),this.offset+=3};m.prototype.writeU32=function(e){this.littleEndian?(this._u8array[this.offset]=e&255,this._u8array[this.offset+1]=(e&65280)>>8,this._u8array[this.offset+2]=(e&16711680)>>16,this._u8array[this.offset+3]=(e&4278190080)>>24):(this._u8array[this.offset]=(e&4278190080)>>24,this._u8array[this.offset+1]=(e&16711680)>>16,this._u8array[this.offset+2]=(e&65280)>>8,this._u8array[this.offset+3]=e&255),this.offset+=4};m.prototype.writeBytes=function(e){for(var t=0;t<e.length;t++)this._u8array[this.offset+t]=e[t];this.offset+=e.length};m.prototype.writeString=function(e,t){t=t||e.length;for(var n=0;n<e.length&&n<t;n++)this._u8array[this.offset+n]=e.charCodeAt(n);for(;n<t;n++)this._u8array[this.offset+n]=0;this.offset+=t};oe=oe||function(e){"use strict";if(!(e===void 0||typeof navigator<"u"&&/MSIE [1-9]\./.test(navigator.userAgent))){var t=e.document,n=function(){return e.URL||e.webkitURL||e},s=t.createElementNS("http://www.w3.org/1999/xhtml","a"),a="download"in s,i=/constructor/i.test(e.HTMLElement)||e.safari,l=/CriOS\/[\d]+/.test(navigator.userAgent),o=e.setImmediate||e.setTimeout,f=function(r){o(function(){throw r},0)},c=function(r){setTimeout(function(){typeof r=="string"?n().revokeObjectURL(r):r.remove()},4e4)},p=function(r){return/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(r.type)?new Blob([String.fromCharCode(65279),r],{type:r.type}):r},u=function(r,h,g){g||(r=p(r));var b,w=this,J=r.type==="application/octet-stream",O=function(){(function(S,v,Be){for(var W=(v=[].concat(v)).length;W--;){var X=S["on"+v[W]];if(typeof X=="function")try{X.call(S,Be||S)}catch(Te){f(Te)}}})(w,"writestart progress write writeend".split(" "))};if(w.readyState=w.INIT,a)return b=n().createObjectURL(r),void o(function(){var S,v;s.href=b,s.download=h,S=s,v=new MouseEvent("click"),S.dispatchEvent(v),O(),c(b),w.readyState=w.DONE},0);(function(){if((l||J&&i)&&e.FileReader){var S=new FileReader;return S.onloadend=function(){var v=l?S.result:S.result.replace(/^data:[^;]*;/,"data:attachment/file;");e.open(v,"_blank")||(e.location.href=v),v=void 0,w.readyState=w.DONE,O()},S.readAsDataURL(r),w.readyState=w.INIT}b||(b=n().createObjectURL(r)),J?e.location.href=b:e.open(b,"_blank")||(e.location.href=b),w.readyState=w.DONE,O(),c(b)})()},d=u.prototype;return typeof navigator<"u"&&navigator.msSaveOrOpenBlob?function(r,h,g){return h=h||r.name||"download",g||(r=p(r)),navigator.msSaveOrOpenBlob(r,h)}:(d.abort=function(){},d.readyState=d.INIT=0,d.WRITING=1,d.DONE=2,d.error=d.onwritestart=d.onprogress=d.onwrite=d.onabort=d.onerror=d.onwriteend=null,function(r,h,g){return new u(r,h||r.name||"download",g)})}}(typeof self<"u"&&self||typeof window<"u"&&window||void 0)});function fe(e){let t=!0;for(let{name:n,flagString:s,description:a}of Q.all()){let i=document.createElement("h2");i.textContent=n,e.appendChild(i);let l=document.createElement("p");l.innerHTML=a,e.appendChild(l);let o=document.createElement("a");o.textContent=s,o.classList.add("button"),o.classList.add("preset-flags"),o.dataset.flags=s,s.length>48&&o.classList.add("small"),t&&(o.dataset.defaultPreset="true"),t=!1,e.appendChild(o)}}function he(e){for(let{name:t,description:n,flags:s}of M.all()){let a=document.createElement("h2");if(a.textContent=t,e.appendChild(a),n){let l=document.createElement("p");l.innerHTML=n,e.appendChild(l)}let i=document.createElement("div");i.classList.add("flag-list"),e.appendChild(i);for(let l of s.values()){let{flag:o,opts:{hard:f,name:c,text:p}}=l,u=document.createElement("div");if(u.textContent=`${o}: ${c}`,u.classList.add("checkbox"),f&&u.classList.add("hard"),p){let d=document.createElement("div");d.classList.add("flag-body"),d.innerHTML=p,u.appendChild(d)}i.appendChild(u)}}}async function me(e){let t=k.get("simea");for(let n of t.values()){let s=document.createElement("div");pe(s,"",await n),e.appendChild(s)}}function pe(e,t,n){e.className="flex-row",e.style.width="100%";let s=document.createElement("input");s.type="radio",s.name="simea-replacement",s.id=`simea-replacement-${n.name}`,s.value=n.name,s.style.display="none",n.name=="Simea"&&(s.checked=!0),e.appendChild(s);let a=document.createElement("label");a.style.position="relative",a.className="sprite-replacement",a.htmlFor=`simea-replacement-${n.name}`;let i=document.createElement("img");i.width=112,i.height=98,i.style.float="left",se(n.nssdata).then(c=>i.src=c),a.appendChild(i);let l=document.createElement("div");if(l.textContent=n.name,l.className="title",a.appendChild(l),n.description){let c=document.createElement("div");c.innerHTML=n.description,c.className="desc",a.appendChild(c)}if(t!=""){let c=document.createElement("div");c.textContent="X",c.className="button",c.style.position="absolute",c.style.top="0",c.style.right="0",c.style.margin="5px",c.onclick=function(){let p=window.localStorage.getItem("simea-replacement"),u=window.localStorage.getItem("simea-replacement-custom")||"{}",d=JSON.parse(u);if(delete d[t],window.localStorage.setItem("simea-replacement-custom",JSON.stringify(d)),n.name==p){let r=document.getElementsByName("simea-replacement");for(let h of r){let g=h;g.value=="Simea"&&(g.checked=!0)}}N()},a.appendChild(c)}let o=document.createElement("div"),f=document.createElement("a");f.textContent="Download .ips",f.className="button",f.onclick=function(){let c=ce.rom.slice(),p=ce.rom.slice();F.applyPatch(n,p,!1);let u=new H.MarcFile(c),d=new H.MarcFile(p);H.createIPSFromFiles(u,d).export(n.name).save()},o.appendChild(f),o.style.marginTop="8px",a.appendChild(o),e.appendChild(a)}function ue(e,t){for(let{name:n,description:s,flags:a}of M.all()){let i=!1,l=document.createElement("h2");l.textContent=n;let o=s?document.createElement("p"):null;o&&(o.innerHTML=s);let f=document.createElement("div");f.classList.add("flag-list");for(let c of a.values()){let{flag:p,opts:{hard:u,name:d,text:r}}=c;if(!t.check(c))continue;i=!0;let h=document.createElement("div");if(h.textContent=`${p}: ${d}`,h.classList.add("checkbox"),u&&h.classList.add("hard"),r){let g=document.createElement("div");g.classList.add("flag-body"),g.innerHTML=r,h.appendChild(g)}f.appendChild(h)}i&&(e.appendChild(l),o&&e.appendChild(o),e.appendChild(f))}}var H,ce,N,ye=T(()=>{re();Y();H=(de(),K(le)),ce=(we(),K(ge));N=()=>{let e=window.localStorage.getItem("simea-replacement"),t=window.localStorage.getItem("simea-replacement-custom")||"{}",n=JSON.parse(t),s=document.getElementById("simea-sprite-custom");s.innerHTML="";for(let[a,i]of Object.entries(n)){let l=i;k.get("simea").set(l.name,Promise.resolve(l)),pe(s,a,l);let f=document.getElementById(`simea-replacement-${l.name}`);f.addEventListener("change",c=>{window.localStorage.setItem("simea-replacement",c.target.value)}),f.value==e&&(f.checked=!0)}}});var U,Se=T(()=>{U=class{constructor(){this.tasks=0,this.completed=0}addTasks(t){this.tasks+=t}addCompleted(t){this.completed+=t}value(){return this.tasks&&this.completed/this.tasks}}});var ge={};G(ge,{download:()=>ke,rom:()=>B});function C(e,...t){(window.ga||(()=>{}))("gtag_UA_131783670_1."+e,...t)}async function xe(e){let t=e.target,n=`${D}: ${y}`,s=new Date().getTime();for(;t;){if(t.tagName==="H1"&&t.parentElement.classList.contains("expandable")){t.parentElement.classList.toggle("expanded");break}else if(t.id==="preset-apply"){C("send","event","custom-preset"),y=new x(document.getElementById("flagstring").value),L();break}else if(t.id==="new-seed"){C("send","event","Main","new-seed"),E=Math.floor(Math.random()*4294967296).toString(16),L();break}else if(t.id==="generate"){C("send","event","Main","generate",n);let a=z(E),[i,l]=await ve(a);if(C("send","timing","Main","generate",new Date().getTime()-s,n),!i)break;let o=V.replace(/\.nes|$/,["_",a.toString(16).padStart(8,0),"_",l.toString(16).padStart(8,0),".nes"].join(""));ke(i,o);break}else if(t.id==="spoiler"){C("send","event","Main","spoiler",n),await ve(z(E)),C("send","timing","Main","spoiler",new Date().getTime()-s,n);break}t=t.parentElement}}function j(e,t){return[...e].sort((n,s)=>{let a=t(n),i=t(s);return a<i?-1:a>i?1:0})}var y,E,B,V,Pe,q,_e,ze,He,Re,je,A,Ee,ve,_,be,L,Ce,Le,Ie,ke,we=T(()=>{Ae();ye();Ue();Fe();Ne();Y();Se();re();Pe=!1,q=!1;window.global=window;_e=typeof CR_PERMALINK=="boolean"&&CR_PERMALINK;ze=()=>{Pe=!0,Le(),Ie(),A(!1),Ce(),window.addEventListener("popstate",e=>{A(!1)}),document.body.addEventListener("click",xe),Re()},He=()=>{if(_e&&document.body.classList.add("permalink"),document.getElementById("race")==null){ze(),ue(document.getElementById("flags"),y);for(let e of[...document.getElementsByClassName("checkbox")])be(e);for(let e of document.querySelectorAll('.flag-list > input[type="checkbox"]'))e.checked=!0,e.disabled=!0;return}fe(document.getElementById("presets")),he(document.getElementById("select-options")),me(document.getElementById("simea-sprite-options")).then(()=>{Ie()}),Le(),A(!0),y||document.querySelector("[data-default-preset]").click();for(let e of[...document.getElementsByClassName("checkbox")])be(e);if(L(),je(),document.body.addEventListener("click",xe),window.addEventListener("popstate",e=>{e.state?(y=new x(e.state.flags),E=e.state.seed):A(!0)}),q){let e=document.createElement("section");e.classList.add("expandable");let t=document.createElement("h1");t.textContent="Debug",e.appendChild(t);let n=document.createElement("div");n.id="debug",e.appendChild(n),document.querySelector("main").appendChild(e)}Re()},Re=()=>{if(te!=="latest"){let e=_e?"":"Current version: ";for(let t of document.getElementsByClassName("version"))t.textContent=`${e}${D} (${ne.toDateString()})`}if(P){let e=document.querySelector("nav"),t=document.createElement("a");t.textContent="Older",t.href=`/sha/${P}`,t.style.float="right",e.appendChild(t)}document.body.classList.add("js-works"),document.body.classList.remove("js-broken"),I=="rc"?(document.body.classList.add("release-candidate"),document.body.classList.add("versioned")):I=="stable"&&document.body.classList.add("versioned")},je=()=>{let e=document.getElementById("seed"),t=()=>{E=e.value,L()};e.addEventListener("keyup",t),e.addEventListener("change",t)},A=e=>{for(let t of location.hash.substring(1).split("&")){let[n,s]=t.split("=");s=decodeURIComponent(s),n==="flags"&&(y=new x(s)),n==="seed"&&(E=decodeURIComponent(s)),n==="race"&&document.body.classList.add("race"),n==="debug"&&(q=!0);for(let a of document.querySelectorAll("[data-flags]"))a.addEventListener("click",()=>{y=new x(a.dataset.flags),$=="unstable"&&y.set("Ds",!0),L()})}};Ee=(e,t,n)=>{let s=[];for(let a=0;a<n;a++)s.push(String.fromCharCode(e[t+2*a]));return s.join("")},ve=async e=>{for(let d of document.getElementsByClassName("seed-out"))d.textContent=e.toString(16).padStart(8,"0");let t=document.getElementById("progress"),n=new U,s=B.slice(),a=!1,i=new x(String(y));document.body.classList.add("shuffling");let l=y.check("Ds")?{}:void 0,o=()=>{a||(t.value=n.value(),setTimeout(o,120))};o();let f,c,p=document.querySelector('input[name="simea-replacement"]:checked').value,u=await k.get("simea").get(p);try{[f,c]=await ie(s,e,i,[u],l,n)}catch(d){let r=d.name==="UsageError";document.body.classList.add(r?"invalid":"failure");let h=document.getElementById(r?"invalid-text":"error-text");throw h.textContent=r?d.message:d.stack,h.parentElement.parentElement.scrollIntoViewIfNeeded(),document.getElementById("checksum").textContent="SHUFFLE FAILED!",d}if(c<0)return document.getElementById("checksum").textContent=`SHUFFLE FAILED! ${c}`,[null,null];if(a=!0,document.body.classList.remove("shuffling"),l&&l.spoiler){let d=l.spoiler;d.flags&&_("spoiler-flags",[d.flags]),_("spoiler-items",j(d.slots.filter(r=>r),r=>r.item)),_("spoiler-route",d.route),_("spoiler-mazes",j(d.mazes,r=>r.location).map(({name:r,maze:h})=>`${r}:
${h}`)),_("spoiler-trades",d.trades.map(({item:r,npc:h})=>`${h}: ${r}`).sort()),_("spoiler-item-names",d.unidentifiedItems.map(({oldName:r,newName:h})=>`${h}: ${r}`).sort()),_("spoiler-walls",j(d.walls,r=>r.location).map(({location:r,oldElement:h,newElement:g})=>`${r}${h===3?" (iron)":""}: ${["wind","fire","water","thunder"][g]}`)),_("spoiler-wild-warps",d.wildWarps.map(({name:r})=>r)),_("spoiler-houses",d.houses.map(({house:r,town:h})=>`${r}: ${h}`.replace(/\s*-\s*/g," ")))}return document.getElementById("checksum").textContent=Ee(f,161941,4)+Ee(f,161942,4),[f,c]};_=(e,t)=>{let n=document.getElementById(e);for(;n.children.length;)n.lastChild.remove();for(let s of t){let a=document.createElement("li");a.textContent=s,n.appendChild(a)}n.previousElementSibling.classList.toggle("empty-spoiler",!t.length)},be=e=>{let t=e.getElementsByClassName("flag-body")[0];t&&t.remove();let[n,s]=e.textContent.split(/:\s*/),a=document.createElement("input");a.type="checkbox",a.id=`flag-${n}`,a.dataset.flag=n,a.dataset.mode="false",e.parentElement.insertBefore(a,e);let i=document.createElement("label");i.textContent=n,i.htmlFor=a.id,e.parentElement.insertBefore(i,e);let l=document.createElement("div");e.parentElement.insertBefore(l,e);let o=document.createElement("label");o.textContent=s,o.htmlFor=a.id,l.appendChild(o),t&&l.appendChild(t),e.classList.contains("hard")&&(i.classList.add("hard"),o.classList.add("hard"),o.textContent+=" *"),e.remove(),a.addEventListener("change",()=>{window.FLAGS=y;let f=y.toggle(n);f?f===!0?(a.checked=!0,i.textContent=n):(a.checked=!0,i.textContent=`${n[0]}${f}${n.substring(1)}`):(a.checked=!1,i.textContent=n),L()})},L=()=>{document.body.classList.remove("failure"),document.body.classList.remove("invalid");for(let n of document.querySelectorAll("input[data-flag]")){let s=n.dataset.flag,a=y.get(s);n.checked=a!==!1;let i=typeof a=="boolean"?"":a;n.nextElementSibling.textContent=`${s[0]}${i}${s.substring(1)}`}let e=String(y).replace(/ /g,"");document.getElementById("seed").value=E||"";let t=["#flags=",e];if(E&&t.push("&seed=",encodeURIComponent(E)),q&&t.push("&debug"),history.replaceState({flags:String(y),seed:E},"",String(window.location).replace(/#.*/,"")+t.join("")),I=="stable"||I=="rc"){let n=E||Math.floor(Math.random()*4294967296).toString(16),s=$,a=e;document.getElementById("race").href=`/${s}/race#flags=${a}&seed=${n}`}Ce()},Ce=()=>{let e=String(y);document.body.classList.toggle("spoiled",y.check("Ds")),document.body.classList.toggle("debug-mode",/D/.test(e));for(let t of document.getElementsByClassName("flagstring-out"))t.textContent=e},Le=()=>{let e=window.localStorage.getItem("name"),t=window.localStorage.getItem("rom"),n=document.getElementById("pick-file"),s=()=>{document.body.classList.add("rom-uploaded"),document.body.classList.toggle("rom-broken",Z(B)!=ee)};e&&t&&(V=e,B=Uint8Array.from(new Array(t.length/2).fill(0).map((a,i)=>Number.parseInt(t[2*i]+t[2*i+1],16))),s()),n.addEventListener("change",()=>{let a=n.files[0],i=new FileReader;i.addEventListener("loadend",()=>{let l=new Uint8Array(i.result),o=16+(l[6]&4?512:0)+(l[4]<<14)+(l[5]<<13),f=l.slice(0,o),c=Array.from(f,p=>p.toString(16).padStart(2,0)).join("");B=f,window.localStorage.setItem("rom",c),window.localStorage.setItem("name",a.name),s(),V=a.name}),i.readAsArrayBuffer(a)})},Ie=()=>{let e=window.localStorage.getItem("simea-replacement"),t=document.getElementsByName("simea-replacement");for(let s of t)s.value==e&&(s.checked=!0);t.forEach(s=>{s.addEventListener("change",a=>{window.localStorage.setItem("simea-replacement",a.target.value)})}),N();let n=document.getElementById("upload-sprite");n.addEventListener("change",()=>{let s=n.files[0],a=new FileReader;a.addEventListener("loadend",()=>{let i=window.localStorage.getItem("simea-replacement-custom")||"{}",l=JSON.parse(i),o=a.result,f=s.name.replace(/\.[^/.]+$/,"").replaceAll(/_/g," ");F.init(f,"simea",ae(s.name,o),`Loaded on ${new Date().toLocaleString()}`).then(c=>{l[f]=c,window.localStorage.setItem("simea-replacement-custom",JSON.stringify(l)),N()}),n.value=""}),a.readAsText(s)})},ke=(e,t)=>{let n=document.createElement("a");document.body.appendChild(n),n.style="display: none";let s=new Blob([e],{type:"octet/stream"}),a=window.URL.createObjectURL(s);n.href=a,n.download=t,n.click(),window.URL.revokeObjectURL(a),n.remove()};He()});we();export{ke as download,B as rom};
