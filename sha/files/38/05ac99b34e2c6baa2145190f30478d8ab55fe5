import{a as D,b as H,c as $,d as E,f as b,g as B,h as T,i as U,j,k as N,l as P,m as _,n as C,o as q,p as R,q as V}from"./chunk-PIJDAFVB.js";import{V as O}from"./chunk-EK6FINJ7.js";function J(e){let t=!0;for(let{name:n,flagString:a,description:s}of H.all()){let r=document.createElement("h2");r.textContent=n,e.appendChild(r);let l=document.createElement("p");l.innerHTML=s,e.appendChild(l);let o=document.createElement("a");o.textContent=a,o.classList.add("button"),o.classList.add("preset-flags"),o.dataset.flags=a,a.length>48&&o.classList.add("small"),t&&(o.dataset.defaultPreset="true"),t=!1,e.appendChild(o)}}function z(e){for(let{name:t,description:n,flags:a}of $.all()){let s=document.createElement("h2");if(s.textContent=t,e.appendChild(s),n){let l=document.createElement("p");l.innerHTML=n,e.appendChild(l)}let r=document.createElement("div");r.classList.add("flag-list"),e.appendChild(r);for(let l of a.values()){let{flag:o,opts:{hard:i,name:p,text:f}}=l,g=document.createElement("div");if(g.textContent=`${o}: ${p}`,g.classList.add("checkbox"),i&&g.classList.add("hard"),f){let d=document.createElement("div");d.classList.add("flag-body"),d.innerHTML=f,g.appendChild(d)}r.appendChild(g)}}}async function K(e){let t=C.get("simea");for(let n of t.values()){let a=document.createElement("div");W(a,"",await n),e.appendChild(a)}}function W(e,t,n){e.className="flex-row",e.style.width="100%";let a=document.createElement("input");a.type="radio",a.name="simea-replacement",a.id=`simea-replacement-${n.name}`,a.value=n.name,a.style.display="none",n.name=="Simea"&&(a.checked=!0),e.appendChild(a);let s=document.createElement("label");s.style.position="relative",s.className="sprite-replacement",s.htmlFor=`simea-replacement-${n.name}`;let r=document.createElement("img");r.width=112,r.height=98,r.style.float="left",P(n.nssdata).then(o=>r.src=o),s.appendChild(r);let l=document.createElement("div");if(l.textContent=n.name,l.className="title",s.appendChild(l),n.description){let o=document.createElement("div");o.innerHTML=n.description,o.className="desc",s.appendChild(o)}if(t!=""){let o=document.createElement("div");o.textContent="X",o.className="button",o.style.position="absolute",o.style.top="0",o.style.right="0",o.style.margin="5px",o.onclick=function(){let i=window.localStorage.getItem("simea-replacement"),p=window.localStorage.getItem("simea-replacement-custom")||"{}",f=JSON.parse(p);if(delete f[t],window.localStorage.setItem("simea-replacement-custom",JSON.stringify(f)),n.name==i){let g=document.getElementsByName("simea-replacement");for(let d of g){let c=d;c.value=="Simea"&&(c.checked=!0)}}L()},s.appendChild(o)}e.appendChild(s)}function X(e,t){for(let{name:n,description:a,flags:s}of $.all()){let r=!1,l=document.createElement("h2");l.textContent=n;let o=a?document.createElement("p"):null;o&&(o.innerHTML=a);let i=document.createElement("div");i.classList.add("flag-list");for(let p of s.values()){let{flag:f,opts:{hard:g,name:d,text:c}}=p;if(!t.check(p))continue;r=!0;let m=document.createElement("div");if(m.textContent=`${f}: ${d}`,m.classList.add("checkbox"),g&&m.classList.add("hard"),c){let w=document.createElement("div");w.classList.add("flag-body"),w.innerHTML=c,m.appendChild(w)}i.appendChild(m)}r&&(e.appendChild(l),o&&e.appendChild(o),e.appendChild(i))}}var L=()=>{let e=window.localStorage.getItem("simea-replacement"),t=window.localStorage.getItem("simea-replacement-custom")||"{}",n=JSON.parse(t),a=document.getElementById("simea-sprite-custom");a.innerHTML="";for(let[s,r]of Object.entries(n)){let l=r;C.get("simea").set(l.name,Promise.resolve(l)),W(a,s,l);let i=document.getElementById(`simea-replacement-${l.name}`);i.addEventListener("change",p=>{window.localStorage.setItem("simea-replacement",p.target.value)}),i.value==e&&(i.checked=!0)}};var x=class{constructor(){this.tasks=0,this.completed=0}addTasks(t){this.tasks+=t}addCompleted(t){this.completed+=t}value(){return this.tasks&&this.completed/this.tasks}};var u,h,k,A,re=!1,F=!1;window.global=window;var Z=typeof CR_PERMALINK=="boolean"&&CR_PERMALINK;function v(e,...t){(window.ga||(()=>{}))("gtag_UA_131783670_1."+e,...t)}var le=()=>{re=!0,se(),ae(),I(!1),ne(),window.addEventListener("popstate",e=>{I(!1)}),document.body.addEventListener("click",te),ee()},ce=()=>{if(Z&&document.body.classList.add("permalink"),document.getElementById("race")==null){le(),X(document.getElementById("flags"),u);for(let e of[...document.getElementsByClassName("checkbox")])Y(e);for(let e of document.querySelectorAll('.flag-list > input[type="checkbox"]'))e.checked=!0,e.disabled=!0;return}J(document.getElementById("presets")),z(document.getElementById("select-options")),K(document.getElementById("simea-sprite-options")).then(()=>{ae()}),se(),I(!0),u||document.querySelector("[data-default-preset]").click();for(let e of[...document.getElementsByClassName("checkbox")])Y(e);if(y(),ie(),document.body.addEventListener("click",te),window.addEventListener("popstate",e=>{e.state?(u=new E(e.state.flags),h=e.state.seed):I(!0)}),F){let e=document.createElement("section");e.classList.add("expandable");let t=document.createElement("h1");t.textContent="Debug",e.appendChild(t);let n=document.createElement("div");n.id="debug",e.appendChild(n),document.querySelector("main").appendChild(e)}ee()},ee=()=>{if(U!=="latest"){let e=Z?"":"Current version: ";for(let t of document.getElementsByClassName("version"))t.textContent=`${e}${T} (${j.toDateString()})`}if(N){let e=document.querySelector("nav"),t=document.createElement("a");t.textContent="Older",t.href=`/sha/${N}`,t.style.float="right",e.appendChild(t)}document.body.classList.add("js-works"),document.body.classList.remove("js-broken"),b=="rc"?(document.body.classList.add("release-candidate"),document.body.classList.add("versioned")):b=="stable"&&document.body.classList.add("versioned")},ie=()=>{let e=document.getElementById("seed"),t=()=>{h=e.value,y()};e.addEventListener("keyup",t),e.addEventListener("change",t)},I=e=>{for(let t of location.hash.substring(1).split("&")){let[n,a]=t.split("=");a=decodeURIComponent(a),n==="flags"&&(u=new E(a)),n==="seed"&&(h=decodeURIComponent(a)),n==="race"&&document.body.classList.add("race"),n==="debug"&&(F=!0);for(let s of document.querySelectorAll("[data-flags]"))s.addEventListener("click",()=>{u=new E(s.dataset.flags),B=="unstable"&&u.set("Ds",!0),y()})}};async function te(e){let t=e.target,n=`${T}: ${u}`,a=new Date().getTime();for(;t;){if(t.tagName==="H1"&&t.parentElement.classList.contains("expandable")){t.parentElement.classList.toggle("expanded");break}else if(t.id==="preset-apply"){v("send","event","custom-preset"),u=new E(document.getElementById("flagstring").value),y();break}else if(t.id==="new-seed"){v("send","event","Main","new-seed"),h=Math.floor(Math.random()*4294967296).toString(16),y();break}else if(t.id==="generate"){v("send","event","Main","generate",n);let s=R(h),[r,l]=await Q(s);if(v("send","timing","Main","generate",new Date().getTime()-a,n),!r)break;let o=A.replace(/\.nes|$/,["_",s.toString(16).padStart(8,0),"_",l.toString(16).padStart(8,0),".nes"].join(""));de(r,o);break}else if(t.id==="spoiler"){v("send","event","Main","spoiler",n),await Q(R(h)),v("send","timing","Main","spoiler",new Date().getTime()-a,n);break}t=t.parentElement}}var G=(e,t,n)=>{let a=[];for(let s=0;s<n;s++)a.push(String.fromCharCode(e[t+2*s]));return a.join("")},Q=async e=>{for(let d of document.getElementsByClassName("seed-out"))d.textContent=e.toString(16).padStart(8,"0");let t=document.getElementById("progress"),n=new x,a=k.slice(),s=!1,r=new E(String(u));document.body.classList.add("shuffling");let l=u.check("Ds")?{}:void 0,o=()=>{s||(t.value=n.value(),setTimeout(o,120))};o();let i,p,f=document.querySelector('input[name="simea-replacement"]:checked').value,g=await C.get("simea").get(f);try{[i,p]=await V(a,e,r,[g],l,n)}catch(d){let c=d.name==="UsageError";document.body.classList.add(c?"invalid":"failure");let m=document.getElementById(c?"invalid-text":"error-text");throw m.textContent=c?d.message:d.stack,m.parentElement.parentElement.scrollIntoViewIfNeeded(),document.getElementById("checksum").textContent="SHUFFLE FAILED!",d}if(p<0)return document.getElementById("checksum").textContent=`SHUFFLE FAILED! ${p}`,[null,null];if(s=!0,document.body.classList.remove("shuffling"),l&&l.spoiler){let d=l.spoiler;d.flags&&S("spoiler-flags",[d.flags]),S("spoiler-items",M(d.slots.filter(c=>c),c=>c.item)),S("spoiler-route",d.route),S("spoiler-mazes",M(d.mazes,c=>c.location).map(({name:c,maze:m})=>`${c}:
${m}`)),S("spoiler-trades",d.trades.map(({item:c,npc:m})=>`${m}: ${c}`).sort()),S("spoiler-item-names",d.unidentifiedItems.map(({oldName:c,newName:m})=>`${m}: ${c}`).sort()),S("spoiler-walls",M(d.walls,c=>c.location).map(({location:c,oldElement:m,newElement:w})=>`${c}${m===3?" (iron)":""}: ${["wind","fire","water","thunder"][w]}`)),S("spoiler-wild-warps",d.wildWarps.map(({name:c})=>c)),S("spoiler-houses",d.houses.map(({house:c,town:m})=>`${c}: ${m}`.replace(/\s*-\s*/g," ")))}return document.getElementById("checksum").textContent=G(i,161941,4)+G(i,161942,4),[i,p]};function M(e,t){return[...e].sort((n,a)=>{let s=t(n),r=t(a);return s<r?-1:s>r?1:0})}var S=(e,t)=>{let n=document.getElementById(e);for(;n.children.length;)n.lastChild.remove();for(let a of t){let s=document.createElement("li");s.textContent=a,n.appendChild(s)}n.previousElementSibling.classList.toggle("empty-spoiler",!t.length)},Y=e=>{let t=e.getElementsByClassName("flag-body")[0];t&&t.remove();let[n,a]=e.textContent.split(/:\s*/),s=document.createElement("input");s.type="checkbox",s.id=`flag-${n}`,s.dataset.flag=n,s.dataset.mode="false",e.parentElement.insertBefore(s,e);let r=document.createElement("label");r.textContent=n,r.htmlFor=s.id,e.parentElement.insertBefore(r,e);let l=document.createElement("div");e.parentElement.insertBefore(l,e);let o=document.createElement("label");o.textContent=a,o.htmlFor=s.id,l.appendChild(o),t&&l.appendChild(t),e.classList.contains("hard")&&(r.classList.add("hard"),o.classList.add("hard"),o.textContent+=" *"),e.remove(),s.addEventListener("change",()=>{window.FLAGS=u;let i=u.toggle(n);i?i===!0?(s.checked=!0,r.textContent=n):(s.checked=!0,r.textContent=`${n[0]}${i}${n.substring(1)}`):(s.checked=!1,r.textContent=n),y()})},y=()=>{document.body.classList.remove("failure"),document.body.classList.remove("invalid");for(let n of document.querySelectorAll("input[data-flag]")){let a=n.dataset.flag,s=u.get(a);n.checked=s!==!1;let r=typeof s=="boolean"?"":s;n.nextElementSibling.textContent=`${a[0]}${r}${a.substring(1)}`}let e=String(u).replace(/ /g,"");document.getElementById("seed").value=h||"";let t=["#flags=",e];if(h&&t.push("&seed=",encodeURIComponent(h)),F&&t.push("&debug"),history.replaceState({flags:String(u),seed:h},"",String(window.location).replace(/#.*/,"")+t.join("")),b=="stable"||b=="rc"){let n=h||Math.floor(Math.random()*4294967296).toString(16),a=B,s=e;document.getElementById("race").href=`/${a}/race#flags=${s}&seed=${n}`}ne()},ne=()=>{let e=String(u);document.body.classList.toggle("spoiled",u.check("Ds")),document.body.classList.toggle("debug-mode",/D/.test(e));for(let t of document.getElementsByClassName("flagstring-out"))t.textContent=e},se=()=>{let e=window.localStorage.getItem("name"),t=window.localStorage.getItem("rom"),n=document.getElementById("pick-file"),a=()=>{document.body.classList.add("rom-uploaded"),document.body.classList.toggle("rom-broken",D(k)!=O)};e&&t&&(A=e,k=Uint8Array.from(new Array(t.length/2).fill(0).map((s,r)=>Number.parseInt(t[2*r]+t[2*r+1],16))),a()),n.addEventListener("change",()=>{let s=n.files[0],r=new FileReader;r.addEventListener("loadend",()=>{let l=new Uint8Array(r.result),o=16+(l[6]&4?512:0)+(l[4]<<14)+(l[5]<<13),i=l.slice(0,o),p=Array.from(i,f=>f.toString(16).padStart(2,0)).join("");k=i,window.localStorage.setItem("rom",p),window.localStorage.setItem("name",s.name),a(),A=s.name}),r.readAsArrayBuffer(s)})},ae=()=>{let e=window.localStorage.getItem("simea-replacement"),t=document.getElementsByName("simea-replacement");for(let a of t)a.value==e&&(a.checked=!0);t.forEach(a=>{a.addEventListener("change",s=>{window.localStorage.setItem("simea-replacement",s.target.value)})}),L();let n=document.getElementById("upload-sprite");n.addEventListener("change",()=>{let a=n.files[0],s=new FileReader;s.addEventListener("loadend",()=>{let r=window.localStorage.getItem("simea-replacement-custom")||"{}",l=JSON.parse(r),o=s.result,i=a.name.replace(/\.[^/.]+$/,"").replaceAll(/_/g," ");_.init(i,"simea",q(a.name,o),`Loaded on ${new Date().toLocaleString()}`).then(p=>{l[i]=p,window.localStorage.setItem("simea-replacement-custom",JSON.stringify(l)),L()}),n.value=""}),s.readAsText(a)})},de=(e,t)=>{let n=document.createElement("a");document.body.appendChild(n),n.style="display: none";let a=new Blob([e],{type:"octet/stream"}),s=window.URL.createObjectURL(a);n.href=s,n.download=t,n.click(),window.URL.revokeObjectURL(s),n.remove()};ce();
