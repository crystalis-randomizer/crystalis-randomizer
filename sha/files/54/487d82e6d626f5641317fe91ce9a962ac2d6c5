import{a as N,c as C,d as I,e as $,f as U,g as O,h as B,i as j,j as P,k as b,l as _,m as T,n as q,o as V,p as R,q as S}from"./chunk-AXGSPDJU.js";import{P as H}from"./chunk-OCKFEL4Z.js";import"./chunk-3LGYUTMU.js";function z(e){let t=!0;for(let{name:n,flagString:s,description:a}of V.all()){let o=document.createElement("h2");o.textContent=n,e.appendChild(o);let r=document.createElement("p");r.innerHTML=a,e.appendChild(r);let l=document.createElement("a");l.textContent=s,l.classList.add("button"),l.classList.add("preset-flags"),l.dataset.flags=s,s.length>48&&l.classList.add("small"),t&&(l.dataset.defaultPreset="true"),t=!1,e.appendChild(l)}}function J(e){for(let{name:t,description:n,flags:s}of R.all()){let a=document.createElement("h2");if(a.textContent=t,e.appendChild(a),n){let r=document.createElement("p");r.innerHTML=n,e.appendChild(r)}let o=document.createElement("div");o.classList.add("flag-list"),e.appendChild(o);for(let r of s.values()){let{flag:l,opts:{hard:i,name:u,text:E}}=r,g=document.createElement("div");if(g.textContent=`${l}: ${u}`,g.classList.add("checkbox"),i&&g.classList.add("hard"),E){let d=document.createElement("div");d.classList.add("flag-body"),d.innerHTML=E,g.appendChild(d)}o.appendChild(g)}}}async function K(e){let t=b.get("simea");for(let n of t.values()){let s=document.createElement("div");A(s,await n),e.appendChild(s)}}function A(e,t){e.className="flex-row",e.style.width="100%";let n=document.createElement("input");n.type="radio",n.name="simea-replacement",n.id=`simea-replacement-${t.name}`,n.value=t.name,n.style.display="none",t.name=="Simea"&&(n.checked=!0),e.appendChild(n);let s=document.createElement("label");s.className="sprite-replacement",s.htmlFor=`simea-replacement-${t.name}`;let a=document.createElement("img");a.width=112,a.height=98,a.style.float="left",j(t.nssdata).then(r=>a.src=r),s.appendChild(a);let o=document.createElement("div");if(o.textContent=t.name,o.className="title",s.appendChild(o),t.description){let r=document.createElement("div");r.innerHTML=t.description,r.className="desc",s.appendChild(r)}e.appendChild(s)}function W(e,t){for(let{name:n,description:s,flags:a}of R.all()){let o=!1,r=document.createElement("h2");r.textContent=n;let l=s?document.createElement("p"):null;l&&(l.innerHTML=s);let i=document.createElement("div");i.classList.add("flag-list");for(let u of a.values()){let{flag:E,opts:{hard:g,name:d,text:c}}=u;if(!t.check(u))continue;o=!0;let p=document.createElement("div");if(p.textContent=`${E}: ${d}`,p.classList.add("checkbox"),g&&p.classList.add("hard"),c){let w=document.createElement("div");w.classList.add("flag-body"),w.innerHTML=c,p.appendChild(w)}i.appendChild(p)}o&&(e.appendChild(r),l&&e.appendChild(l),e.appendChild(i))}}var L=class{constructor(){this.tasks=0,this.completed=0}addTasks(t){this.tasks+=t}addCompleted(t){this.completed+=t}value(){return this.tasks&&this.completed/this.tasks}};var m,f,x,F,re=!1,M=!1;window.global=window;var Z=typeof CR_PERMALINK=="boolean"&&CR_PERMALINK;function v(e,...t){(window.ga||(()=>{}))("gtag_UA_131783670_1."+e,...t)}var le=()=>{re=!0,ae(),se(),k(!1),ne(),window.addEventListener("popstate",e=>{k(!1)}),document.body.addEventListener("click",te),ee()},ce=()=>{if(Z&&document.body.classList.add("permalink"),document.getElementById("race")==null){le(),W(document.getElementById("flags"),m);for(let e of[...document.getElementsByClassName("checkbox")])Q(e);for(let e of document.querySelectorAll('.flag-list > input[type="checkbox"]'))e.checked=!0,e.disabled=!0;return}z(document.getElementById("presets")),J(document.getElementById("select-options")),K(document.getElementById("simea-sprite-options")).then(()=>{se()}),ae(),k(!0),m||document.querySelector("[data-default-preset]").click();for(let e of[...document.getElementsByClassName("checkbox")])Q(e);if(y(),de(),document.body.addEventListener("click",te),window.addEventListener("popstate",e=>{e.state?(m=new S(e.state.flags),f=e.state.seed):k(!0)}),M){let e=document.createElement("section");e.classList.add("expandable");let t=document.createElement("h1");t.textContent="Debug",e.appendChild(t);let n=document.createElement("div");n.id="debug",e.appendChild(n),document.querySelector("main").appendChild(e)}ee()},ee=()=>{if(U!=="latest"){let e=Z?"":"Current version: ";for(let t of document.getElementsByClassName("version"))t.textContent=`${e}${$} (${O.toDateString()})`}if(B){let e=document.querySelector("nav"),t=document.createElement("a");t.textContent="Older",t.href=`/sha/${B}`,t.style.float="right",e.appendChild(t)}document.body.classList.add("js-works"),document.body.classList.remove("js-broken"),C=="rc"?(document.body.classList.add("release-candidate"),document.body.classList.add("versioned")):C=="stable"&&document.body.classList.add("versioned")},de=()=>{let e=document.getElementById("seed"),t=()=>{f=e.value,y()};e.addEventListener("keyup",t),e.addEventListener("change",t)},k=e=>{for(let t of location.hash.substring(1).split("&")){let[n,s]=t.split("=");s=decodeURIComponent(s),n==="flags"&&(m=new S(s)),n==="seed"&&(f=decodeURIComponent(s)),n==="race"&&document.body.classList.add("race"),n==="debug"&&(M=!0);for(let a of document.querySelectorAll("[data-flags]"))a.addEventListener("click",()=>{m=new S(a.dataset.flags),I=="unstable"&&m.set("Ds",!0),y()})}};async function te(e){let t=e.target,n=`${$}: ${m}`,s=new Date().getTime();for(;t;){if(t.tagName==="H1"&&t.parentElement.classList.contains("expandable")){t.parentElement.classList.toggle("expanded");break}else if(t.id==="preset-apply"){v("send","event","custom-preset"),m=new S(document.getElementById("flagstring").value),y();break}else if(t.id==="new-seed"){v("send","event","Main","new-seed"),f=Math.floor(Math.random()*4294967296).toString(16),y();break}else if(t.id==="generate"){v("send","event","Main","generate",n);let a=T(f),[o,r]=await X(a);if(v("send","timing","Main","generate",new Date().getTime()-s,n),!o)break;let l=F.replace(/\.nes|$/,["_",a.toString(16).padStart(8,0),"_",r.toString(16).padStart(8,0),".nes"].join(""));ie(o,l);break}else if(t.id==="spoiler"){v("send","event","Main","spoiler",n),await X(T(f)),v("send","timing","Main","spoiler",new Date().getTime()-s,n);break}t=t.parentElement}}var G=(e,t,n)=>{let s=[];for(let a=0;a<n;a++)s.push(String.fromCharCode(e[t+2*a]));return s.join("")},X=async e=>{for(let d of document.getElementsByClassName("seed-out"))d.textContent=e.toString(16).padStart(8,"0");let t=document.getElementById("progress"),n=new L,s=x.slice(),a=!1,o=new S(String(m));document.body.classList.add("shuffling");let r=m.check("Ds")?{}:void 0,l=()=>{a||(t.value=n.value(),setTimeout(l,120))};l();let i,u,E=document.querySelector('input[name="simea-replacement"]:checked').value,g=await b.get("simea").get(E);try{let{BundleReader:d}=await import("./bundlereader-TUWPK4C4.js");[i,u]=await q(s,e,o,new d,[g],r,n)}catch(d){document.body.classList.add("failure");let c=document.getElementById("error-text");throw c.textContent=d.stack,c.parentElement.parentElement.scrollIntoViewIfNeeded(),document.getElementById("checksum").textContent="SHUFFLE FAILED!",d}if(u<0)return document.getElementById("checksum").textContent=`SHUFFLE FAILED! ${u}`,[null,null];if(a=!0,document.body.classList.remove("shuffling"),r&&r.spoiler){let d=r.spoiler;d.flags&&h("spoiler-flags",[d.flags]),h("spoiler-items",D(d.slots.filter(c=>c),c=>c.item)),h("spoiler-route",d.route),h("spoiler-mazes",D(d.mazes,c=>c.location).map(({name:c,maze:p})=>`${c}:
${p}`)),h("spoiler-trades",d.trades.map(({item:c,npc:p})=>`${p}: ${c}`).sort()),h("spoiler-item-names",d.unidentifiedItems.map(({oldName:c,newName:p})=>`${p}: ${c}`).sort()),h("spoiler-walls",D(d.walls,c=>c.location).map(({location:c,oldElement:p,newElement:w})=>`${c}${p===3?" (iron)":""}: ${["wind","fire","water","thunder"][w]}`)),h("spoiler-wild-warps",d.wildWarps.map(({name:c})=>c)),h("spoiler-houses",d.houses.map(({house:c,town:p})=>`${c}: ${p}`.replace(/\s*-\s*/g," ")))}return document.getElementById("checksum").textContent=G(i,161941,4)+G(i,161942,4),[i,u]};function D(e,t){return[...e].sort((n,s)=>{let a=t(n),o=t(s);return a<o?-1:a>o?1:0})}var h=(e,t)=>{let n=document.getElementById(e);for(;n.children.length;)n.lastChild.remove();for(let s of t){let a=document.createElement("li");a.textContent=s,n.appendChild(a)}n.previousElementSibling.classList.toggle("empty-spoiler",!t.length)},Q=e=>{let t=e.getElementsByClassName("flag-body")[0];t&&t.remove();let[n,s]=e.textContent.split(/:\s*/),a=document.createElement("input");a.type="checkbox",a.id=`flag-${n}`,a.dataset.flag=n,a.dataset.mode="false",e.parentElement.insertBefore(a,e);let o=document.createElement("label");o.textContent=n,o.htmlFor=a.id,e.parentElement.insertBefore(o,e);let r=document.createElement("div");e.parentElement.insertBefore(r,e);let l=document.createElement("label");l.textContent=s,l.htmlFor=a.id,r.appendChild(l),t&&r.appendChild(t),e.classList.contains("hard")&&(o.classList.add("hard"),l.classList.add("hard"),l.textContent+=" *"),e.remove(),a.addEventListener("change",()=>{window.FLAGS=m;let i=m.toggle(n);i?i===!0?(a.checked=!0,o.textContent=n):(a.checked=!0,o.textContent=`${n[0]}${i}${n.substring(1)}`):(a.checked=!1,o.textContent=n),y()})},y=()=>{document.body.classList.remove("failure");for(let n of document.querySelectorAll("input[data-flag]")){let s=n.dataset.flag,a=m.get(s);n.checked=a!==!1;let o=typeof a=="boolean"?"":a;n.nextElementSibling.textContent=`${s[0]}${o}${s.substring(1)}`}let e=String(m).replace(/ /g,"");document.getElementById("seed").value=f||"";let t=["#flags=",e];if(f&&t.push("&seed=",encodeURIComponent(f)),M&&t.push("&debug"),history.replaceState({flags:String(m),seed:f},"",String(window.location).replace(/#.*/,"")+t.join("")),C=="stable"||C=="rc"){let n=f||Math.floor(Math.random()*4294967296).toString(16),s=I,a=e;document.getElementById("race").href=`/${s}/race#flags=${a}&seed=${n}`}ne()},ne=()=>{let e=String(m);document.body.classList.toggle("spoiled",m.check("Ds")),document.body.classList.toggle("debug-mode",/D/.test(e));for(let t of document.getElementsByClassName("flagstring-out"))t.textContent=e},ae=()=>{let e=window.localStorage.getItem("name"),t=window.localStorage.getItem("rom"),n=document.getElementById("pick-file"),s=()=>{document.body.classList.add("rom-uploaded"),document.body.classList.toggle("rom-broken",N(x)!=H)};e&&t&&(F=e,x=Uint8Array.from(new Array(t.length/2).fill(0).map((a,o)=>Number.parseInt(t[2*o]+t[2*o+1],16))),s()),n.addEventListener("change",()=>{let a=n.files[0],o=new FileReader;o.addEventListener("loadend",()=>{let r=new Uint8Array(o.result),l=16+(r[6]&4?512:0)+(r[4]<<14)+(r[5]<<13),i=r.slice(0,l),u=Array.from(i,E=>E.toString(16).padStart(2,0)).join("");x=i,window.localStorage.setItem("rom",u),window.localStorage.setItem("name",a.name),s(),F=a.name}),o.readAsArrayBuffer(a)})},Y=()=>{let e=window.localStorage.getItem("simea-replacement"),t=window.localStorage.getItem("simea-replacement-custom")||"{}",n=JSON.parse(t),s=document.getElementById("simea-sprite-custom");s.innerHTML="";for(let[a,o]of Object.entries(n)){b.get("simea").set(o.name,Promise.resolve(o)),A(s,o);let r=document.getElementById(`simea-replacement-${o.name}`);r.addEventListener("change",l=>{window.localStorage.setItem("simea-replacement",l.target.value)}),r.value==e&&(r.checked=!0)}},se=()=>{let e=window.localStorage.getItem("simea-replacement"),t=document.getElementsByName("simea-replacement");for(let s of t)s.value==e&&(s.checked=!0);t.forEach(s=>{s.addEventListener("change",a=>{window.localStorage.setItem("simea-replacement",a.target.value)})}),Y();let n=document.getElementById("upload-sprite");n.addEventListener("change",()=>{let s=n.files[0],a=new FileReader;a.addEventListener("loadend",()=>{let o=window.localStorage.getItem("simea-replacement-custom")||"{}",r=JSON.parse(o),l=a.result,i=s.name.replace(/\.[^/.]+$/,"").replaceAll(/_/g," ");P.init(i,"simea",_(s.name,l),`Loaded on ${new Date().toLocaleString()}`).then(u=>{r[i]=u,window.localStorage.setItem("simea-replacement-custom",JSON.stringify(r)),Y()}),n.value=""}),a.readAsText(s)})},ie=(e,t)=>{let n=document.createElement("a");document.body.appendChild(n),n.style="display: none";let s=new Blob([e],{type:"octet/stream"}),a=window.URL.createObjectURL(s);n.href=a,n.download=t,n.click(),window.URL.revokeObjectURL(a),n.remove()};ce();
