import{d as Ce,e as Le}from"./chunk-BXWPI37V.js";import{a as Q,b as xe}from"./chunk-PMT6XU5X.js";import{a as j,b as ye,c as _,d as M,e as y,f as q,j as b,k as $,l as T,m as J,n as z,o as R,p as we,q as K,r as k,s as C,t as W,u as X,v as N,w as G,x as be}from"./chunk-YFEZ6BKM.js";import{pa as V,qa as ve}from"./chunk-2QNVB4DA.js";import{b as U,d as Se,f as P}from"./chunk-PIDEUWOP.js";function Y(e){let t=!0;for(let{name:n,flagString:o,description:a}of _.all()){let s=document.createElement("h2");s.textContent=n,e.appendChild(s);let r=document.createElement("p");r.innerHTML=a,e.appendChild(r);let c=document.createElement("a");c.textContent=o,c.classList.add("button"),c.classList.add("preset-flags"),c.dataset.flags=o,o.length>48&&c.classList.add("small"),t&&(c.dataset.defaultPreset="true"),t=!1,e.appendChild(c)}}function Z(e){for(let{name:t,description:n,flags:o}of M.all()){let a=document.createElement("h2");if(a.textContent=t,e.appendChild(a),n){let r=document.createElement("p");r.innerHTML=n,e.appendChild(r)}let s=document.createElement("div");s.classList.add("flag-list"),e.appendChild(s);for(let r of o.values()){let{flag:c,opts:{hard:d,name:u,text:m}}=r,g=document.createElement("div");if(g.textContent=`${c}: ${u}`,g.classList.add("checkbox"),d&&g.classList.add("hard"),m){let i=document.createElement("div");i.classList.add("flag-body"),i.innerHTML=m,g.appendChild(i)}s.appendChild(g)}}}async function ee(e){let t=C.get("simea");for(let n of t.values()){let o=document.createElement("div");te(o,"",await n),e.appendChild(o)}}function te(e,t,n){e.className="flex-row",e.style.width="100%";let o=document.createElement("input");o.type="radio",o.name="simea-replacement",o.id=`simea-replacement-${n.name}`,o.value=n.name,o.style.display="none",n.name=="Simea"&&(o.checked=!0),e.appendChild(o);let a=document.createElement("label");a.style.position="relative",a.className="sprite-replacement",a.htmlFor=`simea-replacement-${n.name}`;let s=document.createElement("img");s.width=112,s.height=98,s.style.float="left",K(n.nssdata).then(m=>s.src=m),a.appendChild(s);let r=document.createElement("div");if(r.textContent=n.name,r.className="title",a.appendChild(r),n.description){let m=document.createElement("div");m.innerHTML=n.description,m.className="desc",a.appendChild(m)}let c=document.createElement("div");if(c.style.position="absolute",c.style.top="0",c.style.right="0",c.style.margin="3px",t!=""){let m=document.createElement("div");m.textContent="X",m.className="button",m.onclick=function(){let g=window.localStorage.getItem("simea-replacement"),i=window.localStorage.getItem("simea-replacement-custom")||"{}",l=JSON.parse(i,L.addMapRestorement);if(delete l[t],window.localStorage.setItem("simea-replacement-custom",JSON.stringify(l,L.addMapReplacement)),n.name==g){let p=document.getElementsByName("simea-replacement");for(let S of p){let O=S;O.value=="Simea"&&(O.checked=!0)}}I()},c.appendChild(m)}let d=document.createElement("div");d.className="button";let u=document.getElementById("download-icon")?.cloneNode(!0);u.setAttribute("id",`download-icon-${n.name}`),u.style.display="flex",d.appendChild(u),d.className="button",d.onclick=function(){let m=L.rom.slice(),g=L.rom.slice();k.applyPatch(n,g.subarray(16),!1);let i=new F.MarcFile(m),l=new F.MarcFile(g);F.createIPSFromFiles(i,l).export(n.name).save()},c.appendChild(d),a.appendChild(c),e.appendChild(a)}function ne(e,t){for(let{name:n,description:o,flags:a}of M.all()){let s=!1,r=document.createElement("h2");r.textContent=n;let c=o?document.createElement("p"):null;c&&(c.innerHTML=o);let d=document.createElement("div");d.classList.add("flag-list");for(let u of a.values()){let{flag:m,opts:{hard:g,name:i,text:l}}=u;if(!t.check(u))continue;s=!0;let p=document.createElement("div");if(p.textContent=`${m}: ${i}`,p.classList.add("checkbox"),g&&p.classList.add("hard"),l){let S=document.createElement("div");S.classList.add("flag-body"),S.innerHTML=l,p.appendChild(S)}d.appendChild(p)}s&&(e.appendChild(r),c&&e.appendChild(c),e.appendChild(d))}}var F,L,I,ae=U(()=>{X();q();F=(Le(),P(Ce)),L=(se(),P(oe));I=()=>{let e=window.localStorage.getItem("simea-replacement"),t=window.localStorage.getItem("simea-replacement-custom")||"{}",n=JSON.parse(t,L.addMapRestorement),o=document.getElementById("simea-sprite-custom");o.innerHTML="";for(let[a,s]of Object.entries(n)){let r=s;C.get("simea").set(r.name,Promise.resolve(r)),te(o,a,r);let d=document.getElementById(`simea-replacement-${r.name}`);d.addEventListener("change",u=>{window.localStorage.setItem("simea-replacement",u.target.value)}),d.value==e&&(d.checked=!0)}}});var oe={};Se(oe,{addMapReplacement:()=>ge,addMapRestorement:()=>he,download:()=>Ee,rom:()=>x});function v(e,...t){(window.ga||(()=>{}))("gtag_UA_131783670_1."+e,...t)}async function me(e){let t=e.target,n=`${T}: ${f}`,o=new Date().getTime();for(;t;){if(t.tagName==="H1"&&t.parentElement.classList.contains("expandable")){t.parentElement.classList.toggle("expanded");break}else if(t.id==="preset-apply"){v("send","event","custom-preset"),f=new y(document.getElementById("flagstring").value),w();break}else if(t.id==="new-seed"){v("send","event","Main","new-seed"),h=Math.floor(Math.random()*4294967296).toString(16),w();break}else if(t.id==="generate"){v("send","event","Main","generate",n);let a=N(h),[s,r]=await ce(a);if(v("send","timing","Main","generate",new Date().getTime()-o,n),!s)break;let c=D.replace(/\.nes|$/,["_",a.toString(16).padStart(8,0),"_",r.toString(16).padStart(8,0),".nes"].join(""));Ee(s,c);break}else if(t.id==="spoiler"){v("send","event","Main","spoiler",n),await ce(N(h)),v("send","timing","Main","spoiler",new Date().getTime()-o,n);break}t=t.parentElement}}function A(e,t){return[...e].sort((n,o)=>{let a=t(n),s=t(o);return a<s?-1:a>s?1:0})}function ge(e,t){return t instanceof Map?{dataType:"Map",value:Array.from(t.entries())}:t}function he(e,t){return typeof t=="object"&&t!==null&&t.dataType==="Map"?new Map(t.value):t}var f,h,x,D,Ie,H,de,Be,Me,ie,$e,B,re,ce,E,le,w,pe,ue,fe,Ee,se=U(()=>{be();ae();we();ye();ve();q();xe();X();Ie=!1,H=!1;window.global=window;de=typeof CR_PERMALINK=="boolean"&&CR_PERMALINK;Be=()=>{Ie=!0,ue(),fe(),B(!1),pe(),window.addEventListener("popstate",e=>{B(!1)}),document.body.addEventListener("click",me),ie()},Me=()=>{if(de&&document.body.classList.add("permalink"),document.getElementById("race")==null){Be(),ne(document.getElementById("flags"),f);for(let e of[...document.getElementsByClassName("checkbox")])le(e);for(let e of document.querySelectorAll('.flag-list > input[type="checkbox"]'))e.checked=!0,e.disabled=!0;return}Y(document.getElementById("presets")),Z(document.getElementById("select-options")),ee(document.getElementById("simea-sprite-options")).then(()=>{fe()}),ue(),B(!0),f||document.querySelector("[data-default-preset]").click();for(let e of[...document.getElementsByClassName("checkbox")])le(e);if(w(),$e(),document.body.addEventListener("click",me),window.addEventListener("popstate",e=>{e.state?(f=new y(e.state.flags),h=e.state.seed):B(!0)}),H){let e=document.createElement("section");e.classList.add("expandable");let t=document.createElement("h1");t.textContent="Debug",e.appendChild(t);let n=document.createElement("div");n.id="debug",e.appendChild(n),document.querySelector("main").appendChild(e)}ie()},ie=()=>{if(J!=="latest"){let e=de?"":"Current version: ";for(let t of document.getElementsByClassName("version"))t.textContent=`${e}${T} (${z.toDateString()})`}if(R){let e=document.querySelector("nav"),t=document.createElement("a");t.textContent="Older",t.href=`/sha/${R}`,t.style.float="right",e.appendChild(t)}document.body.classList.add("js-works"),document.body.classList.remove("js-broken"),b=="rc"?(document.body.classList.add("release-candidate"),document.body.classList.add("versioned")):b=="stable"&&document.body.classList.add("versioned")},$e=()=>{let e=document.getElementById("seed"),t=()=>{h=e.value,w()};e.addEventListener("keyup",t),e.addEventListener("change",t)},B=e=>{for(let t of location.hash.substring(1).split("&")){let[n,o]=t.split("=");o=decodeURIComponent(o),n==="flags"&&(f=new y(o)),n==="seed"&&(h=decodeURIComponent(o)),n==="race"&&document.body.classList.add("race"),n==="debug"&&(H=!0);for(let a of document.querySelectorAll("[data-flags]"))a.addEventListener("click",()=>{f=new y(a.dataset.flags),$=="unstable"&&f.set("Ds",!0),w()})}};re=(e,t,n)=>{let o=[];for(let a=0;a<n;a++)o.push(String.fromCharCode(e[t+2*a]));return o.join("")},ce=async e=>{for(let i of document.getElementsByClassName("seed-out"))i.textContent=e.toString(16).padStart(8,"0");let t=document.getElementById("progress"),n=new Q,o=x.slice(),a=!1,s=new y(String(f));document.body.classList.add("shuffling");let r=f.check("Ds")?{}:void 0,c=()=>{a||(t.value=n.value(),setTimeout(c,120))};c();let d,u,m=document.querySelector('input[name="simea-replacement"]:checked').value,g=await C.get("simea").get(m);try{[d,u]=await G(o,e,s,[g],r,n)}catch(i){let l=i.name==="UsageError";document.body.classList.add(l?"invalid":"failure");let p=document.getElementById(l?"invalid-text":"error-text");throw p.textContent=l?i.message:i.stack,p.parentElement.parentElement.scrollIntoViewIfNeeded(),document.getElementById("checksum").textContent="SHUFFLE FAILED!",i}if(u<0)return document.getElementById("checksum").textContent=`SHUFFLE FAILED! ${u}`,[null,null];if(a=!0,document.body.classList.remove("shuffling"),r&&r.spoiler){let i=r.spoiler;i.flags&&E("spoiler-flags",[i.flags]),E("spoiler-items",A(i.slots.filter(l=>l),l=>l.item)),E("spoiler-route",i.route),E("spoiler-mazes",A(i.mazes,l=>l.location).map(({name:l,maze:p})=>`${l}:
${p}`)),E("spoiler-trades",i.trades.map(({item:l,npc:p})=>`${p}: ${l}`).sort()),E("spoiler-item-names",i.unidentifiedItems.map(({oldName:l,newName:p})=>`${p}: ${l}`).sort()),E("spoiler-walls",A(i.walls,l=>l.location).map(({location:l,oldElement:p,newElement:S})=>`${l}${p===3?" (iron)":""}: ${["wind","fire","water","thunder"][S]}`)),E("spoiler-wild-warps",i.wildWarps.map(({name:l})=>l)),E("spoiler-houses",i.houses.map(({house:l,town:p})=>`${l}: ${p}`.replace(/\s*-\s*/g," ")))}return document.getElementById("checksum").textContent=re(d,161941,4)+re(d,161942,4),[d,u]};E=(e,t)=>{let n=document.getElementById(e);for(;n.children.length;)n.lastChild.remove();for(let o of t){let a=document.createElement("li");a.textContent=o,n.appendChild(a)}n.previousElementSibling.classList.toggle("empty-spoiler",!t.length)},le=e=>{let t=e.getElementsByClassName("flag-body")[0];t&&t.remove();let[n,o]=e.textContent.split(/:\s*/),a=document.createElement("input");a.type="checkbox",a.id=`flag-${n}`,a.dataset.flag=n,a.dataset.mode="false",e.parentElement.insertBefore(a,e);let s=document.createElement("label");s.textContent=n,s.htmlFor=a.id,e.parentElement.insertBefore(s,e);let r=document.createElement("div");e.parentElement.insertBefore(r,e);let c=document.createElement("label");c.textContent=o,c.htmlFor=a.id,r.appendChild(c),t&&r.appendChild(t),e.classList.contains("hard")&&(s.classList.add("hard"),c.classList.add("hard"),c.textContent+=" *"),e.remove(),a.addEventListener("change",()=>{window.FLAGS=f;let d=f.toggle(n);d?d===!0?(a.checked=!0,s.textContent=n):(a.checked=!0,s.textContent=`${n[0]}${d}${n.substring(1)}`):(a.checked=!1,s.textContent=n),w()})},w=()=>{document.body.classList.remove("failure"),document.body.classList.remove("invalid");for(let n of document.querySelectorAll("input[data-flag]")){let o=n.dataset.flag,a=f.get(o);n.checked=a!==!1;let s=typeof a=="boolean"?"":a;n.nextElementSibling.textContent=`${o[0]}${s}${o.substring(1)}`}let e=String(f).replace(/ /g,"");document.getElementById("seed").value=h||"";let t=["#flags=",e];if(h&&t.push("&seed=",encodeURIComponent(h)),H&&t.push("&debug"),history.replaceState({flags:String(f),seed:h},"",String(window.location).replace(/#.*/,"")+t.join("")),b=="stable"||b=="rc"){let n=h||Math.floor(Math.random()*4294967296).toString(16),o=$,a=e;document.getElementById("race").href=`/${o}/race#flags=${a}&seed=${n}`}pe()},pe=()=>{let e=String(f);document.body.classList.toggle("spoiled",f.check("Ds")),document.body.classList.toggle("debug-mode",/D/.test(e));for(let t of document.getElementsByClassName("flagstring-out"))t.textContent=e},ue=()=>{let e=window.localStorage.getItem("name"),t=window.localStorage.getItem("rom"),n=document.getElementById("pick-file"),o=()=>{document.body.classList.add("rom-uploaded");let a=j(x);document.body.classList.toggle("rom-broken",!V.has(a))};e&&t&&(D=e,x=Uint8Array.from(new Array(t.length/2).fill(0).map((a,s)=>Number.parseInt(t[2*s]+t[2*s+1],16))),o()),n.addEventListener("change",()=>{let a=n.files[0],s=new FileReader;s.addEventListener("loadend",()=>{let r=new Uint8Array(s.result),c=16+(r[6]&4?512:0)+(r[4]<<14)+(r[5]<<13),d=r.slice(0,c),u=Array.from(d,m=>m.toString(16).padStart(2,0)).join("");x=d,window.localStorage.setItem("rom",u),window.localStorage.setItem("name",a.name),o(),D=a.name}),s.readAsArrayBuffer(a)})},fe=()=>{let e=window.localStorage.getItem("simea-replacement"),t=document.getElementsByName("simea-replacement");for(let o of t)o.value==e&&(o.checked=!0);t.forEach(o=>{o.addEventListener("change",a=>{window.localStorage.setItem("simea-replacement",a.target.value)})}),I();let n=document.getElementById("upload-sprite");n.addEventListener("change",()=>{let o=n.files[0],a=new FileReader;a.addEventListener("loadend",()=>{let s=window.localStorage.getItem("simea-replacement-custom")||"{}",r=JSON.parse(s,he),c=a.result,d=o.name.replace(/\.[^/.]+$/,"").replaceAll(/_/g," ");k.init(d,"simea",W(o.name,c),`Loaded on ${new Date().toLocaleString()}`).then(u=>{r[d]=u,window.localStorage.setItem("simea-replacement-custom",JSON.stringify(r,ge)),I()}),n.value=""}),a.readAsText(o)})};Ee=(e,t)=>{let n=document.createElement("a");document.body.appendChild(n),n.style="display: none";let o=new Blob([e],{type:"octet/stream"}),a=window.URL.createObjectURL(o);n.href=a,n.download=t,n.click(),window.URL.revokeObjectURL(a),n.remove()};Me()});se();export{ge as addMapReplacement,he as addMapRestorement,Ee as download,x as rom};
