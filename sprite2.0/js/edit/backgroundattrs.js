import { Context } from './context.js';
export class BackgroundAttrs {
    constructor(context) {
        this.context = context;
        const el = this.el = document.createElement('div');
        const updates = [];
        function text(t) { el.appendChild(document.createTextNode(t)); }
        function input(prop, opts) {
            el.appendChild(makeInput(context, updates, prop, opts));
        }
        text('Tileset: ');
        input(Context.TILESET);
        text('Patterns: ');
        input(Context.pattern(0));
        input(Context.pattern(1));
        text(' Palettes: ');
        input(Context.palette(0));
        input(Context.palette(1));
        input(Context.palette(2));
        text(' Location: ');
        input(Context.LOCATION);
        text(' Flag: ');
        const flag = document.createElement('input');
        el.appendChild(flag);
        flag.type = 'checkbox';
        flag.checked = context.flag;
        flag.addEventListener('change', () => context.flag = flag.checked);
    }
}
export function makeInput(context, updates, prop, { incr = 1, radix = 16 } = {}) {
    const input = document.createElement('input');
    input.type = 'text';
    input.size = 3;
    input.value = writeValue(prop.get(context), radix);
    input.addEventListener('keyup', (ev) => handleKey(ev));
    updates.push(() => input.value = writeValue(prop.get(context), radix));
    function handleKey(ev) {
        let [value, newRadix] = readValue(input.value);
        if (isNaN(value))
            return;
        radix = newRadix;
        if (ev.key === 'ArrowUp') {
            value += incr;
            input.value = writeValue((value & 0xff) >>> 0, radix);
        }
        else if (ev.key === 'ArrowDown') {
            value -= incr;
            input.value = writeValue((value & 0xff) >>> 0, radix);
        }
        prop.set(context, value);
    }
    return input;
}
function readValue(value) {
    if (value.startsWith('$')) {
        return [parseInt(value.substring(1), 16), 16];
    }
    else if (value.startsWith('%')) {
        return [parseInt(value.substring(1), 2), 2];
    }
    return [value ? parseInt(value) : NaN, 10];
}
function writeValue(value, radix) {
    if (value == null)
        return '';
    if (radix === 16)
        return '$' + value.toString(16);
    if (radix === 2)
        return '%' + value.toString(2);
    return value.toString();
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYmFja2dyb3VuZGF0dHJzLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vc3JjL2pzL2VkaXQvYmFja2dyb3VuZGF0dHJzLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLE9BQU8sRUFBQyxPQUFPLEVBQVMsTUFBTSxjQUFjLENBQUM7QUFHN0MsTUFBTSxPQUFPLGVBQWU7SUFJMUIsWUFBcUIsT0FBZ0I7UUFBaEIsWUFBTyxHQUFQLE9BQU8sQ0FBUztRQUNuQyxNQUFNLEVBQUUsR0FBRyxJQUFJLENBQUMsRUFBRSxHQUFHLFFBQVEsQ0FBQyxhQUFhLENBQUMsS0FBSyxDQUFDLENBQUM7UUFHbkQsTUFBTSxPQUFPLEdBQXNCLEVBQUUsQ0FBQztRQUN0QyxTQUFTLElBQUksQ0FBQyxDQUFTLElBQUksRUFBRSxDQUFDLFdBQVcsQ0FBQyxRQUFRLENBQUMsY0FBYyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDO1FBQ3hFLFNBQVMsS0FBSyxDQUFDLElBQThCLEVBQzlCLElBQXNDO1lBQ25ELEVBQUUsQ0FBQyxXQUFXLENBQUMsU0FBUyxDQUFDLE9BQU8sRUFBRSxPQUFPLEVBQUUsSUFBSSxFQUFFLElBQUksQ0FBQyxDQUFDLENBQUM7UUFDMUQsQ0FBQztRQUNELElBQUksQ0FBQyxXQUFXLENBQUMsQ0FBQztRQUNsQixLQUFLLENBQUMsT0FBTyxDQUFDLE9BQU8sQ0FBQyxDQUFDO1FBQ3ZCLElBQUksQ0FBQyxZQUFZLENBQUMsQ0FBQztRQUNuQixLQUFLLENBQUMsT0FBTyxDQUFDLE9BQU8sQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDO1FBQzFCLEtBQUssQ0FBQyxPQUFPLENBQUMsT0FBTyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUM7UUFDMUIsSUFBSSxDQUFDLGFBQWEsQ0FBQyxDQUFDO1FBQ3BCLEtBQUssQ0FBQyxPQUFPLENBQUMsT0FBTyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUM7UUFDMUIsS0FBSyxDQUFD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LElBQUksS0FBSyxDQUFDLFVBQVUsQ0FBQyxHQUFHLENBQUMsRUFBRTtRQUNoQyxPQUFPLENBQUMsUUFBUSxDQUFDLEtBQUssQ0FBQyxTQUFTLENBQUMsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUM7S0FDN0M7SUFDRCxPQUFPLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQyxRQUFRLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQyxDQUFDLEdBQUcsRUFBRSxFQUFFLENBQUMsQ0FBQztBQUM3QyxDQUFDO0FBRUQsU0FBUyxVQUFVLENBQUMsS0FBdUIsRUFBRSxLQUFhO0lBQ3hELElBQUksS0FBSyxJQUFJLElBQUk7UUFBRSxPQUFPLEVBQUUsQ0FBQztJQUM3QixJQUFJLEtBQUssS0FBSyxFQUFFO1FBQUUsT0FBTyxHQUFHLEdBQUcsS0FBSyxDQUFDLFFBQVEsQ0FBQyxFQUFFLENBQUMsQ0FBQztJQUNsRCxJQUFJLEtBQUssS0FBSyxDQUFDO1FBQUUsT0FBTyxHQUFHLEdBQUcsS0FBSyxDQUFDLFFBQVEsQ0FBQyxDQUFDLENBQUMsQ0FBQztJQUNoRCxPQUFPLEtBQUssQ0FBQyxRQUFRLEVBQUUsQ0FBQztBQUMxQixDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHtDb250ZXh0LCBHZXRTZXR9IGZyb20gJy4vY29udGV4dC5qcyc7XG5cbi8qKiBQaWNrZXIgZWxlbWVudCBmb3IgYmFja2dyb3VuZCBhdHRyaWJ1dGVzLiAqL1xuZXhwb3J0IGNsYXNzIEJhY2tncm91bmRBdHRycyB7XG5cbiAgZWw6IEhUTUxEaXZFbGVtZW50O1xuXG4gIGNvbnN0cnVjdG9yKHJlYWRvbmx5IGNvbnRleHQ6IENvbnRleHQpIHtcbiAgICBjb25zdCBlbCA9IHRoaXMuZWwgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcbiAgICAvLyBlbC5hcHBlbmRDaGlsZChkb2N1bWVudC5jcmVhdGVUZXh0Tm9kZSgnU2NyZWVuOiAnKSk7XG4gICAgLy8gZWwuYXBwZW5kQ2hpbGQodGhpcy5pbnB1dHNbMF0pO1xuICAgIGNvbnN0IHVwZGF0ZXM6IEFycmF5PCgpID0+IHZvaWQ+ID0gW107XG4gICAgZnVuY3Rpb24gdGV4dCh0OiBzdHJpbmcpIHsgZWwuYXBwZW5kQ2hpbGQoZG9jdW1lbnQuY3JlYXRlVGV4dE5vZGUodCkpOyB9XG4gICAgZnVuY3Rpb24gaW5wdXQocHJvcDogR2V0U2V0PG51bWJlcnx1bmRlZmluZWQ+LFxuICAgICAgICAgICAgICAgICAgIG9wdHM/OiB7aW5jcj86IG51bWJlciwgcmFkaXg/OiBudW1iZXJ9KSB7XG4gICAgICBlbC5hcHBlbmRDaGlsZChtYWtlSW5wdXQoY29udGV4dCwgdXBkYXRlcywgcHJvcCwgb3B0cykpO1xuICAgIH1cbiAgICB0ZXh0KCdUaWxlc2V0OiAnKTtcbiAgICBpbnB1dChDb250ZXh0LlRJTEVTRVQpO1xuICAgIHRleHQoJ1BhdHRlcm5zOiAnKTtcbiAgICBpbnB1dChDb250ZXh0LnBhdHRlcm4oMCkpO1xuICAgIGlucHV0KENvbnRleHQucGF0dGVybigxKSk7XG4gICAgdGV4dCgnIFBhbGV0dGVzOiAnKTtcbiAgICBpbnB1dChDb250ZXh0LnBhbGV0dGUoMCkpO1xuICAgIGlucHV0KENvbnRleHQucGFsZXR0ZSgxKSk7XG4gICAgaW5wdXQoQ29udGV4dC5wYWxldHRlKDIpKTtcbiAgICB0ZXh0KCcgTG9jYXRpb246ICcpO1xuICAgIGlucHV0KENvbnRleHQuTE9DQVRJT04pO1xuICAgIHRleHQoJyBGbGFnOiAnKTtcbiAgICBjb25zdCBmbGFnID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnaW5wdXQnKTtcbiAgICBlbC5hcHBlbmRDaGlsZChmbGFnKTtcbiAgICBmbGFnLnR5cGUgPSAnY2hlY2tib3gnO1xuICAgIGZsYWcuY2hlY2tlZCA9IGNvbnRleHQuZmxhZztcbiAgICBmbGFnLmFkZEV2ZW50TGlzdGVuZXIoJ2NoYW5nZScsICgpID0+IGNvbnRleHQuZmxhZyA9IGZsYWcuY2hlY2tlZCk7XG4gIH1cbn1cblxuZXhwb3J0IGZ1bmN0aW9uIG1ha2VJbnB1dChjb250ZXh0OiBDb250ZXh0LFxuICAgICAgICAgICAgICAgICAgICAgICAgICB1cGRhdGVzOiBBcnJheTwoKSA9PiB2b2lkPixcbiAgICAgICAgICAgICAgICAgICAgICAgICAgcHJvcDogR2V0U2V0PG51bWJlcnx1bmRlZmluZWQ+LFxuICAgICAgICAgICAgICAgICAgICAgICAgICB7aW5jciA9IDEsIHJhZGl4ID0gMTZ9ID0ge30pOiBIVE1MSW5wdXRFbGVtZW50IHtcbiAgY29uc3QgaW5wdXQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdpbnB1dCcpO1xuICBpbnB1dC50eXBlID0gJ3RleHQnO1xuICBpbnB1dC5zaXplID0gMztcbiAgaW5wdXQudmFsdWUgPSB3cml0ZVZhbHVlKHByb3AuZ2V0KGNvbnRleHQpLCByYWRpeCk7XG4gIGlucHV0LmFkZEV2ZW50TGlzdGVuZXIoJ2tleXVwJywgKGV2KSA9PiBoYW5kbGVLZXkoZXYgYXMgS2V5Ym9hcmRFdmVudCkpO1xuXG4gIHVwZGF0ZXMucHVzaCgoKSA9PiBpbnB1dC52YWx1ZSA9IHdyaXRlVmFsdWUocHJvcC5nZXQoY29udGV4dCksIHJhZGl4KSk7XG5cbiAgZnVuY3Rpb24gaGFuZGxlS2V5KGV2OiBLZXlib2FyZEV2ZW50KSB7XG4gICAgbGV0IFt2YWx1ZSwgbmV3UmFkaXhdID0gcmVhZFZhbHVlKGlucHV0LnZhbHVlKTtcbiAgICBpZiAoaXNOYU4odmFsdWUpKSByZXR1cm47XG4gICAgcmFkaXggPSBuZXdSYWRpeDtcbiAgICBpZiAoZXYua2V5ID09PSAnQXJyb3dVcCcpIHtcbiAgICAgIHZhbHVlICs9IGluY3I7XG4gICAgICBpbnB1dC52YWx1ZSA9IHdyaXRlVmFsdWUoKHZhbHVlICYgMHhmZikgPj4+IDAsIHJhZGl4KTtcbiAgICB9IGVsc2UgaWYgKGV2LmtleSA9PT0gJ0Fycm93RG93bicpIHtcbiAgICAgIHZhbHVlIC09IGluY3I7XG4gICAgICBpbnB1dC52YWx1ZSA9IHdyaXRlVmFsdWUoKHZhbHVlICYgMHhmZikgPj4+IDAsIHJhZGl4KTtcbiAgICB9XG4gICAgcHJvcC5zZXQoY29udGV4dCwgdmFsdWUpO1xuICB9XG5cbiAgcmV0dXJuIGlucHV0O1xufVxuXG5mdW5jdGlvbiByZWFkVmFsdWUodmFsdWU6IHN0cmluZyk6IFtudW1iZXIsIG51bWJlcl0ge1xuICBpZiAodmFsdWUuc3RhcnRzV2l0aCgnJCcpKSB7XG4gICAgcmV0dXJuIFtwYXJzZUludCh2YWx1ZS5zdWJzdHJpbmcoMSksIDE2KSwgMTZdO1xuICB9IGVsc2UgaWYgKHZhbHVlLnN0YXJ0c1dpdGgoJyUnKSkge1xuICAgIHJldHVybiBbcGFyc2VJbnQodmFsdWUuc3Vic3RyaW5nKDEpLCAyKSwgMl07XG4gIH1cbiAgcmV0dXJuIFt2YWx1ZSA/IHBhcnNlSW50KHZhbHVlKSA6IE5hTiwgMTBdO1xufVxuXG5mdW5jdGlvbiB3cml0ZVZhbHVlKHZhbHVlOiBudW1iZXJ8dW5kZWZpbmVkLCByYWRpeDogbnVtYmVyKTogc3RyaW5nIHtcbiAgaWYgKHZhbHVlID09IG51bGwpIHJldHVybiAnJztcbiAgaWYgKHJhZGl4ID09PSAxNikgcmV0dXJuICckJyArIHZhbHVlLnRvU3RyaW5nKDE2KTtcbiAgaWYgKHJhZGl4ID09PSAyKSByZXR1cm4gJyUnICsgdmFsdWUudG9TdHJpbmcoMik7XG4gIHJldHVybiB2YWx1ZS50b1N0cmluZygpO1xufVxuIl19