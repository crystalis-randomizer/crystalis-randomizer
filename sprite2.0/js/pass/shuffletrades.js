export function shuffleTrades(rom, flags, random) {
    if (!flags.randomizeTrades())
        return;
    const { items: { StatueOfOnyx, FogLamp, LovePendant, KirisaPlant, IvoryStatue }, locations: { Swan_DanceHall }, npcs: { KensuInSwan }, } = rom;
    const map = new Map();
    const items = [
        [StatueOfOnyx, 0, 'Akahana'],
        [FogLamp, 0, 'Fisherman'],
        [LovePendant, 0, 'Kensu'],
        [KirisaPlant, 0, 'Aryllis'],
        [IvoryStatue, 0, 'Slimed Kensu'],
    ];
    const npcs = items.map(([item, trade, npcName]) => {
        if (item.trades.indexOf(trade) < 0 || trade >= item.itemUseData.length) {
            throw new Error(`not a trade: ${item} ${trade}`);
        }
        const use = item.itemUseData[trade];
        return [use, item.id, npcName];
    });
    random.shuffle(npcs);
    for (const [item, trade] of items) {
        const [use, originalItem, npcName] = npcs.pop();
        item.itemUseData[trade] = use;
        if (rom.spoiler)
            rom.spoiler.addTrade(item.id, item.messageName, npcName);
        if (use.want === 0x164 && flags.fogLampNotRequired()) {
            [...rom.npcs[0x64].spawnConditions.values()][0][0] = 0x200 | item.id;
        }
        map.set(originalItem, item.id);
    }
    rom.itemGets.actionGrants =
        new Map([...rom.itemGets.actionGrants]
            .map(([k, v]) => { var _a; return [(_a = map.get(k)) !== null && _a !== void 0 ? _a : k, v]; }));
    const rage = rom.items[random.nextInt(4)];
    rom.npcs[0xc3].localDialogs.get(-1)[0].condition = 0x200 | rage.id;
    if (rom.spoiler)
        rom.spoiler.addTrade(rage.id, rage.messageName, 'Rage');
    rom.npcs.PortoaQueen.localDialogs.get(-1)[3].condition = 0x200 | rage.id;
    const tornel = rom.items[random.nextInt(4) * 2 + 6];
    for (const ds of rom.npcs[0x5f].localDialogs.values()) {
        for (let i = 2; i < ds.length; i++) {
            if (ds[i].message.action === 3) {
                ds[i - 2].condition = ~(0x200 | (tornel.id - 1));
                ds[i - 1].condition = ~(0x200 | tornel.id);
                if (rom.spoiler) {
                    rom.spoiler.addTrade(tornel.id, tornel.messageName, 'Tornel');
                }
                break;
            }
        }
    }
    KensuInSwan.dialog(Swan_DanceHall)[0].message.mid = '13:00';
}
export function buildTradeInMap(rom) {
    const map = new Map();
    for (const item of rom.items) {
        for (const trade of item.trades) {
            map.set(item.itemUseData[trade].want & 0xff, item.id);
        }
    }
    return map;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic2h1ZmZsZXRyYWRlcy5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3NyYy9qcy9wYXNzL3NodWZmbGV0cmFkZXMudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBTUEsTUFBTSxVQUFVLGFBQWEsQ0FBQyxHQUFRLEVBQUUsS0FBYyxFQUFFLE1BQWM7SUFDcEUsSUFBSSxDQUFDLEtBQUssQ0FBQyxlQUFlLEVBQUU7UUFBRSxPQUFPO0lBQ3JDLE1BQU0sRUFDSixLQUFLLEVBQUUsRUFBQyxZQUFZLEVBQUUsT0FBTyxFQUFFLFdBQVcsRUFDbEMsV0FBVyxFQUFFLFdBQVcsRUFBQyxFQUNqQyxTQUFTLEVBQUUsRUFBQyxjQUFjLEVBQUMsRUFDM0IsSUFBSSxFQUFFLEVBQUMsV0FBVyxFQUFDLEdBQ3BCLEdBQUcsR0FBRyxDQUFDO0lBR1IsTUFBTSxHQUFHLEdBQUcsSUFBSSxHQUFHLEVBQWtCLENBQUM7SUFFdEMsTUFBTSxLQUFLLEdBQW1EO1FBQzVELENBQUMsWUFBWSxFQUFFLENBQUMsRUFBRSxTQUFTLENBQUM7UUFDNUIsQ0FBQyxPQUFPLEVBQUUsQ0FBQyxFQUFFLFdBQVcsQ0FBQztRQUN6QixDQUFDLFdBQVcsRUFBRSxDQUFDLEVBQUUsT0FBTyxDQUFDO1FBQ3pCLENBQUMsV0FBVyxFQUFFLENBQUMsRUFBRSxTQUFTLENBQUM7UUFDM0IsQ0FBQyxXQUFXLEVBQUUsQ0FBQyxFQUFFLGNBQWMsQ0FBQztLQUV4QixDQUFDO0lBQ1gsTUFBTSxJQUFJLEdBQUcsS0FBSyxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUMsSUFBSSxFQUFFLEtBQUssRUFBRSxPQUFPLENBQUMsRUFBRSxFQUFFO1FBQ2hELElBQUksSUFBSSxDQUFDLE1BQU0sQ0FBQyxPQUFPLENBQUMsS0FBSyxDQUFDLEdBQUcsQ0FBQyxJQUFJLEtBQUssSUFBSSxJQUFJLENBQUMsV0FBVyxDQUFDLE1BQU0sRUFBRTtZQUN0RSxNQUFNLElBQUksS0FBSyxDQUFDLGdCQUFnQixJQUFJLElBQUksS0FBSyxFQUFFLENBQUMsQ0FBQztTQUNsRDtRQUNELE1BQU0sR0FBRyxHQUFHLElBQUksQ0FBQyxXQUFXLENBQUMsS0FBSyxDQUFDLENBQUM7UUFDcEMsT0FBTyxDQUFDLEdBQUcsRUFBRSxJQUFJLENBQUMsRUFBRSxFQUFzQixPQUFPLENBQVUsQ0FBQztJQUM5RCxDQUFDLENBQUMsQ0FBQztJQUNILE1BQU0sQ0FBQyxPQUFPLENBQUMsSUFBSSxDQUFDLENBQUM7SUFFckIsS0FBSyxNQUFNLENBQUMsSUFBSSxFQUFFLEtBQUssQ0FBQyxJQUFJLEtBQUssRUFBRTtRQUNqQyxNQUFNLENBQUMsR0FBRyxFQUFFLFlBQVksRUFBRSxPQUFPLENBQUMsR0FBRyxJQUFJLENBQUMsR0FBRyxFQUFHLENBQUM7UUFDakQsSUFBSSxDQUFDLFdBQVcsQ0FBQyxLQUFLLENBQUMsR0FBRyxHQUFHLENBQUM7UUFDOUIsSUFBSSxHQUFHLENBQUMsT0FBTztZQUFFLEdBQUcsQ0FBQyxPQUFPLENBQUMsUUFBUSxDQUFDLElBQUksQ0FBQyxFQUFFLEVBQUUsSUFBSSxDQUFDLFdBQVcsRUFBRSxPQUFPLENBQUMsQ0FBQztRQUMxRSxJQUFJLEdBQUcsQ0FBQyxJQUFJLEtBQUssS0FBSyxJQUFJLEtBQUssQ0FBQyxrQkFBa0IsRUFBRSxFQUFFO1lBRXBELENBQUMsR0FBRyxHQUFHLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFDLGVBQWUsQ0FBQyxNQUFNLEVBQUUsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxHQUFHLEtBQUssR0FBRyxJQUFJLENBQUMsRUFBRSxDQUFDO1NBQ3RFO1FBQ0QsR0FBRyxDQUFDLEdBQUcsQ0FBQyxZQUFZLEVBQUUsSUFBSSxDQUFDLEVBQUUsQ0FBQyxDQUFDO0tBQ2hDO0lBR0QsR0FBRyxDQUFDLFFBQVEsQ0FBQyxZQUFZO1FBQ3JCLElBQUksR0FBRyxDQUFDLENBQUMsR0FBRyxHQUFHLENBQUMsUUFBUSxDQUFDLFlBQVksQ0FBQzthQUM3QixHQUFHLENBQUMsQ0FBQyxDQUFDLENBQUMsRUFBRSxDQUFDLENBQUMsRUFBRSxFQUFFLFdBQUMsT0FBQSxPQUFDLEdBQUcsQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDLG1DQUFJLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQSxFQUFBLENBQUMsQ0FBQyxDQUFDO0lBR3BELE1BQU0sSUFBSSxHQUFHLEdBQUcsQ0FBQyxLQUFLLENBQUMsTUFBTSxDQUFDLE9BQU8sQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDO0lBQzFDLEdBQUcsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUMsWUFBWSxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUMsQ0FBRSxDQUFDLENBQUMsQ0FBQyxDQUFDLFNBQVMsR0FBRyxLQUFLLEdBQUcsSUFBSSxDQUFDLEVBQUUsQ0FBQztJQUNwRSxJQUFJLEdBQUcsQ0FBQyxPQUFPO1FBQUUsR0FBRyxDQUFDLE9BQU8sQ0FBQyxRQUFRLENBQUMsSUFBSSxDQUFDLEVBQUUsRUFBRSxJQUFJLENBQUMsV0FBVyxFQUFFLE1BQU0sQ0FBQyxDQUFDO0lBRXpFLEdBQUcsQ0FBQyxJQUFJLENBQUMsV0FBVyxDQUFDLFlBQVksQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDLENBQUUsQ0FBQyxDQUFDLENBQUMsQ0FBQyxTQUFTLEdBQUcsS0FBSyxHQUFHLElBQUksQ0FBQyxFQUFFLENBQUM7SUFFMUUsTUFBTSxNQUFNLEdBQUcsR0FBRyxDQUFDLEtBQUssQ0FBQyxNQUFNLENBQUMsT0FBTyxDQUFDLENBQUMsQ0FBQyxHQUFHLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQztJQUNwRCxLQUFLLE1BQU0sRUFBRSxJQUFJLEdBQUcsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUMsWUFBWSxDQUFDLE1BQU0sRUFBRSxFQUFFO1FBQ3JELEtBQUssSUFBSSxDQUFDLEdBQUcsQ0FBQyxFQUFFLENBQUMsR0FBRyxFQUFFLENBQUMsTUFBTSxFQUFFLENBQUMsRUFBRSxFQUFFO1lBQ2xDLElBQUksRUFBRSxDQUFDLENBQUMsQ0FBQyxDQUFDLE9BQU8sQ0FBQyxNQUFNLEtBQUssQ0FBQyxFQUFFO2dCQUU5QixFQUFFLENBQUMsQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDLFNBQVMsR0FBRyxDQUFDLENBQUMsS0FBSyxHQUFHLENBQUMsTUFBTSxDQUFDLEVBQUUsR0FBRyxDQUFDLENBQUMsQ0FBQyxDQUFDO2dCQUNqRCxFQUFFLENBQUMsQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDLFNBQVMsR0FBRyxDQUFDLENBQUMsS0FBSyxHQUFHLE1BQU0sQ0FBQyxFQUFFLENBQUMsQ0FBQztnQkFDM0MsSUFBSSxHQUFHLENBQUMsT0FBTyxFQUFFO29CQUNmLEdBQUcsQ0FBQyxPQUFPLENBQUMsUUFBUSxDQUFDLE1BQU0sQ0FBQyxFQUFFLEVBQUUsTUFBTSxDQUFDLFdBQVcsRUFBRSxRQUFRLENBQUMsQ0FBQztpQkFDL0Q7Z0JBQ0QsTUFBTTthQUNQO1NBQ0Y7S0FDRjtJQUlELFdBQVcsQ0FBQyxNQUFNLENBQUMsY0FBYyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsT0FBTyxDQUFDLEdBQUcsR0FBRyxPQUFPLENBQUM7QUFFOUQsQ0FBQztBQUlELE1BQU0sVUFBVSxlQUFlLENBQUMsR0FBUTtJQUN0QyxNQUFNLEdBQUcsR0FBRyxJQUFJLEdBQUcsRUFBRSxDQUFDO0lBQ3RCLEtBQUssTUFBTSxJQUFJLElBQUksR0FBRyxDQUFDLEtBQUssRUFBRTtRQUM1QixLQUFLLE1BQU0sS0FBSyxJQUFJLElBQUksQ0FBQyxNQUFNLEVBQUU7WUFDL0IsR0FBRyxDQUFDLEdBQUcsQ0FBQyxJQUFJLENBQUMsV0FBVyxDQUFDLEtBQUssQ0FBQyxDQUFDLElBQUksR0FBRyxJQUFJLEVBQUUsSUFBSSxDQUFDLEVBQUUsQ0FBQyxDQUFDO1NBQ3ZEO0tBQ0Y7SUFDRCxPQUFPLEdBQUcsQ0FBQztBQUNiLENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQge0ZsYWdTZXR9IGZyb20gJy4uL2ZsYWdzZXQuanMnO1xuaW1wb3J0IHtSYW5kb219IGZyb20gJy4uL3JhbmRvbS5qcyc7XG5pbXBvcnQge1JvbX0gZnJvbSAnLi4vcm9tLmpzJztcbmltcG9ydCB7SXRlbX0gZnJvbSAnLi4vcm9tL2l0ZW0uanMnO1xuXG4vLyBTaHVmZmxlIHRoZSBwYWxldHRlcy5cbmV4cG9ydCBmdW5jdGlvbiBzaHVmZmxlVHJhZGVzKHJvbTogUm9tLCBmbGFnczogRmxhZ1NldCwgcmFuZG9tOiBSYW5kb20pIHtcbiAgaWYgKCFmbGFncy5yYW5kb21pemVUcmFkZXMoKSkgcmV0dXJuO1xuICBjb25zdCB7XG4gICAgaXRlbXM6IHtTdGF0dWVPZk9ueXgsIEZvZ0xhbXAsIExvdmVQZW5kYW50LFxuICAgICAgICAgICAgS2lyaXNhUGxhbnQsIEl2b3J5U3RhdHVlfSxcbiAgICBsb2NhdGlvbnM6IHtTd2FuX0RhbmNlSGFsbH0sXG4gICAgbnBjczoge0tlbnN1SW5Td2FufSxcbiAgfSA9IHJvbTtcblxuICAvLyBNYXAgdGhlIG9yaWdpbmFsIHRyYWRlIHRvIHRoZSBuZXcgdHJhZGUsIGZvciB1cGRhdGluZyBhY3Rpb25HcmFudHMuXG4gIGNvbnN0IG1hcCA9IG5ldyBNYXA8bnVtYmVyLCBudW1iZXI+KCk7XG5cbiAgY29uc3QgaXRlbXM6IFJlYWRvbmx5QXJyYXk8cmVhZG9ubHkgW0l0ZW0sIG51bWJlciwgc3RyaW5nXT4gPSBbXG4gICAgW1N0YXR1ZU9mT255eCwgMCwgJ0FrYWhhbmEnXSxcbiAgICBbRm9nTGFtcCwgMCwgJ0Zpc2hlcm1hbiddLFxuICAgIFtMb3ZlUGVuZGFudCwgMCwgJ0tlbnN1J10sXG4gICAgW0tpcmlzYVBsYW50LCAwLCAnQXJ5bGxpcyddLFxuICAgIFtJdm9yeVN0YXR1ZSwgMCwgJ1NsaW1lZCBLZW5zdSddLFxuICAgIC8vIFtGbHV0ZU9mTGltZSwgMywgJ1N0b25lZCBBa2FoYW5hJ10sXG4gIF0gYXMgY29uc3Q7XG4gIGNvbnN0IG5wY3MgPSBpdGVtcy5tYXAoKFtpdGVtLCB0cmFkZSwgbnBjTmFtZV0pID0+IHtcbiAgICBpZiAoaXRlbS50cmFkZXMuaW5kZXhPZih0cmFkZSkgPCAwIHx8IHRyYWRlID49IGl0ZW0uaXRlbVVzZURhdGEubGVuZ3RoKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoYG5vdCBhIHRyYWRlOiAke2l0ZW19ICR7dHJhZGV9YCk7XG4gICAgfVxuICAgIGNvbnN0IHVzZSA9IGl0ZW0uaXRlbVVzZURhdGFbdHJhZGVdOyAvLyB1c2Uud2FudCA9PT0gTlBDIGlkIHwgMTAwXG4gICAgcmV0dXJuIFt1c2UsIGl0ZW0uaWQgLyogb3JpZ2luYWwgaXRlbSAqLywgbnBjTmFtZV0gYXMgY29uc3Q7XG4gIH0pO1xuICByYW5kb20uc2h1ZmZsZShucGNzKTtcblxuICBmb3IgKGNvbnN0IFtpdGVtLCB0cmFkZV0gb2YgaXRlbXMpIHtcbiAgICBjb25zdCBbdXNlLCBvcmlnaW5hbEl0ZW0sIG5wY05hbWVdID0gbnBjcy5wb3AoKSE7XG4gICAgaXRlbS5pdGVtVXNlRGF0YVt0cmFkZV0gPSB1c2U7XG4gICAgaWYgKHJvbS5zcG9pbGVyKSByb20uc3BvaWxlci5hZGRUcmFkZShpdGVtLmlkLCBpdGVtLm1lc3NhZ2VOYW1lLCBucGNOYW1lKTtcbiAgICBpZiAodXNlLndhbnQgPT09IDB4MTY0ICYmIGZsYWdzLmZvZ0xhbXBOb3RSZXF1aXJlZCgpKSB7XG4gICAgICAvLyBmaXNoZXJtYW4gbm93IHNwYXducyBiYXNlZCBvbiB0cmFkZS1pbiBpdGVtXG4gICAgICBbLi4ucm9tLm5wY3NbMHg2NF0uc3Bhd25Db25kaXRpb25zLnZhbHVlcygpXVswXVswXSA9IDB4MjAwIHwgaXRlbS5pZDtcbiAgICB9XG4gICAgbWFwLnNldChvcmlnaW5hbEl0ZW0sIGl0ZW0uaWQpO1xuICB9XG5cbiAgLy8gRml4IHVwIHRoZSBhY3Rpb25HcmFudHNcbiAgcm9tLml0ZW1HZXRzLmFjdGlvbkdyYW50cyA9XG4gICAgICBuZXcgTWFwKFsuLi5yb20uaXRlbUdldHMuYWN0aW9uR3JhbnRzXVxuICAgICAgICAgICAgICAubWFwKChbaywgdl0pID0+IFttYXAuZ2V0KGspID8/IGssIHZdKSk7XG5cbiAgLy8gQWxzbyByYW5kb21pemUgUmFnZSBhbmQgVG9ybmVsXG4gIGNvbnN0IHJhZ2UgPSByb20uaXRlbXNbcmFuZG9tLm5leHRJbnQoNCldO1xuICByb20ubnBjc1sweGMzXS5sb2NhbERpYWxvZ3MuZ2V0KC0xKSFbMF0uY29uZGl0aW9uID0gMHgyMDAgfCByYWdlLmlkO1xuICBpZiAocm9tLnNwb2lsZXIpIHJvbS5zcG9pbGVyLmFkZFRyYWRlKHJhZ2UuaWQsIHJhZ2UubWVzc2FnZU5hbWUsICdSYWdlJyk7XG4gIC8vIFBvcnRvYSBxdWVlbiAzOCB0YWtlcyB0aGUgc2FtZSBzd29yZCBhcyBSYWdlXG4gIHJvbS5ucGNzLlBvcnRvYVF1ZWVuLmxvY2FsRGlhbG9ncy5nZXQoLTEpIVszXS5jb25kaXRpb24gPSAweDIwMCB8IHJhZ2UuaWQ7XG5cbiAgY29uc3QgdG9ybmVsID0gcm9tLml0ZW1zW3JhbmRvbS5uZXh0SW50KDQpICogMiArIDZdO1xuICBmb3IgKGNvbnN0IGRzIG9mIHJvbS5ucGNzWzB4NWZdLmxvY2FsRGlhbG9ncy52YWx1ZXMoKSkge1xuICAgIGZvciAobGV0IGkgPSAyOyBpIDwgZHMubGVuZ3RoOyBpKyspIHtcbiAgICAgIGlmIChkc1tpXS5tZXNzYWdlLmFjdGlvbiA9PT0gMykge1xuICAgICAgICAvLyBOT1RFOiBicmFjZWxldCBnb2VzIGZpcnN0XG4gICAgICAgIGRzW2kgLSAyXS5jb25kaXRpb24gPSB+KDB4MjAwIHwgKHRvcm5lbC5pZCAtIDEpKTtcbiAgICAgICAgZHNbaSAtIDFdLmNvbmRpdGlvbiA9IH4oMHgyMDAgfCB0b3JuZWwuaWQpO1xuICAgICAgICBpZiAocm9tLnNwb2lsZXIpIHtcbiAgICAgICAgICByb20uc3BvaWxlci5hZGRUcmFkZSh0b3JuZWwuaWQsIHRvcm5lbC5tZXNzYWdlTmFtZSwgJ1Rvcm5lbCcpO1xuICAgICAgICB9XG4gICAgICAgIGJyZWFrO1xuICAgICAgfVxuICAgIH1cbiAgfVxuXG4gIC8vIEtlbnN1IGluIFN3YW4gc2hvdWxkIGtlZXAgdGVsbGluZyB0aGUgcGxheWVyIHdoYXQgaGUgd2FudHMsIHJhdGhlclxuICAvLyB0aGFuIHN3aXRjaGluZyB0byBcIkkgaGF0ZSBwZW9wbGUgd2hvIGFyZSBwdXNoeVwiLlxuICBLZW5zdUluU3dhbi5kaWFsb2coU3dhbl9EYW5jZUhhbGwpWzBdLm1lc3NhZ2UubWlkID0gJzEzOjAwJztcbiAgLy8gVE9ETyAtIG1hcmsgMTM6MDEgYXMgdW51c2VkP1xufVxuXG4vLyBOT1RFIC0gdGhpcyBpcyBjb3BpZWQgZnJvbSBmaXhkaWFsb2dcbi8qKiBCdWlsZHMgYSBtYXAgZnJvbSBOUEMgaWQgdG8gd2FudGVkIGl0ZW0gaWQuICovXG5leHBvcnQgZnVuY3Rpb24gYnVpbGRUcmFkZUluTWFwKHJvbTogUm9tKTogTWFwPG51bWJlciwgbnVtYmVyPiB7XG4gIGNvbnN0IG1hcCA9IG5ldyBNYXAoKTtcbiAgZm9yIChjb25zdCBpdGVtIG9mIHJvbS5pdGVtcykge1xuICAgIGZvciAoY29uc3QgdHJhZGUgb2YgaXRlbS50cmFkZXMpIHtcbiAgICAgIG1hcC5zZXQoaXRlbS5pdGVtVXNlRGF0YVt0cmFkZV0ud2FudCAmIDB4ZmYsIGl0ZW0uaWQpO1xuICAgIH1cbiAgfVxuICByZXR1cm4gbWFwO1xufVxuIl19