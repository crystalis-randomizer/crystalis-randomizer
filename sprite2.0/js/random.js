const IM1 = 2147483563;
const IM2 = 2147483399;
const AM = 1 / IM1;
const IMM1 = IM1 - 1;
const IA1 = 40014;
const IA2 = 40692;
const IQ1 = 53668;
const IQ2 = 52774;
const IR1 = 12211;
const IR2 = 3791;
const NTAB = 32;
const NDIV = 1 + Math.floor(IMM1 / NTAB);
const EPS = 1.2e-7;
const RNMX = 1 - EPS;
export class Random {
    constructor(seed = Math.floor(Math.random() * 0x100000000)) {
        this.idum = 0;
        this.idum2 = 0;
        this.iy = 0;
        this.iv = [];
        this.z1 = null;
        this.seed(seed);
    }
    static newSeed() {
        return Math.floor(Math.random() * 0x100000000);
    }
    seed(seed) {
        this.idum = Math.max(1, Math.floor(seed));
        this.idum2 = this.idum;
        this.iy = 0;
        this.iv = new Array(NTAB).fill(0);
        for (let j = NTAB + 7; j >= 0; j--) {
            const k = Math.floor(this.idum / IQ1);
            this.idum = IA1 * (this.idum - k * IQ1) - k * IR1;
            if (this.idum < 0)
                this.idum += IM1;
            if (j < NTAB)
                this.iv[j] = this.idum;
        }
        this.iy = this.iv[0];
    }
    next() {
        let k = Math.floor(this.idum / IQ1);
        this.idum = IA1 * (this.idum - k * IQ1) - k * IR1;
        if (this.idum < 0)
            this.idum += IM1;
        k = Math.floor(this.idum2 / IQ2);
        this.idum2 = IA2 * (this.idum2 - k * IQ2) - k * IR2;
        if (this.idum2 < 0)
            this.idum2 += IM2;
        const j = Math.floor(this.iy / NDIV);
        this.iy = this.iv[j] - this.idum2;
        this.iv[j] = this.idum;
        if (this.iy < 1)
            this.iy += IMM1;
        return Math.min(AM * this.iy, RNMX);
    }
    nextInt(n) {
        return Math.floor(this.next() * n);
    }
    nextNormal(mean = 0, stdev = 1, min = -Infinity, max = Infinity) {
        while (true) {
            let z = this.z1;
            if (z == null) {
                const r = Math.sqrt(-2 * Math.log(this.next()));
                const theta = TWOPI * this.next();
                z = r * Math.cos(theta);
                this.z1 = r * Math.sin(theta);
            }
            else {
                this.z1 = null;
            }
            z = mean + z * stdev;
            if (z >= min && z <= max)
                return z;
        }
    }
    shuffle(array) {
        for (let i = array.length; i;) {
            const j = this.nextInt(i--);
            [array[i], array[j]] = [array[j], array[i]];
        }
        return array;
    }
    *ishuffle(iterable) {
        const arr = [];
        if (!Array.isArray(iterable)) {
            if (hasSize(iterable)) {
                const iter = iterable[Symbol.iterator]();
                for (let i = 0; i < iterable.size; i++) {
                    const j = i + this.nextInt(iterable.size - i);
                    while (arr.length <= j) {
                        arr.push(iter.next().value);
                    }
                    yield arr[j];
                    arr[j] = arr[i];
                }
                return;
            }
            else {
                iterable = [...iterable];
            }
        }
        if (!Array.isArray(iterable))
            throw new Error('impossible');
        for (let i = 0; i < iterable.length; i++) {
            const j = i + this.nextInt(iterable.length - i);
            yield j in arr ? arr[j] : iterable[j];
            arr[j] = i in arr ? arr[i] : iterable[i];
        }
    }
    pick(arr) {
        if (!arr.length)
            throw new Error('empty array');
        return arr[this.nextInt(arr.length)];
    }
    pickWeighted(arr) {
        if (!arr.length)
            throw new Error('empty array');
        let total = 0;
        for (const [weight] of arr)
            total += weight;
        let choice = this.next() * total;
        for (const [weight, elem] of arr) {
            if (choice < weight)
                return elem;
            choice -= weight;
        }
        throw new Error('bad weights');
    }
    pickAndRemove(...arrs) {
        let count = 0;
        for (const arr of arrs) {
            count += arr.length;
        }
        if (!count)
            throw new Error('empty arrays');
        let i = this.nextInt(count);
        for (const arr of arrs) {
            if (i < arr.length)
                return arr.splice(i, 1)[0];
            i -= arr.length;
        }
        throw new Error('impossible');
    }
    bitGenerator() {
        let bits = 0;
        let next = 0;
        return () => {
            if (!bits) {
                bits = 32;
                next = this.nextInt(0x100000000);
            }
            bits--;
            const result = !(next & 1);
            next >>>= 1;
            return result;
        };
    }
}
function hasSize(iter) {
    return 'size' in iter;
}
const TWOPI = 2 * Math.PI;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicmFuZG9tLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vc3JjL2pzL3JhbmRvbS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxNQUFNLEdBQUcsR0FBRyxVQUFVLENBQUM7QUFDdkIsTUFBTSxHQUFHLEdBQUcsVUFBVSxDQUFDO0FBQ3ZCLE1BQU0sRUFBRSxHQUFHLENBQUMsR0FBRyxHQUFHLENBQUM7QUFDbkIsTUFBTSxJQUFJLEdBQUcsR0FBRyxHQUFHLENBQUMsQ0FBQztBQUNyQixNQUFNLEdBQUcsR0FBRyxLQUFLLENBQUM7QUFDbEIsTUFBTSxHQUFHLEdBQUcsS0FBSyxDQUFDO0FBQ2xCLE1BQU0sR0FBRyxHQUFHLEtBQUssQ0FBQztBQUNsQixNQUFNLEdBQUcsR0FBRyxLQUFLLENBQUM7QUFDbEIsTUFBTSxHQUFHLEdBQUcsS0FBSyxDQUFDO0FBQ2xCLE1BQU0sR0FBRyxHQUFHLElBQUksQ0FBQztBQUNqQixNQUFNLElBQUksR0FBRyxFQUFFLENBQUM7QUFDaEIsTUFBTSxJQUFJLEdBQUcsQ0FBQyxHQUFHLElBQUksQ0FBQyxLQUFLLENBQUMsSUFBSSxHQUFHLElBQUksQ0FBQyxDQUFDO0FBQ3pDLE1BQU0sR0FBRyxHQUFHLE1BQU0sQ0FBQztBQUNuQixNQUFNLElBQUksR0FBRyxDQUFDLEdBQUcsR0FBRyxDQUFDO0FBRXJCLE1BQU0sT0FBTyxNQUFNO0lBYWpCLFlBQVksT0FBZSxJQUFJLENBQUMsS0FBSyxDQUFDLElBQUksQ0FBQyxNQUFNLEVBQUUsR0FBRyxXQUFXLENBQUM7UUFOMUQsU0FBSSxHQUFXLENBQUMsQ0FBQztRQUNqQixVQUFLLEdBQVcsQ0FBQyxDQUFDO1FBQ2xCLE9BQUUsR0FBVyxDQUFDLENBQUM7UUFDZixPQUFFLEdBQWEsRUFBRSxDQUFDO1FBQ2xCLE9BQUUsR0FBa0IsSUFBSSxDQUFDO1FBRy9CLElBQUksQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUM7SUFDbEIsQ0FBQztJQVpELE1BQU0sQ0FBQyxPQUFPO1FBQ1osT0FBTyxJQUFJLENBQUMsS0FBSyxDQUFDLElBQUksQ0FBQyxNQUFNLEVBQUUsR0FBRyxXQUFXLENBQUMsQ0FBQztJQUNqRCxDQUFDO0lBWUQsSUFBSSxDQUFDLElBQVk7UUFDZixJQUFJLENBQUMsSUFBSSxHQUFHLElBQUksQ0FBQyxHQUFHLENBQUMsQ0FBQyxFQUFFLElBQUksQ0FBQyxLQUFLLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQztRQUMxQyxJQUFJLENBQUMsS0FBSyxHQUFHLElBQUksQ0FBQyxJQUFJLENBQUM7UUFDdkIsSUFBSSxDQUFDLEVBQUUsR0FBRyxDQUFDLENBQUM7UUFDWixJQUFJLENBQUMsRUFBRSxHQUFHLElBQUksS0FBSyxDQUFDLElBQUksQ0FBQyxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsQ0FBQztRQUNsQyxLQUFLLElBQUksQ0FBQyxHQUFHLElBQUksR0FBRyxDQUFDLEVBQUUsQ0FBQyxJQUFJLENBQUMsRUFBRSxDQUFDLEVBQUUsRUFBRTtZQUNsQyxNQUFNLENBQUMsR0FBRyxJQUFJLENBQUMsS0FBSyxDQUFDLElBQUksQ0FBQyxJQUFJLEdBQUcsR0FBRyxDQUFDLENBQUM7WUFDdEMsSUFBSSxDQUFDLElBQUksR0FBRyxHQUFHLEdBQUcsQ0FBQyxJQUFJLENBQUMsSUFBSSxHQUFHLENBQUMsR0FBRyxHQUFHLENBQUMsR0FBRyxDQUFDLEdBQUcsR0FBRyxDQUFDO1lBQ2xELElBQUksSUFBSSxDQUFDLElBQUksR0FBRyxDQUFDO2dCQUFFLElBQUksQ0FBQyxJQUFJLElBQUksR0FBRyxDQUFDO1lBQ3BDLElBQUksQ0FBQyxHQUFHLElBQUk7Z0JBQUUsSUFBSSxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUMsR0FBRyxJQUFJLENBQUMsSUFBSSxDQUFDO1NBQ3RDO1FBQ0QsSUFBSSxDQUFDLEVBQUUsR0FBRyxJQUFJLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQyxDQUFDO0lBQ3ZCLENBQUM7SUFFRCxJQUFJO1FBQ0YsSUFBSSxDQUFDLEdBQUcsSUFBSSxDQUFDLEtBQUssQ0FBQyxJQUFJLENBQUMsSUFBSSxHQUFHLEdBQUcsQ0FBQyxDQUFDO1FBQ3BDLElBQUksQ0FBQyxJQUFJLEdBQUcsR0FBRyxHQUFHLENBQUMsSUFBSSxDQUFDLElBQUksR0FBRyxDQUFDLEdBQUcsR0FBRyxDQUFDLEdBQUcsQ0FBQyxHQUFHLEdBQUcsQ0FBQztRQUNsRCxJQUFJLElBQUksQ0FBQyxJQUFJLEdBQUcsQ0FBQztZQUFFLElBQUksQ0FBQyxJQUFJLElBQUksR0FBRyxDQUFDO1FBQ3BDLENBQUMsR0FBRyxJQUFJLENBQUMsS0FBSyxDQUFDLElBQUksQ0FBQyxLQUFLLEdBQUcsR0FBRyxDQUFDLENBQUM7UUFDakMsSUFBSSxDQUFDLEtBQUssR0FBRyxHQUFHLEdBQUcsQ0FBQyxJQUFJLENBQUMsS0FBSyxHQUFHLENBQUMsR0FBRyxHQUFHLENBQUMsR0FBRyxDQUFDLEdBQUcsR0FBRyxDQUFDO1FBQ3BELElBQUksSUFBSSxDQUFDLEtBQUssR0FBRyxDQUFDO1lBQUUsSUFBSSxDQUFDLEtBQUssSUFBSSxHQUFHLENBQUM7UUFDdEMsTUFBTSxDQUFDLEdBQUcsSUFBSSxDQUFDLEtBQUssQ0FBQyxJQUFJLENBQUMsRUFBRSxHQUFHLElBQUksQ0FBQyxDQUFDO1FBQ3JDLElBQUksQ0FBQyxFQUFFLEdBQUcsSUFBSSxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUMsR0FBRyxJQUFJLENBQUMsS0FBSyxDQUFDO1FBQ2xDLElBQUksQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDLEdBQUcsSUFBSSxDQUFDLElBQUksQ0FBQztRQUN2QixJQUFJLElBQUksQ0FBQyxFQUFFLEdBQUcsQ0FBQztZQUFFLElBQUksQ0FBQyxFQUFFLElBQUksSUFBSSxDQUFDO1FBQ2pDLE9BQU8sSUFBSSxDQUFDLEdBQUcsQ0FBQyxFQUFFLEdBQUcsSUFBSSxDQUFDLEVBQUUsRUFBRSxJQUFJLENBQUMsQ0FBQztJQUN0QyxDQUFDO0lBRUQsT0FBTyxDQUFDLENBQVM7UUFDZixPQUFPLElBQUksQ0FBQyxLQUFLLENBQUMsSUFBSSxDQUFDLElBQUksRUFBRSxHQUFHLENBQUMsQ0FBQyxDQUFDO0lBQ3JDLENBQUM7SUFFRCxVQUFVLENBQUMsT0FBZSxDQUFDLEVBQ2hCLFFBQWdCLENBQUMsRUFDakIsTUFBYyxDQUFDLFFBQVEsRUFDdkIsTUFBYyxRQUFRO1FBQy9CLE9BQU8sSUFBSSxFQUFFO1lBQ1gsSUFBSSxDQUFDLEdBQUcsSUFBSSxDQUFDLEVBQUUsQ0FBQztZQUNoQixJQUFJLENBQUMsSUFBSSxJQUFJLEVBQUU7Z0JBQ2IsTUFBTSxDQUFDLEdBQUcsSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsR0FBRyxJQUFJLENBQUMsR0FBRyxDQUFDLElBQUksQ0FBQyxJQUFJLEVBQUUsQ0FBQyxDQUFDLENBQUM7Z0JBQ2hELE1BQU0sS0FBSyxHQUFHLEtBQUssR0FBRyxJQUFJLENBQUMsSUFBSSxFQUFFLENBQUM7Z0JBQ2xDLENBQUMsR0FBRyxDQUFDLEdBQUcsSUFBSSxDQUFDLEdBQUcsQ0FBQyxLQUFLLENBQUMsQ0FBQztnQkFDeEIsSUFBSSxDQUFDLEVBQUUsR0FBRyxDQUFDLEdBQUcsSUFBSSxDQUFDLEdBQUcsQ0FBQyxLQUFLLENBQUMsQ0FBQzthQUMvQjtpQkFBTTtnQkFDTCxJQUFJLENBQUMsRUFBRSxHQUFHLElBQUksQ0FBQzthQUNoQjtZQUNELENBQUMsR0FBRyxJQUFJLEdBQUcsQ0FBQyxHQUFHLEtBQUssQ0FBQztZQUNyQixJQUFJLENBQUMsSUFBSSxHQUFHLElBQUksQ0FBQyxJQUFJLEdBQUc7Z0JBQUUsT0FBTyxDQUFDLENBQUM7U0FDcEM7SUFDSCxDQUFDO0lBRUQsT0FBTyxDQUFzQyxLQUFRO1FBQ25ELEtBQUssSUFBSSxDQUFDLEdBQUcsS0FBSyxDQUFDLE1BQU0sRUFBRSxDQUFDLEdBQUc7WUFDN0IsTUFBTSxDQUFDLEdBQUcsSUFBSSxDQUFDLE9BQU8sQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDO1lBQzVCLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQyxFQUFFLEtBQUssQ0FBQyxDQUFDLENBQUMsQ0FBQyxHQUFHLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQyxFQUFFLEtBQUssQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDO1NBQzdDO1FBQ0QsT0FBTyxLQUFLLENBQUM7SUFDZixDQUFDO0lBR0QsQ0FBRSxRQUFRLENBQUksUUFBcUI7UUFDakMsTUFBTSxHQUFHLEdBQVEsRUFBRSxDQUFDO1FBQ3BCLElBQUksQ0FBQyxLQUFLLENBQUMsT0FBTyxDQUFDLFFBQVEsQ0FBQyxFQUFFO1lBQzVCLElBQUksT0FBTyxDQUFDLFFBQVEsQ0FBQyxFQUFFO2dCQUNyQixNQUFNLElBQUksR0FBRyxRQUFRLENBQUMsTUFBTSxDQUFDLFFBQVEsQ0FBQyxFQUFFLENBQUM7Z0JBQ3pDLEtBQUssSUFBSSxDQUFDLEdBQUcsQ0FBQyxFQUFFLENBQUMsR0FBRyxRQUFRLENBQUMsSUFBSSxFQUFFLENBQUMsRUFBRSxFQUFFO29CQUN0QyxNQUFNLENBQUMsR0FBRyxDQUFDLEdBQUcsSUFBSSxDQUFDLE9BQU8sQ0FBQyxRQUFRLENBQUMsSUFBSSxHQUFHLENBQUMsQ0FBQyxDQUFDO29CQUM5QyxPQUFPLEdBQUcsQ0FBQyxNQUFNLElBQUksQ0FBQyxFQUFFO3dCQUN0QixHQUFHLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxJQUFJLEVBQUUsQ0FBQyxLQUFLLENBQUMsQ0FBQztxQkFDN0I7b0JBQ0QsTUFBTSxHQUFHLENBQUMsQ0FBQyxDQUFDLENBQUM7b0JBQ2IsR0FBRyxDQUFDLENBQUMsQ0FBQyxHQUFHLEdBQUcsQ0FBQyxDQUFDLENBQUMsQ0FBQztpQkFDakI7Z0JBQ0QsT0FBTzthQUNSO2lCQUFNO2dCQUNMLFFBQVEsR0FBRyxDQUFDLEdBQUcsUUFBUSxDQUFDLENBQUM7YUFDMUI7U0FDRjtRQUNELElBQUksQ0FBQyxLQUFLLENBQUMsT0FBTyxDQUFDLFFBQVEsQ0FBQztZQUFFLE1BQU0sSUFBSSxLQUFLLENBQUMsWUFBWSxDQUFDLENBQUM7UUFDNUQsS0FBSyxJQUFJLENBQUMsR0FBRyxDQUFDLEVBQUUsQ0FBQyxHQUFHLFFBQVEsQ0FBQyxNQUFNLEVBQUUsQ0FBQyxFQUFFLEVBQUU7WUFDeEMsTUFBTSxDQUFDLEdBQUcsQ0FBQyxHQUFHLElBQUksQ0FBQyxPQUFPLENBQUMsUUFBUSxDQUFDLE1BQU0sR0FBRyxDQUFDLENBQUMsQ0FBQztZQUNoRCxNQUFNLENBQUMsSUFBSSxHQUFHLENBQUMsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsUUFBUSxDQUFDLENBQUMsQ0FBQyxDQUFDO1lBQ3RDLEdBQUcsQ0FBQyxDQUFDLENBQUMsR0FBRyxDQUFDLElBQUksR0FBRyxDQUFDLENBQUMsQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLFFBQVEsQ0FBQyxDQUFDLENBQUMsQ0FBQztTQUMxQztJQUNILENBQUM7SUFFRCxJQUFJLENBQUksR0FBaUI7UUFDdkIsSUFBSSxDQUFDLEdBQUcsQ0FBQyxNQUFNO1lBQUUsTUFBTSxJQUFJLEtBQUssQ0FBQyxhQUFhLENBQUMsQ0FBQztRQUNoRCxPQUFPLEdBQUcsQ0FBQyxJQUFJLENBQUMsT0FBTyxDQUFDLEdBQUcsQ0FBQyxNQUFNLENBQUMsQ0FBQyxDQUFDO0lBQ3ZDLENBQUM7SUFFRCxZQUFZLENBQUksR0FBd0M7UUFDdEQsSUFBSSxDQUFDLEdBQUcsQ0FBQyxNQUFNO1lBQUUsTUFBTSxJQUFJLEtBQUssQ0FBQyxhQUFhLENBQUMsQ0FBQztRQUNoRCxJQUFJLEtBQUssR0FBRyxDQUFDLENBQUM7UUFDZCxLQUFLLE1BQU0sQ0FBQyxNQUFNLENBQUMsSUFBSSxHQUFHO1lBQUUsS0FBSyxJQUFJLE1BQU0sQ0FBQztRQUM1QyxJQUFJLE1BQU0sR0FBRyxJQUFJLENBQUMsSUFBSSxFQUFFLEdBQUcsS0FBSyxDQUFDO1FBQ2pDLEtBQUssTUFBTSxDQUFDLE1BQU0sRUFBRSxJQUFJLENBQUMsSUFBSSxHQUFHLEVBQUU7WUFDaEMsSUFBSSxNQUFNLEdBQUcsTUFBTTtnQkFBRSxPQUFPLElBQUksQ0FBQztZQUNqQyxNQUFNLElBQUksTUFBTSxDQUFDO1NBQ2xCO1FBQ0QsTUFBTSxJQUFJLEtBQUssQ0FBQyxhQUFhLENBQUMsQ0FBQztJQUNqQyxDQUFDO0lBRUQsYUFBYSxDQUFJLEdBQUcsSUFBVztRQUM3QixJQUFJLEtBQUssR0FBRyxDQUFDLENBQUM7UUFDZCxLQUFLLE1BQU0sR0FBRyxJQUFJLElBQUksRUFBRTtZQUN0QixLQUFLLElBQUksR0FBRyxDQUFDLE1BQU0sQ0FBQztTQUNyQjtRQUNELElBQUksQ0FBQyxLQUFLO1lBQUUsTUFBTSxJQUFJLEtBQUssQ0FBQyxjQUFjLENBQUMsQ0FBQztRQUM1QyxJQUFJLENBQUMsR0FBRyxJQUFJLENBQUMsT0FBTyxDQUFDLEtBQUssQ0FBQyxDQUFDO1FBQzVCLEtBQUssTUFBTSxHQUFHLElBQUksSUFBSSxFQUFFO1lBQ3RCLElBQUksQ0FBQyxHQUFHLEdBQUcsQ0FBQyxNQUFNO2dCQUFFLE9BQU8sR0FBRyxDQUFDLE1BQU0sQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUM7WUFDL0MsQ0FBQyxJQUFJLEdBQUcsQ0FBQyxNQUFNLENBQUM7U0FDakI7UUFDRCxNQUFNLElBQUksS0FBSyxDQUFDLFlBQVksQ0FBQyxDQUFDO0lBQ2hDLENBQUM7SUFFRCxZQUFZO1FBQ1YsSUFBSSxJQUFJLEdBQUcsQ0FBQyxDQUFDO1FBQ2IsSUFBSSxJQUFJLEdBQUcsQ0FBQyxDQUFDO1FBQ2IsT0FBTyxHQUFHLEVBQUU7WUFDVixJQUFJLENBQUMsSUFBSSxFQUFFO2dCQUNULElBQUksR0FBRyxFQUFFLENBQUM7Z0JBQ1YsSUFBSSxHQUFHLElBQUksQ0FBQyxPQUFPLENBQUMsV0FBVyxDQUFDLENBQUM7YUFDbEM7WUFDRCxJQUFJLEVBQUUsQ0FBQztZQUNQLE1BQU0sTUFBTSxHQUFHLENBQUMsQ0FBQyxJQUFJLEdBQUcsQ0FBQyxDQUFDLENBQUM7WUFDM0IsSUFBSSxNQUFNLENBQUMsQ0FBQTtZQUNYLE9BQU8sTUFBTSxDQUFDO1FBQ2hCLENBQUMsQ0FBQztJQUNKLENBQUM7Q0FDRjtBQUtELFNBQVMsT0FBTyxDQUFJLElBQWlCO0lBQ25DLE9BQU8sTUFBTSxJQUFJLElBQUksQ0FBQztBQUN4QixDQUFDO0FBRUQsTUFBTSxLQUFLLEdBQUcsQ0FBQyxHQUFHLElBQUksQ0FBQyxFQUFFLENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyJjb25zdCBJTTEgPSAyMTQ3NDgzNTYzO1xuY29uc3QgSU0yID0gMjE0NzQ4MzM5OTtcbmNvbnN0IEFNID0gMSAvIElNMTtcbmNvbnN0IElNTTEgPSBJTTEgLSAxO1xuY29uc3QgSUExID0gNDAwMTQ7XG5jb25zdCBJQTIgPSA0MDY5MjtcbmNvbnN0IElRMSA9IDUzNjY4O1xuY29uc3QgSVEyID0gNTI3NzQ7XG5jb25zdCBJUjEgPSAxMjIxMTtcbmNvbnN0IElSMiA9IDM3OTE7XG5jb25zdCBOVEFCID0gMzI7XG5jb25zdCBORElWID0gMSArIE1hdGguZmxvb3IoSU1NMSAvIE5UQUIpO1xuY29uc3QgRVBTID0gMS4yZS03O1xuY29uc3QgUk5NWCA9IDEgLSBFUFM7XG5cbmV4cG9ydCBjbGFzcyBSYW5kb20ge1xuXG4gIC8vIFJldHVybnMgYSBuZXcgc2VlZCBhdCByYW5kb20sIHVzaW5nIHRoZSBzeXN0ZW0gUFJORy5cbiAgc3RhdGljIG5ld1NlZWQoKTogbnVtYmVyIHtcbiAgICByZXR1cm4gTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogMHgxMDAwMDAwMDApO1xuICB9XG5cbiAgcHJpdmF0ZSBpZHVtOiBudW1iZXIgPSAwO1xuICBwcml2YXRlIGlkdW0yOiBudW1iZXIgPSAwO1xuICBwcml2YXRlIGl5OiBudW1iZXIgPSAwO1xuICBwcml2YXRlIGl2OiBudW1iZXJbXSA9IFtdO1xuICBwcml2YXRlIHoxOiBudW1iZXIgfCBudWxsID0gbnVsbDsgLy8gZXh0cmEgbm9ybWFsIGRldmlhdGVcblxuICBjb25zdHJ1Y3RvcihzZWVkOiBudW1iZXIgPSBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiAweDEwMDAwMDAwMCkpIHtcbiAgICB0aGlzLnNlZWQoc2VlZCk7XG4gIH1cblxuICBzZWVkKHNlZWQ6IG51bWJlcikge1xuICAgIHRoaXMuaWR1bSA9IE1hdGgubWF4KDEsIE1hdGguZmxvb3Ioc2VlZCkpO1xuICAgIHRoaXMuaWR1bTIgPSB0aGlzLmlkdW07XG4gICAgdGhpcy5peSA9IDA7XG4gICAgdGhpcy5pdiA9IG5ldyBBcnJheShOVEFCKS5maWxsKDApO1xuICAgIGZvciAobGV0IGogPSBOVEFCICsgNzsgaiA+PSAwOyBqLS0pIHtcbiAgICAgIGNvbnN0IGsgPSBNYXRoLmZsb29yKHRoaXMuaWR1bSAvIElRMSk7XG4gICAgICB0aGlzLmlkdW0gPSBJQTEgKiAodGhpcy5pZHVtIC0gayAqIElRMSkgLSBrICogSVIxO1xuICAgICAgaWYgKHRoaXMuaWR1bSA8IDApIHRoaXMuaWR1bSArPSBJTTE7XG4gICAgICBpZiAoaiA8IE5UQUIpIHRoaXMuaXZbal0gPSB0aGlzLmlkdW07XG4gICAgfVxuICAgIHRoaXMuaXkgPSB0aGlzLml2WzBdO1xuICB9XG5cbiAgbmV4dCgpOiBudW1iZXIge1xuICAgIGxldCBrID0gTWF0aC5mbG9vcih0aGlzLmlkdW0gLyBJUTEpO1xuICAgIHRoaXMuaWR1bSA9IElBMSAqICh0aGlzLmlkdW0gLSBrICogSVExKSAtIGsgKiBJUjE7XG4gICAgaWYgKHRoaXMuaWR1bSA8IDApIHRoaXMuaWR1bSArPSBJTTE7XG4gICAgayA9IE1hdGguZmxvb3IodGhpcy5pZHVtMiAvIElRMik7XG4gICAgdGhpcy5pZHVtMiA9IElBMiAqICh0aGlzLmlkdW0yIC0gayAqIElRMikgLSBrICogSVIyO1xuICAgIGlmICh0aGlzLmlkdW0yIDwgMCkgdGhpcy5pZHVtMiArPSBJTTI7XG4gICAgY29uc3QgaiA9IE1hdGguZmxvb3IodGhpcy5peSAvIE5ESVYpO1xuICAgIHRoaXMuaXkgPSB0aGlzLml2W2pdIC0gdGhpcy5pZHVtMjtcbiAgICB0aGlzLml2W2pdID0gdGhpcy5pZHVtO1xuICAgIGlmICh0aGlzLml5IDwgMSkgdGhpcy5peSArPSBJTU0xO1xuICAgIHJldHVybiBNYXRoLm1pbihBTSAqIHRoaXMuaXksIFJOTVgpO1xuICB9XG5cbiAgbmV4dEludChuOiBudW1iZXIpOiBudW1iZXIge1xuICAgIHJldHVybiBNYXRoLmZsb29yKHRoaXMubmV4dCgpICogbik7XG4gIH1cblxuICBuZXh0Tm9ybWFsKG1lYW46IG51bWJlciA9IDAsXG4gICAgICAgICAgICAgc3RkZXY6IG51bWJlciA9IDEsXG4gICAgICAgICAgICAgbWluOiBudW1iZXIgPSAtSW5maW5pdHksXG4gICAgICAgICAgICAgbWF4OiBudW1iZXIgPSBJbmZpbml0eSkge1xuICAgIHdoaWxlICh0cnVlKSB7XG4gICAgICBsZXQgeiA9IHRoaXMuejE7XG4gICAgICBpZiAoeiA9PSBudWxsKSB7XG4gICAgICAgIGNvbnN0IHIgPSBNYXRoLnNxcnQoLTIgKiBNYXRoLmxvZyh0aGlzLm5leHQoKSkpO1xuICAgICAgICBjb25zdCB0aGV0YSA9IFRXT1BJICogdGhpcy5uZXh0KCk7XG4gICAgICAgIHogPSByICogTWF0aC5jb3ModGhldGEpO1xuICAgICAgICB0aGlzLnoxID0gciAqIE1hdGguc2luKHRoZXRhKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHRoaXMuejEgPSBudWxsO1xuICAgICAgfVxuICAgICAgeiA9IG1lYW4gKyB6ICogc3RkZXY7XG4gICAgICBpZiAoeiA+PSBtaW4gJiYgeiA8PSBtYXgpIHJldHVybiB6O1xuICAgIH1cbiAgfVxuXG4gIHNodWZmbGU8VCBleHRlbmRzIE11dGFibGVBcnJheUxpa2U8dW5rbm93bj4+KGFycmF5OiBUKTogVCB7XG4gICAgZm9yIChsZXQgaSA9IGFycmF5Lmxlbmd0aDsgaTspIHtcbiAgICAgIGNvbnN0IGogPSB0aGlzLm5leHRJbnQoaS0tKTtcbiAgICAgIFthcnJheVtpXSwgYXJyYXlbal1dID0gW2FycmF5W2pdLCBhcnJheVtpXV07XG4gICAgfVxuICAgIHJldHVybiBhcnJheTtcbiAgfVxuXG4gIC8qKiBEb2VzIG5vdCBkZXN0cm95IHRoZSBpbnB1dCBpdGVyYWJsZS4gKi9cbiAgKiBpc2h1ZmZsZTxUPihpdGVyYWJsZTogSXRlcmFibGU8VD4pOiBJdGVyYWJsZUl0ZXJhdG9yPFQ+IHtcbiAgICBjb25zdCBhcnI6IFRbXSA9IFtdO1xuICAgIGlmICghQXJyYXkuaXNBcnJheShpdGVyYWJsZSkpIHtcbiAgICAgIGlmIChoYXNTaXplKGl0ZXJhYmxlKSkge1xuICAgICAgICBjb25zdCBpdGVyID0gaXRlcmFibGVbU3ltYm9sLml0ZXJhdG9yXSgpO1xuICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGl0ZXJhYmxlLnNpemU7IGkrKykge1xuICAgICAgICAgIGNvbnN0IGogPSBpICsgdGhpcy5uZXh0SW50KGl0ZXJhYmxlLnNpemUgLSBpKTtcbiAgICAgICAgICB3aGlsZSAoYXJyLmxlbmd0aCA8PSBqKSB7XG4gICAgICAgICAgICBhcnIucHVzaChpdGVyLm5leHQoKS52YWx1ZSk7XG4gICAgICAgICAgfVxuICAgICAgICAgIHlpZWxkIGFycltqXTtcbiAgICAgICAgICBhcnJbal0gPSBhcnJbaV07XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuOyAvLyBUT0RPIC0gd2h5IHdhcyB0aGlzIG5vdCByZXF1aXJlZD9cbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGl0ZXJhYmxlID0gWy4uLml0ZXJhYmxlXTtcbiAgICAgIH1cbiAgICB9XG4gICAgaWYgKCFBcnJheS5pc0FycmF5KGl0ZXJhYmxlKSkgdGhyb3cgbmV3IEVycm9yKCdpbXBvc3NpYmxlJyk7XG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPCBpdGVyYWJsZS5sZW5ndGg7IGkrKykge1xuICAgICAgY29uc3QgaiA9IGkgKyB0aGlzLm5leHRJbnQoaXRlcmFibGUubGVuZ3RoIC0gaSk7XG4gICAgICB5aWVsZCBqIGluIGFyciA/IGFycltqXSA6IGl0ZXJhYmxlW2pdO1xuICAgICAgYXJyW2pdID0gaSBpbiBhcnIgPyBhcnJbaV0gOiBpdGVyYWJsZVtpXTtcbiAgICB9XG4gIH1cblxuICBwaWNrPFQ+KGFycjogcmVhZG9ubHkgVFtdKTogVCB7XG4gICAgaWYgKCFhcnIubGVuZ3RoKSB0aHJvdyBuZXcgRXJyb3IoJ2VtcHR5IGFycmF5Jyk7XG4gICAgcmV0dXJuIGFyclt0aGlzLm5leHRJbnQoYXJyLmxlbmd0aCldO1xuICB9XG5cbiAgcGlja1dlaWdodGVkPFQ+KGFycjogUmVhZG9ubHlBcnJheTxyZWFkb25seSBbbnVtYmVyLCBUXT4pOiBUIHtcbiAgICBpZiAoIWFyci5sZW5ndGgpIHRocm93IG5ldyBFcnJvcignZW1wdHkgYXJyYXknKTtcbiAgICBsZXQgdG90YWwgPSAwO1xuICAgIGZvciAoY29uc3QgW3dlaWdodF0gb2YgYXJyKSB0b3RhbCArPSB3ZWlnaHQ7XG4gICAgbGV0IGNob2ljZSA9IHRoaXMubmV4dCgpICogdG90YWw7XG4gICAgZm9yIChjb25zdCBbd2VpZ2h0LCBlbGVtXSBvZiBhcnIpIHtcbiAgICAgIGlmIChjaG9pY2UgPCB3ZWlnaHQpIHJldHVybiBlbGVtO1xuICAgICAgY2hvaWNlIC09IHdlaWdodDtcbiAgICB9XG4gICAgdGhyb3cgbmV3IEVycm9yKCdiYWQgd2VpZ2h0cycpO1xuICB9XG5cbiAgcGlja0FuZFJlbW92ZTxUPiguLi5hcnJzOiBUW11bXSk6IFQge1xuICAgIGxldCBjb3VudCA9IDA7XG4gICAgZm9yIChjb25zdCBhcnIgb2YgYXJycykge1xuICAgICAgY291bnQgKz0gYXJyLmxlbmd0aDtcbiAgICB9XG4gICAgaWYgKCFjb3VudCkgdGhyb3cgbmV3IEVycm9yKCdlbXB0eSBhcnJheXMnKTtcbiAgICBsZXQgaSA9IHRoaXMubmV4dEludChjb3VudCk7XG4gICAgZm9yIChjb25zdCBhcnIgb2YgYXJycykge1xuICAgICAgaWYgKGkgPCBhcnIubGVuZ3RoKSByZXR1cm4gYXJyLnNwbGljZShpLCAxKVswXTtcbiAgICAgIGkgLT0gYXJyLmxlbmd0aDtcbiAgICB9XG4gICAgdGhyb3cgbmV3IEVycm9yKCdpbXBvc3NpYmxlJyk7XG4gIH1cblxuICBiaXRHZW5lcmF0b3IoKTogKCkgPT4gYm9vbGVhbiB7XG4gICAgbGV0IGJpdHMgPSAwO1xuICAgIGxldCBuZXh0ID0gMDtcbiAgICByZXR1cm4gKCkgPT4ge1xuICAgICAgaWYgKCFiaXRzKSB7XG4gICAgICAgIGJpdHMgPSAzMjtcbiAgICAgICAgbmV4dCA9IHRoaXMubmV4dEludCgweDEwMDAwMDAwMCk7XG4gICAgICB9XG4gICAgICBiaXRzLS07XG4gICAgICBjb25zdCByZXN1bHQgPSAhKG5leHQgJiAxKTtcbiAgICAgIG5leHQgPj4+PSAxXG4gICAgICByZXR1cm4gcmVzdWx0O1xuICAgIH07XG4gIH1cbn1cblxuaW50ZXJmYWNlIEhhc1NpemU8VD4gZXh0ZW5kcyBJdGVyYWJsZTxUPiB7XG4gIHJlYWRvbmx5IHNpemU6IG51bWJlcjtcbn1cbmZ1bmN0aW9uIGhhc1NpemU8VD4oaXRlcjogSXRlcmFibGU8VD4pOiBpdGVyIGlzIEhhc1NpemU8VD4ge1xuICByZXR1cm4gJ3NpemUnIGluIGl0ZXI7XG59XG5cbmNvbnN0IFRXT1BJID0gMiAqIE1hdGguUEk7XG5cbmludGVyZmFjZSBNdXRhYmxlQXJyYXlMaWtlPFQ+IHtcbiAgbGVuZ3RoOiBudW1iZXI7XG4gIFtpbmRleDogbnVtYmVyXTogVDtcbn1cblxuLy8gLy8gUHJvdmlkZSBhIHN0YXRpYyBzaW5nbGV0b24gaW5zdGFuY2UuXG4vLyBsZXQgcmFuZG9tID0gKCgpID0+IHtcbi8vICAgbGV0IHNlZWQgPSAwO1xuLy8gICBpZiAod2luZG93ICYmIHdpbmRvdy5sb2NhdGlvbiAmJiB3aW5kb3cubG9jYXRpb24uaGFzaCkge1xuLy8gICAgIGZvciAoY29uc3QgY29tcG9uZW50IG9mIHdpbmRvdy5sb2NhdGlvbi5oYXNoLnN1YnN0cmluZygxKS5zcGxpdCgnJicpKSB7XG4vLyAgICAgICBjb25zdCBzcGxpdCA9IGNvbXBvbmVudC5zcGxpdCgnPScpO1xuLy8gICAgICAgaWYgKHNwbGl0WzBdID09PSAnc2VlZCcpIHtcbi8vICAgICAgICAgc2VlZCA9IE51bWJlcihzcGxpdFsxXSkgfHwgMDtcbi8vICAgICAgIH1cbi8vICAgICB9XG4vLyAgIH1cbi8vICAgaWYgKCFzZWVkKSB7XG4vLyAgICAgc2VlZCA9IE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIDB4MTAwMDAwMDAwKTtcbi8vICAgfVxuLy8gICByZXR1cm4gbmV3IFJhbmRvbShzZWVkKTtcbi8vIH0pKCk7XG4vLyBSYW5kb20ubmV4dEludCA9IChuKSA9PiByYW5kb20ubmV4dEludChuKTtcbi8vIFJhbmRvbS5uZXh0ID0gKCkgPT4gcmFuZG9tLm5leHQoKTtcbi8vIFJhbmRvbS5zZWVkID0gKHMpID0+IHJhbmRvbS5zZWVkKHMpO1xuIl19