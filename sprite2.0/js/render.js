import { CharacterSet, generateThumbnailImage } from './characters.js';
import { FlagSection, Preset } from './flagset.js';
export function renderPresets(presets) {
    let first = true;
    for (const { name, flagString, description } of Preset.all()) {
        const h2 = document.createElement('h2');
        h2.textContent = name;
        presets.appendChild(h2);
        const p = document.createElement('p');
        p.innerHTML = description;
        presets.appendChild(p);
        const apply = document.createElement('a');
        apply.textContent = flagString;
        apply.classList.add('button');
        apply.classList.add('preset-flags');
        apply.dataset['flags'] = flagString;
        if (flagString.length > 48)
            apply.classList.add('small');
        if (first)
            apply.dataset['defaultPreset'] = 'true';
        first = false;
        presets.appendChild(apply);
    }
}
export function renderOptions(options) {
    for (const { name, description, flags } of FlagSection.all()) {
        const h2 = document.createElement('h2');
        h2.textContent = name;
        options.appendChild(h2);
        if (description) {
            const p = document.createElement('p');
            p.innerHTML = description;
            options.appendChild(p);
        }
        const div = document.createElement('div');
        div.classList.add('flag-list');
        options.appendChild(div);
        for (const flagObj of flags.values()) {
            const { flag, opts: { hard, name, text } } = flagObj;
            const flagDiv = document.createElement('div');
            flagDiv.textContent = `${flag}: ${name}`;
            flagDiv.classList.add('checkbox');
            if (hard)
                flagDiv.classList.add('hard');
            if (text) {
                const textDiv = document.createElement('div');
                textDiv.classList.add('flag-body');
                textDiv.innerHTML = text;
                flagDiv.appendChild(textDiv);
            }
            div.appendChild(flagDiv);
        }
    }
}
export async function renderDefaultCharacters(options) {
    const simeaReplacements = CharacterSet.get("simea");
    for (const sprite of simeaReplacements.values()) {
        const container = document.createElement('div');
        renderCustomCharacter(container, await sprite);
        options.appendChild(container);
    }
}
export function renderCustomCharacter(container, sprite) {
    container.className = "flex-row";
    container.style.width = '100%';
    const input = document.createElement('input');
    input.type = 'radio';
    input.name = 'simea-replacement';
    input.id = `simea-replacement-${sprite.name}`;
    input.value = sprite.name;
    input.style.display = 'none';
    if (sprite.name == "Simea") {
        input.checked = true;
    }
    container.appendChild(input);
    const label = document.createElement('label');
    label.className = "sprite-replacement";
    label.htmlFor = `simea-replacement-${sprite.name}`;
    const img = document.createElement('img');
    img.width = 112;
    img.height = 98;
    img.style.float = "left";
    generateThumbnailImage(sprite.nssdata).then(src => img.src = src);
    label.appendChild(img);
    const title = document.createElement('div');
    title.textContent = sprite.name;
    title.className = "title";
    label.appendChild(title);
    if (sprite.description) {
        const desc = document.createElement('div');
        desc.innerHTML = sprite.description;
        desc.className = "desc";
        label.appendChild(desc);
    }
    container.appendChild(label);
}
export function renderRaceFlags(options, flagset) {
    for (const { name, description, flags } of FlagSection.all()) {
        let any = false;
        const h2 = document.createElement('h2');
        h2.textContent = name;
        const p = description ? document.createElement('p') : null;
        if (p)
            p.innerHTML = description;
        const div = document.createElement('div');
        div.classList.add('flag-list');
        for (const flagObj of flags.values()) {
            const { flag, opts: { hard, name, text } } = flagObj;
            if (!flagset.check(flagObj))
                continue;
            any = true;
            const flagDiv = document.createElement('div');
            flagDiv.textContent = `${flag}: ${name}`;
            flagDiv.classList.add('checkbox');
            if (hard)
                flagDiv.classList.add('hard');
            if (text) {
                const textDiv = document.createElement('div');
                textDiv.classList.add('flag-body');
                textDiv.innerHTML = text;
                flagDiv.appendChild(textDiv);
            }
            div.appendChild(flagDiv);
        }
        if (any) {
            options.appendChild(h2);
            if (p)
                options.appendChild(p);
            options.appendChild(div);
        }
    }
}
;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicmVuZGVyLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vc3JjL2pzL3JlbmRlci50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFFQSxPQUFPLEVBQUUsWUFBWSxFQUFVLHNCQUFzQixFQUFFLE1BQU0saUJBQWlCLENBQUM7QUFDL0UsT0FBTyxFQUFDLFdBQVcsRUFBVyxNQUFNLEVBQUMsTUFBTSxjQUFjLENBQUM7QUFFMUQsTUFBTSxVQUFVLGFBQWEsQ0FBQyxPQUFvQjtJQUNoRCxJQUFJLEtBQUssR0FBRyxJQUFJLENBQUM7SUFDakIsS0FBSyxNQUFNLEVBQUMsSUFBSSxFQUFFLFVBQVUsRUFBRSxXQUFXLEVBQUMsSUFBSSxNQUFNLENBQUMsR0FBRyxFQUFFLEVBQUU7UUFDMUQsTUFBTSxFQUFFLEdBQUcsUUFBUSxDQUFDLGFBQWEsQ0FBQyxJQUFJLENBQUMsQ0FBQztRQUN4QyxFQUFFLENBQUMsV0FBVyxHQUFHLElBQUksQ0FBQztRQUN0QixPQUFPLENBQUMsV0FBVyxDQUFDLEVBQUUsQ0FBQyxDQUFDO1FBQ3hCLE1BQU0sQ0FBQyxHQUFHLFFBQVEsQ0FBQyxhQUFhLENBQUMsR0FBRyxDQUFDLENBQUM7UUFDdEMsQ0FBQyxDQUFDLFNBQVMsR0FBRyxXQUFXLENBQUM7UUFDMUIsT0FBTyxDQUFDLFdBQVcsQ0FBQyxDQUFDLENBQUMsQ0FBQztRQVF2QixNQUFNLEtBQUssR0FBRyxRQUFRLENBQUMsYUFBYSxDQUFDLEdBQUcsQ0FBQyxDQUFDO1FBQzFDLEtBQUssQ0FBQyxXQUFXLEdBQUcsVUFBVSxDQUFDO1FBQy9CLEtBQUssQ0FBQyxTQUFTLENBQUMsR0FBRyxDQUFDLFFBQVEsQ0FBQyxDQUFDO1FBQzlCLEtBQUssQ0FBQyxTQUFTLENBQUMsR0FBRyxDQUFDLGNBQWMsQ0FBQyxDQUFDO1FBQ3BDLEtBQUssQ0FBQyxPQUFPLENBQUMsT0FBTyxDQUFDLEdBQUcsVUFBVSxDQUFDO1FBQ3BDLElBQUksVUFBVSxDQUFDLE1BQU0sR0FBRyxF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LE9BQU8sQ0FBQyxXQUFXLENBQUMsR0FBRyxDQUFDLENBQUM7U0FDMUI7S0FDRjtBQUNILENBQUM7QUFBQSxDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiLy8gVXRpbGl0aWVzIGZvciByZW5kZXJpbmcgZmxhZ3MuXG5cbmltcG9ydCB7IENoYXJhY3RlclNldCwgU3ByaXRlLCBnZW5lcmF0ZVRodW1ibmFpbEltYWdlIH0gZnJvbSAnLi9jaGFyYWN0ZXJzLmpzJztcbmltcG9ydCB7RmxhZ1NlY3Rpb24sIEZsYWdTZXQsIFByZXNldH0gZnJvbSAnLi9mbGFnc2V0LmpzJztcblxuZXhwb3J0IGZ1bmN0aW9uIHJlbmRlclByZXNldHMocHJlc2V0czogSFRNTEVsZW1lbnQpIHtcbiAgbGV0IGZpcnN0ID0gdHJ1ZTtcbiAgZm9yIChjb25zdCB7bmFtZSwgZmxhZ1N0cmluZywgZGVzY3JpcHRpb259IG9mIFByZXNldC5hbGwoKSkge1xuICAgIGNvbnN0IGgyID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnaDInKTtcbiAgICBoMi50ZXh0Q29udGVudCA9IG5hbWU7XG4gICAgcHJlc2V0cy5hcHBlbmRDaGlsZChoMik7XG4gICAgY29uc3QgcCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3AnKTtcbiAgICBwLmlubmVySFRNTCA9IGRlc2NyaXB0aW9uOyAvLyBOT1RFOiBtYWlubHkgZm9yIGl0YWxpY3MgYW5kIGJvbGRcbiAgICBwcmVzZXRzLmFwcGVuZENoaWxkKHApO1xuICAgIC8vY29uc3QgZGl2ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XG4gICAgLy9kaXYuY2xhc3NMaXN0LmFkZCgnZmxleC1yb3cnKTtcbiAgICAvL3ByZXNldHMuYXBwZW5kQ2hpbGQoZGl2KTtcbiAgICAvL2NvbnN0IGZsYWdEaXYgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcbiAgICAvL2ZsYWdEaXYudGV4dENvbnRlbnQgPSBmbGFncztcbiAgICAvL2ZsYWdEaXYuY2xhc3NMaXN0LmFkZCgncHJlc2V0LWZsYWdzJyk7XG4gICAgLy9kaXYuYXBwZW5kQ2hpbGQoZmxhZ0Rpdik7XG4gICAgY29uc3QgYXBwbHkgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdhJyk7XG4gICAgYXBwbHkudGV4dENvbnRlbnQgPSBmbGFnU3RyaW5nOyAvLydBcHBseSc7XG4gICAgYXBwbHkuY2xhc3NMaXN0LmFkZCgnYnV0dG9uJyk7XG4gICAgYXBwbHkuY2xhc3NMaXN0LmFkZCgncHJlc2V0LWZsYWdzJyk7XG4gICAgYXBwbHkuZGF0YXNldFsnZmxhZ3MnXSA9IGZsYWdTdHJpbmc7XG4gICAgaWYgKGZsYWdTdHJpbmcubGVuZ3RoID4gNDgpIGFwcGx5LmNsYXNzTGlzdC5hZGQoJ3NtYWxsJyk7XG4gICAgaWYgKGZpcnN0KSBhcHBseS5kYXRhc2V0WydkZWZhdWx0UHJlc2V0J10gPSAndHJ1ZSc7XG4gICAgZmlyc3QgPSBmYWxzZTtcbiAgICBwcmVzZXRzLmFwcGVuZENoaWxkKGFwcGx5KTtcbiAgfVxufVxuXG5leHBvcnQgZnVuY3Rpb24gcmVuZGVyT3B0aW9ucyhvcHRpb25zOiBIVE1MRWxlbWVudCkge1xuICBmb3IgKGNvbnN0IHtuYW1lLCBkZXNjcmlwdGlvbiwgZmxhZ3N9IG9mIEZsYWdTZWN0aW9uLmFsbCgpKSB7XG4gICAgY29uc3QgaDIgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdoMicpO1xuICAgIGgyLnRleHRDb250ZW50ID0gbmFtZTtcblxuICAgIG9wdGlvbnMuYXBwZW5kQ2hpbGQoaDIpO1xuICAgIGlmIChkZXNjcmlwdGlvbikge1xuICAgICAgY29uc3QgcCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3AnKTtcbiAgICAgIHAuaW5uZXJIVE1MID0gZGVzY3JpcHRpb247IC8vIE5PVEU6IG1haW5seSBmb3IgaXRhbGljcyBhbmQgYm9sZFxuICAgICAgb3B0aW9ucy5hcHBlbmRDaGlsZChwKTtcbiAgICB9XG4gICAgY29uc3QgZGl2ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XG4gICAgZGl2LmNsYXNzTGlzdC5hZGQoJ2ZsYWctbGlzdCcpO1xuICAgIG9wdGlvbnMuYXBwZW5kQ2hpbGQoZGl2KTtcbiAgICBmb3IgKGNvbnN0IGZsYWdPYmogb2YgZmxhZ3MudmFsdWVzKCkpIHtcbiAgICAgIGNvbnN0IHtmbGFnLCBvcHRzOiB7aGFyZCwgbmFtZSwgdGV4dH19ID0gZmxhZ09iajtcbiAgICAgIGNvbnN0IGZsYWdEaXYgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcbiAgICAgIGZsYWdEaXYudGV4dENvbnRlbnQgPSBgJHtmbGFnfTogJHtuYW1lfWA7XG4gICAgICBmbGFnRGl2LmNsYXNzTGlzdC5hZGQoJ2NoZWNrYm94Jyk7XG4gICAgICBpZiAoaGFyZCkgZmxhZ0Rpdi5jbGFzc0xpc3QuYWRkKCdoYXJkJyk7XG4gICAgICBpZiAodGV4dCkge1xuICAgICAgICBjb25zdCB0ZXh0RGl2ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XG4gICAgICAgIHRleHREaXYuY2xhc3NMaXN0LmFkZCgnZmxhZy1ib2R5Jyk7XG4gICAgICAgIHRleHREaXYuaW5uZXJIVE1MID0gdGV4dDtcbiAgICAgICAgZmxhZ0Rpdi5hcHBlbmRDaGlsZCh0ZXh0RGl2KTtcbiAgICAgIH1cbiAgICAgIGRpdi5hcHBlbmRDaGlsZChmbGFnRGl2KTtcbiAgICB9XG4gIH1cbn1cblxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIHJlbmRlckRlZmF1bHRDaGFyYWN0ZXJzKG9wdGlvbnM6IEhUTUxFbGVtZW50KSB7XG4gIC8vIERpc3BsYXkgYWxsIHNpbWVhIHJlcGxhY2VtZW50cyB0aGF0IGFyZSBidWlsdC1pbiB0byB0aGUgcmFuZG9cbiAgY29uc3Qgc2ltZWFSZXBsYWNlbWVudHMgPSBDaGFyYWN0ZXJTZXQuZ2V0KFwic2ltZWFcIik7XG4gIGZvciAoY29uc3Qgc3ByaXRlIG9mIHNpbWVhUmVwbGFjZW1lbnRzLnZhbHVlcygpKSB7XG4gICAgY29uc3QgY29udGFpbmVyID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XG4gICAgcmVuZGVyQ3VzdG9tQ2hhcmFjdGVyKGNvbnRhaW5lciwgYXdhaXQgc3ByaXRlKTtcbiAgICBvcHRpb25zLmFwcGVuZENoaWxkKGNvbnRhaW5lcik7XG4gIH1cbn1cblxuZXhwb3J0IGZ1bmN0aW9uIHJlbmRlckN1c3RvbUNoYXJhY3Rlcihjb250YWluZXI6IEhUTUxFbGVtZW50LCBzcHJpdGU6IFNwcml0ZSkge1xuICBjb250YWluZXIuY2xhc3NOYW1lID0gXCJmbGV4LXJvd1wiO1xuICBjb250YWluZXIuc3R5bGUud2lkdGggPSAnMTAwJSc7XG4gIGNvbnN0IGlucHV0ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnaW5wdXQnKTtcbiAgaW5wdXQudHlwZSA9ICdyYWRpbyc7XG4gIGlucHV0Lm5hbWUgPSAnc2ltZWEtcmVwbGFjZW1lbnQnXG4gIGlucHV0LmlkID0gYHNpbWVhLXJlcGxhY2VtZW50LSR7c3ByaXRlLm5hbWV9YDtcbiAgaW5wdXQudmFsdWUgPSBzcHJpdGUubmFtZTtcbiAgaW5wdXQuc3R5bGUuZGlzcGxheSA9ICdub25lJztcbiAgLy8gU2VsZWN0IHRoZSBtZXNpYSBzcHJpdGUgYnkgZGVmYXVsdC4gTGF0ZXIgd2hlbiBsb2FkaW5nIHRoZSB2YWx1ZXMgZnJvbSBsb2NhbHN0b3JhZ2UsXG4gIC8vIHdlIHdpbGwgY2hvb3NlIHRoZSBwcmV2aW91cyBzcHJpdGUgb3B0aW9uXG4gIGlmIChzcHJpdGUubmFtZSA9PSBcIlNpbWVhXCIpIHtcbiAgICBpbnB1dC5jaGVja2VkID0gdHJ1ZTtcbiAgfVxuICBjb250YWluZXIuYXBwZW5kQ2hpbGQoaW5wdXQpO1xuICBjb25zdCBsYWJlbCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2xhYmVsJyk7XG4gIGxhYmVsLmNsYXNzTmFtZSA9IFwic3ByaXRlLXJlcGxhY2VtZW50XCI7XG4gIGxhYmVsLmh0bWxGb3IgPSBgc2ltZWEtcmVwbGFjZW1lbnQtJHtzcHJpdGUubmFtZX1gO1xuICBjb25zdCBpbWcgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdpbWcnKTtcbiAgaW1nLndpZHRoID0gMTEyO1xuICBpbWcuaGVpZ2h0ID0gOTg7XG4gIGltZy5zdHlsZS5mbG9hdCA9IFwibGVmdFwiO1xuICBnZW5lcmF0ZVRodW1ibmFpbEltYWdlKHNwcml0ZS5uc3NkYXRhKS50aGVuKHNyYyA9PiBpbWcuc3JjID0gc3JjKTtcbiAgbGFiZWwuYXBwZW5kQ2hpbGQoaW1nKTtcblxuICBjb25zdCB0aXRsZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xuICB0aXRsZS50ZXh0Q29udGVudCA9IHNwcml0ZS5uYW1lO1xuICB0aXRsZS5jbGFzc05hbWUgPSBcInRpdGxlXCI7XG4gIGxhYmVsLmFwcGVuZENoaWxkKHRpdGxlKTtcblxuICBpZiAoc3ByaXRlLmRlc2NyaXB0aW9uKSB7XG4gICAgY29uc3QgZGVzYyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xuICAgIGRlc2MuaW5uZXJIVE1MID0gc3ByaXRlLmRlc2NyaXB0aW9uOyAvLyBOT1RFOiBtYWlubHkgZm9yIGl0YWxpY3MgYW5kIGJvbGRcbiAgICBkZXNjLmNsYXNzTmFtZSA9IFwiZGVzY1wiO1xuICAgIGxhYmVsLmFwcGVuZENoaWxkKGRlc2MpO1xuICB9XG4gIGNvbnRhaW5lci5hcHBlbmRDaGlsZChsYWJlbCk7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiByZW5kZXJSYWNlRmxhZ3Mob3B0aW9uczogSFRNTEVsZW1lbnQsIGZsYWdzZXQ6IEZsYWdTZXQpIHtcbiAgZm9yIChjb25zdCB7bmFtZSwgZGVzY3JpcHRpb24sIGZsYWdzfSBvZiBGbGFnU2VjdGlvbi5hbGwoKSkge1xuICAgIGxldCBhbnkgPSBmYWxzZTtcbiAgICBjb25zdCBoMiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2gyJyk7XG4gICAgaDIudGV4dENvbnRlbnQgPSBuYW1lO1xuICAgIGNvbnN0IHAgPSBkZXNjcmlwdGlvbiA/IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3AnKSA6IG51bGw7XG4gICAgaWYgKHApIHAuaW5uZXJIVE1MID0gZGVzY3JpcHRpb24hOyAvLyBOT1RFOiBtYWlubHkgZm9yIGl0YWxpY3MgYW5kIGJvbGRcbiAgICBjb25zdCBkaXYgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcbiAgICBkaXYuY2xhc3NMaXN0LmFkZCgnZmxhZy1saXN0Jyk7XG4gICAgZm9yIChjb25zdCBmbGFnT2JqIG9mIGZsYWdzLnZhbHVlcygpKSB7XG4gICAgICBjb25zdCB7ZmxhZywgb3B0czoge2hhcmQsIG5hbWUsIHRleHR9fSA9IGZsYWdPYmo7XG4gICAgICBpZiAoIWZsYWdzZXQuY2hlY2soZmxhZ09iaikpIGNvbnRpbnVlO1xuICAgICAgYW55ID0gdHJ1ZTtcbiAgICAgIGNvbnN0IGZsYWdEaXYgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcbiAgICAgIGZsYWdEaXYudGV4dENvbnRlbnQgPSBgJHtmbGFnfTogJHtuYW1lfWA7XG4gICAgICBmbGFnRGl2LmNsYXNzTGlzdC5hZGQoJ2NoZWNrYm94Jyk7XG4gICAgICBpZiAoaGFyZCkgZmxhZ0Rpdi5jbGFzc0xpc3QuYWRkKCdoYXJkJyk7XG4gICAgICBpZiAodGV4dCkge1xuICAgICAgICBjb25zdCB0ZXh0RGl2ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XG4gICAgICAgIHRleHREaXYuY2xhc3NMaXN0LmFkZCgnZmxhZy1ib2R5Jyk7XG4gICAgICAgIHRleHREaXYuaW5uZXJIVE1MID0gdGV4dDtcbiAgICAgICAgZmxhZ0Rpdi5hcHBlbmRDaGlsZCh0ZXh0RGl2KTtcbiAgICAgIH1cbiAgICAgIGRpdi5hcHBlbmRDaGlsZChmbGFnRGl2KTtcbiAgICB9XG4gICAgaWYgKGFueSkge1xuICAgICAgb3B0aW9ucy5hcHBlbmRDaGlsZChoMik7XG4gICAgICBpZiAocCkgb3B0aW9ucy5hcHBlbmRDaGlsZChwKTtcbiAgICAgIG9wdGlvbnMuYXBwZW5kQ2hpbGQoZGl2KTtcbiAgICB9XG4gIH1cbn07XG4iXX0=