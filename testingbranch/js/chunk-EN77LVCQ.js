var p=class{constructor(e,i,s){this.rom=e,this.width=i,this.height=s,this.element=document.createElement("canvas"),this.element.width=i,this.element.height=s,this.ctx=this.element.getContext("2d"),this.minX=this.minY=1/0,this.maxX=this.maxY=-1/0,this.data=new Uint32Array(i*s),this.palettes=new Uint32Array(1024),this.patternCoverage=new Uint8Array(16384);for(let x=0;x<256;x++)for(let t=0;t<4;t++){let n=C[this.rom.palettes[x].color(t)];this.palettes[x<<2|t]=n|4278190080}}clear(e=null){this.minX=this.minY=1/0,this.maxX=this.maxY=-1/0;let i=e!=null?this.palettes[e<<2]:0;this.data.fill(i)}toDataUrl(e=!1){return this.element.toDataURL("image/png")}render(){let e=this.ctx.getImageData(0,0,this.width,this.height),i=new Uint8Array(this.data.buffer);e.data.set(i),this.ctx.putImageData(e,0,0)}tile(e,i,s,x){let t=this.rom.patterns.get(s).flip(x<<6);for(let n=0;n<8;n++){let h=t.pixels[8|n]<<1,F=t.pixels[n];for(let l=7;l>=0;l--){let a=h&2|F&1;h>>>=1,F>>>=1,a&&(this.data[(i+n)*this.width+e+l]=this.palettes[x&1020|a])}}this.minX=Math.min(this.minX,e),this.maxX=Math.max(this.maxX,e+8),this.minY=Math.min(this.minY,i),this.maxY=Math.max(this.maxY,i+8)}metatile(e,i,s,x){let t=this.rom.locations[x],n=t.tilePatterns,h=[...t.tilePalettes,127],F=rom.tilesets[t.tileset],l=h[F.attrs[s]],a=t.animation;for(let o=0;o<2;o++)for(let r=0;r<2;r++){let m=F.tiles[o<<1|r][s],f=n[m&128?1:0]<<6|m&127;if(a&&m&128)for(let c=0;c<this.rom.tileAnimations[a].pages.length;c++){let A=this.rom.tileAnimations[a].pages[c]<<6|m&127;this.patternCoverage[A]=1}else this.patternCoverage[f]=1;let B=e+(r<<3),D=i+(o<<3);this.tile(B,D,f,l<<2)}}text(e,i,s,x=18){for(let t=0;t<s.length;t++)this.tile(e+8*t,i,s.charCodeAt(t)|3840,x<<2)}},C=[5395026,11796480,10485760,11599933,7602281,91,95,6208,12048,543240,26368,1196544,7153664,0,0,0,12899815,16728064,14421538,16729963,14090399,6818519,6588,21681,27227,35843,43776,2918400,10777088,0,0,0,16316664,16755516,16742785,16735173,16730354,14633471,4681215,46327,57599,58229,259115,7911470,15065624,7895160,0,0,16777215,16773822,16300216,16300248,16758527,16761855,13095423,10148607,8973816,8650717,12122296,16119980,16777136,16308472,0,0];export{p as a};
